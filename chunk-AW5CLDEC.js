import{b as la,f as ca,i as da,m as ha,n as ua,o as ma,s as pa,t as fa,u as ga,v as _a}from"./chunk-OFZ5H43A.js";import{$ as Fe,$a as Rr,$b as Ti,Aa as Qt,Ab as jr,Ba as xe,C as ye,Ca as ce,Cb as Vr,Cc as ea,D as ft,Da as xt,Db as Gr,Dc as ia,E as ut,Ea as kt,Eb as Ci,Ec as sa,Fb as Ps,Fc as na,G as T,Gb as Ct,Gc as ra,H as gi,Ha as Ne,Hc as aa,I as Nt,Ia as ct,Ic as oa,J as Bt,Jb as Ur,Jc as Pi,K as _i,Ka as ke,Kb as $r,L as Ss,La as Tr,Lb as Wr,M as re,Ma as Mr,N as ae,Na as Pr,Nb as Xr,Oa as Ir,Ob as qr,P as Oe,Pa as de,Q as we,Qa as he,R as Tt,Ra as Ms,S as Kt,Sa as Be,Ua as ue,V as Cr,W as bi,Wb as Yr,X as H,Y as Ae,Yb as Kr,Z as Sr,Za as Lr,Zb as Si,_b as Ei,a as Y,ab as Ai,b as Yt,bb as Dr,cb as Or,da as Z,db as Zt,dc as Is,ea as gt,ec as Qr,f as ne,fa as zt,fc as Zr,g as C,ga as Ut,gc as je,h as Ar,ha as vi,hc as Ve,ia as lt,ic as Jr,j as Ft,jc as ta,k as xr,ka as at,kb as Fr,kc as Ls,la as st,lb as xi,lc as Se,ma as oe,n as kr,na as Mt,oa as yi,ob as ze,oc as Mi,p as ui,pb as Nr,qa as Es,qb as ki,r as mi,ra as R,rb as Ce,s as De,sa as O,sb as He,t as pi,ta as J,ua as wi,ub as Br,va as le,vb as zr,wa as Er,x as fi,xa as Ht,ya as At,za as Ts,zb as Hr}from"./chunk-6342OLEP.js";function uo(o,e){}var Jt=class{viewContainerRef;injector;id;role="dialog";panelClass="";hasBackdrop=!0;backdropClass="";disableClose=!1;width="";height="";minWidth;minHeight;maxWidth;maxHeight;positionStrategy;data=null;direction;ariaDescribedBy=null;ariaLabelledBy=null;ariaLabel=null;ariaModal=!0;autoFocus="first-tabbable";restoreFocus=!0;scrollStrategy;closeOnNavigation=!0;closeOnDestroy=!0;closeOnOverlayDetachments=!0;componentFactoryResolver;providers;container;templateContext};var Os=(()=>{class o extends Zr{_elementRef=T(Tt);_focusTrapFactory=T(jr);_config;_interactivityChecker=T(Hr);_ngZone=T(we);_overlayRef=T(Ls);_focusMonitor=T(Vr);_renderer=T(Fe);_platform=T(xi);_document=T(Lr,{optional:!0});_portalOutlet;_focusTrap=null;_elementFocusedBeforeDialogWasOpened=null;_closeInteractionType=null;_ariaLabelledByQueue=[];_changeDetectorRef=T(Be);_injector=T(ae);_isDestroyed=!1;constructor(){super(),this._config=T(Jt,{optional:!0})||new Jt,this._config.ariaLabelledBy&&this._ariaLabelledByQueue.push(this._config.ariaLabelledBy)}_addAriaLabelledBy(t){this._ariaLabelledByQueue.push(t),this._changeDetectorRef.markForCheck()}_removeAriaLabelledBy(t){let i=this._ariaLabelledByQueue.indexOf(t);i>-1&&(this._ariaLabelledByQueue.splice(i,1),this._changeDetectorRef.markForCheck())}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._isDestroyed=!0,this._restoreFocus()}attachComponentPortal(t){this._portalOutlet.hasAttached();let i=this._portalOutlet.attachComponentPortal(t);return this._contentAttached(),i}attachTemplatePortal(t){this._portalOutlet.hasAttached();let i=this._portalOutlet.attachTemplatePortal(t);return this._contentAttached(),i}attachDomPortal=t=>{this._portalOutlet.hasAttached();let i=this._portalOutlet.attachDomPortal(t);return this._contentAttached(),i};_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(t,i){this._interactivityChecker.isFocusable(t)||(t.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{let s=()=>{n(),r(),t.removeAttribute("tabindex")},n=this._renderer.listen(t,"blur",s),r=this._renderer.listen(t,"mousedown",s)})),t.focus(i)}_focusByCssSelector(t,i){let s=this._elementRef.nativeElement.querySelector(t);s&&this._forceFocus(s,i)}_trapFocus(){this._isDestroyed||Cr(()=>{let t=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||t.focus();break;case!0:case"first-tabbable":this._focusTrap?.focusInitialElement()||this._focusDialogContainer();break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus);break}},{injector:this._injector})}_restoreFocus(){let t=this._config.restoreFocus,i=null;if(typeof t=="string"?i=this._document.querySelector(t):typeof t=="boolean"?i=t?this._elementFocusedBeforeDialogWasOpened:null:t&&(i=t),this._config.restoreFocus&&i&&typeof i.focus=="function"){let s=ze(),n=this._elementRef.nativeElement;(!s||s===this._document.body||s===n||n.contains(s))&&(this._focusMonitor?(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null):i.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){let t=this._elementRef.nativeElement,i=ze();return t===i||t.contains(i)}_initializeFocusTrap(){this._platform.isBrowser&&(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=ze()))}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}static \u0275fac=function(i){return new(i||o)};static \u0275cmp=Z({type:o,selectors:[["cdk-dialog-container"]],viewQuery:function(i,s){if(i&1&&ce(je,7),i&2){let n;xt(n=kt())&&(s._portalOutlet=n.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(i,s){i&2&&at("id",s._config.id||null)("role",s._config.role)("aria-modal",s._config.ariaModal)("aria-labelledby",s._config.ariaLabel?null:s._ariaLabelledByQueue[0])("aria-label",s._config.ariaLabel)("aria-describedby",s._config.ariaDescribedBy||null)},features:[Ut],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(i,s){i&1&&lt(0,uo,0,0,"ng-template",0)},dependencies:[je],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2})}return o})(),Ge=class{overlayRef;config;componentInstance;componentRef;containerInstance;disableClose;closed=new Ft;backdropClick;keydownEvents;outsidePointerEvents;id;_detachSubscription;constructor(e,t){this.overlayRef=e,this.config=t,this.disableClose=t.disableClose,this.backdropClick=e.backdropClick(),this.keydownEvents=e.keydownEvents(),this.outsidePointerEvents=e.outsidePointerEvents(),this.id=t.id,this.keydownEvents.subscribe(i=>{i.keyCode===27&&!this.disableClose&&!ki(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})}),this._detachSubscription=e.detachments().subscribe(()=>{t.closeOnOverlayDetachments!==!1&&this.close()})}close(e,t){if(this.containerInstance){let i=this.closed;this.containerInstance._closeInteractionType=t?.focusOrigin||"program",this._detachSubscription.unsubscribe(),this.overlayRef.dispose(),i.next(e),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(e="",t=""){return this.overlayRef.updateSize({width:e,height:t}),this}addPanelClass(e){return this.overlayRef.addPanelClass(e),this}removePanelClass(e){return this.overlayRef.removePanelClass(e),this}},mo=new ut("DialogScrollStrategy",{providedIn:"root",factory:()=>{let o=T(Se);return()=>o.scrollStrategies.block()}}),po=new ut("DialogData"),fo=new ut("DefaultDialogConfig");var Fs=(()=>{class o{_overlay=T(Se);_injector=T(ae);_defaultOptions=T(fo,{optional:!0});_parentDialog=T(o,{optional:!0,skipSelf:!0});_overlayContainer=T(ta);_idGenerator=T(Ci);_openDialogsAtThisLevel=[];_afterAllClosedAtThisLevel=new Ft;_afterOpenedAtThisLevel=new Ft;_ariaHiddenElements=new Map;_scrollStrategy=T(mo);get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}afterAllClosed=ui(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(fi(void 0)));constructor(){}open(t,i){let s=this._defaultOptions||new Jt;i=Y(Y({},s),i),i.id=i.id||this._idGenerator.getId("cdk-dialog-"),i.id&&this.getDialogById(i.id);let n=this._getOverlayConfig(i),r=this._overlay.create(n),a=new Ge(r,i),l=this._attachContainer(r,a,i);return a.containerInstance=l,this._attachDialogContent(t,a,l,i),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(a),a.closed.subscribe(()=>this._removeOpenDialog(a,!0)),this.afterOpened.next(a),a}closeAll(){Rs(this.openDialogs,t=>t.close())}getDialogById(t){return this.openDialogs.find(i=>i.id===t)}ngOnDestroy(){Rs(this._openDialogsAtThisLevel,t=>{t.config.closeOnDestroy===!1&&this._removeOpenDialog(t,!1)}),Rs(this._openDialogsAtThisLevel,t=>t.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(t){let i=new Jr({positionStrategy:t.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:t.scrollStrategy||this._scrollStrategy(),panelClass:t.panelClass,hasBackdrop:t.hasBackdrop,direction:t.direction,minWidth:t.minWidth,minHeight:t.minHeight,maxWidth:t.maxWidth,maxHeight:t.maxHeight,width:t.width,height:t.height,disposeOnNavigation:t.closeOnNavigation});return t.backdropClass&&(i.backdropClass=t.backdropClass),i}_attachContainer(t,i,s){let n=s.injector||s.viewContainerRef?.injector,r=[{provide:Jt,useValue:s},{provide:Ge,useValue:i},{provide:Ls,useValue:t}],a;s.container?typeof s.container=="function"?a=s.container:(a=s.container.type,r.push(...s.container.providers(s))):a=Os;let l=new Is(a,s.viewContainerRef,ae.create({parent:n||this._injector,providers:r}));return t.attach(l).instance}_attachDialogContent(t,i,s,n){if(t instanceof Sr){let r=this._createInjector(n,i,s,void 0),a={$implicit:n.data,dialogRef:i};n.templateContext&&(a=Y(Y({},a),typeof n.templateContext=="function"?n.templateContext():n.templateContext)),s.attachTemplatePortal(new Qr(t,null,a,r))}else{let r=this._createInjector(n,i,s,this._injector),a=s.attachComponentPortal(new Is(t,n.viewContainerRef,r));i.componentRef=a,i.componentInstance=a.instance}}_createInjector(t,i,s,n){let r=t.injector||t.viewContainerRef?.injector,a=[{provide:po,useValue:t.data},{provide:Ge,useValue:i}];return t.providers&&(typeof t.providers=="function"?a.push(...t.providers(i,t,s)):a.push(...t.providers)),t.direction&&(!r||!r.get(Ps,null,{optional:!0}))&&a.push({provide:Ps,useValue:{value:t.direction,change:kr()}}),ae.create({parent:r||n,providers:a})}_removeOpenDialog(t,i){let s=this.openDialogs.indexOf(t);s>-1&&(this.openDialogs.splice(s,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((n,r)=>{n?r.setAttribute("aria-hidden",n):r.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),i&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){let t=this._overlayContainer.getContainerElement();if(t.parentElement){let i=t.parentElement.children;for(let s=i.length-1;s>-1;s--){let n=i[s];n!==t&&n.nodeName!=="SCRIPT"&&n.nodeName!=="STYLE"&&!n.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(n,n.getAttribute("aria-hidden")),n.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){let t=this._parentDialog;return t?t._getAfterAllClosed():this._afterAllClosedAtThisLevel}static \u0275fac=function(i){return new(i||o)};static \u0275prov=ye({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();function Rs(o,e){let t=o.length;for(;t--;)e(o[t])}var ba=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=gt({type:o});static \u0275inj=ft({providers:[Fs],imports:[Mi,Ve,Gr,Ve]})}return o})();function go(o,e){}var Li=class{viewContainerRef;injector;id;role="dialog";panelClass="";hasBackdrop=!0;backdropClass="";disableClose=!1;width="";height="";minWidth;minHeight;maxWidth;maxHeight;position;data=null;direction;ariaDescribedBy=null;ariaLabelledBy=null;ariaLabel=null;ariaModal=!0;autoFocus="first-tabbable";restoreFocus=!0;delayFocusTrap=!0;scrollStrategy;closeOnNavigation=!0;componentFactoryResolver;enterAnimationDuration;exitAnimationDuration},Ns="mdc-dialog--open",va="mdc-dialog--opening",ya="mdc-dialog--closing",_o=150,bo=75,vo=(()=>{class o extends Os{_animationMode=T(Kt,{optional:!0});_animationStateChanged=new Oe;_animationsEnabled=this._animationMode!=="NoopAnimations";_actionSectionCount=0;_hostElement=this._elementRef.nativeElement;_enterAnimationDuration=this._animationsEnabled?Aa(this._config.enterAnimationDuration)??_o:0;_exitAnimationDuration=this._animationsEnabled?Aa(this._config.exitAnimationDuration)??bo:0;_animationTimer=null;_contentAttached(){super._contentAttached(),this._startOpenAnimation()}_startOpenAnimation(){this._animationStateChanged.emit({state:"opening",totalTime:this._enterAnimationDuration}),this._animationsEnabled?(this._hostElement.style.setProperty(wa,`${this._enterAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(va,Ns)),this._waitForAnimationToComplete(this._enterAnimationDuration,this._finishDialogOpen)):(this._hostElement.classList.add(Ns),Promise.resolve().then(()=>this._finishDialogOpen()))}_startExitAnimation(){this._animationStateChanged.emit({state:"closing",totalTime:this._exitAnimationDuration}),this._hostElement.classList.remove(Ns),this._animationsEnabled?(this._hostElement.style.setProperty(wa,`${this._exitAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(ya)),this._waitForAnimationToComplete(this._exitAnimationDuration,this._finishDialogClose)):Promise.resolve().then(()=>this._finishDialogClose())}_updateActionSectionCount(t){this._actionSectionCount+=t,this._changeDetectorRef.markForCheck()}_finishDialogOpen=()=>{this._clearAnimationClasses(),this._openAnimationDone(this._enterAnimationDuration)};_finishDialogClose=()=>{this._clearAnimationClasses(),this._animationStateChanged.emit({state:"closed",totalTime:this._exitAnimationDuration})};_clearAnimationClasses(){this._hostElement.classList.remove(va,ya)}_waitForAnimationToComplete(t,i){this._animationTimer!==null&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(i,t)}_requestAnimationFrame(t){this._ngZone.runOutsideAngular(()=>{typeof requestAnimationFrame=="function"?requestAnimationFrame(t):t()})}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_openAnimationDone(t){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:t})}ngOnDestroy(){super.ngOnDestroy(),this._animationTimer!==null&&clearTimeout(this._animationTimer)}attachComponentPortal(t){let i=super.attachComponentPortal(t);return i.location.nativeElement.classList.add("mat-mdc-dialog-component-host"),i}static \u0275fac=(()=>{let t;return function(s){return(t||(t=re(o)))(s||o)}})();static \u0275cmp=Z({type:o,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1",1,"mat-mdc-dialog-container","mdc-dialog"],hostVars:10,hostBindings:function(i,s){i&2&&(Er("id",s._config.id),at("aria-modal",s._config.ariaModal)("role",s._config.role)("aria-labelledby",s._config.ariaLabel?null:s._ariaLabelledByQueue[0])("aria-label",s._config.ariaLabel)("aria-describedby",s._config.ariaDescribedBy||null),Mt("_mat-animation-noopable",!s._animationsEnabled)("mat-mdc-dialog-container-with-actions",s._actionSectionCount>0))},features:[Ut],decls:3,vars:0,consts:[[1,"mat-mdc-dialog-inner-container","mdc-dialog__container"],[1,"mat-mdc-dialog-surface","mdc-dialog__surface"],["cdkPortalOutlet",""]],template:function(i,s){i&1&&(R(0,"div",0)(1,"div",1),lt(2,go,0,0,"ng-template",2),O()())},dependencies:[je],styles:['.mat-mdc-dialog-container{width:100%;height:100%;display:block;box-sizing:border-box;max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit;outline:0}.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-max-width, 560px);min-width:var(--mat-dialog-container-min-width, 280px)}@media(max-width: 599px){.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-small-max-width, calc(100vw - 32px))}}.mat-mdc-dialog-inner-container{display:flex;flex-direction:row;align-items:center;justify-content:space-around;box-sizing:border-box;height:100%;opacity:0;transition:opacity linear var(--mat-dialog-transition-duration, 0ms);max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit}.mdc-dialog--closing .mat-mdc-dialog-inner-container{transition:opacity 75ms linear;transform:none}.mdc-dialog--open .mat-mdc-dialog-inner-container{opacity:1}._mat-animation-noopable .mat-mdc-dialog-inner-container{transition:none}.mat-mdc-dialog-surface{display:flex;flex-direction:column;flex-grow:0;flex-shrink:0;box-sizing:border-box;width:100%;height:100%;position:relative;overflow-y:auto;outline:0;transform:scale(0.8);transition:transform var(--mat-dialog-transition-duration, 0ms) cubic-bezier(0, 0, 0.2, 1);max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit;box-shadow:var(--mat-dialog-container-elevation-shadow, none);border-radius:var(--mdc-dialog-container-shape, var(--mat-sys-corner-extra-large, 4px));background-color:var(--mdc-dialog-container-color, var(--mat-sys-surface, white))}[dir=rtl] .mat-mdc-dialog-surface{text-align:right}.mdc-dialog--open .mat-mdc-dialog-surface,.mdc-dialog--closing .mat-mdc-dialog-surface{transform:none}._mat-animation-noopable .mat-mdc-dialog-surface{transition:none}.mat-mdc-dialog-surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:2px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}.mat-mdc-dialog-title{display:block;position:relative;flex-shrink:0;box-sizing:border-box;margin:0 0 1px;padding:var(--mat-dialog-headline-padding, 6px 24px 13px)}.mat-mdc-dialog-title::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}[dir=rtl] .mat-mdc-dialog-title{text-align:right}.mat-mdc-dialog-container .mat-mdc-dialog-title{color:var(--mdc-dialog-subhead-color, var(--mat-sys-on-surface, rgba(0, 0, 0, 0.87)));font-family:var(--mdc-dialog-subhead-font, var(--mat-sys-headline-small-font, inherit));line-height:var(--mdc-dialog-subhead-line-height, var(--mat-sys-headline-small-line-height, 1.5rem));font-size:var(--mdc-dialog-subhead-size, var(--mat-sys-headline-small-size, 1rem));font-weight:var(--mdc-dialog-subhead-weight, var(--mat-sys-headline-small-weight, 400));letter-spacing:var(--mdc-dialog-subhead-tracking, var(--mat-sys-headline-small-tracking, 0.03125em))}.mat-mdc-dialog-content{display:block;flex-grow:1;box-sizing:border-box;margin:0;overflow:auto;max-height:65vh}.mat-mdc-dialog-content>:first-child{margin-top:0}.mat-mdc-dialog-content>:last-child{margin-bottom:0}.mat-mdc-dialog-container .mat-mdc-dialog-content{color:var(--mdc-dialog-supporting-text-color, var(--mat-sys-on-surface-variant, rgba(0, 0, 0, 0.6)));font-family:var(--mdc-dialog-supporting-text-font, var(--mat-sys-body-medium-font, inherit));line-height:var(--mdc-dialog-supporting-text-line-height, var(--mat-sys-body-medium-line-height, 1.5rem));font-size:var(--mdc-dialog-supporting-text-size, var(--mat-sys-body-medium-size, 1rem));font-weight:var(--mdc-dialog-supporting-text-weight, var(--mat-sys-body-medium-weight, 400));letter-spacing:var(--mdc-dialog-supporting-text-tracking, var(--mat-sys-body-medium-tracking, 0.03125em))}.mat-mdc-dialog-container .mat-mdc-dialog-content{padding:var(--mat-dialog-content-padding, 20px 24px)}.mat-mdc-dialog-container-with-actions .mat-mdc-dialog-content{padding:var(--mat-dialog-with-actions-content-padding, 20px 24px 0)}.mat-mdc-dialog-container .mat-mdc-dialog-title+.mat-mdc-dialog-content{padding-top:0}.mat-mdc-dialog-actions{display:flex;position:relative;flex-shrink:0;flex-wrap:wrap;align-items:center;justify-content:flex-end;box-sizing:border-box;min-height:52px;margin:0;padding:8px;border-top:1px solid rgba(0,0,0,0);padding:var(--mat-dialog-actions-padding, 16px 24px);justify-content:var(--mat-dialog-actions-alignment, flex-end)}@media(forced-colors: active){.mat-mdc-dialog-actions{border-top-color:CanvasText}}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-start,.mat-mdc-dialog-actions[align=start]{justify-content:start}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-center,.mat-mdc-dialog-actions[align=center]{justify-content:center}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-end,.mat-mdc-dialog-actions[align=end]{justify-content:flex-end}.mat-mdc-dialog-actions .mat-button-base+.mat-button-base,.mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-mdc-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}.mat-mdc-dialog-component-host{display:contents}'],encapsulation:2})}return o})(),wa="--mat-dialog-transition-duration";function Aa(o){return o==null?null:typeof o=="number"?o:o.endsWith("ms")?He(o.substring(0,o.length-2)):o.endsWith("s")?He(o.substring(0,o.length-1))*1e3:o==="0"?0:null}var Ii=function(o){return o[o.OPEN=0]="OPEN",o[o.CLOSING=1]="CLOSING",o[o.CLOSED=2]="CLOSED",o}(Ii||{}),Bs=class{_ref;_containerInstance;componentInstance;componentRef;disableClose;id;_afterOpened=new Ft;_beforeClosed=new Ft;_result;_closeFallbackTimeout;_state=Ii.OPEN;_closeInteractionType;constructor(e,t,i){this._ref=e,this._containerInstance=i,this.disableClose=t.disableClose,this.id=e.id,e.addPanelClass("mat-mdc-dialog-panel"),i._animationStateChanged.pipe(De(s=>s.state==="opened"),pi(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),i._animationStateChanged.pipe(De(s=>s.state==="closed"),pi(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),e.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),mi(this.backdropClick(),this.keydownEvents().pipe(De(s=>s.keyCode===27&&!this.disableClose&&!ki(s)))).subscribe(s=>{this.disableClose||(s.preventDefault(),yo(this,s.type==="keydown"?"keyboard":"mouse"))})}close(e){this._result=e,this._containerInstance._animationStateChanged.pipe(De(t=>t.state==="closing"),pi(1)).subscribe(t=>{this._beforeClosed.next(e),this._beforeClosed.complete(),this._ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),t.totalTime+100)}),this._state=Ii.CLOSING,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}updatePosition(e){let t=this._ref.config.positionStrategy;return e&&(e.left||e.right)?e.left?t.left(e.left):t.right(e.right):t.centerHorizontally(),e&&(e.top||e.bottom)?e.top?t.top(e.top):t.bottom(e.bottom):t.centerVertically(),this._ref.updatePosition(),this}updateSize(e="",t=""){return this._ref.updateSize(e,t),this}addPanelClass(e){return this._ref.addPanelClass(e),this}removePanelClass(e){return this._ref.removePanelClass(e),this}getState(){return this._state}_finishDialogClose(){this._state=Ii.CLOSED,this._ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}};function yo(o,e,t){return o._closeInteractionType=e,o.close(t)}var zs=new ut("MatMdcDialogData"),wo=new ut("mat-mdc-dialog-default-options"),Ao=new ut("mat-mdc-dialog-scroll-strategy",{providedIn:"root",factory:()=>{let o=T(Se);return()=>o.scrollStrategies.block()}});var Hs=(()=>{class o{_overlay=T(Se);_defaultOptions=T(wo,{optional:!0});_scrollStrategy=T(Ao);_parentDialog=T(o,{optional:!0,skipSelf:!0});_idGenerator=T(Ci);_dialog=T(Fs);_openDialogsAtThisLevel=[];_afterAllClosedAtThisLevel=new Ft;_afterOpenedAtThisLevel=new Ft;dialogConfigClass=Li;_dialogRefConstructor;_dialogContainerType;_dialogDataToken;get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){let t=this._parentDialog;return t?t._getAfterAllClosed():this._afterAllClosedAtThisLevel}afterAllClosed=ui(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(fi(void 0)));constructor(){this._dialogRefConstructor=Bs,this._dialogContainerType=vo,this._dialogDataToken=zs}open(t,i){let s;i=Y(Y({},this._defaultOptions||new Li),i),i.id=i.id||this._idGenerator.getId("mat-mdc-dialog-"),i.scrollStrategy=i.scrollStrategy||this._scrollStrategy();let n=this._dialog.open(t,Yt(Y({},i),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,closeOnOverlayDetachments:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:this.dialogConfigClass,useValue:i},{provide:Jt,useValue:i}]},templateContext:()=>({dialogRef:s}),providers:(r,a,l)=>(s=new this._dialogRefConstructor(r,i,l),s.updatePosition(i?.position),[{provide:this._dialogContainerType,useValue:l},{provide:this._dialogDataToken,useValue:a.data},{provide:this._dialogRefConstructor,useValue:s}])}));return s.componentRef=n.componentRef,s.componentInstance=n.componentInstance,this.openDialogs.push(s),this.afterOpened.next(s),s.afterClosed().subscribe(()=>{let r=this.openDialogs.indexOf(s);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||this._getAfterAllClosed().next())}),s}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(t){return this.openDialogs.find(i=>i.id===t)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(t){let i=t.length;for(;i--;)t[i].close()}static \u0275fac=function(i){return new(i||o)};static \u0275prov=ye({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var Ri=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=gt({type:o});static \u0275inj=ft({providers:[Hs],imports:[ba,Mi,Ve,Ct,Ct]})}return o})();var xa=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=gt({type:o});static \u0275inj=ft({imports:[Ct,Ct]})}return o})();var ko=["*"],Co='.mdc-list{margin:0;padding:8px 0;list-style-type:none}.mdc-list:focus{outline:none}.mdc-list-item{display:flex;position:relative;justify-content:flex-start;overflow:hidden;padding:0;align-items:stretch;cursor:pointer;padding-left:16px;padding-right:16px;background-color:var(--mdc-list-list-item-container-color, transparent);border-radius:var(--mdc-list-list-item-container-shape, var(--mat-sys-corner-none))}.mdc-list-item.mdc-list-item--selected{background-color:var(--mdc-list-list-item-selected-container-color)}.mdc-list-item:focus{outline:0}.mdc-list-item.mdc-list-item--disabled{cursor:auto}.mdc-list-item.mdc-list-item--with-one-line{height:var(--mdc-list-list-item-one-line-container-height, 48px)}.mdc-list-item.mdc-list-item--with-one-line .mdc-list-item__start{align-self:center;margin-top:0}.mdc-list-item.mdc-list-item--with-one-line .mdc-list-item__end{align-self:center;margin-top:0}.mdc-list-item.mdc-list-item--with-two-lines{height:var(--mdc-list-list-item-two-line-container-height, 64px)}.mdc-list-item.mdc-list-item--with-two-lines .mdc-list-item__start{align-self:flex-start;margin-top:16px}.mdc-list-item.mdc-list-item--with-two-lines .mdc-list-item__end{align-self:center;margin-top:0}.mdc-list-item.mdc-list-item--with-three-lines{height:var(--mdc-list-list-item-three-line-container-height, 88px)}.mdc-list-item.mdc-list-item--with-three-lines .mdc-list-item__start{align-self:flex-start;margin-top:16px}.mdc-list-item.mdc-list-item--with-three-lines .mdc-list-item__end{align-self:flex-start;margin-top:16px}.mdc-list-item.mdc-list-item--selected::before,.mdc-list-item.mdc-list-item--selected:focus::before,.mdc-list-item:not(.mdc-list-item--selected):focus::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;content:"";pointer-events:none}a.mdc-list-item{color:inherit;text-decoration:none}.mdc-list-item__start{fill:currentColor;flex-shrink:0;pointer-events:none}.mdc-list-item--with-leading-icon .mdc-list-item__start{color:var(--mdc-list-list-item-leading-icon-color, var(--mat-sys-on-surface-variant));width:var(--mdc-list-list-item-leading-icon-size, 24px);height:var(--mdc-list-list-item-leading-icon-size, 24px);margin-left:16px;margin-right:32px}[dir=rtl] .mdc-list-item--with-leading-icon .mdc-list-item__start{margin-left:32px;margin-right:16px}.mdc-list-item--with-leading-icon:hover .mdc-list-item__start{color:var(--mdc-list-list-item-hover-leading-icon-color)}.mdc-list-item--with-leading-avatar .mdc-list-item__start{width:var(--mdc-list-list-item-leading-avatar-size, 40px);height:var(--mdc-list-list-item-leading-avatar-size, 40px);margin-left:16px;margin-right:16px;border-radius:50%}.mdc-list-item--with-leading-avatar .mdc-list-item__start,[dir=rtl] .mdc-list-item--with-leading-avatar .mdc-list-item__start{margin-left:16px;margin-right:16px;border-radius:50%}.mdc-list-item__end{flex-shrink:0;pointer-events:none}.mdc-list-item--with-trailing-meta .mdc-list-item__end{font-family:var(--mdc-list-list-item-trailing-supporting-text-font, var(--mat-sys-label-small-font));line-height:var(--mdc-list-list-item-trailing-supporting-text-line-height, var(--mat-sys-label-small-line-height));font-size:var(--mdc-list-list-item-trailing-supporting-text-size, var(--mat-sys-label-small-size));font-weight:var(--mdc-list-list-item-trailing-supporting-text-weight, var(--mat-sys-label-small-weight));letter-spacing:var(--mdc-list-list-item-trailing-supporting-text-tracking, var(--mat-sys-label-small-tracking))}.mdc-list-item--with-trailing-icon .mdc-list-item__end{color:var(--mdc-list-list-item-trailing-icon-color, var(--mat-sys-on-surface-variant));width:var(--mdc-list-list-item-trailing-icon-size, 24px);height:var(--mdc-list-list-item-trailing-icon-size, 24px)}.mdc-list-item--with-trailing-icon:hover .mdc-list-item__end{color:var(--mdc-list-list-item-hover-trailing-icon-color)}.mdc-list-item.mdc-list-item--with-trailing-meta .mdc-list-item__end{color:var(--mdc-list-list-item-trailing-supporting-text-color, var(--mat-sys-on-surface-variant))}.mdc-list-item--selected.mdc-list-item--with-trailing-icon .mdc-list-item__end{color:var(--mdc-list-list-item-selected-trailing-icon-color, var(--mat-sys-primary))}.mdc-list-item__content{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;align-self:center;flex:1;pointer-events:none}.mdc-list-item--with-two-lines .mdc-list-item__content,.mdc-list-item--with-three-lines .mdc-list-item__content{align-self:stretch}.mdc-list-item__primary-text{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;color:var(--mdc-list-list-item-label-text-color, var(--mat-sys-on-surface));font-family:var(--mdc-list-list-item-label-text-font, var(--mat-sys-body-large-font));line-height:var(--mdc-list-list-item-label-text-line-height, var(--mat-sys-body-large-line-height));font-size:var(--mdc-list-list-item-label-text-size, var(--mat-sys-body-large-size));font-weight:var(--mdc-list-list-item-label-text-weight, var(--mat-sys-body-large-weight));letter-spacing:var(--mdc-list-list-item-label-text-tracking, var(--mat-sys-body-large-tracking))}.mdc-list-item:hover .mdc-list-item__primary-text{color:var(--mdc-list-list-item-hover-label-text-color, var(--mat-sys-on-surface))}.mdc-list-item:focus .mdc-list-item__primary-text{color:var(--mdc-list-list-item-focus-label-text-color, var(--mat-sys-on-surface))}.mdc-list-item--with-two-lines .mdc-list-item__primary-text,.mdc-list-item--with-three-lines .mdc-list-item__primary-text{display:block;margin-top:0;line-height:normal;margin-bottom:-20px}.mdc-list-item--with-two-lines .mdc-list-item__primary-text::before,.mdc-list-item--with-three-lines .mdc-list-item__primary-text::before{display:inline-block;width:0;height:28px;content:"";vertical-align:0}.mdc-list-item--with-two-lines .mdc-list-item__primary-text::after,.mdc-list-item--with-three-lines .mdc-list-item__primary-text::after{display:inline-block;width:0;height:20px;content:"";vertical-align:-20px}.mdc-list-item__secondary-text{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;display:block;margin-top:0;color:var(--mdc-list-list-item-supporting-text-color, var(--mat-sys-on-surface-variant));font-family:var(--mdc-list-list-item-supporting-text-font, var(--mat-sys-body-medium-font));line-height:var(--mdc-list-list-item-supporting-text-line-height, var(--mat-sys-body-medium-line-height));font-size:var(--mdc-list-list-item-supporting-text-size, var(--mat-sys-body-medium-size));font-weight:var(--mdc-list-list-item-supporting-text-weight, var(--mat-sys-body-medium-weight));letter-spacing:var(--mdc-list-list-item-supporting-text-tracking, var(--mat-sys-body-medium-tracking))}.mdc-list-item__secondary-text::before{display:inline-block;width:0;height:20px;content:"";vertical-align:0}.mdc-list-item--with-three-lines .mdc-list-item__secondary-text{white-space:normal;line-height:20px}.mdc-list-item--with-overline .mdc-list-item__secondary-text{white-space:nowrap;line-height:auto}.mdc-list-item--with-leading-radio.mdc-list-item,.mdc-list-item--with-leading-checkbox.mdc-list-item,.mdc-list-item--with-leading-icon.mdc-list-item,.mdc-list-item--with-leading-avatar.mdc-list-item{padding-left:0;padding-right:16px}[dir=rtl] .mdc-list-item--with-leading-radio.mdc-list-item,[dir=rtl] .mdc-list-item--with-leading-checkbox.mdc-list-item,[dir=rtl] .mdc-list-item--with-leading-icon.mdc-list-item,[dir=rtl] .mdc-list-item--with-leading-avatar.mdc-list-item{padding-left:16px;padding-right:0}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines .mdc-list-item__primary-text,.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines .mdc-list-item__primary-text,.mdc-list-item--with-leading-icon.mdc-list-item--with-two-lines .mdc-list-item__primary-text,.mdc-list-item--with-leading-avatar.mdc-list-item--with-two-lines .mdc-list-item__primary-text{display:block;margin-top:0;line-height:normal;margin-bottom:-20px}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines .mdc-list-item__primary-text::before,.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines .mdc-list-item__primary-text::before,.mdc-list-item--with-leading-icon.mdc-list-item--with-two-lines .mdc-list-item__primary-text::before,.mdc-list-item--with-leading-avatar.mdc-list-item--with-two-lines .mdc-list-item__primary-text::before{display:inline-block;width:0;height:32px;content:"";vertical-align:0}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines .mdc-list-item__primary-text::after,.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines .mdc-list-item__primary-text::after,.mdc-list-item--with-leading-icon.mdc-list-item--with-two-lines .mdc-list-item__primary-text::after,.mdc-list-item--with-leading-avatar.mdc-list-item--with-two-lines .mdc-list-item__primary-text::after{display:inline-block;width:0;height:20px;content:"";vertical-align:-20px}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end,.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end,.mdc-list-item--with-leading-icon.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end,.mdc-list-item--with-leading-avatar.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end{display:block;margin-top:0;line-height:normal}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end::before,.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end::before,.mdc-list-item--with-leading-icon.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end::before,.mdc-list-item--with-leading-avatar.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end::before{display:inline-block;width:0;height:32px;content:"";vertical-align:0}.mdc-list-item--with-trailing-icon.mdc-list-item,[dir=rtl] .mdc-list-item--with-trailing-icon.mdc-list-item{padding-left:0;padding-right:0}.mdc-list-item--with-trailing-icon .mdc-list-item__end{margin-left:16px;margin-right:16px}.mdc-list-item--with-trailing-meta.mdc-list-item{padding-left:16px;padding-right:0}[dir=rtl] .mdc-list-item--with-trailing-meta.mdc-list-item{padding-left:0;padding-right:16px}.mdc-list-item--with-trailing-meta .mdc-list-item__end{-webkit-user-select:none;user-select:none;margin-left:28px;margin-right:16px}[dir=rtl] .mdc-list-item--with-trailing-meta .mdc-list-item__end{margin-left:16px;margin-right:28px}.mdc-list-item--with-trailing-meta.mdc-list-item--with-three-lines .mdc-list-item__end,.mdc-list-item--with-trailing-meta.mdc-list-item--with-two-lines .mdc-list-item__end{display:block;line-height:normal;align-self:flex-start;margin-top:0}.mdc-list-item--with-trailing-meta.mdc-list-item--with-three-lines .mdc-list-item__end::before,.mdc-list-item--with-trailing-meta.mdc-list-item--with-two-lines .mdc-list-item__end::before{display:inline-block;width:0;height:28px;content:"";vertical-align:0}.mdc-list-item--with-leading-radio .mdc-list-item__start,.mdc-list-item--with-leading-checkbox .mdc-list-item__start{margin-left:8px;margin-right:24px}[dir=rtl] .mdc-list-item--with-leading-radio .mdc-list-item__start,[dir=rtl] .mdc-list-item--with-leading-checkbox .mdc-list-item__start{margin-left:24px;margin-right:8px}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines .mdc-list-item__start,.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines .mdc-list-item__start{align-self:flex-start;margin-top:8px}.mdc-list-item--with-trailing-radio.mdc-list-item,.mdc-list-item--with-trailing-checkbox.mdc-list-item{padding-left:16px;padding-right:0}[dir=rtl] .mdc-list-item--with-trailing-radio.mdc-list-item,[dir=rtl] .mdc-list-item--with-trailing-checkbox.mdc-list-item{padding-left:0;padding-right:16px}.mdc-list-item--with-trailing-radio.mdc-list-item--with-leading-icon,.mdc-list-item--with-trailing-radio.mdc-list-item--with-leading-avatar,.mdc-list-item--with-trailing-checkbox.mdc-list-item--with-leading-icon,.mdc-list-item--with-trailing-checkbox.mdc-list-item--with-leading-avatar{padding-left:0}[dir=rtl] .mdc-list-item--with-trailing-radio.mdc-list-item--with-leading-icon,[dir=rtl] .mdc-list-item--with-trailing-radio.mdc-list-item--with-leading-avatar,[dir=rtl] .mdc-list-item--with-trailing-checkbox.mdc-list-item--with-leading-icon,[dir=rtl] .mdc-list-item--with-trailing-checkbox.mdc-list-item--with-leading-avatar{padding-right:0}.mdc-list-item--with-trailing-radio .mdc-list-item__end,.mdc-list-item--with-trailing-checkbox .mdc-list-item__end{margin-left:24px;margin-right:8px}[dir=rtl] .mdc-list-item--with-trailing-radio .mdc-list-item__end,[dir=rtl] .mdc-list-item--with-trailing-checkbox .mdc-list-item__end{margin-left:8px;margin-right:24px}.mdc-list-item--with-trailing-radio.mdc-list-item--with-three-lines .mdc-list-item__end,.mdc-list-item--with-trailing-checkbox.mdc-list-item--with-three-lines .mdc-list-item__end{align-self:flex-start;margin-top:8px}.mdc-list-group__subheader{margin:.75rem 16px}.mdc-list-item--disabled .mdc-list-item__start,.mdc-list-item--disabled .mdc-list-item__content,.mdc-list-item--disabled .mdc-list-item__end{opacity:1}.mdc-list-item--disabled .mdc-list-item__primary-text,.mdc-list-item--disabled .mdc-list-item__secondary-text{opacity:var(--mdc-list-list-item-disabled-label-text-opacity, 0.3)}.mdc-list-item--disabled.mdc-list-item--with-leading-icon .mdc-list-item__start{color:var(--mdc-list-list-item-disabled-leading-icon-color, var(--mat-sys-on-surface));opacity:var(--mdc-list-list-item-disabled-leading-icon-opacity, 0.38)}.mdc-list-item--disabled.mdc-list-item--with-trailing-icon .mdc-list-item__end{color:var(--mdc-list-list-item-disabled-trailing-icon-color, var(--mat-sys-on-surface));opacity:var(--mdc-list-list-item-disabled-trailing-icon-opacity, 0.38)}.mat-mdc-list-item.mat-mdc-list-item-both-leading-and-trailing,[dir=rtl] .mat-mdc-list-item.mat-mdc-list-item-both-leading-and-trailing{padding-left:0;padding-right:0}.mdc-list-item.mdc-list-item--disabled .mdc-list-item__primary-text{color:var(--mdc-list-list-item-disabled-label-text-color, var(--mat-sys-on-surface))}.mdc-list-item:hover::before{background-color:var(--mdc-list-list-item-hover-state-layer-color, var(--mat-sys-on-surface));opacity:var(--mdc-list-list-item-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mdc-list-item.mdc-list-item--disabled::before{background-color:var(--mdc-list-list-item-disabled-state-layer-color, var(--mat-sys-on-surface));opacity:var(--mdc-list-list-item-disabled-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mdc-list-item:focus::before{background-color:var(--mdc-list-list-item-focus-state-layer-color, var(--mat-sys-on-surface));opacity:var(--mdc-list-list-item-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mdc-list-item--disabled .mdc-radio,.mdc-list-item--disabled .mdc-checkbox{opacity:var(--mdc-list-list-item-disabled-label-text-opacity, 0.3)}.mdc-list-item--with-leading-avatar .mat-mdc-list-item-avatar{border-radius:var(--mdc-list-list-item-leading-avatar-shape, var(--mat-sys-corner-full));background-color:var(--mdc-list-list-item-leading-avatar-color, var(--mat-sys-primary-container))}.mat-mdc-list-item-icon{font-size:var(--mdc-list-list-item-leading-icon-size, 24px)}@media(forced-colors: active){a.mdc-list-item--activated::after{content:"";position:absolute;top:50%;right:16px;transform:translateY(-50%);width:10px;height:0;border-bottom:solid 10px;border-radius:10px}a.mdc-list-item--activated [dir=rtl]::after{right:auto;left:16px}}.mat-mdc-list-base{display:block}.mat-mdc-list-base .mdc-list-item__start,.mat-mdc-list-base .mdc-list-item__end,.mat-mdc-list-base .mdc-list-item__content{pointer-events:auto}.mat-mdc-list-item,.mat-mdc-list-option{width:100%;box-sizing:border-box;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-list-item:not(.mat-mdc-list-item-interactive),.mat-mdc-list-option:not(.mat-mdc-list-item-interactive){cursor:default}.mat-mdc-list-item .mat-divider-inset,.mat-mdc-list-option .mat-divider-inset{position:absolute;left:0;right:0;bottom:0}.mat-mdc-list-item .mat-mdc-list-item-avatar~.mat-divider-inset,.mat-mdc-list-option .mat-mdc-list-item-avatar~.mat-divider-inset{margin-left:72px}[dir=rtl] .mat-mdc-list-item .mat-mdc-list-item-avatar~.mat-divider-inset,[dir=rtl] .mat-mdc-list-option .mat-mdc-list-item-avatar~.mat-divider-inset{margin-right:72px}.mat-mdc-list-item-interactive::before{top:0;left:0;right:0;bottom:0;position:absolute;content:"";opacity:0;pointer-events:none;border-radius:inherit}.mat-mdc-list-item>.mat-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-mdc-list-item:focus>.mat-focus-indicator::before{content:""}.mat-mdc-list-item.mdc-list-item--with-three-lines .mat-mdc-list-item-line.mdc-list-item__secondary-text{white-space:nowrap;line-height:normal}.mat-mdc-list-item.mdc-list-item--with-three-lines .mat-mdc-list-item-unscoped-content.mdc-list-item__secondary-text{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2}mat-action-list button{background:none;color:inherit;border:none;font:inherit;outline:inherit;-webkit-tap-highlight-color:rgba(0,0,0,0);text-align:start}mat-action-list button::-moz-focus-inner{border:0}.mdc-list-item--with-leading-icon .mdc-list-item__start{margin-inline-start:var(--mat-list-list-item-leading-icon-start-space, 16px);margin-inline-end:var(--mat-list-list-item-leading-icon-end-space, 16px)}.mat-mdc-nav-list .mat-mdc-list-item{border-radius:var(--mat-list-active-indicator-shape, var(--mat-sys-corner-full));--mat-focus-indicator-border-radius:var(--mat-list-active-indicator-shape, var(--mat-sys-corner-full))}.mat-mdc-nav-list .mat-mdc-list-item.mdc-list-item--activated{background-color:var(--mat-list-active-indicator-color, var(--mat-sys-secondary-container))}',So=["unscopedContent"],Eo=["text"],To=[[["","matListItemAvatar",""],["","matListItemIcon",""]],[["","matListItemTitle",""]],[["","matListItemLine",""]],"*",[["","matListItemMeta",""]],[["mat-divider"]]],Mo=["[matListItemAvatar],[matListItemIcon]","[matListItemTitle]","[matListItemLine]","*","[matListItemMeta]","mat-divider"];var Po=new ut("ListOption"),Vs=(()=>{class o{_elementRef=T(Tt);constructor(){}static \u0275fac=function(i){return new(i||o)};static \u0275dir=zt({type:o,selectors:[["","matListItemTitle",""]],hostAttrs:[1,"mat-mdc-list-item-title","mdc-list-item__primary-text"]})}return o})(),Io=(()=>{class o{_elementRef=T(Tt);constructor(){}static \u0275fac=function(i){return new(i||o)};static \u0275dir=zt({type:o,selectors:[["","matListItemLine",""]],hostAttrs:[1,"mat-mdc-list-item-line","mdc-list-item__secondary-text"]})}return o})(),Gs=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275dir=zt({type:o,selectors:[["","matListItemMeta",""]],hostAttrs:[1,"mat-mdc-list-item-meta","mdc-list-item__end"]})}return o})(),ka=(()=>{class o{_listOption=T(Po,{optional:!0});constructor(){}_isAlignedAtStart(){return!this._listOption||this._listOption?._getTogglePosition()==="after"}static \u0275fac=function(i){return new(i||o)};static \u0275dir=zt({type:o,hostVars:4,hostBindings:function(i,s){i&2&&Mt("mdc-list-item__start",s._isAlignedAtStart())("mdc-list-item__end",!s._isAlignedAtStart())}})}return o})(),Us=(()=>{class o extends ka{static \u0275fac=(()=>{let t;return function(s){return(t||(t=re(o)))(s||o)}})();static \u0275dir=zt({type:o,selectors:[["","matListItemAvatar",""]],hostAttrs:[1,"mat-mdc-list-item-avatar"],features:[Ut]})}return o})(),Lo=(()=>{class o extends ka{static \u0275fac=(()=>{let t;return function(s){return(t||(t=re(o)))(s||o)}})();static \u0275dir=zt({type:o,selectors:[["","matListItemIcon",""]],hostAttrs:[1,"mat-mdc-list-item-icon"],features:[Ut]})}return o})(),Ro=new ut("MAT_LIST_CONFIG"),js=(()=>{class o{_isNonInteractive=!0;get disableRipple(){return this._disableRipple}set disableRipple(t){this._disableRipple=Ce(t)}_disableRipple=!1;get disabled(){return this._disabled}set disabled(t){this._disabled=Ce(t)}_disabled=!1;_defaultOptions=T(Ro,{optional:!0});static \u0275fac=function(i){return new(i||o)};static \u0275dir=zt({type:o,hostVars:1,hostBindings:function(i,s){i&2&&at("aria-disabled",s.disabled)},inputs:{disableRipple:"disableRipple",disabled:"disabled"}})}return o})(),Do=(()=>{class o{_elementRef=T(Tt);_ngZone=T(we);_listBase=T(js,{optional:!0});_platform=T(xi);_hostElement;_isButtonElement;_noopAnimations;_avatars;_icons;set lines(t){this._explicitLines=He(t,null),this._updateItemLines(!1)}_explicitLines=null;get disableRipple(){return this.disabled||this._disableRipple||this._noopAnimations||!!this._listBase?.disableRipple}set disableRipple(t){this._disableRipple=Ce(t)}_disableRipple=!1;get disabled(){return this._disabled||!!this._listBase?.disabled}set disabled(t){this._disabled=Ce(t)}_disabled=!1;_subscriptions=new Ar;_rippleRenderer=null;_hasUnscopedTextContent=!1;rippleConfig;get rippleDisabled(){return this.disableRipple||!!this.rippleConfig.disabled}constructor(){T(Nr).load(Ur);let t=T(Wr,{optional:!0}),i=T(Kt,{optional:!0});this.rippleConfig=t||{},this._hostElement=this._elementRef.nativeElement,this._isButtonElement=this._hostElement.nodeName.toLowerCase()==="button",this._noopAnimations=i==="NoopAnimations",this._listBase&&!this._listBase._isNonInteractive&&this._initInteractiveListItem(),this._isButtonElement&&!this._hostElement.hasAttribute("type")&&this._hostElement.setAttribute("type","button")}ngAfterViewInit(){this._monitorProjectedLinesAndTitle(),this._updateItemLines(!0)}ngOnDestroy(){this._subscriptions.unsubscribe(),this._rippleRenderer!==null&&this._rippleRenderer._removeTriggerEvents()}_hasIconOrAvatar(){return!!(this._avatars.length||this._icons.length)}_initInteractiveListItem(){this._hostElement.classList.add("mat-mdc-list-item-interactive"),this._rippleRenderer=new $r(this,this._ngZone,this._hostElement,this._platform,T(ae)),this._rippleRenderer.setupTriggerEvents(this._hostElement)}_monitorProjectedLinesAndTitle(){this._ngZone.runOutsideAngular(()=>{this._subscriptions.add(mi(this._lines.changes,this._titles.changes).subscribe(()=>this._updateItemLines(!1)))})}_updateItemLines(t){if(!this._lines||!this._titles||!this._unscopedContent)return;t&&this._checkDomForUnscopedTextContent();let i=this._explicitLines??this._inferLinesFromContent(),s=this._unscopedContent.nativeElement;if(this._hostElement.classList.toggle("mat-mdc-list-item-single-line",i<=1),this._hostElement.classList.toggle("mdc-list-item--with-one-line",i<=1),this._hostElement.classList.toggle("mdc-list-item--with-two-lines",i===2),this._hostElement.classList.toggle("mdc-list-item--with-three-lines",i===3),this._hasUnscopedTextContent){let n=this._titles.length===0&&i===1;s.classList.toggle("mdc-list-item__primary-text",n),s.classList.toggle("mdc-list-item__secondary-text",!n)}else s.classList.remove("mdc-list-item__primary-text"),s.classList.remove("mdc-list-item__secondary-text")}_inferLinesFromContent(){let t=this._titles.length+this._lines.length;return this._hasUnscopedTextContent&&(t+=1),t}_checkDomForUnscopedTextContent(){this._hasUnscopedTextContent=Array.from(this._unscopedContent.nativeElement.childNodes).filter(t=>t.nodeType!==t.COMMENT_NODE).some(t=>!!(t.textContent&&t.textContent.trim()))}static \u0275fac=function(i){return new(i||o)};static \u0275dir=zt({type:o,contentQueries:function(i,s,n){if(i&1&&(xe(n,Us,4),xe(n,Lo,4)),i&2){let r;xt(r=kt())&&(s._avatars=r),xt(r=kt())&&(s._icons=r)}},hostVars:4,hostBindings:function(i,s){i&2&&(at("aria-disabled",s.disabled)("disabled",s._isButtonElement&&s.disabled||null),Mt("mdc-list-item--disabled",s.disabled))},inputs:{lines:"lines",disableRipple:"disableRipple",disabled:"disabled"}})}return o})();var Ca=(()=>{class o extends js{static \u0275fac=(()=>{let t;return function(s){return(t||(t=re(o)))(s||o)}})();static \u0275cmp=Z({type:o,selectors:[["mat-list"]],hostAttrs:[1,"mat-mdc-list","mat-mdc-list-base","mdc-list"],exportAs:["matList"],features:[Ir([{provide:js,useExisting:o}]),Ut],ngContentSelectors:ko,decls:1,vars:0,template:function(i,s){i&1&&(Ts(),Qt(0))},styles:[Co],encapsulation:2,changeDetection:0})}return o})(),Sa=(()=>{class o extends Do{_lines;_titles;_meta;_unscopedContent;_itemText;get activated(){return this._activated}set activated(t){this._activated=Ce(t)}_activated=!1;_getAriaCurrent(){return this._hostElement.nodeName==="A"&&this._activated?"page":null}_hasBothLeadingAndTrailing(){return this._meta.length!==0&&(this._avatars.length!==0||this._icons.length!==0)}static \u0275fac=(()=>{let t;return function(s){return(t||(t=re(o)))(s||o)}})();static \u0275cmp=Z({type:o,selectors:[["mat-list-item"],["a","mat-list-item",""],["button","mat-list-item",""]],contentQueries:function(i,s,n){if(i&1&&(xe(n,Io,5),xe(n,Vs,5),xe(n,Gs,5)),i&2){let r;xt(r=kt())&&(s._lines=r),xt(r=kt())&&(s._titles=r),xt(r=kt())&&(s._meta=r)}},viewQuery:function(i,s){if(i&1&&(ce(So,5),ce(Eo,5)),i&2){let n;xt(n=kt())&&(s._unscopedContent=n.first),xt(n=kt())&&(s._itemText=n.first)}},hostAttrs:[1,"mat-mdc-list-item","mdc-list-item"],hostVars:13,hostBindings:function(i,s){i&2&&(at("aria-current",s._getAriaCurrent()),Mt("mdc-list-item--activated",s.activated)("mdc-list-item--with-leading-avatar",s._avatars.length!==0)("mdc-list-item--with-leading-icon",s._icons.length!==0)("mdc-list-item--with-trailing-meta",s._meta.length!==0)("mat-mdc-list-item-both-leading-and-trailing",s._hasBothLeadingAndTrailing())("_mat-animation-noopable",s._noopAnimations))},inputs:{activated:"activated"},exportAs:["matListItem"],features:[Ut],ngContentSelectors:Mo,decls:10,vars:0,consts:[["unscopedContent",""],[1,"mdc-list-item__content"],[1,"mat-mdc-list-item-unscoped-content",3,"cdkObserveContent"],[1,"mat-focus-indicator"]],template:function(i,s){if(i&1){let n=le();Ts(To),Qt(0),R(1,"span",1),Qt(2,1),Qt(3,2),R(4,"span",2,0),Ht("cdkObserveContent",function(){return Nt(n),Bt(s._updateItemLines(!0))}),Qt(6,3),O()(),Qt(7,4),Qt(8,5),J(9,"div",3)}},dependencies:[Br],encapsulation:2,changeDetection:0})}return o})();var Ea=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=gt({type:o});static \u0275inj=ft({imports:[zr,Ct,Xr,qr,xa]})}return o})();var Fo=["determinateSpinner"];function No(o,e){if(o&1&&(_i(),R(0,"svg",11),J(1,"circle",12),O()),o&2){let t=At();at("viewBox",t._viewBox()),H(),oe("stroke-dasharray",t._strokeCircumference(),"px")("stroke-dashoffset",t._strokeCircumference()/2,"px")("stroke-width",t._circleStrokeWidth(),"%"),at("r",t._circleRadius())}}var Bo=new ut("mat-progress-spinner-default-options",{providedIn:"root",factory:zo});function zo(){return{diameter:Ta}}var Ta=100,Ho=10,Ma=(()=>{class o{_elementRef=T(Tt);_noopAnimations;get color(){return this._color||this._defaultColor}set color(t){this._color=t}_color;_defaultColor="primary";_determinateCircle;constructor(){let t=T(Kt,{optional:!0}),i=T(Bo);this._noopAnimations=t==="NoopAnimations"&&!!i&&!i._forceAnimations,this.mode=this._elementRef.nativeElement.nodeName.toLowerCase()==="mat-spinner"?"indeterminate":"determinate",i&&(i.color&&(this.color=this._defaultColor=i.color),i.diameter&&(this.diameter=i.diameter),i.strokeWidth&&(this.strokeWidth=i.strokeWidth))}mode;get value(){return this.mode==="determinate"?this._value:0}set value(t){this._value=Math.max(0,Math.min(100,t||0))}_value=0;get diameter(){return this._diameter}set diameter(t){this._diameter=t||0}_diameter=Ta;get strokeWidth(){return this._strokeWidth??this.diameter/10}set strokeWidth(t){this._strokeWidth=t||0}_strokeWidth;_circleRadius(){return(this.diameter-Ho)/2}_viewBox(){let t=this._circleRadius()*2+this.strokeWidth;return`0 0 ${t} ${t}`}_strokeCircumference(){return 2*Math.PI*this._circleRadius()}_strokeDashOffset(){return this.mode==="determinate"?this._strokeCircumference()*(100-this._value)/100:null}_circleStrokeWidth(){return this.strokeWidth/this.diameter*100}static \u0275fac=function(i){return new(i||o)};static \u0275cmp=Z({type:o,selectors:[["mat-progress-spinner"],["mat-spinner"]],viewQuery:function(i,s){if(i&1&&ce(Fo,5),i&2){let n;xt(n=kt())&&(s._determinateCircle=n.first)}},hostAttrs:["role","progressbar","tabindex","-1",1,"mat-mdc-progress-spinner","mdc-circular-progress"],hostVars:18,hostBindings:function(i,s){i&2&&(at("aria-valuemin",0)("aria-valuemax",100)("aria-valuenow",s.mode==="determinate"?s.value:null)("mode",s.mode),yi("mat-"+s.color),oe("width",s.diameter,"px")("height",s.diameter,"px")("--mdc-circular-progress-size",s.diameter+"px")("--mdc-circular-progress-active-indicator-width",s.diameter+"px"),Mt("_mat-animation-noopable",s._noopAnimations)("mdc-circular-progress--indeterminate",s.mode==="indeterminate"))},inputs:{color:"color",mode:"mode",value:[2,"value","value",ue],diameter:[2,"diameter","diameter",ue],strokeWidth:[2,"strokeWidth","strokeWidth",ue]},exportAs:["matProgressSpinner"],features:[vi],decls:14,vars:11,consts:[["circle",""],["determinateSpinner",""],["aria-hidden","true",1,"mdc-circular-progress__determinate-container"],["xmlns","http://www.w3.org/2000/svg","focusable","false",1,"mdc-circular-progress__determinate-circle-graphic"],["cx","50%","cy","50%",1,"mdc-circular-progress__determinate-circle"],["aria-hidden","true",1,"mdc-circular-progress__indeterminate-container"],[1,"mdc-circular-progress__spinner-layer"],[1,"mdc-circular-progress__circle-clipper","mdc-circular-progress__circle-left"],[3,"ngTemplateOutlet"],[1,"mdc-circular-progress__gap-patch"],[1,"mdc-circular-progress__circle-clipper","mdc-circular-progress__circle-right"],["xmlns","http://www.w3.org/2000/svg","focusable","false",1,"mdc-circular-progress__indeterminate-circle-graphic"],["cx","50%","cy","50%"]],template:function(i,s){if(i&1&&(lt(0,No,2,8,"ng-template",null,0,Ms),R(2,"div",2,1),_i(),R(4,"svg",3),J(5,"circle",4),O()(),Ss(),R(6,"div",5)(7,"div",6)(8,"div",7),wi(9,8),O(),R(10,"div",9),wi(11,8),O(),R(12,"div",10),wi(13,8),O()()()),i&2){let n=Ne(1);H(4),at("viewBox",s._viewBox()),H(),oe("stroke-dasharray",s._strokeCircumference(),"px")("stroke-dashoffset",s._strokeDashOffset(),"px")("stroke-width",s._circleStrokeWidth(),"%"),at("r",s._circleRadius()),H(4),st("ngTemplateOutlet",n),H(2),st("ngTemplateOutlet",n),H(2),st("ngTemplateOutlet",n)}},dependencies:[Dr],styles:[".mat-mdc-progress-spinner{display:block;overflow:hidden;line-height:0;position:relative;direction:ltr;transition:opacity 250ms cubic-bezier(0.4, 0, 0.6, 1)}.mat-mdc-progress-spinner circle{stroke-width:var(--mdc-circular-progress-active-indicator-width, 4px)}.mat-mdc-progress-spinner._mat-animation-noopable,.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__determinate-circle{transition:none !important}.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__indeterminate-circle-graphic,.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__spinner-layer,.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__indeterminate-container{animation:none !important}.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__indeterminate-container circle{stroke-dasharray:0 !important}@media(forced-colors: active){.mat-mdc-progress-spinner .mdc-circular-progress__indeterminate-circle-graphic,.mat-mdc-progress-spinner .mdc-circular-progress__determinate-circle{stroke:currentColor;stroke:CanvasText}}.mdc-circular-progress__determinate-container,.mdc-circular-progress__indeterminate-circle-graphic,.mdc-circular-progress__indeterminate-container,.mdc-circular-progress__spinner-layer{position:absolute;width:100%;height:100%}.mdc-circular-progress__determinate-container{transform:rotate(-90deg)}.mdc-circular-progress--indeterminate .mdc-circular-progress__determinate-container{opacity:0}.mdc-circular-progress__indeterminate-container{font-size:0;letter-spacing:0;white-space:nowrap;opacity:0}.mdc-circular-progress--indeterminate .mdc-circular-progress__indeterminate-container{opacity:1;animation:mdc-circular-progress-container-rotate 1568.2352941176ms linear infinite}.mdc-circular-progress__determinate-circle-graphic,.mdc-circular-progress__indeterminate-circle-graphic{fill:rgba(0,0,0,0)}.mat-mdc-progress-spinner .mdc-circular-progress__determinate-circle,.mat-mdc-progress-spinner .mdc-circular-progress__indeterminate-circle-graphic{stroke:var(--mdc-circular-progress-active-indicator-color, var(--mat-sys-primary))}@media(forced-colors: active){.mat-mdc-progress-spinner .mdc-circular-progress__determinate-circle,.mat-mdc-progress-spinner .mdc-circular-progress__indeterminate-circle-graphic{stroke:CanvasText}}.mdc-circular-progress__determinate-circle{transition:stroke-dashoffset 500ms cubic-bezier(0, 0, 0.2, 1)}.mdc-circular-progress__gap-patch{position:absolute;top:0;left:47.5%;box-sizing:border-box;width:5%;height:100%;overflow:hidden}.mdc-circular-progress__gap-patch .mdc-circular-progress__indeterminate-circle-graphic{left:-900%;width:2000%;transform:rotate(180deg)}.mdc-circular-progress__circle-clipper .mdc-circular-progress__indeterminate-circle-graphic{width:200%}.mdc-circular-progress__circle-right .mdc-circular-progress__indeterminate-circle-graphic{left:-100%}.mdc-circular-progress--indeterminate .mdc-circular-progress__circle-left .mdc-circular-progress__indeterminate-circle-graphic{animation:mdc-circular-progress-left-spin 1333ms cubic-bezier(0.4, 0, 0.2, 1) infinite both}.mdc-circular-progress--indeterminate .mdc-circular-progress__circle-right .mdc-circular-progress__indeterminate-circle-graphic{animation:mdc-circular-progress-right-spin 1333ms cubic-bezier(0.4, 0, 0.2, 1) infinite both}.mdc-circular-progress__circle-clipper{display:inline-flex;position:relative;width:50%;height:100%;overflow:hidden}.mdc-circular-progress--indeterminate .mdc-circular-progress__spinner-layer{animation:mdc-circular-progress-spinner-layer-rotate 5332ms cubic-bezier(0.4, 0, 0.2, 1) infinite both}@keyframes mdc-circular-progress-container-rotate{to{transform:rotate(360deg)}}@keyframes mdc-circular-progress-spinner-layer-rotate{12.5%{transform:rotate(135deg)}25%{transform:rotate(270deg)}37.5%{transform:rotate(405deg)}50%{transform:rotate(540deg)}62.5%{transform:rotate(675deg)}75%{transform:rotate(810deg)}87.5%{transform:rotate(945deg)}100%{transform:rotate(1080deg)}}@keyframes mdc-circular-progress-left-spin{from{transform:rotate(265deg)}50%{transform:rotate(130deg)}to{transform:rotate(265deg)}}@keyframes mdc-circular-progress-right-spin{from{transform:rotate(-265deg)}50%{transform:rotate(-130deg)}to{transform:rotate(-265deg)}}"],encapsulation:2,changeDetection:0})}return o})();var Pa=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=gt({type:o});static \u0275inj=ft({imports:[Ct]})}return o})();var qe={};qe.d=(o,e)=>{for(var t in e)qe.o(e,t)&&!qe.o(o,t)&&Object.defineProperty(o,t,{enumerable:!0,get:e[t]})};qe.o=(o,e)=>Object.prototype.hasOwnProperty.call(o,e);var L=globalThis.pdfjsLib={};qe.d(L,{AbortException:()=>Xt,AnnotationEditorLayer:()=>Bl,AnnotationEditorParamsType:()=>z,AnnotationEditorType:()=>D,AnnotationEditorUIManager:()=>ti,AnnotationLayer:()=>ar,AnnotationMode:()=>te,ColorPicker:()=>ms,DOMSVGFactory:()=>ri,DrawLayer:()=>fr,FeatureTest:()=>ot,GlobalWorkerOptions:()=>pe,ImageKind:()=>Hi,InvalidPDFException:()=>ji,MissingPDFException:()=>fe,OPS:()=>It,OutputScale:()=>Je,PDFDataRangeTransport:()=>es,PDFDateString:()=>Gi,PDFWorker:()=>Me,PasswordResponses:()=>Wo,PermissionFlag:()=>$o,PixelsPerInch:()=>ie,RenderingCancelledException:()=>Ze,TextLayer:()=>si,UnexpectedResponseException:()=>Pe,Util:()=>E,VerbosityLevel:()=>gs,XfaLayer:()=>ns,build:()=>Ol,createValidAbsoluteUrl:()=>Ko,fetchData:()=>ys,getDocument:()=>Il,getFilenameFromUrl:()=>nl,getPdfFilenameFromUrl:()=>rl,getXfaPageViewport:()=>al,isDataScheme:()=>ws,isPdfFile:()=>br,noContextMenu:()=>Rt,normalizeUnicode:()=>el,setLayerDimensions:()=>ge,shadow:()=>B,stopEvent:()=>Lt,version:()=>Dl});var mt=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Xa=[1,0,0,1,0,0],Ks=[.001,0,0,.001,0,0],Vo=1e7,zi=1.35,Go=.35,ud=Go/zi,vt={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},te={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Uo="pdfjs_internal_editor_",D={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},z={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},$o={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},dt={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Hi={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},nt={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};var Ue={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};var gs={ERRORS:0,WARNINGS:1,INFOS:5},It={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},Wo={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},_s=gs.WARNINGS;function Xo(o){Number.isInteger(o)&&(_s=o)}function qo(){return _s}function bs(o){_s>=gs.INFOS&&console.log(`Info: ${o}`)}function F(o){_s>=gs.WARNINGS&&console.log(`Warning: ${o}`)}function G(o){throw new Error(o)}function et(o,e){o||G(e)}function Yo(o){switch(o?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Ko(o,e=null,t=null){if(!o)return null;try{if(t&&typeof o=="string"&&(t.addDefaultProtocol&&o.startsWith("www.")&&o.match(/\./g)?.length>=2&&(o=`http://${o}`),t.tryConvertEncoding))try{o=tl(o)}catch{}let i=e?new URL(o,e):new URL(o);if(Yo(i))return i}catch{}return null}function B(o,e,t,i=!1){return Object.defineProperty(o,e,{value:t,enumerable:!i,configurable:!0,writable:!1}),t}var se=function(){function e(t,i){this.message=t,this.name=i}return e.prototype=new Error,e.constructor=e,e}(),Ye=class extends se{constructor(e,t){super(e,"PasswordException"),this.code=t}},Ke=class extends se{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}},ji=class extends se{constructor(e){super(e,"InvalidPDFException")}},fe=class extends se{constructor(e){super(e,"MissingPDFException")}},Pe=class extends se{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}},Qs=class extends se{constructor(e){super(e,"FormatError")}},Xt=class extends se{constructor(e){super(e,"AbortException")}};function qa(o){(typeof o!="object"||o?.length===void 0)&&G("Invalid argument for bytesToString");let e=o.length,t=8192;if(e<t)return String.fromCharCode.apply(null,o);let i=[];for(let s=0;s<e;s+=t){let n=Math.min(s+t,e),r=o.subarray(s,n);i.push(String.fromCharCode.apply(null,r))}return i.join("")}function vs(o){typeof o!="string"&&G("Invalid argument for stringToBytes");let e=o.length,t=new Uint8Array(e);for(let i=0;i<e;++i)t[i]=o.charCodeAt(i)&255;return t}function Qo(o){return String.fromCharCode(o>>24&255,o>>16&255,o>>8&255,o&255)}function gr(o){let e=Object.create(null);for(let[t,i]of o)e[t]=i;return e}function Zo(){let o=new Uint8Array(4);return o[0]=1,new Uint32Array(o.buffer,0,1)[0]===1}function Jo(){try{return new Function(""),!0}catch{return!1}}var ot=class{static get isLittleEndian(){return B(this,"isLittleEndian",Zo())}static get isEvalSupported(){return B(this,"isEvalSupported",Jo())}static get isOffscreenCanvasSupported(){return B(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return B(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){return typeof navigator<"u"&&typeof navigator?.platform=="string"?B(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof navigator?.userAgent=="string"&&navigator.userAgent.includes("Firefox")}):B(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){return B(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}},$s=Array.from(Array(256).keys(),o=>o.toString(16).padStart(2,"0")),E=class{static makeHexColor(e,t,i){return`#${$s[e]}${$s[t]}${$s[i]}`}static scaleMinMax(e,t){let i;e[0]?(e[0]<0&&(i=t[0],t[0]=t[2],t[2]=i),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(i=t[1],t[1]=t[3],t[3]=i),t[1]*=e[3],t[3]*=e[3]):(i=t[0],t[0]=t[1],t[1]=i,i=t[2],t[2]=t[3],t[3]=i,e[1]<0&&(i=t[1],t[1]=t[3],t[3]=i),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(i=t[0],t[0]=t[2],t[2]=i),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){let i=e[0]*t[0]+e[1]*t[2]+t[4],s=e[0]*t[1]+e[1]*t[3]+t[5];return[i,s]}static applyInverseTransform(e,t){let i=t[0]*t[3]-t[1]*t[2],s=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/i,n=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/i;return[s,n]}static getAxialAlignedBoundingBox(e,t){let i=this.applyTransform(e,t),s=this.applyTransform(e.slice(2,4),t),n=this.applyTransform([e[0],e[3]],t),r=this.applyTransform([e[2],e[1]],t);return[Math.min(i[0],s[0],n[0],r[0]),Math.min(i[1],s[1],n[1],r[1]),Math.max(i[0],s[0],n[0],r[0]),Math.max(i[1],s[1],n[1],r[1])]}static inverseTransform(e){let t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){let t=[e[0],e[2],e[1],e[3]],i=e[0]*t[0]+e[1]*t[2],s=e[0]*t[1]+e[1]*t[3],n=e[2]*t[0]+e[3]*t[2],r=e[2]*t[1]+e[3]*t[3],a=(i+r)/2,l=Math.sqrt((i+r)**2-4*(i*r-n*s))/2,c=a+l||1,d=a-l||1;return[Math.sqrt(c),Math.sqrt(d)]}static normalizeRect(e){let t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){let i=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),s=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(i>s)return null;let n=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),r=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return n>r?null:[i,n,s,r]}static#t(e,t,i,s,n,r,a,l,c,d){if(c<=0||c>=1)return;let h=1-c,u=c*c,m=u*c,p=h*(h*(h*e+3*c*t)+3*u*i)+m*s,f=h*(h*(h*n+3*c*r)+3*u*a)+m*l;d[0]=Math.min(d[0],p),d[1]=Math.min(d[1],f),d[2]=Math.max(d[2],p),d[3]=Math.max(d[3],f)}static#e(e,t,i,s,n,r,a,l,c,d,h,u){if(Math.abs(c)<1e-12){Math.abs(d)>=1e-12&&this.#t(e,t,i,s,n,r,a,l,-h/d,u);return}let m=d**2-4*h*c;if(m<0)return;let p=Math.sqrt(m),f=2*c;this.#t(e,t,i,s,n,r,a,l,(-d+p)/f,u),this.#t(e,t,i,s,n,r,a,l,(-d-p)/f,u)}static bezierBoundingBox(e,t,i,s,n,r,a,l,c){return c?(c[0]=Math.min(c[0],e,a),c[1]=Math.min(c[1],t,l),c[2]=Math.max(c[2],e,a),c[3]=Math.max(c[3],t,l)):c=[Math.min(e,a),Math.min(t,l),Math.max(e,a),Math.max(t,l)],this.#e(e,i,n,a,t,s,r,l,3*(-e+3*(i-n)+a),6*(e-2*i+n),3*(i-e),c),this.#e(e,i,n,a,t,s,r,l,3*(-t+3*(s-r)+l),6*(t-2*s+r),3*(s-t),c),c}};function tl(o){return decodeURIComponent(escape(o))}var Ws=null,Ia=null;function el(o){return Ws||(Ws=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Ia=new Map([["\uFB05","\u017Ft"]])),o.replaceAll(Ws,(e,t,i)=>t?t.normalize("NFKC"):Ia.get(i))}function il(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();let o=new Uint8Array(32);return crypto.getRandomValues(o),qa(o)}var _r="pdfjs_internal_id_",$t={BEZIER_CURVE_TO:0,MOVE_TO:1,LINE_TO:2,QUADRATIC_CURVE_TO:3,RESTORE:4,SAVE:5,SCALE:6,TRANSFORM:7,TRANSLATE:8};function sl(o){return Uint8Array.prototype.toBase64?o.toBase64():btoa(qa(o))}typeof Promise.try!="function"&&(Promise.try=function(o,...e){return new Promise(t=>{t(o(...e))})});var Wt="http://www.w3.org/2000/svg",ie=class{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF};function ys(o,e="text"){return C(this,null,function*(){if(Xe(o,document.baseURI)){let t=yield fetch(o);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,i)=>{let s=new XMLHttpRequest;s.open("GET",o,!0),s.responseType=e,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(s.status===200||s.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(s.response);return}t(s.responseText);return}i(new Error(s.statusText))}},s.send(null)})})}var Qe=class o{constructor({viewBox:e,scale:t,rotation:i,offsetX:s=0,offsetY:n=0,dontFlip:r=!1}){this.viewBox=e,this.scale=t,this.rotation=i,this.offsetX=s,this.offsetY=n;let a=(e[2]+e[0])/2,l=(e[3]+e[1])/2,c,d,h,u;switch(i%=360,i<0&&(i+=360),i){case 180:c=-1,d=0,h=0,u=1;break;case 90:c=0,d=1,h=1,u=0;break;case 270:c=0,d=-1,h=-1,u=0;break;case 0:c=1,d=0,h=0,u=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}r&&(h=-h,u=-u);let m,p,f,_;c===0?(m=Math.abs(l-e[1])*t+s,p=Math.abs(a-e[0])*t+n,f=(e[3]-e[1])*t,_=(e[2]-e[0])*t):(m=Math.abs(a-e[0])*t+s,p=Math.abs(l-e[1])*t+n,f=(e[2]-e[0])*t,_=(e[3]-e[1])*t),this.transform=[c*t,d*t,h*t,u*t,m-c*t*a-h*t*l,p-d*t*a-u*t*l],this.width=f,this.height=_}get rawDims(){let{viewBox:e}=this;return B(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:i=this.offsetX,offsetY:s=this.offsetY,dontFlip:n=!1}={}){return new o({viewBox:this.viewBox.slice(),scale:e,rotation:t,offsetX:i,offsetY:s,dontFlip:n})}convertToViewportPoint(e,t){return E.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){let t=E.applyTransform([e[0],e[1]],this.transform),i=E.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],i[0],i[1]]}convertToPdfPoint(e,t){return E.applyInverseTransform([e,t],this.transform)}},Ze=class extends se{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}};function ws(o){let e=o.length,t=0;for(;t<e&&o[t].trim()==="";)t++;return o.substring(t,t+5).toLowerCase()==="data:"}function br(o){return typeof o=="string"&&/\.pdf$/i.test(o)}function nl(o){return[o]=o.split(/[#?]/,1),o.substring(o.lastIndexOf("/")+1)}function rl(o,e="document.pdf"){if(typeof o!="string")return e;if(ws(o))return F('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;let t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,i=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,s=t.exec(o),n=i.exec(s[1])||i.exec(s[2])||i.exec(s[3]);if(n&&(n=n[0],n.includes("%")))try{n=i.exec(decodeURIComponent(n))[0]}catch{}return n||e}var Vi=class{started=Object.create(null);times=[];time(e){e in this.started&&F(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||F(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){let e=[],t=0;for(let{name:i}of this.times)t=Math.max(i.length,t);for(let{name:i,start:s,end:n}of this.times)e.push(`${i.padEnd(t)} ${n-s}ms
`);return e.join("")}};function Xe(o,e){try{let{protocol:t}=e?new URL(o,e):new URL(o);return t==="http:"||t==="https:"}catch{return!1}}function Rt(o){o.preventDefault()}function Lt(o){o.preventDefault(),o.stopPropagation()}function La(o){console.log("Deprecated API usage: "+o)}var Gi=class{static#t;static toDateObject(e){if(!e||typeof e!="string")return null;this.#t||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");let t=this.#t.exec(e);if(!t)return null;let i=parseInt(t[1],10),s=parseInt(t[2],10);s=s>=1&&s<=12?s-1:0;let n=parseInt(t[3],10);n=n>=1&&n<=31?n:1;let r=parseInt(t[4],10);r=r>=0&&r<=23?r:0;let a=parseInt(t[5],10);a=a>=0&&a<=59?a:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;let c=t[7]||"Z",d=parseInt(t[8],10);d=d>=0&&d<=23?d:0;let h=parseInt(t[9],10)||0;return h=h>=0&&h<=59?h:0,c==="-"?(r+=d,a+=h):c==="+"&&(r-=d,a-=h),new Date(Date.UTC(i,s,n,r,a,l))}};function al(o,{scale:e=1,rotation:t=0}){let{width:i,height:s}=o.attributes.style,n=[0,0,parseInt(i),parseInt(s)];return new Qe({viewBox:n,scale:e,rotation:t})}function vr(o){if(o.startsWith("#")){let e=parseInt(o.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return o.startsWith("rgb(")?o.slice(4,-1).split(",").map(e=>parseInt(e)):o.startsWith("rgba(")?o.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(F(`Not a valid color format: "${o}"`),[0,0,0])}function ol(o){let e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);for(let t of o.keys()){e.style.color=t;let i=window.getComputedStyle(e).color;o.set(t,vr(i))}e.remove()}function X(o){let{a:e,b:t,c:i,d:s,e:n,f:r}=o.getTransform();return[e,t,i,s,n,r]}function jt(o){let{a:e,b:t,c:i,d:s,e:n,f:r}=o.getTransform().invertSelf();return[e,t,i,s,n,r]}function ge(o,e,t=!1,i=!0){if(e instanceof Qe){let{pageWidth:s,pageHeight:n}=e.rawDims,{style:r}=o,a=ot.isCSSRoundSupported,l=`var(--scale-factor) * ${s}px`,c=`var(--scale-factor) * ${n}px`,d=a?`round(down, ${l}, var(--scale-round-x, 1px))`:`calc(${l})`,h=a?`round(down, ${c}, var(--scale-round-y, 1px))`:`calc(${c})`;!t||e.rotation%180===0?(r.width=d,r.height=h):(r.width=h,r.height=d)}i&&o.setAttribute("data-main-rotation",e.rotation)}var Je=class{constructor(){let e=window.devicePixelRatio||1;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}},Zs=class o{#t=null;#e=null;#i;#s=null;#r=null;static#n=null;constructor(e){this.#i=e,o.#n||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"})}render(){let e=this.#t=document.createElement("div");e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");let t=this.#i._uiManager._signal;e.addEventListener("contextmenu",Rt,{signal:t}),e.addEventListener("pointerdown",o.#c,{signal:t});let i=this.#s=document.createElement("div");i.className="buttons",e.append(i);let s=this.#i.toolbarPosition;if(s){let{style:n}=e,r=this.#i._uiManager.direction==="ltr"?1-s[0]:s[0];n.insetInlineEnd=`${100*r}%`,n.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`}return this.#h(),e}get div(){return this.#t}static#c(e){e.stopPropagation()}#o(e){this.#i._focusEventsAllowed=!1,Lt(e)}#d(e){this.#i._focusEventsAllowed=!0,Lt(e)}#l(e){let t=this.#i._uiManager._signal;e.addEventListener("focusin",this.#o.bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",this.#d.bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",Rt,{signal:t})}hide(){this.#t.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#t.classList.remove("hidden"),this.#r?.shown()}#h(){let{editorType:e,_uiManager:t}=this.#i,i=document.createElement("button");i.className="delete",i.tabIndex=0,i.setAttribute("data-l10n-id",o.#n[e]),this.#l(i),i.addEventListener("click",s=>{t.delete()},{signal:t._signal}),this.#s.append(i)}get#a(){let e=document.createElement("div");return e.className="divider",e}addAltText(e){return C(this,null,function*(){let t=yield e.render();this.#l(t),this.#s.prepend(t,this.#a),this.#r=e})}addColorPicker(e){this.#e=e;let t=e.renderButton();this.#l(t),this.#s.prepend(t,this.#a)}remove(){this.#t.remove(),this.#e?.destroy(),this.#e=null}},Js=class{#t=null;#e=null;#i;constructor(e){this.#i=e}#s(){let e=this.#e=document.createElement("div");e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",Rt,{signal:this.#i._signal});let t=this.#t=document.createElement("div");return t.className="buttons",e.append(t),this.#n(),e}#r(e,t){let i=0,s=0;for(let n of e){let r=n.y+n.height;if(r<i)continue;let a=n.x+(t?n.width:0);if(r>i){s=a,i=r;continue}t?a>s&&(s=a):a<s&&(s=a)}return[t?1-s:s,i]}show(e,t,i){let[s,n]=this.#r(t,i),{style:r}=this.#e||=this.#s();e.append(this.#e),r.insetInlineEnd=`${100*s}%`,r.top=`calc(${100*n}% + var(--editor-toolbar-vert-offset))`}hide(){this.#e.remove()}#n(){let e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");let t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");let i=this.#i._signal;e.addEventListener("contextmenu",Rt,{signal:i}),e.addEventListener("click",()=>{this.#i.highlightSelection("floating_button")},{signal:i}),this.#t.append(e)}};function Ui(o,e,t){for(let i of t)e.addEventListener(i,o[i].bind(o))}var tn=class{#t=0;get id(){return`${Uo}${this.#t++}`}},en=class o{#t=il();#e=0;#i=null;static get _isSVGFittingCanvas(){let e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',i=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),s=new Image;s.src=e;let n=s.decode().then(()=>(i.drawImage(s,0,0,1,1,0,0,1,3),new Uint32Array(i.getImageData(0,0,1,1).data.buffer)[0]===0));return B(this,"_isSVGFittingCanvas",n)}#s(e,t){return C(this,null,function*(){this.#i||=new Map;let i=this.#i.get(e);if(i===null)return null;if(i?.bitmap)return i.refCounter+=1,i;try{i||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let s;if(typeof t=="string"?(i.url=t,s=yield ys(t,"blob")):t instanceof File?s=i.file=t:t instanceof Blob&&(s=t),s.type==="image/svg+xml"){let n=o._isSVGFittingCanvas,r=new FileReader,a=new Image,l=new Promise((c,d)=>{a.onload=()=>{i.bitmap=a,i.isSvg=!0,c()},r.onload=()=>C(this,null,function*(){let h=i.svgUrl=r.result;a.src=(yield n)?`${h}#svgView(preserveAspectRatio(none))`:h}),a.onerror=r.onerror=d});r.readAsDataURL(s),yield l}else i.bitmap=yield createImageBitmap(s);i.refCounter=1}catch(s){F(s),i=null}return this.#i.set(e,i),i&&this.#i.set(i.id,i),i})}getFromFile(e){return C(this,null,function*(){let{lastModified:t,name:i,size:s,type:n}=e;return this.#s(`${t}_${i}_${s}_${n}`,e)})}getFromUrl(e){return C(this,null,function*(){return this.#s(e,e)})}getFromBlob(e,t){return C(this,null,function*(){let i=yield t;return this.#s(e,i)})}getFromId(e){return C(this,null,function*(){this.#i||=new Map;let t=this.#i.get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){let{blobPromise:i}=t;return delete t.blobPromise,this.getFromBlob(t.id,i)}return this.getFromUrl(t.url)})}getFromCanvas(e,t){this.#i||=new Map;let i=this.#i.get(e);if(i?.bitmap)return i.refCounter+=1,i;let s=new OffscreenCanvas(t.width,t.height);return s.getContext("2d").drawImage(t,0,0),i={bitmap:s.transferToImageBitmap(),id:`image_${this.#t}_${this.#e++}`,refCounter:1,isSvg:!1},this.#i.set(e,i),this.#i.set(i.id,i),i}getSvgUrl(e){let t=this.#i.get(e);return t?.isSvg?t.svgUrl:null}deleteId(e){this.#i||=new Map;let t=this.#i.get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;let{bitmap:i}=t;if(!t.url&&!t.file){let s=new OffscreenCanvas(i.width,i.height);s.getContext("bitmaprenderer").transferFromImageBitmap(i),t.blobPromise=s.convertToBlob()}i.close?.(),t.bitmap=null}isValidId(e){return e.startsWith(`image_${this.#t}_`)}},sn=class{#t=[];#e=!1;#i;#s=-1;constructor(e=128){this.#i=e}add({cmd:e,undo:t,post:i,mustExec:s,type:n=NaN,overwriteIfSameType:r=!1,keepUndo:a=!1}){if(s&&e(),this.#e)return;let l={cmd:e,undo:t,post:i,type:n};if(this.#s===-1){this.#t.length>0&&(this.#t.length=0),this.#s=0,this.#t.push(l);return}if(r&&this.#t[this.#s].type===n){a&&(l.undo=this.#t[this.#s].undo),this.#t[this.#s]=l;return}let c=this.#s+1;c===this.#i?this.#t.splice(0,1):(this.#s=c,c<this.#t.length&&this.#t.splice(c)),this.#t.push(l)}undo(){if(this.#s===-1)return;this.#e=!0;let{undo:e,post:t}=this.#t[this.#s];e(),t?.(),this.#e=!1,this.#s-=1}redo(){if(this.#s<this.#t.length-1){this.#s+=1,this.#e=!0;let{cmd:e,post:t}=this.#t[this.#s];e(),t?.(),this.#e=!1}}hasSomethingToUndo(){return this.#s!==-1}hasSomethingToRedo(){return this.#s<this.#t.length-1}cleanType(e){if(this.#s!==-1){for(let t=this.#s;t>=0;t--)if(this.#t[t].type!==e){this.#t.splice(t+1,this.#s-t),this.#s=t;return}this.#t.length=0,this.#s=-1}}destroy(){this.#t=null}},_e=class{constructor(e){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;let{isMac:t}=ot.platform;for(let[i,s,n={}]of e)for(let r of i){let a=r.startsWith("mac+");t&&a?(this.callbacks.set(r.slice(4),{callback:s,options:n}),this.allKeys.add(r.split("+").at(-1))):!t&&!a&&(this.callbacks.set(r,{callback:s,options:n}),this.allKeys.add(r.split("+").at(-1)))}}#t(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);let t=this.buffer.join("+");return this.buffer.length=0,t}exec(e,t){if(!this.allKeys.has(t.key))return;let i=this.callbacks.get(this.#t(t));if(!i)return;let{callback:s,options:{bubbles:n=!1,args:r=[],checker:a=null}}=i;a&&!a(e,t)||(s.bind(e,...r,t)(),n||Lt(t))}},nn=class o{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){let e=new Map([["CanvasText",null],["Canvas",null]]);return ol(e),B(this,"_colors",e)}convert(e){let t=vr(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(let[i,s]of this._colors)if(s.every((n,r)=>n===t[r]))return o._colorsMapping.get(i);return t}getHexCode(e){let t=this._colors.get(e);return t?E.makeHexColor(...t):e}},ti=(()=>{class o{#t=new AbortController;#e=null;#i=new Map;#s=new Map;#r=null;#n=null;#c=null;#o=new sn;#d=null;#l=null;#h=0;#a=new Set;#u=null;#m=null;#p=new Set;_editorUndoBar=null;#g=!1;#f=!1;#_=!1;#b=null;#y=null;#w=null;#k=null;#C=!1;#S=null;#T=new tn;#A=!1;#M=!1;#E=null;#P=null;#D=null;#B=null;#x=D.NONE;#v=new Set;#R=null;#z=null;#j=null;#V={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#F=[0,0];#L=null;#H=null;#W=null;#O=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){let t=o.prototype,i=a=>a.#H.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&a.hasSomethingToControl(),s=(a,{target:l})=>{if(l instanceof HTMLInputElement){let{type:c}=l;return c!=="text"&&c!=="number"}return!0},n=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return B(this,"_keyboardManager",new _e([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],t.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:s}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(a,{target:l})=>!(l instanceof HTMLButtonElement)&&a.#H.contains(l)&&!a.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(a,{target:l})=>!(l instanceof HTMLButtonElement)&&a.#H.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-n,0],checker:i}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-r,0],checker:i}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[n,0],checker:i}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[r,0],checker:i}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-n],checker:i}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-r],checker:i}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,n],checker:i}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,r],checker:i}]]))}constructor(t,i,s,n,r,a,l,c,d,h,u,m){let p=this._signal=this.#t.signal;this.#H=t,this.#W=i,this.#r=s,this._eventBus=n,n._on("editingaction",this.onEditingAction.bind(this),{signal:p}),n._on("pagechanging",this.onPageChanging.bind(this),{signal:p}),n._on("scalechanging",this.onScaleChanging.bind(this),{signal:p}),n._on("rotationchanging",this.onRotationChanging.bind(this),{signal:p}),n._on("setpreference",this.onSetPreference.bind(this),{signal:p}),n._on("switchannotationeditorparams",f=>this.updateParams(f.type,f.value),{signal:p}),this.#et(),this.#rt(),this.#q(),this.#n=r.annotationStorage,this.#b=r.filterFactory,this.#z=a,this.#k=l||null,this.#g=c,this.#f=d,this.#_=h,this.#B=u||null,this.viewParameters={realScale:ie.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=m||null}destroy(){this.#O?.resolve(),this.#O=null,this.#t?.abort(),this.#t=null,this._signal=null;for(let t of this.#s.values())t.destroy();this.#s.clear(),this.#i.clear(),this.#p.clear(),this.#e=null,this.#v.clear(),this.#o.destroy(),this.#r?.destroy(),this.#S?.hide(),this.#S=null,this.#y&&(clearTimeout(this.#y),this.#y=null),this.#L&&(clearTimeout(this.#L),this.#L=null),this._editorUndoBar?.destroy()}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return this.#B}get useNewAltTextFlow(){return this.#f}get useNewAltTextWhenAddingImage(){return this.#_}get hcmFilter(){return B(this,"hcmFilter",this.#z?this.#b.addHCMFilter(this.#z.foreground,this.#z.background):"none")}get direction(){return B(this,"direction",getComputedStyle(this.#H).direction)}get highlightColors(){return B(this,"highlightColors",this.#k?new Map(this.#k.split(",").map(t=>t.split("=").map(i=>i.trim()))):null)}get highlightColorNames(){return B(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#l=t}setMainHighlightColorPicker(t){this.#D=t}editAltText(t,i=!1){this.#r?.editAltText(this,t,i)}switchToMode(t,i){this._eventBus.on("annotationeditormodechanged",i,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,i){this._eventBus.dispatch("setpreference",{source:this,name:t,value:i})}onSetPreference({name:t,value:i}){switch(t){case"enableNewAltTextWhenAddingImage":this.#_=i;break}}onPageChanging({pageNumber:t}){this.#h=t-1}focusMainContainer(){this.#H.focus()}findParent(t,i){for(let s of this.#s.values()){let{x:n,y:r,width:a,height:l}=s.div.getBoundingClientRect();if(t>=n&&t<=n+a&&i>=r&&i<=r+l)return s}return null}disableUserSelect(t=!1){this.#W.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#p.add(t)}removeShouldRescale(t){this.#p.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove(),this.viewParameters.realScale=t*ie.PDF_TO_CSS_UNITS;for(let i of this.#p)i.onScaleChanging();this.#l?.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}#U({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#X(t){let{currentLayer:i}=this;if(i.hasTextLayer(t))return i;for(let s of this.#s.values())if(s.hasTextLayer(t))return s;return null}highlightSelection(t=""){let i=document.getSelection();if(!i||i.isCollapsed)return;let{anchorNode:s,anchorOffset:n,focusNode:r,focusOffset:a}=i,l=i.toString(),d=this.#U(i).closest(".textLayer"),h=this.getSelectionBoxes(d);if(!h)return;i.empty();let u=this.#X(d),m=this.#x===D.NONE,p=()=>{u?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:h,anchorNode:s,anchorOffset:n,focusNode:r,focusOffset:a,text:l}),m&&this.showAllEditors("highlight",!0,!0)};if(m){this.switchToMode(D.HIGHLIGHT,p);return}p()}#J(){let t=document.getSelection();if(!t||t.isCollapsed)return;let s=this.#U(t).closest(".textLayer"),n=this.getSelectionBoxes(s);n&&(this.#S||=new Js(this),this.#S.show(s,n,this.direction==="ltr"))}addToAnnotationStorage(t){!t.isEmpty()&&this.#n&&!this.#n.has(t.id)&&this.#n.setValue(t.id,t)}#tt(){let t=document.getSelection();if(!t||t.isCollapsed){this.#R&&(this.#S?.hide(),this.#R=null,this.#I({hasSelectedText:!1}));return}let{anchorNode:i}=t;if(i===this.#R)return;let n=this.#U(t).closest(".textLayer");if(!n){this.#R&&(this.#S?.hide(),this.#R=null,this.#I({hasSelectedText:!1}));return}if(this.#S?.hide(),this.#R=i,this.#I({hasSelectedText:!0}),!(this.#x!==D.HIGHLIGHT&&this.#x!==D.NONE)&&(this.#x===D.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#C=this.isShiftKeyDown,!this.isShiftKeyDown)){let r=this.#x===D.HIGHLIGHT?this.#X(n):null;r?.toggleDrawing();let a=new AbortController,l=this.combinedSignal(a),c=d=>{d.type==="pointerup"&&d.button!==0||(a.abort(),r?.toggleDrawing(!0),d.type==="pointerup"&&this.#$("main_toolbar"))};window.addEventListener("pointerup",c,{signal:l}),window.addEventListener("blur",c,{signal:l})}}#$(t=""){this.#x===D.HIGHLIGHT?this.highlightSelection(t):this.#g&&this.#J()}#et(){document.addEventListener("selectionchange",this.#tt.bind(this),{signal:this._signal})}#it(){if(this.#w)return;this.#w=new AbortController;let t=this.combinedSignal(this.#w);window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})}#st(){this.#w?.abort(),this.#w=null}blur(){if(this.isShiftKeyDown=!1,this.#C&&(this.#C=!1,this.#$("main_toolbar")),!this.hasSelection)return;let{activeElement:t}=document;for(let i of this.#v)if(i.div.contains(t)){this.#P=[i,t],i._focusEventsAllowed=!1;break}}focus(){if(!this.#P)return;let[t,i]=this.#P;this.#P=null,i.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),i.focus()}#q(){if(this.#E)return;this.#E=new AbortController;let t=this.combinedSignal(this.#E);window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}#nt(){this.#E?.abort(),this.#E=null}#Y(){if(this.#d)return;this.#d=new AbortController;let t=this.combinedSignal(this.#d);document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})}#K(){this.#d?.abort(),this.#d=null}#rt(){let t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#q(),this.#Y()}removeEditListeners(){this.#nt(),this.#K()}dragOver(t){for(let{type:i}of t.dataTransfer.items)for(let s of this.#m)if(s.isHandlingMimeForPasting(i)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(let i of t.dataTransfer.items)for(let s of this.#m)if(s.isHandlingMimeForPasting(i.type)){s.paste(i,this.currentLayer),t.preventDefault();return}}copy(t){if(t.preventDefault(),this.#e?.commitOrRemove(),!this.hasSelection)return;let i=[];for(let s of this.#v){let n=s.serialize(!0);n&&i.push(n)}i.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(i))}cut(t){this.copy(t),this.delete()}paste(t){return C(this,null,function*(){t.preventDefault();let{clipboardData:i}=t;for(let r of i.items)for(let a of this.#m)if(a.isHandlingMimeForPasting(r.type)){a.paste(r,this.currentLayer);return}let s=i.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(r){F(`paste: "${r.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();let n=this.currentLayer;try{let r=[];for(let c of s){let d=yield n.deserialize(c);if(!d)return;r.push(d)}let a=()=>{for(let c of r)this.#Q(c);this.#Z(r)},l=()=>{for(let c of r)c.remove()};this.addCommands({cmd:a,undo:l,mustExec:!0})}catch(r){F(`paste: "${r.message}".`)}})}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),this.#x!==D.NONE&&!this.isEditorHandlingKeyboard&&o._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,this.#C&&(this.#C=!1,this.#$("main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}#I(t){Object.entries(t).some(([s,n])=>this.#V[s]!==n)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#V,t)}),this.#x===D.HIGHLIGHT&&t.hasSelectedEditor===!1&&this.#N([[z.HIGHLIGHT_FREE,!0]]))}#N(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){t?(this.#it(),this.#Y(),this.#I({isEditing:this.#x!==D.NONE,isEmpty:this.#G(),hasSomethingToUndo:this.#o.hasSomethingToUndo(),hasSomethingToRedo:this.#o.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#st(),this.#K(),this.#I({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!this.#m){this.#m=t;for(let i of this.#m)this.#N(i.defaultPropertiesToUpdate)}}getId(){return this.#T.id}get currentLayer(){return this.#s.get(this.#h)}getLayer(t){return this.#s.get(t)}get currentPageIndex(){return this.#h}addLayer(t){this.#s.set(t.pageIndex,t),this.#A?t.enable():t.disable()}removeLayer(t){this.#s.delete(t.pageIndex)}updateMode(t,i=null,s=!1){return C(this,null,function*(){if(this.#x!==t&&!(this.#O&&(yield this.#O.promise,!this.#O))){if(this.#O=Promise.withResolvers(),this.#x=t,t===D.NONE){this.setEditingState(!1),this.#ot(),this._editorUndoBar?.hide(),this.#O.resolve();return}this.setEditingState(!0),yield this.#at(),this.unselectAll();for(let n of this.#s.values())n.updateMode(t);if(!i){s&&this.addNewEditorFromKeyboard(),this.#O.resolve();return}for(let n of this.#i.values())n.annotationElementId===i?(this.setSelected(n),n.enterInEditMode()):n.unselect();this.#O.resolve()}})}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t!==this.#x&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:t})}updateParams(t,i){if(this.#m){switch(t){case z.CREATE:this.currentLayer.addNewEditor();return;case z.HIGHLIGHT_DEFAULT_COLOR:this.#D?.updateColor(i);break;case z.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#j||=new Map).set(t,i),this.showAllEditors("highlight",i);break}for(let s of this.#v)s.updateParams(t,i);for(let s of this.#m)s.updateDefaultParams(t,i)}}showAllEditors(t,i,s=!1){for(let r of this.#i.values())r.editorType===t&&r.show(i);(this.#j?.get(z.HIGHLIGHT_SHOW_ALL)??!0)!==i&&this.#N([[z.HIGHLIGHT_SHOW_ALL,i]])}enableWaiting(t=!1){if(this.#M!==t){this.#M=t;for(let i of this.#s.values())t?i.disableClick():i.enableClick(),i.div.classList.toggle("waiting",t)}}#at(){return C(this,null,function*(){if(!this.#A){this.#A=!0;let t=[];for(let i of this.#s.values())t.push(i.enable());yield Promise.all(t);for(let i of this.#i.values())i.enable()}})}#ot(){if(this.unselectAll(),this.#A){this.#A=!1;for(let t of this.#s.values())t.disable();for(let t of this.#i.values())t.disable()}}getEditors(t){let i=[];for(let s of this.#i.values())s.pageIndex===t&&i.push(s);return i}getEditor(t){return this.#i.get(t)}addEditor(t){this.#i.set(t.id,t)}removeEditor(t){t.div.contains(document.activeElement)&&(this.#y&&clearTimeout(this.#y),this.#y=setTimeout(()=>{this.focusMainContainer(),this.#y=null},0)),this.#i.delete(t.id),this.unselect(t),(!t.annotationElementId||!this.#a.has(t.annotationElementId))&&this.#n?.remove(t.id)}addDeletedAnnotationElement(t){this.#a.add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return this.#a.has(t)}removeDeletedAnnotationElement(t){this.#a.delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}#Q(t){let i=this.#s.get(t.pageIndex);i?i.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}setActiveEditor(t){this.#e!==t&&(this.#e=t,t&&this.#N(t.propertiesToUpdate))}get#lt(){let t=null;for(t of this.#v);return t}updateUI(t){this.#lt===t&&this.#N(t.propertiesToUpdate)}updateUIForDefaultProperties(t){this.#N(t.defaultPropertiesToUpdate)}toggleSelected(t){if(this.#v.has(t)){this.#v.delete(t),t.unselect(),this.#I({hasSelectedEditor:this.hasSelection});return}this.#v.add(t),t.select(),this.#N(t.propertiesToUpdate),this.#I({hasSelectedEditor:!0})}setSelected(t){this.#l?.commitOrRemove();for(let i of this.#v)i!==t&&i.unselect();this.#v.clear(),this.#v.add(t),t.select(),this.#N(t.propertiesToUpdate),this.#I({hasSelectedEditor:!0})}isSelected(t){return this.#v.has(t)}get firstSelectedEditor(){return this.#v.values().next().value}unselect(t){t.unselect(),this.#v.delete(t),this.#I({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#v.size!==0}get isEnterHandled(){return this.#v.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#o.undo(),this.#I({hasSomethingToUndo:this.#o.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#G()}),this._editorUndoBar?.hide()}redo(){this.#o.redo(),this.#I({hasSomethingToUndo:!0,hasSomethingToRedo:this.#o.hasSomethingToRedo(),isEmpty:this.#G()})}addCommands(t){this.#o.add(t),this.#I({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#G()})}cleanUndoStack(t){this.#o.cleanType(t)}#G(){if(this.#i.size===0)return!0;if(this.#i.size===1)for(let t of this.#i.values())return t.isEmpty();return!1}delete(){this.commitOrRemove();let t=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!t)return;let i=t?[t]:[...this.#v],s=()=>{this._editorUndoBar?.show(n,i.length===1?i[0].editorType:i.length);for(let r of i)r.remove()},n=()=>{for(let r of i)this.#Q(r)};this.addCommands({cmd:s,undo:n,mustExec:!0})}commitOrRemove(){this.#e?.commitOrRemove()}hasSomethingToControl(){return this.#e||this.hasSelection}#Z(t){for(let i of this.#v)i.unselect();this.#v.clear();for(let i of t)i.isEmpty()||(this.#v.add(i),i.select());this.#I({hasSelectedEditor:this.hasSelection})}selectAll(){for(let t of this.#v)t.commit();this.#Z(this.#i.values())}unselectAll(){if(!(this.#e&&(this.#e.commitOrRemove(),this.#x!==D.NONE))&&!this.#l?.commitOrRemove()&&this.hasSelection){for(let t of this.#v)t.unselect();this.#v.clear(),this.#I({hasSelectedEditor:!1})}}translateSelectedEditors(t,i,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;this.#F[0]+=t,this.#F[1]+=i;let[n,r]=this.#F,a=[...this.#v],l=1e3;this.#L&&clearTimeout(this.#L),this.#L=setTimeout(()=>{this.#L=null,this.#F[0]=this.#F[1]=0,this.addCommands({cmd:()=>{for(let c of a)this.#i.has(c.id)&&c.translateInPage(n,r)},undo:()=>{for(let c of a)this.#i.has(c.id)&&c.translateInPage(-n,-r)},mustExec:!1})},l);for(let c of a)c.translateInPage(t,i)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#u=new Map;for(let t of this.#v)this.#u.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#u)return!1;this.disableUserSelect(!1);let t=this.#u;this.#u=null;let i=!1;for(let[{x:n,y:r,pageIndex:a},l]of t)l.newX=n,l.newY=r,l.newPageIndex=a,i||=n!==l.savedX||r!==l.savedY||a!==l.savedPageIndex;if(!i)return!1;let s=(n,r,a,l)=>{if(this.#i.has(n.id)){let c=this.#s.get(l);c?n._setParentAndPosition(c,r,a):(n.pageIndex=l,n.x=r,n.y=a)}};return this.addCommands({cmd:()=>{for(let[n,{newX:r,newY:a,newPageIndex:l}]of t)s(n,r,a,l)},undo:()=>{for(let[n,{savedX:r,savedY:a,savedPageIndex:l}]of t)s(n,r,a,l)},mustExec:!0}),!0}dragSelectedEditors(t,i){if(this.#u)for(let s of this.#u.keys())s.drag(t,i)}rebuild(t){if(t.parent===null){let i=this.getLayer(t.pageIndex);i?(i.changeParent(t),i.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#v.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#e===t}getActive(){return this.#e}getMode(){return this.#x}get imageManager(){return B(this,"imageManager",new en)}getSelectionBoxes(t){if(!t)return null;let i=document.getSelection();for(let d=0,h=i.rangeCount;d<h;d++)if(!t.contains(i.getRangeAt(d).commonAncestorContainer))return null;let{x:s,y:n,width:r,height:a}=t.getBoundingClientRect(),l;switch(t.getAttribute("data-main-rotation")){case"90":l=(d,h,u,m)=>({x:(h-n)/a,y:1-(d+u-s)/r,width:m/a,height:u/r});break;case"180":l=(d,h,u,m)=>({x:1-(d+u-s)/r,y:1-(h+m-n)/a,width:u/r,height:m/a});break;case"270":l=(d,h,u,m)=>({x:1-(h+m-n)/a,y:(d-s)/r,width:m/a,height:u/r});break;default:l=(d,h,u,m)=>({x:(d-s)/r,y:(h-n)/a,width:u/r,height:m/a});break}let c=[];for(let d=0,h=i.rangeCount;d<h;d++){let u=i.getRangeAt(d);if(!u.collapsed)for(let{x:m,y:p,width:f,height:_}of u.getClientRects())f===0||_===0||c.push(l(m,p,f,_))}return c.length===0?null:c}addChangedExistingAnnotation({annotationElementId:t,id:i}){(this.#c||=new Map).set(t,i)}removeChangedExistingAnnotation({annotationElementId:t}){this.#c?.delete(t)}renderAnnotationElement(t){let i=this.#c?.get(t.data.id);if(!i)return;let s=this.#n.getRawValue(i);s&&(this.#x===D.NONE&&!s.hasBeenModified||s.renderAnnotationElement(t))}}return o})(),Ra=(()=>{class o{#t=null;#e=!1;#i=null;#s=null;#r=null;#n=null;#c=!1;#o=null;#d=null;#l=null;#h=null;#a=!1;static#u=null;static _l10n=null;constructor(t){this.#d=t,this.#a=t._uiManager.useNewAltTextFlow,o.#u||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(t){o._l10n??=t}render(){return C(this,null,function*(){let t=this.#i=document.createElement("button");t.className="altText",t.tabIndex="0";let i=this.#s=document.createElement("span");t.append(i),this.#a?(t.classList.add("new"),t.setAttribute("data-l10n-id",o.#u.missing),i.setAttribute("data-l10n-id",o.#u["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),i.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));let s=this.#d._uiManager._signal;t.addEventListener("contextmenu",Rt,{signal:s}),t.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:s});let n=r=>{r.preventDefault(),this.#d._uiManager.editAltText(this.#d),this.#a&&this.#d._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#m}})};return t.addEventListener("click",n,{capture:!0,signal:s}),t.addEventListener("keydown",r=>{r.target===t&&r.key==="Enter"&&(this.#c=!0,n(r))},{signal:s}),yield this.#p(),t})}get#m(){return this.#t&&"added"||this.#t===null&&this.guessedText&&"review"||"missing"}finish(){this.#i&&(this.#i.focus({focusVisible:this.#c}),this.#c=!1)}isEmpty(){return this.#a?this.#t===null:!this.#t&&!this.#e}hasData(){return this.#a?this.#t!==null||!!this.#l:this.isEmpty()}get guessedText(){return this.#l}setGuessedText(t){return C(this,null,function*(){this.#t===null&&(this.#l=t,this.#h=yield o._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t}),this.#p())})}toggleAltTextBadge(t=!1){if(!this.#a||this.#t){this.#o?.remove(),this.#o=null;return}if(!this.#o){let i=this.#o=document.createElement("div");i.className="noAltTextBadge",this.#d.div.append(i)}this.#o.classList.toggle("hidden",!t)}serialize(t){let i=this.#t;return!t&&this.#l===i&&(i=this.#h),{altText:i,decorative:this.#e,guessedText:this.#l,textWithDisclaimer:this.#h}}get data(){return{altText:this.#t,decorative:this.#e}}set data({altText:t,decorative:i,guessedText:s,textWithDisclaimer:n,cancel:r=!1}){s&&(this.#l=s,this.#h=n),!(this.#t===t&&this.#e===i)&&(r||(this.#t=t,this.#e=i),this.#p())}toggle(t=!1){this.#i&&(!t&&this.#n&&(clearTimeout(this.#n),this.#n=null),this.#i.disabled=!t)}shown(){this.#d._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#m}})}destroy(){this.#i?.remove(),this.#i=null,this.#s=null,this.#r=null,this.#o?.remove(),this.#o=null}#p(){return C(this,null,function*(){let t=this.#i;if(!t)return;if(this.#a){if(t.classList.toggle("done",!!this.#t),t.setAttribute("data-l10n-id",o.#u[this.#m]),this.#s?.setAttribute("data-l10n-id",o.#u[`${this.#m}-label`]),!this.#t){this.#r?.remove();return}}else{if(!this.#t&&!this.#e){t.classList.remove("done"),this.#r?.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let i=this.#r;if(!i){this.#r=i=document.createElement("span"),i.className="tooltip",i.setAttribute("role","tooltip"),i.id=`alt-text-tooltip-${this.#d.id}`;let n=100,r=this.#d._uiManager._signal;r.addEventListener("abort",()=>{clearTimeout(this.#n),this.#n=null},{once:!0}),t.addEventListener("mouseenter",()=>{this.#n=setTimeout(()=>{this.#n=null,this.#r.classList.add("show"),this.#d._reportTelemetry({action:"alt_text_tooltip"})},n)},{signal:r}),t.addEventListener("mouseleave",()=>{this.#n&&(clearTimeout(this.#n),this.#n=null),this.#r?.classList.remove("show")},{signal:r})}this.#e?i.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(i.removeAttribute("data-l10n-id"),i.textContent=this.#t),i.parentNode||t.append(i),this.#d.getImageForAltText()?.setAttribute("aria-describedby",i.id)})}}return o})(),q=class o{#t=null;#e=null;#i=null;#s=!1;#r=null;#n="";#c=!1;#o=null;#d=null;#l=null;#h=null;#a="";#u=!1;#m=null;#p=!1;#g=!1;#f=!1;#_=null;#b=0;#y=0;#w=null;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#k=!1;#C=o._zIndex++;static _borderLineWidth=-1;static _colorManager=new nn;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){let e=o.prototype._resizeWithKeyboard,t=ti.TRANSLATE_SMALL,i=ti.TRANSLATE_BIG;return B(this,"_resizerKeyboardManager",new _e([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-i,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[i,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-i]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,i]}],[["Escape","mac+Escape"],o.prototype._stopResizingWithKeyboard]]))}constructor(e){this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;let{rotation:t,rawDims:{pageWidth:i,pageHeight:s,pageX:n,pageY:r}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[i,s],this.pageTranslation=[n,r];let[a,l]=this.parentDimensions;this.x=e.x/a,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return B(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){let t=new rn({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(o._l10n??=e,o._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),o._borderLineWidth!==-1)return;let i=getComputedStyle(document.documentElement);o._borderLineWidth=parseFloat(i.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){G("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#k}set _isDraggable(e){this.#k=e,this.div?.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){let[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#C}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):this.#L(),this.parent=e}focusin(e){this._focusEventsAllowed&&(this.#u?this.#u=!1:this.parent.setSelected(this))}focusout(e){!this._focusEventsAllowed||!this.isAttachedToDOM||e.relatedTarget?.closest(`#${this.id}`)||(e.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,i,s){let[n,r]=this.parentDimensions;[i,s]=this.screenToPageTranslation(i,s),this.x=(e+i)/n,this.y=(t+s)/r,this.fixAndSetPosition()}#S([e,t],i,s){[i,s]=this.screenToPageTranslation(i,s),this.x+=i/e,this.y+=s/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(e,t){this.#S(this.parentDimensions,e,t)}translateInPage(e,t){this.#m||=[this.x,this.y,this.width,this.height],this.#S(this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}drag(e,t){this.#m||=[this.x,this.y,this.width,this.height];let{div:i,parentDimensions:[s,n]}=this;if(this.x+=e/s,this.y+=t/n,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){let{x:h,y:u}=this.div.getBoundingClientRect();this.parent.findNewParent(this,h,u)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:r,y:a}=this,[l,c]=this.getBaseTranslation();r+=l,a+=c;let{style:d}=i;d.left=`${(100*r).toFixed(2)}%`,d.top=`${(100*a).toFixed(2)}%`,this._onTranslating(r,a),i.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!this.#m&&(this.#m[0]!==this.x||this.#m[1]!==this.y)}get _hasBeenResized(){return!!this.#m&&(this.#m[2]!==this.width||this.#m[3]!==this.height)}getBaseTranslation(){let[e,t]=this.parentDimensions,{_borderLineWidth:i}=o,s=i/e,n=i/t;switch(this.rotation){case 90:return[-s,n];case 180:return[s,n];case 270:return[s,-n];default:return[-s,-n]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){let{div:{style:t},pageDimensions:[i,s]}=this,{x:n,y:r,width:a,height:l}=this;if(a*=i,l*=s,n*=i,r*=s,this._mustFixPosition)switch(e){case 0:n=Math.max(0,Math.min(i-a,n)),r=Math.max(0,Math.min(s-l,r));break;case 90:n=Math.max(0,Math.min(i-l,n)),r=Math.min(s,Math.max(a,r));break;case 180:n=Math.min(i,Math.max(a,n)),r=Math.min(s,Math.max(l,r));break;case 270:n=Math.min(i,Math.max(l,n)),r=Math.max(0,Math.min(s-a,r));break}this.x=n/=i,this.y=r/=s;let[c,d]=this.getBaseTranslation();n+=c,r+=d,t.left=`${(100*n).toFixed(2)}%`,t.top=`${(100*r).toFixed(2)}%`,this.moveInDOM()}static#T(e,t,i){switch(i){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}}screenToPageTranslation(e,t){return o.#T(e,t,this.parentRotation)}pageTranslationToScreen(e,t){return o.#T(e,t,360-this.parentRotation)}#A(e){switch(e){case 90:{let[t,i]=this.pageDimensions;return[0,-t/i,i/t,0]}case 180:return[-1,0,0,-1];case 270:{let[t,i]=this.pageDimensions;return[0,t/i,-i/t,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){let{parentScale:e,pageDimensions:[t,i]}=this;return[t*e,i*e]}setDims(e,t){let[i,s]=this.parentDimensions,{style:n}=this.div;n.width=`${(100*e/i).toFixed(2)}%`,this.#c||(n.height=`${(100*t/s).toFixed(2)}%`)}fixDims(){let{style:e}=this.div,{height:t,width:i}=e,s=i.endsWith("%"),n=!this.#c&&t.endsWith("%");if(s&&n)return;let[r,a]=this.parentDimensions;s||(e.width=`${(100*parseFloat(i)/r).toFixed(2)}%`),!this.#c&&!n&&(e.height=`${(100*parseFloat(t)/a).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#M(){if(this.#o)return;this.#o=document.createElement("div"),this.#o.classList.add("resizers");let e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(let i of e){let s=document.createElement("div");this.#o.append(s),s.classList.add("resizer",i),s.setAttribute("data-resizer-name",i),s.addEventListener("pointerdown",this.#E.bind(this,i),{signal:t}),s.addEventListener("contextmenu",Rt,{signal:t}),s.tabIndex=-1}this.div.prepend(this.#o)}#E(e,t){t.preventDefault();let{isMac:i}=ot.platform;if(t.button!==0||t.ctrlKey&&i)return;this.#i?.toggle(!1);let s=this._isDraggable;this._isDraggable=!1,this.#d=[t.screenX,t.screenY];let n=new AbortController,r=this._uiManager.combinedSignal(n);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#B.bind(this,e),{passive:!0,capture:!0,signal:r}),window.addEventListener("touchmove",Lt,{passive:!1,signal:r}),window.addEventListener("contextmenu",Rt,{signal:r}),this.#l={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};let a=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;let c=()=>{n.abort(),this.parent.togglePointerEvents(!0),this.#i?.toggle(!0),this._isDraggable=s,this.parent.div.style.cursor=a,this.div.style.cursor=l,this.#D()};window.addEventListener("pointerup",c,{signal:r}),window.addEventListener("blur",c,{signal:r})}#P(e,t,i,s){this.width=i,this.height=s,this.x=e,this.y=t;let[n,r]=this.parentDimensions;this.setDims(n*i,r*s),this.fixAndSetPosition(),this._onResized()}_onResized(){}#D(){if(!this.#l)return;let{savedX:e,savedY:t,savedWidth:i,savedHeight:s}=this.#l;this.#l=null;let n=this.x,r=this.y,a=this.width,l=this.height;n===e&&r===t&&a===i&&l===s||this.addCommands({cmd:this.#P.bind(this,n,r,a,l),undo:this.#P.bind(this,e,t,i,s),mustExec:!0})}#B(e,t){let[i,s]=this.parentDimensions,n=this.x,r=this.y,a=this.width,l=this.height,c=o.MIN_SIZE/i,d=o.MIN_SIZE/s,h=S=>Math.round(S*1e4)/1e4,u=this.#A(this.rotation),m=(S,I)=>[u[0]*S+u[2]*I,u[1]*S+u[3]*I],p=this.#A(360-this.rotation),f=(S,I)=>[p[0]*S+p[2]*I,p[1]*S+p[3]*I],_,g,b=!1,v=!1;switch(e){case"topLeft":b=!0,_=(S,I)=>[0,0],g=(S,I)=>[S,I];break;case"topMiddle":_=(S,I)=>[S/2,0],g=(S,I)=>[S/2,I];break;case"topRight":b=!0,_=(S,I)=>[S,0],g=(S,I)=>[0,I];break;case"middleRight":v=!0,_=(S,I)=>[S,I/2],g=(S,I)=>[0,I/2];break;case"bottomRight":b=!0,_=(S,I)=>[S,I],g=(S,I)=>[0,0];break;case"bottomMiddle":_=(S,I)=>[S/2,I],g=(S,I)=>[S/2,0];break;case"bottomLeft":b=!0,_=(S,I)=>[0,I],g=(S,I)=>[S,0];break;case"middleLeft":v=!0,_=(S,I)=>[0,I/2],g=(S,I)=>[S,I/2];break}let y=_(a,l),w=g(a,l),A=m(...w),x=h(n+A[0]),M=h(r+A[1]),P=1,j=1,N,U;if(t.fromKeyboard)({deltaX:N,deltaY:U}=t);else{let{screenX:S,screenY:I}=t,[Dt,Gt]=this.#d;[N,U]=this.screenToPageTranslation(S-Dt,I-Gt),this.#d[0]=S,this.#d[1]=I}if([N,U]=f(N/i,U/s),b){let S=Math.hypot(a,l);P=j=Math.max(Math.min(Math.hypot(w[0]-y[0]-N,w[1]-y[1]-U)/S,1/a,1/l),c/a,d/l)}else v?P=Math.max(c,Math.min(1,Math.abs(w[0]-y[0]-N)))/a:j=Math.max(d,Math.min(1,Math.abs(w[1]-y[1]-U)))/l;let it=h(a*P),V=h(l*j);A=m(...g(it,V));let pt=x-A[0],$=M-A[1];this.#m||=[this.x,this.y,this.width,this.height],this.width=it,this.height=V,this.x=pt,this.y=$,this.setDims(i*it,s*V),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#i?.finish()}addEditToolbar(){return C(this,null,function*(){return this._editToolbar||this.#g?this._editToolbar:(this._editToolbar=new Zs(this),this.div.append(this._editToolbar.render()),this.#i&&(yield this._editToolbar.addAltText(this.#i)),this._editToolbar)})}removeEditToolbar(){this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,this.#i?.destroy())}addContainer(e){let t=this._editToolbar?.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}addAltTextButton(){return C(this,null,function*(){this.#i||(Ra.initialize(o._l10n),this.#i=new Ra(this),this.#t&&(this.#i.data=this.#t,this.#t=null),yield this.addEditToolbar())})}get altTextData(){return this.#i?.data}set altTextData(e){this.#i&&(this.#i.data=e)}get guessedAltText(){return this.#i?.guessedText}setGuessedAltText(e){return C(this,null,function*(){yield this.#i?.setGuessedText(e)})}serializeAltText(e){return this.#i?.serialize(e)}hasAltText(){return!!this.#i&&!this.#i.isEmpty()}hasAltTextData(){return this.#i?.hasData()??!1}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=this.#s?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),this.#R();let[e,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*t/e).toFixed(2)}%`,this.div.style.maxHeight=`${(100*e/t).toFixed(2)}%`);let[i,s]=this.getInitialTranslation();return this.translate(i,s),Ui(this,this.div,["pointerdown"]),this._uiManager._editorUndoBar?.hide(),this.div}pointerdown(e){let{isMac:t}=ot.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(this.#u=!0,this._isDraggable){this.#v(e);return}this.#x(e)}get isSelected(){return this._uiManager.isSelected(this)}#x(e){let{isMac:t}=ot.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)}#v(e){let{isSelected:t}=this;this._uiManager.setUpDragSession();let i=new AbortController,s=this._uiManager.combinedSignal(i),n={capture:!0,passive:!1,signal:s},r=l=>{i.abort(),this.#r=null,this.#u=!1,this._uiManager.endDragSession()||this.#x(l)};t&&(this.#b=e.clientX,this.#y=e.clientY,this.#r=e.pointerId,this.#n=e.pointerType,window.addEventListener("pointermove",l=>{let{clientX:c,clientY:d,pointerId:h}=l;if(h!==this.#r){Lt(l);return}let[u,m]=this.screenToPageTranslation(c-this.#b,d-this.#y);this.#b=c,this.#y=d,this._uiManager.dragSelectedEditors(u,m)},n),window.addEventListener("touchmove",Lt,n),window.addEventListener("pointerdown",l=>{l.isPrimary&&l.pointerType===this.#n&&r(l),Lt(l)},n)),this._onStartDragging();let a=l=>{if(!this.#r||this.#r===l.pointerId){r(l),this._onStopDragging();return}Lt(l)};window.addEventListener("pointerup",a,{signal:s}),window.addEventListener("blur",a,{signal:s})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#_&&clearTimeout(this.#_),this.#_=setTimeout(()=>{this.#_=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(e,t,i){e.changeParent(this),this.x=t,this.y=i,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,i=this.rotation){let s=this.parentScale,[n,r]=this.pageDimensions,[a,l]=this.pageTranslation,c=e/s,d=t/s,h=this.x*n,u=this.y*r,m=this.width*n,p=this.height*r;switch(i){case 0:return[h+c+a,r-u-d-p+l,h+c+m+a,r-u-d+l];case 90:return[h+d+a,r-u+c+l,h+d+p+a,r-u+c+m+l];case 180:return[h-c-m+a,r-u+d+l,h-c+a,r-u+d+p+l];case 270:return[h-d-p+a,r-u-c-m+l,h-d+a,r-u-c+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){let[i,s,n,r]=e,a=n-i,l=r-s;switch(this.rotation){case 0:return[i,t-r,a,l];case 90:return[i,t-s,l,a];case 180:return[n,t-s,a,l];case 270:return[n,t-r,l,a];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){this.#g=!0}disableEditMode(){this.#g=!1}isInEditMode(){return this.#g}shouldGetKeyboardEvents(){return this.#f}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){let{top:e,left:t,bottom:i,right:s}=this.getClientDimensions(),{innerHeight:n,innerWidth:r}=window;return t<r&&s>0&&e<n&&i>0}#R(){if(this.#h||!this.div)return;this.#h=new AbortController;let e=this._uiManager.combinedSignal(this.#h);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})}rebuild(){this.#R()}rotate(e){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(e=!1,t=null){G("An editor must be serializable")}static deserialize(e,t,i){return C(this,null,function*(){let s=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:i});s.rotation=e.rotation,s.#t=e.accessibilityData;let[n,r]=s.pageDimensions,[a,l,c,d]=s.getRectInCurrentCoords(e.rect,r);return s.x=a/n,s.y=l/r,s.width=c/n,s.height=d/r,s})}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#h?.abort(),this.#h=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#_&&(clearTimeout(this.#_),this.#_=null),this.#L(),this.removeEditToolbar(),this.#w){for(let e of this.#w.values())clearTimeout(e);this.#w=null}this.parent=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#M(),this.#o.classList.remove("hidden"),Ui(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),this.#l={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};let t=this.#o.children;if(!this.#e){this.#e=Array.from(t);let r=this.#z.bind(this),a=this.#j.bind(this),l=this._uiManager._signal;for(let c of this.#e){let d=c.getAttribute("data-resizer-name");c.setAttribute("role","spinbutton"),c.addEventListener("keydown",r,{signal:l}),c.addEventListener("blur",a,{signal:l}),c.addEventListener("focus",this.#V.bind(this,d),{signal:l}),c.setAttribute("data-l10n-id",o._l10nResizer[d])}}let i=this.#e[0],s=0;for(let r of t){if(r===i)break;s++}let n=(360-this.rotation+this.parentRotation)%360/90*(this.#e.length/4);if(n!==s){if(n<s)for(let a=0;a<s-n;a++)this.#o.append(this.#o.firstChild);else if(n>s)for(let a=0;a<n-s;a++)this.#o.firstChild.before(this.#o.lastChild);let r=0;for(let a of t){let c=this.#e[r++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",o._l10nResizer[c])}}this.#F(0),this.#f=!0,this.#o.firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}#z(e){o._resizerKeyboardManager.exec(this,e)}#j(e){this.#f&&e.relatedTarget?.parentNode!==this.#o&&this.#L()}#V(e){this.#a=this.#f?e:""}#F(e){if(this.#e)for(let t of this.#e)t.tabIndex=e}_resizeWithKeyboard(e,t){this.#f&&this.#B(this.#a,{deltaX:e,deltaY:t,fromKeyboard:!0})}#L(){this.#f=!1,this.#F(-1),this.#D()}_stopResizingWithKeyboard(){this.#L(),this.div.focus()}select(){if(this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#i?.toggleAltTextBadge(!1)}unselect(){this.#o?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#i?.toggleAltTextBadge(!0)}updateParams(e,t){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return this.#p}set isEditing(e){this.#p=e,this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){this.#c=!0;let i=e/t,{style:s}=this.div;s.aspectRatio=i,s.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){this.#w||=new Map;let{action:i}=e,s=this.#w.get(i);s&&clearTimeout(s),s=setTimeout(()=>{this._reportTelemetry(e),this.#w.delete(i),this.#w.size===0&&(this.#w=null)},o._telemetryTimeout),this.#w.set(i,s);return}e.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),this.#s=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#s=!0}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){let i=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),i.before(t)}return t}resetAnnotationElement(e){let{firstChild:t}=e.container;t?.nodeName==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}},rn=class extends q{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}},Da=3285377520,St=4294901760,Vt=65535,$i=class{constructor(e){this.h1=e?e&4294967295:Da,this.h2=e?e&4294967295:Da}update(e){let t,i;if(typeof e=="string"){t=new Uint8Array(e.length*2),i=0;for(let f=0,_=e.length;f<_;f++){let g=e.charCodeAt(f);g<=255?t[i++]=g:(t[i++]=g>>>8,t[i++]=g&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),i=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");let s=i>>2,n=i-s*4,r=new Uint32Array(t.buffer,0,s),a=0,l=0,c=this.h1,d=this.h2,h=3432918353,u=461845907,m=h&Vt,p=u&Vt;for(let f=0;f<s;f++)f&1?(a=r[f],a=a*h&St|a*m&Vt,a=a<<15|a>>>17,a=a*u&St|a*p&Vt,c^=a,c=c<<13|c>>>19,c=c*5+3864292196):(l=r[f],l=l*h&St|l*m&Vt,l=l<<15|l>>>17,l=l*u&St|l*p&Vt,d^=l,d=d<<13|d>>>19,d=d*5+3864292196);switch(a=0,n){case 3:a^=t[s*4+2]<<16;case 2:a^=t[s*4+1]<<8;case 1:a^=t[s*4],a=a*h&St|a*m&Vt,a=a<<15|a>>>17,a=a*u&St|a*p&Vt,s&1?c^=a:d^=a}this.h1=c,this.h2=d}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&St|e*36045&Vt,t=t*4283543511&St|((t<<16|e>>>16)*2950163797&St)>>>16,e^=t>>>1,e=e*444984403&St|e*60499&Vt,t=t*3301882366&St|((t<<16|e>>>16)*3120437893&St)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}},an=Object.freeze({map:null,hash:"",transfer:void 0}),ei=class{#t=!1;#e=null;#i=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){let i=this.#i.get(e);return i===void 0?t:Object.assign(t,i)}getRawValue(e){return this.#i.get(e)}remove(e){if(this.#i.delete(e),this.#i.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(let t of this.#i.values())if(t instanceof q)return;this.onAnnotationEditor(null)}}setValue(e,t){let i=this.#i.get(e),s=!1;if(i!==void 0)for(let[n,r]of Object.entries(t))i[n]!==r&&(s=!0,i[n]=r);else s=!0,this.#i.set(e,t);s&&this.#s(),t instanceof q&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return this.#i.has(e)}getAll(){return this.#i.size>0?gr(this.#i):null}setAll(e){for(let[t,i]of Object.entries(e))this.setValue(t,i)}get size(){return this.#i.size}#s(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new Wi(this)}get serializable(){if(this.#i.size===0)return an;let e=new Map,t=new $i,i=[],s=Object.create(null),n=!1;for(let[r,a]of this.#i){let l=a instanceof q?a.serialize(!1,s):a;l&&(e.set(r,l),t.update(`${r}:${JSON.stringify(l)}`),n||=!!l.bitmap)}if(n)for(let r of e.values())r.bitmap&&i.push(r.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:i}:an}get editorStats(){let e=null,t=new Map;for(let i of this.#i.values()){if(!(i instanceof q))continue;let s=i.telemetryFinalData;if(!s)continue;let{type:n}=s;t.has(n)||t.set(n,Object.getPrototypeOf(i).constructor),e||=Object.create(null);let r=e[n]||=new Map;for(let[a,l]of Object.entries(s)){if(a==="type")continue;let c=r.get(a);c||(c=new Map,r.set(a,c));let d=c.get(l)??0;c.set(l,d+1)}}for(let[i,s]of t)e[i]=s.computeTelemetryFinalData(e[i]);return e}resetModifiedIds(){this.#e=null}get modifiedIds(){if(this.#e)return this.#e;let e=[];for(let t of this.#i.values())!(t instanceof q)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return this.#e={ids:new Set(e),hash:e.join(",")}}},Wi=class extends ei{#t;constructor(e){super();let{map:t,hash:i,transfer:s}=e.serializable,n=structuredClone(t,s?{transfer:s}:null);this.#t={map:n,hash:i,transfer:s}}get print(){G("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}get modifiedIds(){return B(this,"modifiedIds",{ids:new Set,hash:""})}},on=class{#t=new Set;constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));let t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(let e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}loadSystemFont(i){return C(this,arguments,function*({systemFontInfo:e,_inspectFont:t}){if(!(!e||this.#t.has(e.loadedName))){if(et(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){let{loadedName:s,src:n,style:r}=e,a=new FontFace(s,n,r);this.addNativeFontFace(a);try{yield a.load(),this.#t.add(s),t?.(e)}catch{F(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(a)}return}G("Not implemented: loadSystemFont without the Font Loading API.")}})}bind(e){return C(this,null,function*(){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){yield this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){let i=e.createNativeFontFace();if(i){this.addNativeFontFace(i);try{yield i.loaded}catch(s){throw F(`Failed to load font '${i.family}': '${s}'.`),e.disableFontFace=!0,s}}return}let t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;yield new Promise(i=>{let s=this._queueLoadingCallback(i);this._prepareFontLoadEvent(e,s)})}})}get isFontLoadingAPISupported(){let e=!!this._document?.fonts;return B(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){let e=!1;return(mt||typeof navigator<"u"&&typeof navigator?.userAgent=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),B(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){function t(){for(et(!s.done,"completeRequest() cannot be called twice."),s.done=!0;i.length>0&&i[0].done;){let n=i.shift();setTimeout(n.callback,0)}}let{loadingRequests:i}=this,s={done:!1,complete:t,callback:e};return i.push(s),s}get _loadTestFont(){let e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return B(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function i(y,w){return y.charCodeAt(w)<<24|y.charCodeAt(w+1)<<16|y.charCodeAt(w+2)<<8|y.charCodeAt(w+3)&255}function s(y,w,A,x){let M=y.substring(0,w),P=y.substring(w+A);return M+x+P}let n,r,a=this._document.createElement("canvas");a.width=1,a.height=1;let l=a.getContext("2d"),c=0;function d(y,w){if(++c>30){F("Load test font never loaded."),w();return}if(l.font="30px "+y,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){w();return}setTimeout(d.bind(null,y,w))}let h=`lt${Date.now()}${this.loadTestFontId++}`,u=this._loadTestFont;u=s(u,976,h.length,h);let p=16,f=1482184792,_=i(u,p);for(n=0,r=h.length-3;n<r;n+=4)_=_-f+i(h,n)|0;n<h.length&&(_=_-f+i(h+"XXX",n)|0),u=s(u,p,4,Qo(_));let g=`url(data:font/opentype;base64,${btoa(u)});`,b=`@font-face {font-family:"${h}";src:${g}}`;this.insertRule(b);let v=this._document.createElement("div");v.style.visibility="hidden",v.style.width=v.style.height="10px",v.style.position="absolute",v.style.top=v.style.left="0px";for(let y of[e.loadedName,h]){let w=this._document.createElement("span");w.textContent="Hi",w.style.fontFamily=y,v.append(w)}this._document.body.append(v),d(h,()=>{v.remove(),t.complete()})}},ln=class{constructor(e,{disableFontFace:t=!1,inspectFont:i=null}){this.compiledGlyphs=Object.create(null);for(let s in e)this[s]=e[s];this.disableFontFace=t===!0,this._inspectFont=i}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{let t={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(t.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,t)}return this._inspectFont?.(this),e}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;let e=`url(data:${this.mimetype};base64,${sl(this.data)});`,t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${e}}`}return this._inspectFont?.(this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];let i;try{i=e.get(this.loadedName+"_path_"+t)}catch(n){F(`getPathGenerator - ignoring character: "${n}".`)}if(!Array.isArray(i)||i.length===0)return this.compiledGlyphs[t]=function(n,r){};let s=[];for(let n=0,r=i.length;n<r;)switch(i[n++]){case $t.BEZIER_CURVE_TO:{let[a,l,c,d,h,u]=i.slice(n,n+6);s.push(m=>m.bezierCurveTo(a,l,c,d,h,u)),n+=6}break;case $t.MOVE_TO:{let[a,l]=i.slice(n,n+2);s.push(c=>c.moveTo(a,l)),n+=2}break;case $t.LINE_TO:{let[a,l]=i.slice(n,n+2);s.push(c=>c.lineTo(a,l)),n+=2}break;case $t.QUADRATIC_CURVE_TO:{let[a,l,c,d]=i.slice(n,n+4);s.push(h=>h.quadraticCurveTo(a,l,c,d)),n+=4}break;case $t.RESTORE:s.push(a=>a.restore());break;case $t.SAVE:s.push(a=>a.save());break;case $t.SCALE:et(s.length===2,"Scale command is only valid at the third position.");break;case $t.TRANSFORM:{let[a,l,c,d,h,u]=i.slice(n,n+6);s.push(m=>m.transform(a,l,c,d,h,u)),n+=6}break;case $t.TRANSLATE:{let[a,l]=i.slice(n,n+2);s.push(c=>c.translate(a,l)),n+=2}break}return s.push(n=>n.closePath()),this.compiledGlyphs[t]=function(r,a){s[0](r),s[1](r),r.scale(a,-a);for(let l=2,c=s.length;l<c;l++)s[l](r)}}},Xi=class{#t=!1;constructor({enableHWA:e=!1}){this.#t=e}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");let i=this._createCanvas(e,t);return{canvas:i,context:i.getContext("2d",{willReadFrequently:!this.#t})}}reset(e,t,i){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||i<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=i}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){G("Abstract method `_createCanvas` called.")}},cn=class extends Xi{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){let i=this._document.createElement("canvas");return i.width=e,i.height=t,i}},qi=class{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}fetch(t){return C(this,arguments,function*({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");let i=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(i).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${i}`)})})}_fetch(e){return C(this,null,function*(){G("Abstract method `_fetch` called.")})}},Yi=class extends qi{_fetch(e){return C(this,null,function*(){let t=yield ys(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):vs(t)})}},Ki=class{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,i,s,n){return"none"}destroy(e=!1){}},dn=class extends Ki{#t;#e;#i;#s;#r;#n;#c=0;constructor({docId:e,ownerDocument:t=globalThis.document}){super(),this.#s=e,this.#r=t}get#o(){return this.#e||=new Map}get#d(){return this.#n||=new Map}get#l(){if(!this.#i){let e=this.#r.createElement("div"),{style:t}=e;t.visibility="hidden",t.contain="strict",t.width=t.height=0,t.position="absolute",t.top=t.left=0,t.zIndex=-1;let i=this.#r.createElementNS(Wt,"svg");i.setAttribute("width",0),i.setAttribute("height",0),this.#i=this.#r.createElementNS(Wt,"defs"),e.append(i),i.append(this.#i),this.#r.body.append(e)}return this.#i}#h(e){if(e.length===1){let l=e[0],c=new Array(256);for(let h=0;h<256;h++)c[h]=l[h]/255;let d=c.join(",");return[d,d,d]}let[t,i,s]=e,n=new Array(256),r=new Array(256),a=new Array(256);for(let l=0;l<256;l++)n[l]=t[l]/255,r[l]=i[l]/255,a[l]=s[l]/255;return[n.join(","),r.join(","),a.join(",")]}#a(e){if(this.#t===void 0){this.#t="";let t=this.#r.URL;t!==this.#r.baseURI&&(ws(t)?F('#createUrl: ignore "data:"-URL for performance reasons.'):this.#t=t.split("#",1)[0])}return`url(${this.#t}#${e})`}addFilter(e){if(!e)return"none";let t=this.#o.get(e);if(t)return t;let[i,s,n]=this.#h(e),r=e.length===1?i:`${i}${s}${n}`;if(t=this.#o.get(r),t)return this.#o.set(e,t),t;let a=`g_${this.#s}_transfer_map_${this.#c++}`,l=this.#a(a);this.#o.set(e,l),this.#o.set(r,l);let c=this.#p(a);return this.#f(i,s,n,c),l}addHCMFilter(e,t){let i=`${e}-${t}`,s="base",n=this.#d.get(s);if(n?.key===i||(n?(n.filter?.remove(),n.key=i,n.url="none",n.filter=null):(n={key:i,url:"none",filter:null},this.#d.set(s,n)),!e||!t))return n.url;let r=this.#b(e);e=E.makeHexColor(...r);let a=this.#b(t);if(t=E.makeHexColor(...a),this.#l.style.color="",e==="#000000"&&t==="#ffffff"||e===t)return n.url;let l=new Array(256);for(let m=0;m<=255;m++){let p=m/255;l[m]=p<=.03928?p/12.92:((p+.055)/1.055)**2.4}let c=l.join(","),d=`g_${this.#s}_hcm_filter`,h=n.filter=this.#p(d);this.#f(c,c,c,h),this.#m(h);let u=(m,p)=>{let f=r[m]/255,_=a[m]/255,g=new Array(p+1);for(let b=0;b<=p;b++)g[b]=f+b/p*(_-f);return g.join(",")};return this.#f(u(0,5),u(1,5),u(2,5),h),n.url=this.#a(d),n.url}addAlphaFilter(e){let t=this.#o.get(e);if(t)return t;let[i]=this.#h([e]),s=`alpha_${i}`;if(t=this.#o.get(s),t)return this.#o.set(e,t),t;let n=`g_${this.#s}_alpha_map_${this.#c++}`,r=this.#a(n);this.#o.set(e,r),this.#o.set(s,r);let a=this.#p(n);return this.#_(i,a),r}addLuminosityFilter(e){let t=this.#o.get(e||"luminosity");if(t)return t;let i,s;if(e?([i]=this.#h([e]),s=`luminosity_${i}`):s="luminosity",t=this.#o.get(s),t)return this.#o.set(e,t),t;let n=`g_${this.#s}_luminosity_map_${this.#c++}`,r=this.#a(n);this.#o.set(e,r),this.#o.set(s,r);let a=this.#p(n);return this.#u(a),e&&this.#_(i,a),r}addHighlightHCMFilter(e,t,i,s,n){let r=`${t}-${i}-${s}-${n}`,a=this.#d.get(e);if(a?.key===r||(a?(a.filter?.remove(),a.key=r,a.url="none",a.filter=null):(a={key:r,url:"none",filter:null},this.#d.set(e,a)),!t||!i))return a.url;let[l,c]=[t,i].map(this.#b.bind(this)),d=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),h=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),[u,m]=[s,n].map(this.#b.bind(this));h<d&&([d,h,u,m]=[h,d,m,u]),this.#l.style.color="";let p=(g,b,v)=>{let y=new Array(256),w=(h-d)/v,A=g/255,x=(b-g)/(255*v),M=0;for(let P=0;P<=v;P++){let j=Math.round(d+P*w),N=A+P*x;for(let U=M;U<=j;U++)y[U]=N;M=j+1}for(let P=M;P<256;P++)y[P]=y[M-1];return y.join(",")},f=`g_${this.#s}_hcm_${e}_filter`,_=a.filter=this.#p(f);return this.#m(_),this.#f(p(u[0],m[0],5),p(u[1],m[1],5),p(u[2],m[2],5),_),a.url=this.#a(f),a.url}destroy(e=!1){e&&this.#n?.size||(this.#i?.parentNode.parentNode.remove(),this.#i=null,this.#e?.clear(),this.#e=null,this.#n?.clear(),this.#n=null,this.#c=0)}#u(e){let t=this.#r.createElementNS(Wt,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(t)}#m(e){let t=this.#r.createElementNS(Wt,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(t)}#p(e){let t=this.#r.createElementNS(Wt,"filter");return t.setAttribute("color-interpolation-filters","sRGB"),t.setAttribute("id",e),this.#l.append(t),t}#g(e,t,i){let s=this.#r.createElementNS(Wt,t);s.setAttribute("type","discrete"),s.setAttribute("tableValues",i),e.append(s)}#f(e,t,i,s){let n=this.#r.createElementNS(Wt,"feComponentTransfer");s.append(n),this.#g(n,"feFuncR",e),this.#g(n,"feFuncG",t),this.#g(n,"feFuncB",i)}#_(e,t){let i=this.#r.createElementNS(Wt,"feComponentTransfer");t.append(i),this.#g(i,"feFuncA",e)}#b(e){return this.#l.style.color=e,vr(getComputedStyle(this.#l).getPropertyValue("color"))}},Qi=class{constructor({baseUrl:e=null}){this.baseUrl=e}fetch(t){return C(this,arguments,function*({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");let i=`${this.baseUrl}${e}`;return this._fetch(i).catch(s=>{throw new Error(`Unable to load font data at: ${i}`)})})}_fetch(e){return C(this,null,function*(){G("Abstract method `_fetch` called.")})}},Zi=class extends Qi{_fetch(e){return C(this,null,function*(){let t=yield ys(e,"arraybuffer");return new Uint8Array(t)})}};function Ya(o){return C(this,null,function*(){let t=yield process.getBuiltinModule("fs").promises.readFile(o);return new Uint8Array(t)})}var hn=class extends Ki{},un=class extends Xi{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}},mn=class extends qi{_fetch(e){return C(this,null,function*(){return Ya(e)})}},pn=class extends Qi{_fetch(e){return C(this,null,function*(){return Ya(e)})}},ht={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function fn(o,e){if(!e)return;let t=e[2]-e[0],i=e[3]-e[1],s=new Path2D;s.rect(e[0],e[1],t,i),o.clip(s)}var ii=class{getPattern(){G("Abstract method `getPattern` called.")}},gn=class extends ii{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(let i of this._colorStops)t.addColorStop(i[0],i[1]);return t}getPattern(e,t,i,s){let n;if(s===ht.STROKE||s===ht.FILL){let r=t.current.getClippedPathBoundingBox(s,X(e))||[0,0,0,0],a=Math.ceil(r[2]-r[0])||1,l=Math.ceil(r[3]-r[1])||1,c=t.cachedCanvases.getCanvas("pattern",a,l),d=c.context;d.clearRect(0,0,d.canvas.width,d.canvas.height),d.beginPath(),d.rect(0,0,d.canvas.width,d.canvas.height),d.translate(-r[0],-r[1]),i=E.transform(i,[1,0,0,1,r[0],r[1]]),d.transform(...t.baseTransform),this.matrix&&d.transform(...this.matrix),fn(d,this._bbox),d.fillStyle=this._createGradient(d),d.fill(),n=e.createPattern(c.canvas,"no-repeat");let h=new DOMMatrix(i);n.setTransform(h)}else fn(e,this._bbox),n=this._createGradient(e);return n}};function Xs(o,e,t,i,s,n,r,a){let l=e.coords,c=e.colors,d=o.data,h=o.width*4,u;l[t+1]>l[i+1]&&(u=t,t=i,i=u,u=n,n=r,r=u),l[i+1]>l[s+1]&&(u=i,i=s,s=u,u=r,r=a,a=u),l[t+1]>l[i+1]&&(u=t,t=i,i=u,u=n,n=r,r=u);let m=(l[t]+e.offsetX)*e.scaleX,p=(l[t+1]+e.offsetY)*e.scaleY,f=(l[i]+e.offsetX)*e.scaleX,_=(l[i+1]+e.offsetY)*e.scaleY,g=(l[s]+e.offsetX)*e.scaleX,b=(l[s+1]+e.offsetY)*e.scaleY;if(p>=b)return;let v=c[n],y=c[n+1],w=c[n+2],A=c[r],x=c[r+1],M=c[r+2],P=c[a],j=c[a+1],N=c[a+2],U=Math.round(p),it=Math.round(b),V,pt,$,S,I,Dt,Gt,yt;for(let rt=U;rt<=it;rt++){if(rt<_){let W=rt<p?0:(p-rt)/(p-_);V=m-(m-f)*W,pt=v-(v-A)*W,$=y-(y-x)*W,S=w-(w-M)*W}else{let W;rt>b?W=1:_===b?W=0:W=(_-rt)/(_-b),V=f-(f-g)*W,pt=A-(A-P)*W,$=x-(x-j)*W,S=M-(M-N)*W}let Q;rt<p?Q=0:rt>b?Q=1:Q=(p-rt)/(p-b),I=m-(m-g)*Q,Dt=v-(v-P)*Q,Gt=y-(y-j)*Q,yt=w-(w-N)*Q;let ve=Math.round(Math.min(V,I)),Re=Math.round(Math.max(V,I)),wt=h*rt+ve*4;for(let W=ve;W<=Re;W++)Q=(V-W)/(V-I),Q<0?Q=0:Q>1&&(Q=1),d[wt++]=pt-(pt-Dt)*Q|0,d[wt++]=$-($-Gt)*Q|0,d[wt++]=S-(S-yt)*Q|0,d[wt++]=255}}function ll(o,e,t){let i=e.coords,s=e.colors,n,r;switch(e.type){case"lattice":let a=e.verticesPerRow,l=Math.floor(i.length/a)-1,c=a-1;for(n=0;n<l;n++){let d=n*a;for(let h=0;h<c;h++,d++)Xs(o,t,i[d],i[d+1],i[d+a],s[d],s[d+1],s[d+a]),Xs(o,t,i[d+a+1],i[d+1],i[d+a],s[d+a+1],s[d+1],s[d+a])}break;case"triangles":for(n=0,r=i.length;n<r;n+=3)Xs(o,t,i[n],i[n+1],i[n+2],s[n],s[n+1],s[n+2]);break;default:throw new Error("illegal figure")}}var _n=class extends ii{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,i){let a=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),c=Math.ceil(this._bounds[2])-a,d=Math.ceil(this._bounds[3])-l,h=Math.min(Math.ceil(Math.abs(c*e[0]*1.1)),3e3),u=Math.min(Math.ceil(Math.abs(d*e[1]*1.1)),3e3),m=c/h,p=d/u,f={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-l,scaleX:1/m,scaleY:1/p},_=h+2*2,g=u+2*2,b=i.getCanvas("mesh",_,g),v=b.context,y=v.createImageData(h,u);if(t){let A=y.data;for(let x=0,M=A.length;x<M;x+=4)A[x]=t[0],A[x+1]=t[1],A[x+2]=t[2],A[x+3]=255}for(let A of this._figures)ll(y,A,f);return v.putImageData(y,2,2),{canvas:b.canvas,offsetX:a-2*m,offsetY:l-2*p,scaleX:m,scaleY:p}}getPattern(e,t,i,s){fn(e,this._bbox);let n;if(s===ht.SHADING)n=E.singularValueDecompose2dScale(X(e));else if(n=E.singularValueDecompose2dScale(t.baseTransform),this.matrix){let a=E.singularValueDecompose2dScale(this.matrix);n=[n[0]*a[0],n[1]*a[1]]}let r=this._createMeshCanvas(n,s===ht.SHADING?null:this._background,t.cachedCanvases);return s!==ht.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(r.offsetX,r.offsetY),e.scale(r.scaleX,r.scaleY),e.createPattern(r.canvas,"no-repeat")}},bn=class extends ii{getPattern(){return"hotpink"}};function cl(o){switch(o[0]){case"RadialAxial":return new gn(o);case"Mesh":return new _n(o);case"Dummy":return new bn}throw new Error(`Unknown IR type: ${o[0]}`)}var Oa={COLORED:1,UNCOLORED:2},dl=(()=>{class o{static MAX_PATTERN_SIZE=3e3;constructor(t,i,s,n,r){this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.color=i,this.ctx=s,this.canvasGraphicsFactory=n,this.baseTransform=r}createPatternCanvas(t){let{bbox:i,operatorList:s,paintType:n,tilingType:r,color:a,canvasGraphicsFactory:l}=this,{xstep:c,ystep:d}=this;c=Math.abs(c),d=Math.abs(d),bs("TilingType: "+r);let h=i[0],u=i[1],m=i[2],p=i[3],f=m-h,_=p-u,g=E.singularValueDecompose2dScale(this.matrix),b=E.singularValueDecompose2dScale(this.baseTransform),v=g[0]*b[0],y=g[1]*b[1],w=f,A=_,x=!1,M=!1,P=Math.ceil(c*v),j=Math.ceil(d*y),N=Math.ceil(f*v),U=Math.ceil(_*y);P>=N?w=c:x=!0,j>=U?A=d:M=!0;let it=this.getSizeAndScale(w,this.ctx.canvas.width,v),V=this.getSizeAndScale(A,this.ctx.canvas.height,y),pt=t.cachedCanvases.getCanvas("pattern",it.size,V.size),$=pt.context,S=l.createCanvasGraphics($);if(S.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(S,n,a),$.translate(-it.scale*h,-V.scale*u),S.transform(it.scale,0,0,V.scale,0,0),$.save(),this.clipBbox(S,h,u,m,p),S.baseTransform=X(S.ctx),S.executeOperatorList(s),S.endDrawing(),$.restore(),x||M){let I=pt.canvas;x&&(w=c),M&&(A=d);let Dt=this.getSizeAndScale(w,this.ctx.canvas.width,v),Gt=this.getSizeAndScale(A,this.ctx.canvas.height,y),yt=Dt.size,rt=Gt.size,Q=t.cachedCanvases.getCanvas("pattern-workaround",yt,rt),ve=Q.context,Re=x?Math.floor(f/c):0,wt=M?Math.floor(_/d):0;for(let W=0;W<=Re;W++)for(let Ot=0;Ot<=wt;Ot++)ve.drawImage(I,yt*W,rt*Ot,yt,rt,0,0,yt,rt);return{canvas:Q.canvas,scaleX:Dt.scale,scaleY:Gt.scale,offsetX:h,offsetY:u}}return{canvas:pt.canvas,scaleX:it.scale,scaleY:V.scale,offsetX:h,offsetY:u}}getSizeAndScale(t,i,s){let n=Math.max(o.MAX_PATTERN_SIZE,i),r=Math.ceil(t*s);return r>=n?r=n:s=r/t,{scale:s,size:r}}clipBbox(t,i,s,n,r){let a=n-i,l=r-s;t.ctx.rect(i,s,a,l),t.current.updateRectMinMax(X(t.ctx),[i,s,n,r]),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,i,s){let n=t.ctx,r=t.current;switch(i){case Oa.COLORED:let a=this.ctx;n.fillStyle=a.fillStyle,n.strokeStyle=a.strokeStyle,r.fillColor=a.fillStyle,r.strokeColor=a.strokeStyle;break;case Oa.UNCOLORED:let l=E.makeHexColor(s[0],s[1],s[2]);n.fillStyle=l,n.strokeStyle=l,r.fillColor=l,r.strokeColor=l;break;default:throw new Qs(`Unsupported paint type: ${i}`)}}getPattern(t,i,s,n){let r=s;n!==ht.SHADING&&(r=E.transform(r,i.baseTransform),this.matrix&&(r=E.transform(r,this.matrix)));let a=this.createPatternCanvas(i),l=new DOMMatrix(r);l=l.translate(a.offsetX,a.offsetY),l=l.scale(1/a.scaleX,1/a.scaleY);let c=t.createPattern(a.canvas,"repeat");return c.setTransform(l),c}}return o})();function hl({src:o,srcPos:e=0,dest:t,width:i,height:s,nonBlackColor:n=4294967295,inverseDecode:r=!1}){let a=ot.isLittleEndian?4278190080:255,[l,c]=r?[n,a]:[a,n],d=i>>3,h=i&7,u=o.length;t=new Uint32Array(t.buffer);let m=0;for(let p=0;p<s;p++){for(let _=e+d;e<_;e++){let g=e<u?o[e]:255;t[m++]=g&128?c:l,t[m++]=g&64?c:l,t[m++]=g&32?c:l,t[m++]=g&16?c:l,t[m++]=g&8?c:l,t[m++]=g&4?c:l,t[m++]=g&2?c:l,t[m++]=g&1?c:l}if(h===0)continue;let f=e<u?o[e++]:255;for(let _=0;_<h;_++)t[m++]=f&1<<7-_?c:l}return{srcPos:e,destPos:m}}var Fa=16,Na=100,ul=15,Ba=10,za=1e3,bt=16;function ml(o,e){if(o._removeMirroring)throw new Error("Context is already forwarding operations.");o.__originalSave=o.save,o.__originalRestore=o.restore,o.__originalRotate=o.rotate,o.__originalScale=o.scale,o.__originalTranslate=o.translate,o.__originalTransform=o.transform,o.__originalSetTransform=o.setTransform,o.__originalResetTransform=o.resetTransform,o.__originalClip=o.clip,o.__originalMoveTo=o.moveTo,o.__originalLineTo=o.lineTo,o.__originalBezierCurveTo=o.bezierCurveTo,o.__originalRect=o.rect,o.__originalClosePath=o.closePath,o.__originalBeginPath=o.beginPath,o._removeMirroring=()=>{o.save=o.__originalSave,o.restore=o.__originalRestore,o.rotate=o.__originalRotate,o.scale=o.__originalScale,o.translate=o.__originalTranslate,o.transform=o.__originalTransform,o.setTransform=o.__originalSetTransform,o.resetTransform=o.__originalResetTransform,o.clip=o.__originalClip,o.moveTo=o.__originalMoveTo,o.lineTo=o.__originalLineTo,o.bezierCurveTo=o.__originalBezierCurveTo,o.rect=o.__originalRect,o.closePath=o.__originalClosePath,o.beginPath=o.__originalBeginPath,delete o._removeMirroring},o.save=function(){e.save(),this.__originalSave()},o.restore=function(){e.restore(),this.__originalRestore()},o.translate=function(i,s){e.translate(i,s),this.__originalTranslate(i,s)},o.scale=function(i,s){e.scale(i,s),this.__originalScale(i,s)},o.transform=function(i,s,n,r,a,l){e.transform(i,s,n,r,a,l),this.__originalTransform(i,s,n,r,a,l)},o.setTransform=function(i,s,n,r,a,l){e.setTransform(i,s,n,r,a,l),this.__originalSetTransform(i,s,n,r,a,l)},o.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},o.rotate=function(i){e.rotate(i),this.__originalRotate(i)},o.clip=function(i){e.clip(i),this.__originalClip(i)},o.moveTo=function(t,i){e.moveTo(t,i),this.__originalMoveTo(t,i)},o.lineTo=function(t,i){e.lineTo(t,i),this.__originalLineTo(t,i)},o.bezierCurveTo=function(t,i,s,n,r,a){e.bezierCurveTo(t,i,s,n,r,a),this.__originalBezierCurveTo(t,i,s,n,r,a)},o.rect=function(t,i,s,n){e.rect(t,i,s,n),this.__originalRect(t,i,s,n)},o.closePath=function(){e.closePath(),this.__originalClosePath()},o.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}var vn=class{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,i){let s;return this.cache[e]!==void 0?(s=this.cache[e],this.canvasFactory.reset(s,t,i)):(s=this.canvasFactory.create(t,i),this.cache[e]=s),s}delete(e){delete this.cache[e]}clear(){for(let e in this.cache){let t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}};function Di(o,e,t,i,s,n,r,a,l,c){let[d,h,u,m,p,f]=X(o);if(h===0&&u===0){let b=r*d+p,v=Math.round(b),y=a*m+f,w=Math.round(y),A=(r+l)*d+p,x=Math.abs(Math.round(A)-v)||1,M=(a+c)*m+f,P=Math.abs(Math.round(M)-w)||1;return o.setTransform(Math.sign(d),0,0,Math.sign(m),v,w),o.drawImage(e,t,i,s,n,0,0,x,P),o.setTransform(d,h,u,m,p,f),[x,P]}if(d===0&&m===0){let b=a*u+p,v=Math.round(b),y=r*h+f,w=Math.round(y),A=(a+c)*u+p,x=Math.abs(Math.round(A)-v)||1,M=(r+l)*h+f,P=Math.abs(Math.round(M)-w)||1;return o.setTransform(0,Math.sign(h),Math.sign(u),0,v,w),o.drawImage(e,t,i,s,n,0,0,P,x),o.setTransform(d,h,u,m,p,f),[P,x]}o.drawImage(e,t,i,s,n,r,a,l,c);let _=Math.hypot(d,h),g=Math.hypot(u,m);return[_*l,g*c]}function pl(o){let{width:e,height:t}=o;if(e>za||t>za)return null;let i=1e3,s=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),n=e+1,r=new Uint8Array(n*(t+1)),a,l,c,d=e+7&-8,h=new Uint8Array(d*t),u=0;for(let g of o.data){let b=128;for(;b>0;)h[u++]=g&b?0:255,b>>=1}let m=0;for(u=0,h[u]!==0&&(r[0]=1,++m),l=1;l<e;l++)h[u]!==h[u+1]&&(r[l]=h[u]?2:1,++m),u++;for(h[u]!==0&&(r[l]=2,++m),a=1;a<t;a++){u=a*d,c=a*n,h[u-d]!==h[u]&&(r[c]=h[u]?1:8,++m);let g=(h[u]?4:0)+(h[u-d]?8:0);for(l=1;l<e;l++)g=(g>>2)+(h[u+1]?4:0)+(h[u-d+1]?8:0),s[g]&&(r[c+l]=s[g],++m),u++;if(h[u-d]!==h[u]&&(r[c+l]=h[u]?2:4,++m),m>i)return null}for(u=d*(t-1),c=a*n,h[u]!==0&&(r[c]=8,++m),l=1;l<e;l++)h[u]!==h[u+1]&&(r[c+l]=h[u]?4:8,++m),u++;if(h[u]!==0&&(r[c+l]=4,++m),m>i)return null;let p=new Int32Array([0,n,-1,0,-n,0,0,0,1]),f=new Path2D;for(a=0;m&&a<=t;a++){let g=a*n,b=g+e;for(;g<b&&!r[g];)g++;if(g===b)continue;f.moveTo(g%n,a);let v=g,y=r[g];do{let w=p[y];do g+=w;while(!r[g]);let A=r[g];A!==5&&A!==10?(y=A,r[g]=0):(y=A&51*y>>4,r[g]&=y>>2|y<<2),f.lineTo(g%n,g/n|0),r[g]||--m}while(v!==g);--a}return h=null,r=null,function(g){g.save(),g.scale(1/e,-1/t),g.translate(0,-t),g.fill(f),g.beginPath(),g.restore()}}var Ji=class{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=Xa,this.textMatrixScale=1,this.fontMatrix=Ks,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=dt.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){let e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,i){[t,i]=E.applyTransform([t,i],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,i),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,i)}updateRectMinMax(e,t){let i=E.applyTransform(t,e),s=E.applyTransform(t.slice(2),e),n=E.applyTransform([t[0],t[3]],e),r=E.applyTransform([t[2],t[1]],e);this.minX=Math.min(this.minX,i[0],s[0],n[0],r[0]),this.minY=Math.min(this.minY,i[1],s[1],n[1],r[1]),this.maxX=Math.max(this.maxX,i[0],s[0],n[0],r[0]),this.maxY=Math.max(this.maxY,i[1],s[1],n[1],r[1])}updateScalingPathMinMax(e,t){E.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.minY=Math.min(this.minY,t[1]),this.maxX=Math.max(this.maxX,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,i,s,n,r,a,l,c,d){let h=E.bezierBoundingBox(t,i,s,n,r,a,l,c,d);d||this.updateRectMinMax(e,h)}getPathBoundingBox(e=ht.FILL,t=null){let i=[this.minX,this.minY,this.maxX,this.maxY];if(e===ht.STROKE){t||G("Stroke bounding box must include transform.");let s=E.singularValueDecompose2dScale(t),n=s[0]*this.lineWidth/2,r=s[1]*this.lineWidth/2;i[0]-=n,i[1]-=r,i[2]+=n,i[3]+=r}return i}updateClipFromPath(){let e=E.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=ht.FILL,t=null){return E.intersect(this.clipBox,this.getPathBoundingBox(e,t))}};function Ha(o,e){if(e instanceof ImageData){o.putImageData(e,0,0);return}let t=e.height,i=e.width,s=t%bt,n=(t-s)/bt,r=s===0?n:n+1,a=o.createImageData(i,bt),l=0,c,d=e.data,h=a.data,u,m,p,f;if(e.kind===Hi.GRAYSCALE_1BPP){let _=d.byteLength,g=new Uint32Array(h.buffer,0,h.byteLength>>2),b=g.length,v=i+7>>3,y=4294967295,w=ot.isLittleEndian?4278190080:255;for(u=0;u<r;u++){for(p=u<n?bt:s,c=0,m=0;m<p;m++){let A=_-l,x=0,M=A>v?i:A*8-7,P=M&-8,j=0,N=0;for(;x<P;x+=8)N=d[l++],g[c++]=N&128?y:w,g[c++]=N&64?y:w,g[c++]=N&32?y:w,g[c++]=N&16?y:w,g[c++]=N&8?y:w,g[c++]=N&4?y:w,g[c++]=N&2?y:w,g[c++]=N&1?y:w;for(;x<M;x++)j===0&&(N=d[l++],j=128),g[c++]=N&j?y:w,j>>=1}for(;c<b;)g[c++]=0;o.putImageData(a,0,u*bt)}}else if(e.kind===Hi.RGBA_32BPP){for(m=0,f=i*bt*4,u=0;u<n;u++)h.set(d.subarray(l,l+f)),l+=f,o.putImageData(a,0,m),m+=bt;u<r&&(f=i*s*4,h.set(d.subarray(l,l+f)),o.putImageData(a,0,m))}else if(e.kind===Hi.RGB_24BPP)for(p=bt,f=i*p,u=0;u<r;u++){for(u>=n&&(p=s,f=i*p),c=0,m=f;m--;)h[c++]=d[l++],h[c++]=d[l++],h[c++]=d[l++],h[c++]=255;o.putImageData(a,0,u*bt)}else throw new Error(`bad image kind: ${e.kind}`)}function ja(o,e){if(e.bitmap){o.drawImage(e.bitmap,0,0);return}let t=e.height,i=e.width,s=t%bt,n=(t-s)/bt,r=s===0?n:n+1,a=o.createImageData(i,bt),l=0,c=e.data,d=a.data;for(let h=0;h<r;h++){let u=h<n?bt:s;({srcPos:l}=hl({src:c,srcPos:l,dest:d,width:i,height:u,nonBlackColor:0})),o.putImageData(a,0,h*bt)}}function $e(o,e){let t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(let i of t)o[i]!==void 0&&(e[i]=o[i]);o.setLineDash!==void 0&&(e.setLineDash(o.getLineDash()),e.lineDashOffset=o.lineDashOffset)}function Oi(o){if(o.strokeStyle=o.fillStyle="#000000",o.fillRule="nonzero",o.globalAlpha=1,o.lineWidth=1,o.lineCap="butt",o.lineJoin="miter",o.miterLimit=10,o.globalCompositeOperation="source-over",o.font="10px sans-serif",o.setLineDash!==void 0&&(o.setLineDash([]),o.lineDashOffset=0),!mt){let{filter:e}=o;e!=="none"&&e!==""&&(o.filter="none")}}function Va(o,e){if(e)return!0;let t=E.singularValueDecompose2dScale(o);t[0]=Math.fround(t[0]),t[1]=Math.fround(t[1]);let i=Math.fround((globalThis.devicePixelRatio||1)*ie.PDF_TO_CSS_UNITS);return t[0]<=i&&t[1]<=i}var fl=["butt","round","square"],gl=["miter","round","bevel"],_l={},Ga={},Te=class o{constructor(e,t,i,s,n,{optionalContentConfig:r,markedContentStack:a=null},l,c){this.ctx=e,this.current=new Ji(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=i,this.canvasFactory=s,this.filterFactory=n,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=r,this.cachedCanvases=new vn(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=c,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:i=!1,background:s=null}){let n=this.ctx.canvas.width,r=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,n,r),this.ctx.fillStyle=a,i){let l=this.cachedCanvases.getCanvas("transparent",n,r);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...X(this.compositeCtx))}this.ctx.save(),Oi(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=X(this.ctx)}executeOperatorList(e,t,i,s){let n=e.argsArray,r=e.fnArray,a=t||0,l=n.length;if(l===a)return a;let c=l-a>Ba&&typeof i=="function",d=c?Date.now()+ul:0,h=0,u=this.commonObjs,m=this.objs,p;for(;;){if(s!==void 0&&a===s.nextBreakPoint)return s.breakIt(a,i),a;if(p=r[a],p!==It.dependency)this[p].apply(this,n[a]);else for(let f of n[a]){let _=f.startsWith("g_")?u:m;if(!_.has(f))return _.get(f,i),a}if(a++,a===l)return a;if(c&&++h>Ba){if(Date.now()>d)return i(),a;h=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(let e of this._cachedBitmapsMap.values()){for(let t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){let e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){let t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}}_scaleImage(e,t){let i=e.width??e.displayWidth,s=e.height??e.displayHeight,n=Math.max(Math.hypot(t[0],t[1]),1),r=Math.max(Math.hypot(t[2],t[3]),1),a=i,l=s,c="prescale1",d,h;for(;n>2&&a>1||r>2&&l>1;){let u=a,m=l;n>2&&a>1&&(u=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),n/=a/u),r>2&&l>1&&(m=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,r/=l/m),d=this.cachedCanvases.getCanvas(c,u,m),h=d.context,h.clearRect(0,0,u,m),h.drawImage(e,0,0,a,l,0,0,u,m),e=d.canvas,a=u,l=m,c=c==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:a,paintHeight:l}}_createMaskCanvas(e){let t=this.ctx,{width:i,height:s}=e,n=this.current.fillColor,r=this.current.patternFill,a=X(t),l,c,d,h;if((e.bitmap||e.data)&&e.count>1){let M=e.bitmap||e.data.buffer;c=JSON.stringify(r?a:[a.slice(0,4),n]),l=this._cachedBitmapsMap.get(M),l||(l=new Map,this._cachedBitmapsMap.set(M,l));let P=l.get(c);if(P&&!r){let j=Math.round(Math.min(a[0],a[2])+a[4]),N=Math.round(Math.min(a[1],a[3])+a[5]);return{canvas:P,offsetX:j,offsetY:N}}d=P}d||(h=this.cachedCanvases.getCanvas("maskCanvas",i,s),ja(h.context,e));let u=E.transform(a,[1/i,0,0,-1/s,0,0]);u=E.transform(u,[1,0,0,1,0,-s]);let[m,p,f,_]=E.getAxialAlignedBoundingBox([0,0,i,s],u),g=Math.round(f-m)||1,b=Math.round(_-p)||1,v=this.cachedCanvases.getCanvas("fillCanvas",g,b),y=v.context,w=m,A=p;y.translate(-w,-A),y.transform(...u),d||(d=this._scaleImage(h.canvas,jt(y)),d=d.img,l&&r&&l.set(c,d)),y.imageSmoothingEnabled=Va(X(y),e.interpolate),Di(y,d,0,0,d.width,d.height,0,0,i,s),y.globalCompositeOperation="source-in";let x=E.transform(jt(y),[1,0,0,1,-w,-A]);return y.fillStyle=r?n.getPattern(t,this,x,ht.FILL):n,y.fillRect(0,0,i,s),l&&!r&&(this.cachedCanvases.delete("fillCanvas"),l.set(c,v.canvas)),{canvas:v.canvas,offsetX:Math.round(w),offsetY:Math.round(A)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=fl[e]}setLineJoin(e){this.ctx.lineJoin=gl[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){let i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(e),i.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(let[t,i]of e)switch(t){case"LW":this.setLineWidth(i);break;case"LC":this.setLineCap(i);break;case"LJ":this.setLineJoin(i);break;case"ML":this.setMiterLimit(i);break;case"D":this.setDash(i[0],i[1]);break;case"RI":this.setRenderingIntent(i);break;case"FL":this.setFlatness(i);break;case"Font":this.setFont(i[0],i[1]);break;case"CA":this.current.strokeAlpha=i;break;case"ca":this.current.fillAlpha=i,this.ctx.globalAlpha=i;break;case"BM":this.ctx.globalCompositeOperation=i;break;case"SMask":this.current.activeSMask=i?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(i);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");let e=this.ctx.canvas.width,t=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,s=this.cachedCanvases.getCanvas(i,e,t);this.suspendedCtx=this.ctx,this.ctx=s.context;let n=this.ctx;n.setTransform(...X(this.suspendedCtx)),$e(this.suspendedCtx,n),ml(n,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),$e(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let t=this.current.activeSMask,i=this.suspendedCtx;this.composeSMask(i,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,i,s){let n=s[0],r=s[1],a=s[2]-n,l=s[3]-r;a===0||l===0||(this.genericComposeSMask(t.context,i,a,l,t.subtype,t.backdrop,t.transferMap,n,r,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(i.canvas,0,0),e.restore())}genericComposeSMask(e,t,i,s,n,r,a,l,c,d,h){let u=e.canvas,m=l-d,p=c-h;if(r){let _=E.makeHexColor(...r);if(m<0||p<0||m+i>u.width||p+s>u.height){let g=this.cachedCanvases.getCanvas("maskExtension",i,s),b=g.context;b.drawImage(u,-m,-p),b.globalCompositeOperation="destination-atop",b.fillStyle=_,b.fillRect(0,0,i,s),b.globalCompositeOperation="source-over",u=g.canvas,m=p=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);let g=new Path2D;g.rect(m,p,i,s),e.clip(g),e.globalCompositeOperation="destination-atop",e.fillStyle=_,e.fillRect(m,p,i,s),e.restore()}}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),n==="Alpha"&&a?t.filter=this.filterFactory.addAlphaFilter(a):n==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(a));let f=new Path2D;f.rect(l,c,i,s),t.clip(f),t.globalCompositeOperation="destination-in",t.drawImage(u,m,p,i,s,l,c,i,s),t.restore()}save(){this.inSMaskMode?($e(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();let e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),$e(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,i,s,n,r){this.ctx.transform(e,t,i,s,n,r),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,i){let s=this.ctx,n=this.current,r=n.x,a=n.y,l,c,d=X(s),h=d[0]===0&&d[3]===0||d[1]===0&&d[2]===0,u=h?i.slice(0):null;for(let m=0,p=0,f=e.length;m<f;m++)switch(e[m]|0){case It.rectangle:r=t[p++],a=t[p++];let _=t[p++],g=t[p++],b=r+_,v=a+g;s.moveTo(r,a),_===0||g===0?s.lineTo(b,v):(s.lineTo(b,a),s.lineTo(b,v),s.lineTo(r,v)),h||n.updateRectMinMax(d,[r,a,b,v]),s.closePath();break;case It.moveTo:r=t[p++],a=t[p++],s.moveTo(r,a),h||n.updatePathMinMax(d,r,a);break;case It.lineTo:r=t[p++],a=t[p++],s.lineTo(r,a),h||n.updatePathMinMax(d,r,a);break;case It.curveTo:l=r,c=a,r=t[p+4],a=t[p+5],s.bezierCurveTo(t[p],t[p+1],t[p+2],t[p+3],r,a),n.updateCurvePathMinMax(d,l,c,t[p],t[p+1],t[p+2],t[p+3],r,a,u),p+=6;break;case It.curveTo2:l=r,c=a,s.bezierCurveTo(r,a,t[p],t[p+1],t[p+2],t[p+3]),n.updateCurvePathMinMax(d,l,c,r,a,t[p],t[p+1],t[p+2],t[p+3],u),r=t[p+2],a=t[p+3],p+=4;break;case It.curveTo3:l=r,c=a,r=t[p+2],a=t[p+3],s.bezierCurveTo(t[p],t[p+1],r,a,r,a),n.updateCurvePathMinMax(d,l,c,t[p],t[p+1],r,a,r,a,u),p+=4;break;case It.closePath:s.closePath();break}h&&n.updateScalingPathMinMax(d,u),n.setCurrentPoint(r,a)}closePath(){this.ctx.closePath()}stroke(e=!0){let t=this.ctx,i=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof i=="object"&&i?.getPattern?(t.save(),t.strokeStyle=i.getPattern(t,this,jt(t),ht.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){let t=this.ctx,i=this.current.fillColor,s=this.current.patternFill,n=!1;s&&(t.save(),t.fillStyle=i.getPattern(t,this,jt(t),ht.FILL),n=!0);let r=this.current.getClippedPathBoundingBox();this.contentVisible&&r!==null&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),n&&t.restore(),e&&this.consumePath(r)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=_l}eoClip(){this.pendingClip=Ga}beginText(){this.current.textMatrix=Xa,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){let e=this.pendingTextPaths,t=this.ctx;if(e===void 0){t.beginPath();return}t.save(),t.beginPath();for(let i of e)t.setTransform(...i.transform),t.translate(i.x,i.y),i.addToPath(t,i.fontSize);t.restore(),t.clip(),t.beginPath(),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){let i=this.commonObjs.get(e),s=this.current;if(!i)throw new Error(`Can't find font for ${e}`);if(s.fontMatrix=i.fontMatrix||Ks,(s.fontMatrix[0]===0||s.fontMatrix[3]===0)&&F("Invalid font matrix for font "+e),t<0?(t=-t,s.fontDirection=-1):s.fontDirection=1,this.current.font=i,this.current.fontSize=t,i.isType3Font)return;let n=i.loadedName||"sans-serif",r=i.systemFontInfo?.css||`"${n}", ${i.fallbackName}`,a="normal";i.black?a="900":i.bold&&(a="bold");let l=i.italic?"italic":"normal",c=t;t<Fa?c=Fa:t>Na&&(c=Na),this.current.fontSizeScale=t/c,this.ctx.font=`${l} ${a} ${c}px ${r}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,i,s,n,r){this.current.textMatrix=[e,t,i,s,n,r],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,i,s,n){let r=this.ctx,a=this.current,l=a.font,c=a.textRenderingMode,d=a.fontSize/a.fontSizeScale,h=c&dt.FILL_STROKE_MASK,u=!!(c&dt.ADD_TO_PATH_FLAG),m=a.patternFill&&!l.missingFile,p=a.patternStroke&&!l.missingFile,f;(l.disableFontFace||u||m||p)&&(f=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||m||p?(r.save(),r.translate(t,i),r.beginPath(),f(r,d),(h===dt.FILL||h===dt.FILL_STROKE)&&(s&&r.setTransform(...s),r.fill()),(h===dt.STROKE||h===dt.FILL_STROKE)&&(n&&r.setTransform(...n),r.stroke()),r.restore()):((h===dt.FILL||h===dt.FILL_STROKE)&&r.fillText(e,t,i),(h===dt.STROKE||h===dt.FILL_STROKE)&&r.strokeText(e,t,i)),u&&(this.pendingTextPaths||=[]).push({transform:X(r),x:t,y:i,fontSize:d,addToPath:f})}get isFontSubpixelAAEnabled(){let{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);let t=e.getImageData(0,0,10,10).data,i=!1;for(let s=3;s<t.length;s+=4)if(t[s]>0&&t[s]<255){i=!0;break}return B(this,"isFontSubpixelAAEnabled",i)}showText(e){let t=this.current,i=t.font;if(i.isType3Font)return this.showType3Text(e);let s=t.fontSize;if(s===0)return;let n=this.ctx,r=t.fontSizeScale,a=t.charSpacing,l=t.wordSpacing,c=t.fontDirection,d=t.textHScale*c,h=e.length,u=i.vertical,m=u?1:-1,p=i.defaultVMetrics,f=s*t.fontMatrix[0],_=t.textRenderingMode===dt.FILL&&!i.disableFontFace&&!t.patternFill;n.save(),n.transform(...t.textMatrix),n.translate(t.x,t.y+t.textRise),c>0?n.scale(d,-1):n.scale(d,1);let g,b;if(t.patternFill){n.save();let x=t.fillColor.getPattern(n,this,jt(n),ht.FILL);g=X(n),n.restore(),n.fillStyle=x}if(t.patternStroke){n.save();let x=t.strokeColor.getPattern(n,this,jt(n),ht.STROKE);b=X(n),n.restore(),n.strokeStyle=x}let v=t.lineWidth,y=t.textMatrixScale;if(y===0||v===0){let x=t.textRenderingMode&dt.FILL_STROKE_MASK;(x===dt.STROKE||x===dt.FILL_STROKE)&&(v=this.getSinglePixelWidth())}else v/=y;if(r!==1&&(n.scale(r,r),v/=r),n.lineWidth=v,i.isInvalidPDFjsFont){let x=[],M=0;for(let P of e)x.push(P.unicode),M+=P.width;n.fillText(x.join(""),0,0),t.x+=M*f*d,n.restore(),this.compose();return}let w=0,A;for(A=0;A<h;++A){let x=e[A];if(typeof x=="number"){w+=m*x*s/1e3;continue}let M=!1,P=(x.isSpace?l:0)+a,j=x.fontChar,N=x.accent,U,it,V=x.width;if(u){let $=x.vmetric||p,S=-(x.vmetric?$[1]:V*.5)*f,I=$[2]*f;V=$?-$[0]:V,U=S/r,it=(w+I)/r}else U=w/r,it=0;if(i.remeasure&&V>0){let $=n.measureText(j).width*1e3/s*r;if(V<$&&this.isFontSubpixelAAEnabled){let S=V/$;M=!0,n.save(),n.scale(S,1),U/=S}else V!==$&&(U+=(V-$)/2e3*s/r)}if(this.contentVisible&&(x.isInFont||i.missingFile)){if(_&&!N)n.fillText(j,U,it);else if(this.paintChar(j,U,it,g,b),N){let $=U+s*N.offset.x/r,S=it-s*N.offset.y/r;this.paintChar(N.fontChar,$,S,g,b)}}let pt=u?V*f-P*c:V*f+P*c;w+=pt,M&&n.restore()}u?t.y-=w:t.x+=w*d,n.restore(),this.compose()}showType3Text(e){let t=this.ctx,i=this.current,s=i.font,n=i.fontSize,r=i.fontDirection,a=s.vertical?1:-1,l=i.charSpacing,c=i.wordSpacing,d=i.textHScale*r,h=i.fontMatrix||Ks,u=e.length,m=i.textRenderingMode===dt.INVISIBLE,p,f,_,g;if(!(m||n===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...i.textMatrix),t.translate(i.x,i.y),t.scale(d,r),p=0;p<u;++p){if(f=e[p],typeof f=="number"){g=a*f*n/1e3,this.ctx.translate(g,0),i.x+=g*d;continue}let b=(f.isSpace?c:0)+l,v=s.charProcOperatorList[f.operatorListId];if(!v){F(`Type3 character "${f.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=f,this.save(),t.scale(n,n),t.transform(...h),this.executeOperatorList(v),this.restore()),_=E.applyTransform([f.width,0],h)[0]*n+b,t.translate(_,0),i.x+=_*d}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,i,s,n,r){this.ctx.rect(i,s,n-i,r-s),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){let i=e[1],s=this.baseTransform||X(this.ctx),n={createCanvasGraphics:r=>new o(r,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new dl(e,i,this.ctx,n,s)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,i){this.ctx.strokeStyle=this.current.strokeColor=E.makeHexColor(e,t,i),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t,i){this.ctx.fillStyle=this.current.fillColor=E.makeHexColor(e,t,i),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let i;return this.cachedPatterns.has(e)?i=this.cachedPatterns.get(e):(i=cl(this.getObject(e)),this.cachedPatterns.set(e,i)),t&&(i.matrix=t),i}shadingFill(e){if(!this.contentVisible)return;let t=this.ctx;this.save();let i=this._getPattern(e);t.fillStyle=i.getPattern(t,this,jt(t),ht.SHADING);let s=jt(t);if(s){let{width:n,height:r}=t.canvas,[a,l,c,d]=E.getAxialAlignedBoundingBox([0,0,n,r],s);this.ctx.fillRect(a,l,c-a,d-l)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){G("Should not call beginInlineImage")}beginImageData(){G("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=X(this.ctx),t)){let i=t[2]-t[0],s=t[3]-t[1];this.ctx.rect(t[0],t[1],i,s),this.current.updateRectMinMax(X(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let t=this.ctx;e.isolated||bs("TODO: Support non-isolated groups."),e.knockout&&F("Knockout groups not supported.");let i=X(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let s=E.getAxialAlignedBoundingBox(e.bbox,X(t)),n=[0,0,t.canvas.width,t.canvas.height];s=E.intersect(s,n)||[0,0,0,0];let r=Math.floor(s[0]),a=Math.floor(s[1]),l=Math.max(Math.ceil(s[2])-r,1),c=Math.max(Math.ceil(s[3])-a,1);this.current.startNewPathAndClipBox([0,0,l,c]);let d="groupAt"+this.groupLevel;e.smask&&(d+="_smask_"+this.smaskCounter++%2);let h=this.cachedCanvases.getCanvas(d,l,c),u=h.context;u.translate(-r,-a),u.transform(...i),e.smask?this.smaskStack.push({canvas:h.canvas,context:u,offsetX:r,offsetY:a,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(r,a),t.save()),$e(t,u),this.ctx=u,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;let t=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();let s=X(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...s);let n=E.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],s);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(n)}}beginAnnotation(e,t,i,s,n){if(this.#t(),Oi(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){let r=t[2]-t[0],a=t[3]-t[1];if(n&&this.annotationCanvasMap){i=i.slice(),i[4]-=t[0],i[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=r,t[3]=a;let[l,c]=E.singularValueDecompose2dScale(X(this.ctx)),{viewportScale:d}=this,h=Math.ceil(r*this.outputScaleX*d),u=Math.ceil(a*this.outputScaleY*d);this.annotationCanvas=this.canvasFactory.create(h,u);let{canvas:m,context:p}=this.annotationCanvas;this.annotationCanvasMap.set(e,m),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,this.ctx.save(),this.ctx.setTransform(l,0,0,-c,0,a*c),Oi(this.ctx)}else Oi(this.ctx),this.endPath(),this.ctx.rect(t[0],t[1],r,a),this.ctx.clip(),this.ctx.beginPath()}this.current=new Ji(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...i),this.transform(...s)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;let t=e.count;e=this.getObject(e.data,e),e.count=t;let i=this.ctx,s=this.processingType3;if(s&&(s.compiled===void 0&&(s.compiled=pl(e)),s.compiled)){s.compiled(i);return}let n=this._createMaskCanvas(e),r=n.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(r,n.offsetX,n.offsetY),i.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,i=0,s=0,n,r){if(!this.contentVisible)return;e=this.getObject(e.data,e);let a=this.ctx;a.save();let l=X(a);a.transform(t,i,s,n,0,0);let c=this._createMaskCanvas(e);a.setTransform(1,0,0,1,c.offsetX-l[4],c.offsetY-l[5]);for(let d=0,h=r.length;d<h;d+=2){let u=E.transform(l,[t,i,s,n,r[d],r[d+1]]),[m,p]=E.applyTransform([0,0],u);a.drawImage(c.canvas,m,p)}a.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;let t=this.ctx,i=this.current.fillColor,s=this.current.patternFill;for(let n of e){let{data:r,width:a,height:l,transform:c}=n,d=this.cachedCanvases.getCanvas("maskCanvas",a,l),h=d.context;h.save();let u=this.getObject(r,n);ja(h,u),h.globalCompositeOperation="source-in",h.fillStyle=s?i.getPattern(h,this,jt(t),ht.FILL):i,h.fillRect(0,0,a,l),h.restore(),t.save(),t.transform(...c),t.scale(1,-1),Di(t,d.canvas,0,0,a,l,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;let t=this.getObject(e);if(!t){F("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,i,s){if(!this.contentVisible)return;let n=this.getObject(e);if(!n){F("Dependent image isn't ready yet");return}let r=n.width,a=n.height,l=[];for(let c=0,d=s.length;c<d;c+=2)l.push({transform:[t,0,0,i,s[c],s[c+1]],x:0,y:0,w:r,h:a});this.paintInlineImageXObjectGroup(n,l)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;let{bitmap:t,width:i,height:s}=e,n=this.cachedCanvases.getCanvas("inlineImage",i,s),r=n.context;return r.filter=this.current.transferMaps,r.drawImage(t,0,0),r.filter="none",n.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;let t=e.width,i=e.height,s=this.ctx;if(this.save(),!mt){let{filter:a}=s;a!=="none"&&a!==""&&(s.filter="none")}s.scale(1/t,-1/i);let n;if(e.bitmap)n=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)n=e;else{let l=this.cachedCanvases.getCanvas("inlineImage",t,i).context;Ha(l,e),n=this.applyTransferMapsToCanvas(l)}let r=this._scaleImage(n,jt(s));s.imageSmoothingEnabled=Va(X(s),e.interpolate),Di(s,r.img,0,0,r.paintWidth,r.paintHeight,0,-i,t,i),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;let i=this.ctx,s;if(e.bitmap)s=e.bitmap;else{let n=e.width,r=e.height,l=this.cachedCanvases.getCanvas("inlineImage",n,r).context;Ha(l,e),s=this.applyTransferMapsToCanvas(l)}for(let n of t)i.save(),i.transform(...n.transform),i.scale(1,-1),Di(i,s,n.x,n.y,n.w,n.h,0,-1,1,1),i.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){let t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);let i=this.ctx;this.pendingClip&&(t||(this.pendingClip===Ga?i.clip("evenodd"):i.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),i.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let e=X(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{let t=Math.abs(e[0]*e[3]-e[2]*e[1]),i=Math.hypot(e[0],e[2]),s=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(i,s)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){let{lineWidth:e}=this.current,{a:t,b:i,c:s,d:n}=this.ctx.getTransform(),r,a;if(i===0&&s===0){let l=Math.abs(t),c=Math.abs(n);if(l===c)if(e===0)r=a=1/l;else{let d=l*e;r=a=d<1?1/d:1}else if(e===0)r=1/l,a=1/c;else{let d=l*e,h=c*e;r=d<1?1/d:1,a=h<1?1/h:1}}else{let l=Math.abs(t*n-i*s),c=Math.hypot(t,i),d=Math.hypot(s,n);if(e===0)r=d/l,a=c/l;else{let h=e*l;r=d>h?d/h:1,a=c>h?c/h:1}}this._cachedScaleForStroking[0]=r,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(e){let{ctx:t}=this,{lineWidth:i}=this.current,[s,n]=this.getScaleForStroking();if(t.lineWidth=i||1,s===1&&n===1){t.stroke();return}let r=t.getLineDash();if(e&&t.save(),t.scale(s,n),r.length>0){let a=Math.max(s,n);t.setLineDash(r.map(l=>l/a)),t.lineDashOffset/=a}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};for(let o in It)Te.prototype[o]!==void 0&&(Te.prototype[It[o]]=Te.prototype[o]);var pe=class{static#t=null;static#e="";static get workerPort(){return this.#t}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");this.#t=e}static get workerSrc(){return this.#e}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");this.#e=e}},Fi={UNKNOWN:0,DATA:1,ERROR:2},tt={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Ua(){}function Et(o){switch(o instanceof Error||typeof o=="object"&&o!==null||G('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),o.name){case"AbortException":return new Xt(o.message);case"MissingPDFException":return new fe(o.message);case"PasswordException":return new Ye(o.message,o.code);case"UnexpectedResponseException":return new Pe(o.message,o.status);case"UnknownErrorException":return new Ke(o.message,o.details);default:return new Ke(o.message,o.toString())}}var me=class{#t=new AbortController;constructor(e,t,i){this.sourceName=e,this.targetName=t,this.comObj=i,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),i.addEventListener("message",this.#e.bind(this),{signal:this.#t.signal})}#e({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){this.#s(e);return}if(e.callback){let i=e.callbackId,s=this.callbackCapabilities[i];if(!s)throw new Error(`Cannot resolve callback ${i}`);if(delete this.callbackCapabilities[i],e.callback===Fi.DATA)s.resolve(e.data);else if(e.callback===Fi.ERROR)s.reject(Et(e.reason));else throw new Error("Unexpected callback case");return}let t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){let i=this.sourceName,s=e.sourceName,n=this.comObj;Promise.try(t,e.data).then(function(r){n.postMessage({sourceName:i,targetName:s,callback:Fi.DATA,callbackId:e.callbackId,data:r})},function(r){n.postMessage({sourceName:i,targetName:s,callback:Fi.ERROR,callbackId:e.callbackId,reason:Et(r)})});return}if(e.streamId){this.#i(e);return}t(e.data)}on(e,t){let i=this.actionHandler;if(i[e])throw new Error(`There is already an actionName called "${e}"`);i[e]=t}send(e,t,i){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},i)}sendWithPromise(e,t,i){let s=this.callbackId++,n=Promise.withResolvers();this.callbackCapabilities[s]=n;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:s,data:t},i)}catch(r){n.reject(r)}return n.promise}sendWithStream(e,t,i,s){let n=this.streamId++,r=this.sourceName,a=this.targetName,l=this.comObj;return new ReadableStream({start:c=>{let d=Promise.withResolvers();return this.streamControllers[n]={controller:c,startCall:d,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:r,targetName:a,action:e,streamId:n,data:t,desiredSize:c.desiredSize},s),d.promise},pull:c=>{let d=Promise.withResolvers();return this.streamControllers[n].pullCall=d,l.postMessage({sourceName:r,targetName:a,stream:tt.PULL,streamId:n,desiredSize:c.desiredSize}),d.promise},cancel:c=>{et(c instanceof Error,"cancel must have a valid reason");let d=Promise.withResolvers();return this.streamControllers[n].cancelCall=d,this.streamControllers[n].isClosed=!0,l.postMessage({sourceName:r,targetName:a,stream:tt.CANCEL,streamId:n,reason:Et(c)}),d.promise}},i)}#i(e){let t=e.streamId,i=this.sourceName,s=e.sourceName,n=this.comObj,r=this,a=this.actionHandler[e.action],l={enqueue(c,d=1,h){if(this.isCancelled)return;let u=this.desiredSize;this.desiredSize-=d,u>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),n.postMessage({sourceName:i,targetName:s,stream:tt.ENQUEUE,streamId:t,chunk:c},h)},close(){this.isCancelled||(this.isCancelled=!0,n.postMessage({sourceName:i,targetName:s,stream:tt.CLOSE,streamId:t}),delete r.streamSinks[t])},error(c){et(c instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,n.postMessage({sourceName:i,targetName:s,stream:tt.ERROR,streamId:t,reason:Et(c)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(a,e.data,l).then(function(){n.postMessage({sourceName:i,targetName:s,stream:tt.START_COMPLETE,streamId:t,success:!0})},function(c){n.postMessage({sourceName:i,targetName:s,stream:tt.START_COMPLETE,streamId:t,reason:Et(c)})})}#s(e){let t=e.streamId,i=this.sourceName,s=e.sourceName,n=this.comObj,r=this.streamControllers[t],a=this.streamSinks[t];switch(e.stream){case tt.START_COMPLETE:e.success?r.startCall.resolve():r.startCall.reject(Et(e.reason));break;case tt.PULL_COMPLETE:e.success?r.pullCall.resolve():r.pullCall.reject(Et(e.reason));break;case tt.PULL:if(!a){n.postMessage({sourceName:i,targetName:s,stream:tt.PULL_COMPLETE,streamId:t,success:!0});break}a.desiredSize<=0&&e.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=e.desiredSize,Promise.try(a.onPull||Ua).then(function(){n.postMessage({sourceName:i,targetName:s,stream:tt.PULL_COMPLETE,streamId:t,success:!0})},function(c){n.postMessage({sourceName:i,targetName:s,stream:tt.PULL_COMPLETE,streamId:t,reason:Et(c)})});break;case tt.ENQUEUE:if(et(r,"enqueue should have stream controller"),r.isClosed)break;r.controller.enqueue(e.chunk);break;case tt.CLOSE:if(et(r,"close should have stream controller"),r.isClosed)break;r.isClosed=!0,r.controller.close(),this.#r(r,t);break;case tt.ERROR:et(r,"error should have stream controller"),r.controller.error(Et(e.reason)),this.#r(r,t);break;case tt.CANCEL_COMPLETE:e.success?r.cancelCall.resolve():r.cancelCall.reject(Et(e.reason)),this.#r(r,t);break;case tt.CANCEL:if(!a)break;let l=Et(e.reason);Promise.try(a.onCancel||Ua,l).then(function(){n.postMessage({sourceName:i,targetName:s,stream:tt.CANCEL_COMPLETE,streamId:t,success:!0})},function(c){n.postMessage({sourceName:i,targetName:s,stream:tt.CANCEL_COMPLETE,streamId:t,reason:Et(c)})}),a.sinkCapability.reject(l),a.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}#r(e,t){return C(this,null,function*(){yield Promise.allSettled([e.startCall?.promise,e.pullCall?.promise,e.cancelCall?.promise]),delete this.streamControllers[t]})}destroy(){this.#t?.abort(),this.#t=null}},yn=class{#t;#e;constructor({parsedData:e,rawData:t}){this.#t=e,this.#e=t}getRaw(){return this.#e}get(e){return this.#t.get(e)??null}getAll(){return gr(this.#t)}has(e){return this.#t.has(e)}},Ee=Symbol("INTERNAL"),wn=class{#t=!1;#e=!1;#i=!1;#s=!0;constructor(e,{name:t,intent:i,usage:s,rbGroups:n}){this.#t=!!(e&vt.DISPLAY),this.#e=!!(e&vt.PRINT),this.name=t,this.intent=i,this.usage=s,this.rbGroups=n}get visible(){if(this.#i)return this.#s;if(!this.#s)return!1;let{print:e,view:t}=this.usage;return this.#t?t?.viewState!=="OFF":this.#e?e?.printState!=="OFF":!0}_setVisible(e,t,i=!1){e!==Ee&&G("Internal method `_setVisible` called."),this.#i=i,this.#s=t}},An=class{#t=null;#e=new Map;#i=null;#s=null;constructor(e,t=vt.DISPLAY){if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,this.#s=e.order;for(let i of e.groups)this.#e.set(i.id,new wn(t,i));if(e.baseState==="OFF")for(let i of this.#e.values())i._setVisible(Ee,!1);for(let i of e.on)this.#e.get(i)._setVisible(Ee,!0);for(let i of e.off)this.#e.get(i)._setVisible(Ee,!1);this.#i=this.getHash()}}#r(e){let t=e.length;if(t<2)return!0;let i=e[0];for(let s=1;s<t;s++){let n=e[s],r;if(Array.isArray(n))r=this.#r(n);else if(this.#e.has(n))r=this.#e.get(n).visible;else return F(`Optional content group not found: ${n}`),!0;switch(i){case"And":if(!r)return!1;break;case"Or":if(r)return!0;break;case"Not":return!r;default:return!0}}return i==="And"}isVisible(e){if(this.#e.size===0)return!0;if(!e)return bs("Optional content group not defined."),!0;if(e.type==="OCG")return this.#e.has(e.id)?this.#e.get(e.id).visible:(F(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return this.#r(e.expression);if(!e.policy||e.policy==="AnyOn"){for(let t of e.ids){if(!this.#e.has(t))return F(`Optional content group not found: ${t}`),!0;if(this.#e.get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(let t of e.ids){if(!this.#e.has(t))return F(`Optional content group not found: ${t}`),!0;if(!this.#e.get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(let t of e.ids){if(!this.#e.has(t))return F(`Optional content group not found: ${t}`),!0;if(!this.#e.get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(let t of e.ids){if(!this.#e.has(t))return F(`Optional content group not found: ${t}`),!0;if(this.#e.get(t).visible)return!1}return!0}return F(`Unknown optional content policy ${e.policy}.`),!0}return F(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,i=!0){let s=this.#e.get(e);if(!s){F(`Optional content group not found: ${e}`);return}if(i&&t&&s.rbGroups.length)for(let n of s.rbGroups)for(let r of n)r!==e&&this.#e.get(r)?._setVisible(Ee,!1,!0);s._setVisible(Ee,!!t,!0),this.#t=null}setOCGState({state:e,preserveRB:t}){let i;for(let s of e){switch(s){case"ON":case"OFF":case"Toggle":i=s;continue}let n=this.#e.get(s);if(n)switch(i){case"ON":this.setVisibility(s,!0,t);break;case"OFF":this.setVisibility(s,!1,t);break;case"Toggle":this.setVisibility(s,!n.visible,t);break}}this.#t=null}get hasInitialVisibility(){return this.#i===null||this.getHash()===this.#i}getOrder(){return this.#e.size?this.#s?this.#s.slice():[...this.#e.keys()]:null}getGroups(){return this.#e.size>0?gr(this.#e):null}getGroup(e){return this.#e.get(e)||null}getHash(){if(this.#t!==null)return this.#t;let e=new $i;for(let[t,i]of this.#e)e.update(`${t}:${i.visible}`);return this.#t=e.hexdigest()}},xn=class{constructor(e,{disableRange:t=!1,disableStream:i=!1}){et(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');let{length:s,initialData:n,progressiveDone:r,contentDispositionFilename:a}=e;if(this._queuedChunks=[],this._progressiveDone=r,this._contentDispositionFilename=a,n?.length>0){let l=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!i,this._isRangeSupported=!t,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((l,c)=>{this._onReceiveData({begin:l,chunk:c})}),e.addProgressListener((l,c)=>{this._onProgress({loaded:l,total:c})}),e.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){let i=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i);else{let s=this._rangeReaders.some(function(n){return n._begin!==e?!1:(n._enqueue(i),!0)});et(s,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(e){e.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:e.loaded}):this._fullRequestReader?.onProgress?.({loaded:e.loaded,total:e.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){let t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){et(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");let e=this._queuedChunks;return this._queuedChunks=null,new kn(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let i=new Cn(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeReaders.slice(0))t.cancel(e);this._pdfDataRangeTransport.abort()}},kn=class{constructor(e,t,i=!1,s=null){this._stream=e,this._done=i||!1,this._filename=br(s)?s:null,this._queuedChunks=t||[],this._loaded=0;for(let n of this._queuedChunks)this._loaded+=n.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}read(){return C(this,null,function*(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise})}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}},Cn=class{constructor(e,t,i){this._stream=e,this._begin=t,this._end=i,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(let i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}read(){return C(this,null,function*(){if(this._queuedChunk){let t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise})}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}};function bl(o){let e=!0,t=i("filename\\*","i").exec(o);if(t){t=t[1];let d=a(t);return d=unescape(d),d=l(d),d=c(d),n(d)}if(t=r(o),t){let d=c(t);return n(d)}if(t=i("filename","i").exec(o),t){t=t[1];let d=a(t);return d=c(d),n(d)}function i(d,h){return new RegExp("(?:^|;)\\s*"+d+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',h)}function s(d,h){if(d){if(!/^[\x00-\xFF]+$/.test(h))return h;try{let u=new TextDecoder(d,{fatal:!0}),m=vs(h);h=u.decode(m),e=!1}catch{}}return h}function n(d){return e&&/[\x80-\xff]/.test(d)&&(d=s("utf-8",d),e&&(d=s("iso-8859-1",d))),d}function r(d){let h=[],u,m=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(u=m.exec(d))!==null;){let[,f,_,g]=u;if(f=parseInt(f,10),f in h){if(f===0)break;continue}h[f]=[_,g]}let p=[];for(let f=0;f<h.length&&f in h;++f){let[_,g]=h[f];g=a(g),_&&(g=unescape(g),f===0&&(g=l(g))),p.push(g)}return p.join("")}function a(d){if(d.startsWith('"')){let h=d.slice(1).split('\\"');for(let u=0;u<h.length;++u){let m=h[u].indexOf('"');m!==-1&&(h[u]=h[u].slice(0,m),h.length=u+1),h[u]=h[u].replaceAll(/\\(.)/g,"$1")}d=h.join('"')}return d}function l(d){let h=d.indexOf("'");if(h===-1)return d;let u=d.slice(0,h),p=d.slice(h+1).replace(/^[^']*'/,"");return s(u,p)}function c(d){return!d.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(d)?d:d.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(h,u,m,p){if(m==="q"||m==="Q")return p=p.replaceAll("_"," "),p=p.replaceAll(/=([0-9a-fA-F]{2})/g,function(f,_){return String.fromCharCode(parseInt(_,16))}),s(u,p);try{p=atob(p)}catch{}return s(u,p)})}return""}function Ka(o,e){let t=new Headers;if(!o||!e||typeof e!="object")return t;for(let i in e){let s=e[i];s!==void 0&&t.append(i,s)}return t}function As(o){try{return new URL(o).origin}catch{}return null}function Qa({responseHeaders:o,isHttp:e,rangeChunkSize:t,disableRange:i}){let s={allowRangeRequests:!1,suggestedLength:void 0},n=parseInt(o.get("Content-Length"),10);return!Number.isInteger(n)||(s.suggestedLength=n,n<=2*t)||i||!e||o.get("Accept-Ranges")!=="bytes"||(o.get("Content-Encoding")||"identity")!=="identity"||(s.allowRangeRequests=!0),s}function Za(o){let e=o.get("Content-Disposition");if(e){let t=bl(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(br(t))return t}return null}function xs(o,e){return o===404||o===0&&e.startsWith("file:")?new fe('Missing PDF "'+e+'".'):new Pe(`Unexpected server response (${o}) while retrieving PDF "${e}".`,o)}function Ja(o){return o===200||o===206}function to(o,e,t){return{method:"GET",headers:o,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function eo(o){return o instanceof Uint8Array?o.buffer:o instanceof ArrayBuffer?o:(F(`getArrayBuffer - unexpected data format: ${o}`),new Uint8Array(o).buffer)}var ts=class{_responseOrigin=null;constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=Ka(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return et(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Sn(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let i=new En(this,e,t);return this._rangeRequestReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeRequestReaders.slice(0))t.cancel(e)}},Sn=class{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;let t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;let i=new Headers(e.headers),s=t.url;fetch(s,to(i,this._withCredentials,this._abortController)).then(n=>{if(e._responseOrigin=As(n.url),!Ja(n.status))throw xs(n.status,s);this._reader=n.body.getReader(),this._headersCapability.resolve();let r=n.headers,{allowRangeRequests:a,suggestedLength:l}=Qa({responseHeaders:r,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=l||this._contentLength,this._filename=Za(r),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Xt("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}read(){return C(this,null,function*(){yield this._headersCapability.promise;let{value:e,done:t}=yield this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:eo(e),done:!1})})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}},En=class{constructor(e,t,i){this._stream=e,this._reader=null,this._loaded=0;let s=e.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController;let n=new Headers(e.headers);n.append("Range",`bytes=${t}-${i-1}`);let r=s.url;fetch(r,to(n,this._withCredentials,this._abortController)).then(a=>{let l=As(a.url);if(l!==e._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${e._responseOrigin}".`);if(!Ja(a.status))throw xs(a.status,r);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}read(){return C(this,null,function*(){yield this._readCapability.promise;let{value:e,done:t}=yield this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded}),{value:eo(e),done:!1})})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}},qs=200,Ys=206;function vl(o){let e=o.response;return typeof e!="string"?e:vs(e).buffer}var Tn=class{_responseOrigin=null;constructor({url:e,httpHeaders:t,withCredentials:i}){this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=Ka(this.isHttp,t),this.withCredentials=i||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(e,t,i){let s={begin:e,end:t};for(let n in i)s[n]=i[n];return this.request(s)}requestFull(e){return this.request(e)}request(e){let t=new XMLHttpRequest,i=this.currXhrId++,s=this.pendingRequests[i]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(let[n,r]of this.headers)t.setRequestHeader(n,r);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),s.expectedStatus=Ys):s.expectedStatus=qs,t.responseType="arraybuffer",e.onError&&(t.onerror=function(n){e.onError(t.status)}),t.onreadystatechange=this.onStateChange.bind(this,i),t.onprogress=this.onProgress.bind(this,i),s.onHeadersReceived=e.onHeadersReceived,s.onDone=e.onDone,s.onError=e.onError,s.onProgress=e.onProgress,t.send(null),i}onProgress(e,t){let i=this.pendingRequests[e];i&&i.onProgress?.(t)}onStateChange(e,t){let i=this.pendingRequests[e];if(!i)return;let s=i.xhr;if(s.readyState>=2&&i.onHeadersReceived&&(i.onHeadersReceived(),delete i.onHeadersReceived),s.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],s.status===0&&this.isHttp){i.onError?.(s.status);return}let n=s.status||qs;if(!(n===qs&&i.expectedStatus===Ys)&&n!==i.expectedStatus){i.onError?.(s.status);return}let a=vl(s);if(n===Ys){let l=s.getResponseHeader("Content-Range"),c=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);i.onDone({begin:parseInt(c[1],10),chunk:a})}else a?i.onDone({begin:0,chunk:a}):i.onError?.(s.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){let t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}},Mn=class{constructor(e){this._source=e,this._manager=new Tn(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){let t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return et(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Pn(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){let i=new In(this._manager,e,t);return i.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeRequestReaders.slice(0))t.cancel(e)}},Pn=class{constructor(e,t){this._manager=e;let i={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=t.url,this._fullRequestId=e.requestFull(i),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=As(t.responseURL);let i=t.getAllResponseHeaders(),s=new Headers(i?i.trim().split(/[\r\n]+/).map(a=>{let[l,...c]=a.split(": ");return[l,c.join(": ")]}):[]),{allowRangeRequests:n,suggestedLength:r}=Qa({responseHeaders:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});n&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=Za(s),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=xs(e,this._url),this._headersCapability.reject(this._storedError);for(let t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){this.onProgress?.({loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}read(){return C(this,null,function*(){if(yield this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise})}cancel(e){this._done=!0,this._headersCapability.reject(e);for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}},In=class{constructor(e,t,i){this._manager=e;let s={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=e.url,this._requestId=e.requestRange(t,i,s),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){let e=As(this._manager.getRequestXhr(this._requestId)?.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(e){let t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(let i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??=xs(e,this._url);for(let t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){this.isStreamingSupported||this.onProgress?.({loaded:e.loaded})}get isStreamingSupported(){return!1}read(){return C(this,null,function*(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){let t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise})}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}},yl=/^[a-z][a-z0-9\-+.]+:/i;function wl(o){if(yl.test(o))return new URL(o);let e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(o))}var Ln=class{constructor(e){this.source=e,this.url=wl(e.url),et(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return et(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Rn(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let i=new Dn(this,e,t);return this._rangeRequestReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeRequestReaders.slice(0))t.cancel(e)}},Rn=class{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;let t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();let i=process.getBuiltinModule("fs");i.promises.lstat(this._url).then(s=>{this._contentLength=s.size,this._setReadableStream(i.createReadStream(this._url)),this._headersCapability.resolve()},s=>{s.code==="ENOENT"&&(s=new fe(`Missing PDF "${this._url}".`)),this._storedError=s,this._headersCapability.reject(s)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}read(){return C(this,null,function*(){if(yield this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Xt("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}},Dn=class{constructor(e,t,i){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();let s=e.source;this._isStreamingSupported=!s.disableStream;let n=process.getBuiltinModule("fs");this._setReadableStream(n.createReadStream(this._url,{start:t,end:i-1}))}get isStreamingSupported(){return this._isStreamingSupported}read(){return C(this,null,function*(){if(yield this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}},Al=1e5,_t=30,xl=.8,si=class o{#t=Promise.withResolvers();#e=null;#i=!1;#s=!!globalThis.FontInspector?.enabled;#r=null;#n=null;#c=0;#o=0;#d=null;#l=null;#h=0;#a=0;#u=Object.create(null);#m=[];#p=null;#g=[];#f=new WeakMap;#_=null;static#b=new Map;static#y=new Map;static#w=new WeakMap;static#k=null;static#C=new Set;constructor({textContentSource:e,container:t,viewport:i}){if(e instanceof ReadableStream)this.#p=e;else if(typeof e=="object")this.#p=new ReadableStream({start(l){l.enqueue(e),l.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#e=this.#l=t,this.#a=i.scale*(globalThis.devicePixelRatio||1),this.#h=i.rotation,this.#n={div:null,properties:null,ctx:null};let{pageWidth:s,pageHeight:n,pageX:r,pageY:a}=i.rawDims;this.#_=[1,0,0,-1,-r,a+n],this.#o=s,this.#c=n,o.#P(),ge(t,i),this.#t.promise.finally(()=>{o.#C.delete(this),this.#n=null,this.#u=null}).catch(()=>{})}static get fontFamilyMap(){let{isWindows:e,isFirefox:t}=ot.platform;return B(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){let e=()=>{this.#d.read().then(({value:t,done:i})=>{if(i){this.#t.resolve();return}this.#r??=t.lang,Object.assign(this.#u,t.styles),this.#S(t.items),e()},this.#t.reject)};return this.#d=this.#p.getReader(),o.#C.add(this),e(),this.#t.promise}update({viewport:e,onBefore:t=null}){let i=e.scale*(globalThis.devicePixelRatio||1),s=e.rotation;if(s!==this.#h&&(t?.(),this.#h=s,ge(this.#l,{rotation:s})),i!==this.#a){t?.(),this.#a=i;let n={div:null,properties:null,ctx:o.#M(this.#r)};for(let r of this.#g)n.properties=this.#f.get(r),n.div=r,this.#A(n)}}cancel(){let e=new Xt("TextLayer task cancelled.");this.#d?.cancel(e).catch(()=>{}),this.#d=null,this.#t.reject(e)}get textDivs(){return this.#g}get textContentItemsStr(){return this.#m}#S(e){if(this.#i)return;this.#n.ctx??=o.#M(this.#r);let t=this.#g,i=this.#m;for(let s of e){if(t.length>Al){F("Ignoring additional textDivs for performance reasons."),this.#i=!0;return}if(s.str===void 0){if(s.type==="beginMarkedContentProps"||s.type==="beginMarkedContent"){let n=this.#e;this.#e=document.createElement("span"),this.#e.classList.add("markedContent"),s.id!==null&&this.#e.setAttribute("id",`${s.id}`),n.append(this.#e)}else s.type==="endMarkedContent"&&(this.#e=this.#e.parentNode);continue}i.push(s.str),this.#T(s)}}#T(e){let t=document.createElement("span"),i={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};this.#g.push(t);let s=E.transform(this.#_,e.transform),n=Math.atan2(s[1],s[0]),r=this.#u[e.fontName];r.vertical&&(n+=Math.PI/2);let a=this.#s&&r.fontSubstitution||r.fontFamily;a=o.fontFamilyMap.get(a)||a;let l=Math.hypot(s[2],s[3]),c=l*o.#D(a,this.#r),d,h;n===0?(d=s[4],h=s[5]-c):(d=s[4]+c*Math.sin(n),h=s[5]-c*Math.cos(n));let u="calc(var(--scale-factor)*",m=t.style;this.#e===this.#l?(m.left=`${(100*d/this.#o).toFixed(2)}%`,m.top=`${(100*h/this.#c).toFixed(2)}%`):(m.left=`${u}${d.toFixed(2)}px)`,m.top=`${u}${h.toFixed(2)}px)`),m.fontSize=`${u}${(o.#k*l).toFixed(2)}px)`,m.fontFamily=a,i.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,this.#s&&(t.dataset.fontName=r.fontSubstitutionLoadedName||e.fontName),n!==0&&(i.angle=n*(180/Math.PI));let p=!1;if(e.str.length>1)p=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){let f=Math.abs(e.transform[0]),_=Math.abs(e.transform[3]);f!==_&&Math.max(f,_)/Math.min(f,_)>1.5&&(p=!0)}if(p&&(i.canvasWidth=r.vertical?e.height:e.width),this.#f.set(t,i),this.#n.div=t,this.#n.properties=i,this.#A(this.#n),i.hasText&&this.#e.append(t),i.hasEOL){let f=document.createElement("br");f.setAttribute("role","presentation"),this.#e.append(f)}}#A(e){let{div:t,properties:i,ctx:s}=e,{style:n}=t,r="";if(o.#k>1&&(r=`scale(${1/o.#k})`),i.canvasWidth!==0&&i.hasText){let{fontFamily:a}=n,{canvasWidth:l,fontSize:c}=i;o.#E(s,c*this.#a,a);let{width:d}=s.measureText(t.textContent);d>0&&(r=`scaleX(${l*this.#a/d}) ${r}`)}i.angle!==0&&(r=`rotate(${i.angle}deg) ${r}`),r.length>0&&(n.transform=r)}static cleanup(){if(!(this.#C.size>0)){this.#b.clear();for(let{canvas:e}of this.#y.values())e.remove();this.#y.clear()}}static#M(e=null){let t=this.#y.get(e||="");if(!t){let i=document.createElement("canvas");i.className="hiddenCanvasElement",i.lang=e,document.body.append(i),t=i.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#y.set(e,t),this.#w.set(t,{size:0,family:""})}return t}static#E(e,t,i){let s=this.#w.get(e);t===s.size&&i===s.family||(e.font=`${t}px ${i}`,s.size=t,s.family=i)}static#P(){if(this.#k!==null)return;let e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),this.#k=e.getBoundingClientRect().height,e.remove()}static#D(e,t){let i=this.#b.get(e);if(i)return i;let s=this.#M(t);s.canvas.width=s.canvas.height=_t,this.#E(s,_t,e);let n=s.measureText(""),r=n.fontBoundingBoxAscent,a=Math.abs(n.fontBoundingBoxDescent);if(r){let d=r/(r+a);return this.#b.set(e,d),s.canvas.width=s.canvas.height=0,d}s.strokeStyle="red",s.clearRect(0,0,_t,_t),s.strokeText("g",0,0);let l=s.getImageData(0,0,_t,_t).data;a=0;for(let d=l.length-1-3;d>=0;d-=4)if(l[d]>0){a=Math.ceil(d/4/_t);break}s.clearRect(0,0,_t,_t),s.strokeText("A",0,_t),l=s.getImageData(0,0,_t,_t).data,r=0;for(let d=0,h=l.length;d<h;d+=4)if(l[d]>0){r=_t-Math.floor(d/4/_t);break}s.canvas.width=s.canvas.height=0;let c=r?r/(r+a):xl;return this.#b.set(e,c),c}},ni=class o{static textContent(e){let t=[],i={items:t,styles:Object.create(null)};function s(n){if(!n)return;let r=null,a=n.name;if(a==="#text")r=n.value;else if(o.shouldBuildText(a))n?.attributes?.textContent?r=n.attributes.textContent:n.value&&(r=n.value);else return;if(r!==null&&t.push({str:r}),!!n.children)for(let l of n.children)s(l)}return s(e),i}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}},kl=65536,Cl=100,Sl=5e3,El=mt?un:cn,Tl=mt?mn:Yi,Ml=mt?hn:dn,Pl=mt?pn:Zi;function Il(o={}){typeof o=="string"||o instanceof URL?o={url:o}:(o instanceof ArrayBuffer||ArrayBuffer.isView(o))&&(o={data:o});let e=new On,{docId:t}=e,i=o.url?Ll(o.url):null,s=o.data?Rl(o.data):null,n=o.httpHeaders||null,r=o.withCredentials===!0,a=o.password??null,l=o.range instanceof es?o.range:null,c=Number.isInteger(o.rangeChunkSize)&&o.rangeChunkSize>0?o.rangeChunkSize:kl,d=o.worker instanceof Me?o.worker:null,h=o.verbosity,u=typeof o.docBaseUrl=="string"&&!ws(o.docBaseUrl)?o.docBaseUrl:null,m=typeof o.cMapUrl=="string"?o.cMapUrl:null,p=o.cMapPacked!==!1,f=o.CMapReaderFactory||Tl,_=typeof o.standardFontDataUrl=="string"?o.standardFontDataUrl:null,g=o.StandardFontDataFactory||Pl,b=o.stopAtErrors!==!0,v=Number.isInteger(o.maxImageSize)&&o.maxImageSize>-1?o.maxImageSize:-1,y=o.isEvalSupported!==!1,w=typeof o.isOffscreenCanvasSupported=="boolean"?o.isOffscreenCanvasSupported:!mt,A=typeof o.isImageDecoderSupported=="boolean"?o.isImageDecoderSupported:!mt&&(ot.platform.isFirefox||!globalThis.chrome),x=Number.isInteger(o.canvasMaxAreaInBytes)?o.canvasMaxAreaInBytes:-1,M=typeof o.disableFontFace=="boolean"?o.disableFontFace:mt,P=o.fontExtraProperties===!0,j=o.enableXfa===!0,N=o.ownerDocument||globalThis.document,U=o.disableRange===!0,it=o.disableStream===!0,V=o.disableAutoFetch===!0,pt=o.pdfBug===!0,$=o.CanvasFactory||El,S=o.FilterFactory||Ml,I=o.enableHWA===!0,Dt=l?l.length:o.length??NaN,Gt=typeof o.useSystemFonts=="boolean"?o.useSystemFonts:!mt&&!M,yt=typeof o.useWorkerFetch=="boolean"?o.useWorkerFetch:f===Yi&&g===Zi&&m&&_&&Xe(m,document.baseURI)&&Xe(_,document.baseURI);o.canvasFactory&&La("`canvasFactory`-instance option, please use `CanvasFactory` instead."),o.filterFactory&&La("`filterFactory`-instance option, please use `FilterFactory` instead.");let rt=null;Xo(h);let Q={canvasFactory:new $({ownerDocument:N,enableHWA:I}),filterFactory:new S({docId:t,ownerDocument:N}),cMapReaderFactory:yt?null:new f({baseUrl:m,isCompressed:p}),standardFontDataFactory:yt?null:new g({baseUrl:_})};if(!d){let wt={verbosity:h,port:pe.workerPort};d=wt.port?Me.fromPort(wt):new Me(wt),e._worker=d}let ve={docId:t,apiVersion:"4.9.155",data:s,password:a,disableAutoFetch:V,rangeChunkSize:c,length:Dt,docBaseUrl:u,enableXfa:j,evaluatorOptions:{maxImageSize:v,disableFontFace:M,ignoreErrors:b,isEvalSupported:y,isOffscreenCanvasSupported:w,isImageDecoderSupported:A,canvasMaxAreaInBytes:x,fontExtraProperties:P,useSystemFonts:Gt,cMapUrl:yt?m:null,standardFontDataUrl:yt?_:null}},Re={disableFontFace:M,fontExtraProperties:P,ownerDocument:N,pdfBug:pt,styleElement:rt,loadingParams:{disableAutoFetch:V,enableXfa:j}};return d.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");let wt=d.messageHandler.sendWithPromise("GetDocRequest",ve,s?[s.buffer]:null),W;if(l)W=new xn(l,{disableRange:U,disableStream:it});else if(!s){if(!i)throw new Error("getDocument - no `url` parameter provided.");let Ot;if(mt)if(Xe(i)){if(typeof fetch>"u"||typeof Response>"u"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");Ot=ts}else Ot=Ln;else Ot=Xe(i)?ts:Mn;W=new Ot({url:i,length:Dt,httpHeaders:n,withCredentials:r,rangeChunkSize:c,disableRange:U,disableStream:it})}return wt.then(Ot=>{if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");let wr=new me(t,Ot,d.port),ho=new zn(wr,e,W,Re,Q);e._transport=ho,wr.send("Ready",null)})}).catch(e._capability.reject),e}function Ll(o){if(o instanceof URL)return o.href;try{return new URL(o,window.location).href}catch{if(mt&&typeof o=="string")return o}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function Rl(o){if(mt&&typeof Buffer<"u"&&o instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(o instanceof Uint8Array&&o.byteLength===o.buffer.byteLength)return o;if(typeof o=="string")return vs(o);if(o instanceof ArrayBuffer||ArrayBuffer.isView(o)||typeof o=="object"&&!isNaN(o?.length))return new Uint8Array(o);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function $a(o){return typeof o=="object"&&Number.isInteger(o?.num)&&o.num>=0&&Number.isInteger(o?.gen)&&o.gen>=0}var On=class o{static#t=0;constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${o.#t++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}destroy(){return C(this,null,function*(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),yield this._transport?.destroy()}catch(e){throw this._worker?.port&&delete this._worker._pendingDestroy,e}this._transport=null,this._worker?.destroy(),this._worker=null})}},es=class{constructor(e,t,i=!1,s=null){this.length=e,this.initialData=t,this.progressiveDone=i,this.contentDispositionFilename=s,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(let i of this._rangeListeners)i(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(let i of this._progressListeners)i(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(let t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(let e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){G("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}},Fn=class{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return B(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){let{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}},Nn=class{#t=null;#e=!1;constructor(e,t,i,s=!1){this._pageIndex=e,this._pageInfo=t,this._transport=i,this._stats=s?new Vi:null,this._pdfBug=s,this.commonObjs=i.commonObjs,this.objs=new is,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:i=0,offsetY:s=0,dontFlip:n=!1}={}){return new Qe({viewBox:this.view,scale:e,rotation:t,offsetX:i,offsetY:s,dontFlip:n})}getAnnotations({intent:e="display"}={}){let{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return B(this,"isPureXfa",!!this._transport._htmlForXfa)}getXfa(){return C(this,null,function*(){return this._transport._htmlForXfa?.children[this._pageIndex]||null})}render({canvasContext:e,viewport:t,intent:i="display",annotationMode:s=te.ENABLE,transform:n=null,background:r=null,optionalContentConfigPromise:a=null,annotationCanvasMap:l=null,pageColors:c=null,printAnnotationStorage:d=null,isEditing:h=!1}){this._stats?.time("Overall");let u=this._transport.getRenderingIntent(i,s,d,h),{renderingIntent:m,cacheKey:p}=u;this.#e=!1,this.#s(),a||=this._transport.getOptionalContentConfig(m);let f=this._intentStates.get(p);f||(f=Object.create(null),this._intentStates.set(p,f)),f.streamReaderCancelTimeout&&(clearTimeout(f.streamReaderCancelTimeout),f.streamReaderCancelTimeout=null);let _=!!(m&vt.PRINT);f.displayReadyCapability||(f.displayReadyCapability=Promise.withResolvers(),f.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(u));let g=y=>{f.renderTasks.delete(b),(this._maybeCleanupAfterRender||_)&&(this.#e=!0),this.#i(!_),y?(b.capability.reject(y),this._abortOperatorList({intentState:f,reason:y instanceof Error?y:new Error(y)})):b.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},b=new jn({callback:g,params:{canvasContext:e,viewport:t,transform:n,background:r},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:f.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!_,pdfBug:this._pdfBug,pageColors:c});(f.renderTasks||=new Set).add(b);let v=b.task;return Promise.all([f.displayReadyCapability.promise,a]).then(([y,w])=>{if(this.destroyed){g();return}if(this._stats?.time("Rendering"),!(w.renderingIntent&m))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");b.initializeGraphics({transparency:y,optionalContentConfig:w}),b.operatorListChanged()}).catch(g),v}getOperatorList({intent:e="display",annotationMode:t=te.ENABLE,printAnnotationStorage:i=null,isEditing:s=!1}={}){function n(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(l))}let r=this._transport.getRenderingIntent(e,t,i,s,!0),a=this._intentStates.get(r.cacheKey);a||(a=Object.create(null),this._intentStates.set(r.cacheKey,a));let l;return a.opListReadCapability||(l=Object.create(null),l.operatorListChanged=n,a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||=new Set).add(l),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(r)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(s){return s.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(i=>ni.textContent(i));let t=this.streamTextContent(e);return new Promise(function(i,s){function n(){r.read().then(function({value:l,done:c}){if(c){i(a);return}a.lang??=l.lang,Object.assign(a.styles,l.styles),a.items.push(...l.items),n()},s)}let r=t.getReader(),a={items:[],styles:Object.create(null),lang:null};n()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let e=[];for(let t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(let i of t.renderTasks)e.push(i.completed),i.cancel();return this.objs.clear(),this.#e=!1,this.#s(),Promise.all(e)}cleanup(e=!1){this.#e=!0;let t=this.#i(!1);return e&&t&&(this._stats&&=new Vi),t}#i(e=!1){if(this.#s(),!this.#e||this.destroyed)return!1;if(e)return this.#t=setTimeout(()=>{this.#t=null,this.#i(!1)},Sl),!1;for(let{renderTasks:t,operatorList:i}of this._intentStates.values())if(t.size>0||!i.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#e=!1,!0}#s(){this.#t&&(clearTimeout(this.#t),this.#t=null)}_startRenderPage(e,t){let i=this._intentStates.get(t);i&&(this._stats?.timeEnd("Page Request"),i.displayReadyCapability?.resolve(e))}_renderPageChunk(e,t){for(let i=0,s=e.length;i<s;i++)t.operatorList.fnArray.push(e.fnArray[i]),t.operatorList.argsArray.push(e.argsArray[i]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(let i of t.renderTasks)i.operatorListChanged();e.lastChunk&&this.#i(!0)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:i,modifiedIds:s}){let{map:n,transfer:r}=i,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:n,modifiedIds:s},r).getReader(),c=this._intentStates.get(t);c.streamReader=l;let d=()=>{l.read().then(({value:h,done:u})=>{if(u){c.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(h,c),d())},h=>{if(c.streamReader=null,!this._transport.destroyed){if(c.operatorList){c.operatorList.lastChunk=!0;for(let u of c.renderTasks)u.operatorListChanged();this.#i(!0)}if(c.displayReadyCapability)c.displayReadyCapability.reject(h);else if(c.opListReadCapability)c.opListReadCapability.reject(h);else throw h}})};d()}_abortOperatorList({intentState:e,reason:t,force:i=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!i){if(e.renderTasks.size>0)return;if(t instanceof Ze){let s=Cl;t.extraDelay>0&&t.extraDelay<1e3&&(s+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},s);return}}if(e.streamReader.cancel(new Xt(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(let[s,n]of this._intentStates)if(n===e){this._intentStates.delete(s);break}this.cleanup()}}}get stats(){return this._stats}},Bn=class{#t=new Map;#e=Promise.resolve();postMessage(e,t){let i={data:structuredClone(e,t?{transfer:t}:null)};this.#e.then(()=>{for(let[s]of this.#t)s.call(this,i)})}addEventListener(e,t,i=null){let s=null;if(i?.signal instanceof AbortSignal){let{signal:n}=i;if(n.aborted){F("LoopbackPort - cannot use an `aborted` signal.");return}let r=()=>this.removeEventListener(e,t);s=()=>n.removeEventListener("abort",r),n.addEventListener("abort",r)}this.#t.set(t,s)}removeEventListener(e,t){this.#t.get(t)?.(),this.#t.delete(t)}terminate(){for(let[,e]of this.#t)e?.();this.#t.clear()}},Me=class o{static#t=0;static#e=!1;static#i;static{mt&&(this.#e=!0,pe.workerSrc||="./pdf.worker.mjs"),this._isSameOrigin=(e,t)=>{let i;try{if(i=new URL(e),!i.origin||i.origin==="null")return!1}catch{return!1}let s=new URL(t,i);return i.origin===s.origin},this._createCDNWrapper=e=>{let t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))}}constructor({name:e=null,port:t=null,verbosity:i=qo()}={}){if(this.name=e,this.destroyed=!1,this.verbosity=i,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,t){if(o.#i?.has(t))throw new Error("Cannot use more than one PDFWorker per port.");(o.#i||=new WeakMap).set(t,this),this._initializeFromPort(t);return}this._initialize()}get promise(){return this._readyCapability.promise}#s(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new me("main","worker",e),this._messageHandler.on("ready",function(){}),this.#s()}_initialize(){if(o.#e||o.#r){this._setupFakeWorker();return}let{workerSrc:e}=o;try{o._isSameOrigin(window.location.href,e)||(e=o._createCDNWrapper(new URL(e,window.location).href));let t=new Worker(e,{type:"module"}),i=new me("main","worker",t),s=()=>{n.abort(),i.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},n=new AbortController;t.addEventListener("error",()=>{this._webWorker||s()},{signal:n.signal}),i.on("test",a=>{if(n.abort(),this.destroyed||!a){s();return}this._messageHandler=i,this._port=t,this._webWorker=t,this.#s()}),i.on("ready",a=>{if(n.abort(),this.destroyed){s();return}try{r()}catch{this._setupFakeWorker()}});let r=()=>{let a=new Uint8Array;i.send("test",a,[a.buffer])};r();return}catch{bs("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){o.#e||(F("Setting up fake worker."),o.#e=!0),o._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}let t=new Bn;this._port=t;let i=`fake${o.#t++}`,s=new me(i+"_worker",i,t);e.setup(s,t),this._messageHandler=new me(i,i+"_worker",t),this.#s()}).catch(e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){this.destroyed=!0,this._webWorker?.terminate(),this._webWorker=null,o.#i?.delete(this._port),this._port=null,this._messageHandler?.destroy(),this._messageHandler=null}static fromPort(e){if(!e?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");let t=this.#i?.get(e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new o(e)}static get workerSrc(){if(pe.workerSrc)return pe.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get#r(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){return B(this,"_setupFakeWorkerGlobal",C(this,null,function*(){return this.#r?this.#r:(yield import(this.workerSrc)).WorkerMessageHandler}))}},zn=class{#t=new Map;#e=new Map;#i=new Map;#s=new Map;#r=null;constructor(e,t,i,s,n){this.messageHandler=e,this.loadingTask=t,this.commonObjs=new is,this.fontLoader=new on({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this.loadingParams=s.loadingParams,this._params=s,this.canvasFactory=n.canvasFactory,this.filterFactory=n.filterFactory,this.cMapReaderFactory=n.cMapReaderFactory,this.standardFontDataFactory=n.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=i,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}#n(e,t=null){let i=this.#t.get(e);if(i)return i;let s=this.messageHandler.sendWithPromise(e,t);return this.#t.set(e,s),s}get annotationStorage(){return B(this,"annotationStorage",new ei)}getRenderingIntent(e,t=te.ENABLE,i=null,s=!1,n=!1){let r=vt.DISPLAY,a=an;switch(e){case"any":r=vt.ANY;break;case"display":break;case"print":r=vt.PRINT;break;default:F(`getRenderingIntent - invalid intent: ${e}`)}let l=r&vt.PRINT&&i instanceof Wi?i:this.annotationStorage;switch(t){case te.DISABLE:r+=vt.ANNOTATIONS_DISABLE;break;case te.ENABLE:break;case te.ENABLE_FORMS:r+=vt.ANNOTATIONS_FORMS;break;case te.ENABLE_STORAGE:r+=vt.ANNOTATIONS_STORAGE,a=l.serializable;break;default:F(`getRenderingIntent - invalid annotationMode: ${t}`)}s&&(r+=vt.IS_EDITING),n&&(r+=vt.OPLIST);let{ids:c,hash:d}=l.modifiedIds,h=[r,a.hash,d];return{renderingIntent:r,cacheKey:h.join("_"),annotationStorageSerializable:a,modifiedIds:c}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#r?.reject(new Error("Worker was destroyed during onPassword callback"));let e=[];for(let i of this.#e.values())e.push(i._destroy());this.#e.clear(),this.#i.clear(),this.#s.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();let t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),si.cleanup(),this._networkStream?.cancelAllRequests(new Xt("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(i,s)=>{et(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=n=>{this._lastProgress={loaded:n.loaded,total:n.total}},s.onPull=()=>{this._fullReader.read().then(function({value:n,done:r}){if(r){s.close();return}et(n instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(n),1,[n])}).catch(n=>{s.error(n)})},s.onCancel=n=>{this._fullReader.cancel(n),s.ready.catch(r=>{if(!this.destroyed)throw r})}}),e.on("ReaderHeadersReady",i=>C(this,null,function*(){yield this._fullReader.headersReady;let{isStreamingSupported:s,isRangeSupported:n,contentLength:r}=this._fullReader;return(!s||!n)&&(this._lastProgress&&t.onProgress?.(this._lastProgress),this._fullReader.onProgress=a=>{t.onProgress?.({loaded:a.loaded,total:a.total})}),{isStreamingSupported:s,isRangeSupported:n,contentLength:r}})),e.on("GetRangeReader",(i,s)=>{et(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let n=this._networkStream.getRangeReader(i.begin,i.end);if(!n){s.close();return}s.onPull=()=>{n.read().then(function({value:r,done:a}){if(a){s.close();return}et(r instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{s.error(r)})},s.onCancel=r=>{n.cancel(r),s.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("GetDoc",({pdfInfo:i})=>{this._numPages=i.numPages,this._htmlForXfa=i.htmlForXfa,delete i.htmlForXfa,t._capability.resolve(new Fn(i,this))}),e.on("DocException",function(i){let s;switch(i.name){case"PasswordException":s=new Ye(i.message,i.code);break;case"InvalidPDFException":s=new ji(i.message);break;case"MissingPDFException":s=new fe(i.message);break;case"UnexpectedResponseException":s=new Pe(i.message,i.status);break;case"UnknownErrorException":s=new Ke(i.message,i.details);break;default:G("DocException - expected a valid Error.")}t._capability.reject(s)}),e.on("PasswordRequest",i=>{if(this.#r=Promise.withResolvers(),t.onPassword){let s=n=>{n instanceof Error?this.#r.reject(n):this.#r.resolve({password:n})};try{t.onPassword(s,i.code)}catch(n){this.#r.reject(n)}}else this.#r.reject(new Ye(i.message,i.code));return this.#r.promise}),e.on("DataLoaded",i=>{t.onProgress?.({loaded:i.length,total:i.length}),this.downloadInfoCapability.resolve(i)}),e.on("StartRenderPage",i=>{if(this.destroyed)return;this.#e.get(i.pageIndex)._startRenderPage(i.transparency,i.cacheKey)}),e.on("commonobj",([i,s,n])=>{if(this.destroyed||this.commonObjs.has(i))return null;switch(s){case"Font":let{disableFontFace:r,fontExtraProperties:a,pdfBug:l}=this._params;if("error"in n){let u=n.error;F(`Error during font loading: ${u}`),this.commonObjs.resolve(i,u);break}let c=l&&globalThis.FontInspector?.enabled?(u,m)=>globalThis.FontInspector.fontAdded(u,m):null,d=new ln(n,{disableFontFace:r,inspectFont:c});this.fontLoader.bind(d).catch(()=>e.sendWithPromise("FontFallback",{id:i})).finally(()=>{!a&&d.data&&(d.data=null),this.commonObjs.resolve(i,d)});break;case"CopyLocalImage":let{imageRef:h}=n;et(h,"The imageRef must be defined.");for(let u of this.#e.values())for(let[,m]of u.objs)if(m?.ref===h)return m.dataLen?(this.commonObjs.resolve(i,structuredClone(m)),m.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(i,n);break;default:throw new Error(`Got unknown common object type ${s}`)}return null}),e.on("obj",([i,s,n,r])=>{if(this.destroyed)return;let a=this.#e.get(s);if(!a.objs.has(i)){if(a._intentStates.size===0){r?.bitmap?.close();return}switch(n){case"Image":a.objs.resolve(i,r),r?.dataLen>Vo&&(a._maybeCleanupAfterRender=!0);break;case"Pattern":a.objs.resolve(i,r);break;default:throw new Error(`Got unknown object type ${n}`)}}}),e.on("DocProgress",i=>{this.destroyed||t.onProgress?.({loaded:i.loaded,total:i.total})}),e.on("FetchBuiltInCMap",i=>C(this,null,function*(){if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(i)})),e.on("FetchStandardFontData",i=>C(this,null,function*(){if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(i)}))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&F("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");let{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:this._fullReader?.filename??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));let t=e-1,i=this.#i.get(t);if(i)return i;let s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(n=>{if(this.destroyed)throw new Error("Transport destroyed");n.refStr&&this.#s.set(n.refStr,e);let r=new Nn(t,n,this,this._params.pdfBug);return this.#e.set(t,r),r});return this.#i.set(t,s),s}getPageIndex(e){return $a(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return this.#n("GetFieldObjects")}hasJSActions(){return this.#n("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#n("GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return this.#n("GetOptionalContentConfig").then(t=>new An(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){let e="GetMetadata",t=this.#t.get(e);if(t)return t;let i=this.messageHandler.sendWithPromise(e,null).then(s=>({info:s[0],metadata:s[1]?new yn(s[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#t.set(e,i),i}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}startCleanup(e=!1){return C(this,null,function*(){if(!this.destroyed){yield this.messageHandler.sendWithPromise("Cleanup",null);for(let t of this.#e.values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0),si.cleanup()}})}cachedPageNumber(e){if(!$a(e))return null;let t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return this.#s.get(t)??null}},Ni=Symbol("INITIAL_DATA"),is=class{#t=Object.create(null);#e(e){return this.#t[e]||=Yt(Y({},Promise.withResolvers()),{data:Ni})}get(e,t=null){if(t){let s=this.#e(e);return s.promise.then(()=>t(s.data)),null}let i=this.#t[e];if(!i||i.data===Ni)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return i.data}has(e){let t=this.#t[e];return!!t&&t.data!==Ni}resolve(e,t=null){let i=this.#e(e);i.data=t,i.resolve()}clear(){for(let e in this.#t){let{data:t}=this.#t[e];t?.bitmap?.close()}this.#t=Object.create(null)}*[Symbol.iterator](){for(let e in this.#t){let{data:t}=this.#t[e];t!==Ni&&(yield[e,t])}}},Hn=class{#t=null;constructor(e){this.#t=e,this.onContinue=null}get promise(){return this.#t.capability.promise}cancel(e=0){this.#t.cancel(null,e)}get separateAnnots(){let{separateAnnots:e}=this.#t.operatorList;if(!e)return!1;let{annotationCanvasMap:t}=this.#t;return e.form||e.canvas&&t?.size>0}},jn=class o{#t=null;static#e=new WeakSet;constructor({callback:e,params:t,objs:i,commonObjs:s,annotationCanvasMap:n,operatorList:r,pageIndex:a,canvasFactory:l,filterFactory:c,useRequestAnimationFrame:d=!1,pdfBug:h=!1,pageColors:u=null}){this.callback=e,this.params=t,this.objs=i,this.commonObjs=s,this.annotationCanvasMap=n,this.operatorListIdx=null,this.operatorList=r,this._pageIndex=a,this.canvasFactory=l,this.filterFactory=c,this._pdfBug=h,this.pageColors=u,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=d===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Hn(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){if(this.cancelled)return;if(this._canvas){if(o.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");o.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{canvasContext:i,viewport:s,transform:n,background:r}=this.params;this.gfx=new Te(i,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:n,viewport:s,transparency:e,background:r}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(e=null,t=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#t&&(window.cancelAnimationFrame(this.#t),this.#t=null),o.#e.delete(this._canvas),this.callback(e||new Ze(`Rendering cancelled, page ${this._pageIndex+1}`,t))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#t=window.requestAnimationFrame(()=>{this.#t=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}_next(){return C(this,null,function*(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),o.#e.delete(this._canvas),this.callback())))})}},Dl="4.9.155",Ol="a4eb8407c";function Wa(o){return Math.floor(Math.max(0,Math.min(1,o))*255).toString(16).padStart(2,"0")}function We(o){return Math.max(0,Math.min(255,255*o))}var ss=class{static CMYK_G([e,t,i,s]){return["G",1-Math.min(1,.3*e+.59*i+.11*t+s)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=We(e),[e,e,e]}static G_HTML([e]){let t=Wa(e);return`#${t}${t}${t}`}static RGB_G([e,t,i]){return["G",.3*e+.59*t+.11*i]}static RGB_rgb(e){return e.map(We)}static RGB_HTML(e){return`#${e.map(Wa).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,i,s]){return["RGB",1-Math.min(1,e+s),1-Math.min(1,i+s),1-Math.min(1,t+s)]}static CMYK_rgb([e,t,i,s]){return[We(1-Math.min(1,e+s)),We(1-Math.min(1,i+s)),We(1-Math.min(1,t+s))]}static CMYK_HTML(e){let t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,i]){let s=1-e,n=1-t,r=1-i,a=Math.min(s,n,r);return["CMYK",s,n,r,a]}},Vn=class{create(e,t,i=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");let s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),i||(s.setAttribute("width",`${e}px`),s.setAttribute("height",`${t}px`)),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox",`0 0 ${e} ${t}`),s}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){G("Abstract method `_createSVG` called.")}},ri=class extends Vn{_createSVG(e){return document.createElementNS(Wt,e)}},ns=class{static setupStorage(e,t,i,s,n){let r=s.getValue(t,{value:null});switch(i.name){case"textarea":if(r.value!==null&&(e.textContent=r.value),n==="print")break;e.addEventListener("input",a=>{s.setValue(t,{value:a.target.value})});break;case"input":if(i.attributes.type==="radio"||i.attributes.type==="checkbox"){if(r.value===i.attributes.xfaOn?e.setAttribute("checked",!0):r.value===i.attributes.xfaOff&&e.removeAttribute("checked"),n==="print")break;e.addEventListener("change",a=>{s.setValue(t,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(r.value!==null&&e.setAttribute("value",r.value),n==="print")break;e.addEventListener("input",a=>{s.setValue(t,{value:a.target.value})})}break;case"select":if(r.value!==null){e.setAttribute("value",r.value);for(let a of i.children)a.attributes.value===r.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}e.addEventListener("input",a=>{let l=a.target.options,c=l.selectedIndex===-1?"":l[l.selectedIndex].value;s.setValue(t,{value:c})});break}}static setAttributes({html:e,element:t,storage:i=null,intent:s,linkService:n}){let{attributes:r}=t,a=e instanceof HTMLAnchorElement;r.type==="radio"&&(r.name=`${r.name}-${s}`);for(let[l,c]of Object.entries(r))if(c!=null)switch(l){case"class":c.length&&e.setAttribute(l,c.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",c);break;case"style":Object.assign(e.style,c);break;case"textContent":e.textContent=c;break;default:(!a||l!=="href"&&l!=="newWindow")&&e.setAttribute(l,c)}a&&n.addLinkAttributes(e,r.href,r.newWindow),i&&r.dataId&&this.setupStorage(e,r.dataId,t,i)}static render(e){let t=e.annotationStorage,i=e.linkService,s=e.xfaHtml,n=e.intent||"display",r=document.createElement(s.name);s.attributes&&this.setAttributes({html:r,element:s,intent:n,linkService:i});let a=n!=="richText",l=e.div;if(l.append(r),e.viewport){let h=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=h}a&&l.setAttribute("class","xfaLayer xfaFont");let c=[];if(s.children.length===0){if(s.value){let h=document.createTextNode(s.value);r.append(h),a&&ni.shouldBuildText(s.name)&&c.push(h)}return{textDivs:c}}let d=[[s,-1,r]];for(;d.length>0;){let[h,u,m]=d.at(-1);if(u+1===h.children.length){d.pop();continue}let p=h.children[++d.at(-1)[1]];if(p===null)continue;let{name:f}=p;if(f==="#text"){let g=document.createTextNode(p.value);c.push(g),m.append(g);continue}let _=p?.attributes?.xmlns?document.createElementNS(p.attributes.xmlns,f):document.createElement(f);if(m.append(_),p.attributes&&this.setAttributes({html:_,element:p,storage:t,intent:n,linkService:i}),p.children?.length>0)d.push([p,-1,_]);else if(p.value){let g=document.createTextNode(p.value);a&&ni.shouldBuildText(f)&&c.push(g),_.append(g)}}for(let h of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))h.setAttribute("readOnly",!0);return{textDivs:c}}static update(e){let t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}},di=1e3,Fl=9,be=new WeakSet;function ee(o){return{width:o[2]-o[0],height:o[3]-o[1]}}var Gn=class{static create(e){switch(e.data.annotationType){case nt.LINK:return new rs(e);case nt.TEXT:return new Un(e);case nt.WIDGET:switch(e.data.fieldType){case"Tx":return new $n(e);case"Btn":return e.data.radioButton?new as(e):e.data.checkBox?new Xn(e):new qn(e);case"Ch":return new Yn(e);case"Sig":return new Wn(e)}return new qt(e);case nt.POPUP:return new ai(e);case nt.FREETEXT:return new os(e);case nt.LINE:return new Qn(e);case nt.SQUARE:return new Zn(e);case nt.CIRCLE:return new Jn(e);case nt.POLYLINE:return new ls(e);case nt.CARET:return new er(e);case nt.INK:return new oi(e);case nt.POLYGON:return new tr(e);case nt.HIGHLIGHT:return new cs(e);case nt.UNDERLINE:return new ir(e);case nt.SQUIGGLY:return new sr(e);case nt.STRIKEOUT:return new nr(e);case nt.STAMP:return new ds(e);case nt.FILEATTACHMENT:return new rr(e);default:return new K(e)}}},K=class o{#t=null;#e=!1;#i=null;constructor(e,{isRenderable:t=!1,ignoreBorder:i=!1,createQuadrilaterals:s=!1}={}){this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(i)),s&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:i}){return!!(e?.str||t?.str||i?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return o._hasPopupData(this.data)}updateEdited(e){if(!this.container)return;this.#t||={rect:this.data.rect.slice(0)};let{rect:t}=e;t&&this.#s(t),this.#i?.popup.updateEdited(e)}resetEdited(){this.#t&&(this.#s(this.#t.rect),this.#i?.popup.resetEdited(),this.#t=null)}#s(e){let{container:{style:t},data:{rect:i,rotation:s},parent:{viewport:{rawDims:{pageWidth:n,pageHeight:r,pageX:a,pageY:l}}}}=this;i?.splice(0,4,...e);let{width:c,height:d}=ee(e);t.left=`${100*(e[0]-a)/n}%`,t.top=`${100*(r-e[3]+l)/r}%`,s===0?(t.width=`${100*c/n}%`,t.height=`${100*d/r}%`):this.setRotation(s)}_createContainer(e){let{data:t,parent:{page:i,viewport:s}}=this,n=document.createElement("section");n.setAttribute("data-annotation-id",t.id),this instanceof qt||(n.tabIndex=di);let{style:r}=n;if(r.zIndex=this.parent.zIndex++,t.alternativeText&&(n.title=t.alternativeText),t.noRotate&&n.classList.add("norotate"),!t.rect||this instanceof ai){let{rotation:f}=t;return!t.hasOwnCanvas&&f!==0&&this.setRotation(f,n),n}let{width:a,height:l}=ee(t.rect);if(!e&&t.borderStyle.width>0){r.borderWidth=`${t.borderStyle.width}px`;let f=t.borderStyle.horizontalCornerRadius,_=t.borderStyle.verticalCornerRadius;if(f>0||_>0){let b=`calc(${f}px * var(--scale-factor)) / calc(${_}px * var(--scale-factor))`;r.borderRadius=b}else if(this instanceof as){let b=`calc(${a}px * var(--scale-factor)) / calc(${l}px * var(--scale-factor))`;r.borderRadius=b}switch(t.borderStyle.style){case Ue.SOLID:r.borderStyle="solid";break;case Ue.DASHED:r.borderStyle="dashed";break;case Ue.BEVELED:F("Unimplemented border style: beveled");break;case Ue.INSET:F("Unimplemented border style: inset");break;case Ue.UNDERLINE:r.borderBottomStyle="solid";break;default:break}let g=t.borderColor||null;g?(this.#e=!0,r.borderColor=E.makeHexColor(g[0]|0,g[1]|0,g[2]|0)):r.borderWidth=0}let c=E.normalizeRect([t.rect[0],i.view[3]-t.rect[1]+i.view[1],t.rect[2],i.view[3]-t.rect[3]+i.view[1]]),{pageWidth:d,pageHeight:h,pageX:u,pageY:m}=s.rawDims;r.left=`${100*(c[0]-u)/d}%`,r.top=`${100*(c[1]-m)/h}%`;let{rotation:p}=t;return t.hasOwnCanvas||p===0?(r.width=`${100*a/d}%`,r.height=`${100*l/h}%`):this.setRotation(p,n),n}setRotation(e,t=this.container){if(!this.data.rect)return;let{pageWidth:i,pageHeight:s}=this.parent.viewport.rawDims,{width:n,height:r}=ee(this.data.rect),a,l;e%180===0?(a=100*n/i,l=100*r/s):(a=100*r/i,l=100*n/s),t.style.width=`${a}%`,t.style.height=`${l}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){let e=(t,i,s)=>{let n=s.detail[t],r=n[0],a=n.slice(1);s.target.style[i]=ss[`${r}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[i]:ss[`${r}_rgb`](a)})};return B(this,"_commonActions",{display:t=>{let{display:i}=t.detail,s=i%2===1;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:s,noPrint:i===1||i===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{let{hidden:i}=t.detail;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:i,noView:i})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{let i=t.detail.rotation;this.setRotation(i),this.annotationStorage.setValue(this.data.id,{rotation:i})}})}_dispatchEventFromSandbox(e,t){let i=this._commonActions;for(let s of Object.keys(t.detail))(e[s]||i[s])?.(t)}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;let t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;let i=this._commonActions;for(let[s,n]of Object.entries(t)){let r=i[s];if(r){let a={detail:{[s]:n},target:e};r(a),delete t[s]}}}_createQuadrilaterals(){if(!this.container)return;let{quadPoints:e}=this.data;if(!e)return;let[t,i,s,n]=this.data.rect.map(f=>Math.fround(f));if(e.length===8){let[f,_,g,b]=e.subarray(2,6);if(s===f&&n===_&&t===g&&i===b)return}let{style:r}=this.container,a;if(this.#e){let{borderColor:f,borderWidth:_}=r;r.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${f}" stroke-width="${_}">`],this.container.classList.add("hasBorder")}let l=s-t,c=n-i,{svgFactory:d}=this,h=d.createElement("svg");h.classList.add("quadrilateralsContainer"),h.setAttribute("width",0),h.setAttribute("height",0);let u=d.createElement("defs");h.append(u);let m=d.createElement("clipPath"),p=`clippath_${this.data.id}`;m.setAttribute("id",p),m.setAttribute("clipPathUnits","objectBoundingBox"),u.append(m);for(let f=2,_=e.length;f<_;f+=8){let g=e[f],b=e[f+1],v=e[f+2],y=e[f+3],w=d.createElement("rect"),A=(v-t)/l,x=(n-b)/c,M=(g-v)/l,P=(b-y)/c;w.setAttribute("x",A),w.setAttribute("y",x),w.setAttribute("width",M),w.setAttribute("height",P),m.append(w),a?.push(`<rect vector-effect="non-scaling-stroke" x="${A}" y="${x}" width="${M}" height="${P}"/>`)}this.#e&&(a.push("</g></svg>')"),r.backgroundImage=a.join("")),this.container.append(h),this.container.style.clipPath=`url(#${p})`}_createPopup(){let{data:e}=this,t=this.#i=new ai({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]});this.parent.div.append(t.render())}render(){G("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){let i=[];if(this._fieldObjects){let s=this._fieldObjects[e];if(s)for(let{page:n,id:r,exportValues:a}of s){if(n===-1||r===t)continue;let l=typeof a=="string"?a:null,c=document.querySelector(`[data-element-id="${r}"]`);if(c&&!be.has(c)){F(`_getElementsByName - element not allowed: ${r}`);continue}i.push({id:r,exportValue:l,domElement:c})}return i}for(let s of document.getElementsByName(e)){let{exportValue:n}=s,r=s.getAttribute("data-element-id");r!==t&&be.has(s)&&i.push({id:r,exportValue:n,domElement:s})}return i}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){let e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(let t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;let{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}},rs=class extends K{constructor(e,t=null){super(e,{isRenderable:!0,ignoreBorder:!!t?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=e.data.isTooltipOnly}render(){let{data:e,linkService:t}=this,i=document.createElement("a");i.setAttribute("data-element-id",e.id);let s=!1;return e.url?(t.addLinkAttributes(i,e.url,e.newWindow),s=!0):e.action?(this._bindNamedAction(i,e.action),s=!0):e.attachment?(this.#e(i,e.attachment,e.attachmentDest),s=!0):e.setOCGState?(this.#i(i,e.setOCGState),s=!0):e.dest?(this._bindLink(i,e.dest),s=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,e),s=!0),e.resetForm?(this._bindResetFormAction(i,e.resetForm),s=!0):this.isTooltipOnly&&!s&&(this._bindLink(i,""),s=!0)),this.container.classList.add("linkAnnotation"),s&&this.container.append(i),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(e,t){e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.goToDestination(t),!1),(t||t==="")&&this.#t()}_bindNamedAction(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),this.#t()}#e(e,t,i=null){e.href=this.linkService.getAnchorUrl(""),t.description&&(e.title=t.description),e.onclick=()=>(this.downloadManager?.openOrDownloadData(t.content,t.filename,i),!1),this.#t()}#i(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(t),!1),this.#t()}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl("");let i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(let s of Object.keys(t.actions)){let n=i.get(s);n&&(e[n]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t.id,name:s}}),!1))}e.onclick||(e.onclick=()=>!1),this.#t()}_bindResetFormAction(e,t){let i=e.onclick;if(i||(e.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){F('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(e.onclick=()=>!1);return}e.onclick=()=>{i?.();let{fields:s,refs:n,include:r}=t,a=[];if(s.length!==0||n.length!==0){let d=new Set(n);for(let h of s){let u=this._fieldObjects[h]||[];for(let{id:m}of u)d.add(m)}for(let h of Object.values(this._fieldObjects))for(let u of h)d.has(u.id)===r&&a.push(u)}else for(let d of Object.values(this._fieldObjects))a.push(...d);let l=this.annotationStorage,c=[];for(let d of a){let{id:h}=d;switch(c.push(h),d.type){case"text":{let m=d.defaultValue||"";l.setValue(h,{value:m});break}case"checkbox":case"radiobutton":{let m=d.defaultValue===d.exportValues;l.setValue(h,{value:m});break}case"combobox":case"listbox":{let m=d.defaultValue||"";l.setValue(h,{value:m});break}default:continue}let u=document.querySelector(`[data-element-id="${h}"]`);if(u){if(!be.has(u)){F(`_bindResetFormAction - element not allowed: ${h}`);continue}}else continue;u.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:c,name:"ResetForm"}}),!1}}},Un=class extends K{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");let e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}},qt=class extends K{render(){return this.container}showElementAndHideCanvas(e){this.data.hasOwnCanvas&&(e.previousSibling?.nodeName==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return ot.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,i,s,n){i.includes("mouse")?e.addEventListener(i,r=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:n(r),shift:r.shiftKey,modifier:this._getKeyModifier(r)}})}):e.addEventListener(i,r=>{if(i==="blur"){if(!t.focused||!r.relatedTarget)return;t.focused=!1}else if(i==="focus"){if(t.focused)return;t.focused=!0}n&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:n(r)}})})}_setEventListeners(e,t,i,s){for(let[n,r]of i)(r==="Action"||this.data.actions?.[r])&&((r==="Focus"||r==="Blur")&&(t||={focused:!1}),this._setEventListener(e,t,n,r,s),r==="Focus"&&!this.data.actions?.Blur?this._setEventListener(e,t,"blur","Blur",null):r==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){let t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":E.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){let t=["left","center","right"],{fontColor:i}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||Fl,n=e.style,r,a=2,l=c=>Math.round(10*c)/10;if(this.data.multiLine){let c=Math.abs(this.data.rect[3]-this.data.rect[1]-a),d=Math.round(c/(zi*s))||1,h=c/d;r=Math.min(s,l(h/zi))}else{let c=Math.abs(this.data.rect[3]-this.data.rect[1]-a);r=Math.min(s,l(c/zi))}n.fontSize=`calc(${r}px * var(--scale-factor))`,n.color=E.makeHexColor(i[0],i[1],i[2]),this.data.textAlignment!==null&&(n.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}},$n=class extends qt{constructor(e){let t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,i,s){let n=this.annotationStorage;for(let r of this._getElementsByName(e.name,e.id))r.domElement&&(r.domElement[t]=i),n.setValue(r.id,{[s]:i})}render(){let e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let i=null;if(this.renderForms){let s=e.getValue(t,{value:this.data.fieldValue}),n=s.value||"",r=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;r&&n.length>r&&(n=n.slice(0,r));let a=s.formattedValue||this.data.textContent?.join(`
`)||null;a&&this.data.comb&&(a=a.replaceAll(/\s+/g,""));let l={userValue:n,formattedValue:a,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(i=document.createElement("textarea"),i.textContent=a??n,this.data.doNotScroll&&(i.style.overflowY="hidden")):(i=document.createElement("input"),i.type="text",i.setAttribute("value",a??n),this.data.doNotScroll&&(i.style.overflowX="hidden")),this.data.hasOwnCanvas&&(i.hidden=!0),be.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,i.name=this.data.fieldName,i.tabIndex=di,this._setRequired(i,this.data.required),r&&(i.maxLength=r),i.addEventListener("input",d=>{e.setValue(t,{value:d.target.value}),this.setPropertyOnSiblings(i,"value",d.target.value,"value"),l.formattedValue=null}),i.addEventListener("resetform",d=>{let h=this.data.defaultFieldValue??"";i.value=l.userValue=h,l.formattedValue=null});let c=d=>{let{formattedValue:h}=l;h!=null&&(d.target.value=h),d.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){i.addEventListener("focus",h=>{if(l.focused)return;let{target:u}=h;l.userValue&&(u.value=l.userValue),l.lastCommittedValue=u.value,l.commitKey=1,this.data.actions?.Focus||(l.focused=!0)}),i.addEventListener("updatefromsandbox",h=>{this.showElementAndHideCanvas(h.target);let u={value(m){l.userValue=m.detail.value??"",e.setValue(t,{value:l.userValue.toString()}),m.target.value=l.userValue},formattedValue(m){let{formattedValue:p}=m.detail;l.formattedValue=p,p!=null&&m.target!==document.activeElement&&(m.target.value=p),e.setValue(t,{formattedValue:p})},selRange(m){m.target.setSelectionRange(...m.detail.selRange)},charLimit:m=>{let{charLimit:p}=m.detail,{target:f}=m;if(p===0){f.removeAttribute("maxLength");return}f.setAttribute("maxLength",p);let _=l.userValue;!_||_.length<=p||(_=_.slice(0,p),f.value=l.userValue=_,e.setValue(t,{value:_}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:_,willCommit:!0,commitKey:1,selStart:f.selectionStart,selEnd:f.selectionEnd}}))}};this._dispatchEventFromSandbox(u,h)}),i.addEventListener("keydown",h=>{l.commitKey=1;let u=-1;if(h.key==="Escape"?u=0:h.key==="Enter"&&!this.data.multiLine?u=2:h.key==="Tab"&&(l.commitKey=3),u===-1)return;let{value:m}=h.target;l.lastCommittedValue!==m&&(l.lastCommittedValue=m,l.userValue=m,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:m,willCommit:!0,commitKey:u,selStart:h.target.selectionStart,selEnd:h.target.selectionEnd}}))});let d=c;c=null,i.addEventListener("blur",h=>{if(!l.focused||!h.relatedTarget)return;this.data.actions?.Blur||(l.focused=!1);let{value:u}=h.target;l.userValue=u,l.lastCommittedValue!==u&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:u,willCommit:!0,commitKey:l.commitKey,selStart:h.target.selectionStart,selEnd:h.target.selectionEnd}}),d(h)}),this.data.actions?.Keystroke&&i.addEventListener("beforeinput",h=>{l.lastCommittedValue=null;let{data:u,target:m}=h,{value:p,selectionStart:f,selectionEnd:_}=m,g=f,b=_;switch(h.inputType){case"deleteWordBackward":{let v=p.substring(0,f).match(/\w*[^\w]*$/);v&&(g-=v[0].length);break}case"deleteWordForward":{let v=p.substring(f).match(/^[^\w]*\w*/);v&&(b+=v[0].length);break}case"deleteContentBackward":f===_&&(g-=1);break;case"deleteContentForward":f===_&&(b+=1);break}h.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:p,change:u||"",willCommit:!1,selStart:g,selEnd:b}})}),this._setEventListeners(i,l,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],h=>h.target.value)}if(c&&i.addEventListener("blur",c),this.data.comb){let h=(this.data.rect[2]-this.data.rect[0])/r;i.classList.add("comb"),i.style.letterSpacing=`calc(${h}px * var(--scale-factor) - 1ch)`}}else i=document.createElement("div"),i.textContent=this.data.fieldValue,i.style.verticalAlign="middle",i.style.display="table-cell",this.data.hasOwnCanvas&&(i.hidden=!0);return this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}},Wn=class extends qt{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}},Xn=class extends qt{constructor(e){super(e,{isRenderable:e.renderForms})}render(){let e=this.annotationStorage,t=this.data,i=t.id,s=e.getValue(i,{value:t.exportValue===t.fieldValue}).value;typeof s=="string"&&(s=s!=="Off",e.setValue(i,{value:s})),this.container.classList.add("buttonWidgetAnnotation","checkBox");let n=document.createElement("input");return be.add(n),n.setAttribute("data-element-id",i),n.disabled=t.readOnly,this._setRequired(n,this.data.required),n.type="checkbox",n.name=t.fieldName,s&&n.setAttribute("checked",!0),n.setAttribute("exportValue",t.exportValue),n.tabIndex=di,n.addEventListener("change",r=>{let{name:a,checked:l}=r.target;for(let c of this._getElementsByName(a,i)){let d=l&&c.exportValue===t.exportValue;c.domElement&&(c.domElement.checked=d),e.setValue(c.id,{value:d})}e.setValue(i,{value:l})}),n.addEventListener("resetform",r=>{let a=t.defaultFieldValue||"Off";r.target.checked=a===t.exportValue}),this.enableScripting&&this.hasJSActions&&(n.addEventListener("updatefromsandbox",r=>{let a={value(l){l.target.checked=l.detail.value!=="Off",e.setValue(i,{value:l.target.checked})}};this._dispatchEventFromSandbox(a,r)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],r=>r.target.checked)),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}},as=class extends qt{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");let e=this.annotationStorage,t=this.data,i=t.id,s=e.getValue(i,{value:t.fieldValue===t.buttonValue}).value;if(typeof s=="string"&&(s=s!==t.buttonValue,e.setValue(i,{value:s})),s)for(let r of this._getElementsByName(t.fieldName,i))e.setValue(r.id,{value:!1});let n=document.createElement("input");if(be.add(n),n.setAttribute("data-element-id",i),n.disabled=t.readOnly,this._setRequired(n,this.data.required),n.type="radio",n.name=t.fieldName,s&&n.setAttribute("checked",!0),n.tabIndex=di,n.addEventListener("change",r=>{let{name:a,checked:l}=r.target;for(let c of this._getElementsByName(a,i))e.setValue(c.id,{value:!1});e.setValue(i,{value:l})}),n.addEventListener("resetform",r=>{let a=t.defaultFieldValue;r.target.checked=a!=null&&a===t.buttonValue}),this.enableScripting&&this.hasJSActions){let r=t.buttonValue;n.addEventListener("updatefromsandbox",a=>{let l={value:c=>{let d=r===c.detail.value;for(let h of this._getElementsByName(c.target.name)){let u=d&&h.id===i;h.domElement&&(h.domElement.checked=u),e.setValue(h.id,{value:u})}}};this._dispatchEventFromSandbox(l,a)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}},qn=class extends rs{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){let e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");let t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",i=>{this._dispatchEventFromSandbox({},i)})),e}},Yn=class extends qt{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");let e=this.annotationStorage,t=this.data.id,i=e.getValue(t,{value:this.data.fieldValue}),s=document.createElement("select");be.add(s),s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,this._setRequired(s,this.data.required),s.name=this.data.fieldName,s.tabIndex=di;let n=this.data.combo&&this.data.options.length>0;this.data.combo||(s.size=this.data.options.length,this.data.multiSelect&&(s.multiple=!0)),s.addEventListener("resetform",d=>{let h=this.data.defaultFieldValue;for(let u of s.options)u.selected=u.value===h});for(let d of this.data.options){let h=document.createElement("option");h.textContent=d.displayValue,h.value=d.exportValue,i.value.includes(d.exportValue)&&(h.setAttribute("selected",!0),n=!1),s.append(h)}let r=null;if(n){let d=document.createElement("option");d.value=" ",d.setAttribute("hidden",!0),d.setAttribute("selected",!0),s.prepend(d),r=()=>{d.remove(),s.removeEventListener("input",r),r=null},s.addEventListener("input",r)}let a=d=>{let h=d?"value":"textContent",{options:u,multiple:m}=s;return m?Array.prototype.filter.call(u,p=>p.selected).map(p=>p[h]):u.selectedIndex===-1?null:u[u.selectedIndex][h]},l=a(!1),c=d=>{let h=d.target.options;return Array.prototype.map.call(h,u=>({displayValue:u.textContent,exportValue:u.value}))};return this.enableScripting&&this.hasJSActions?(s.addEventListener("updatefromsandbox",d=>{let h={value(u){r?.();let m=u.detail.value,p=new Set(Array.isArray(m)?m:[m]);for(let f of s.options)f.selected=p.has(f.value);e.setValue(t,{value:a(!0)}),l=a(!1)},multipleSelection(u){s.multiple=!0},remove(u){let m=s.options,p=u.detail.remove;m[p].selected=!1,s.remove(p),m.length>0&&Array.prototype.findIndex.call(m,_=>_.selected)===-1&&(m[0].selected=!0),e.setValue(t,{value:a(!0),items:c(u)}),l=a(!1)},clear(u){for(;s.length!==0;)s.remove(0);e.setValue(t,{value:null,items:[]}),l=a(!1)},insert(u){let{index:m,displayValue:p,exportValue:f}=u.detail.insert,_=s.children[m],g=document.createElement("option");g.textContent=p,g.value=f,_?_.before(g):s.append(g),e.setValue(t,{value:a(!0),items:c(u)}),l=a(!1)},items(u){let{items:m}=u.detail;for(;s.length!==0;)s.remove(0);for(let p of m){let{displayValue:f,exportValue:_}=p,g=document.createElement("option");g.textContent=f,g.value=_,s.append(g)}s.options.length>0&&(s.options[0].selected=!0),e.setValue(t,{value:a(!0),items:c(u)}),l=a(!1)},indices(u){let m=new Set(u.detail.indices);for(let p of u.target.options)p.selected=m.has(p.index);e.setValue(t,{value:a(!0)}),l=a(!1)},editable(u){u.target.disabled=!u.detail.editable}};this._dispatchEventFromSandbox(h,d)}),s.addEventListener("input",d=>{let h=a(!0),u=a(!1);e.setValue(t,{value:h}),d.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:u,changeEx:h,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(s,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],d=>d.target.value)):s.addEventListener("input",function(d){e.setValue(t,{value:a(!0)})}),this.data.combo&&this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}},ai=class extends K{constructor(e){let{data:t,elements:i}=e;super(e,{isRenderable:K._hasPopupData(t)}),this.elements=i,this.popup=null}render(){this.container.classList.add("popupAnnotation");let e=this.popup=new Kn({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(let i of this.elements)i.popup=e,i.container.ariaHasPopup="dialog",t.push(i.data.id),i.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(i=>`${_r}${i}`).join(",")),this.container}},Kn=class{#t=this.#S.bind(this);#e=this.#E.bind(this);#i=this.#M.bind(this);#s=this.#A.bind(this);#r=null;#n=null;#c=null;#o=null;#d=null;#l=null;#h=null;#a=!1;#u=null;#m=null;#p=null;#g=null;#f=null;#_=null;#b=!1;constructor({container:e,color:t,elements:i,titleObj:s,modificationDate:n,contentsObj:r,richText:a,parent:l,rect:c,parentRect:d,open:h}){this.#n=e,this.#f=s,this.#c=r,this.#g=a,this.#l=l,this.#r=t,this.#p=c,this.#h=d,this.#d=i,this.#o=Gi.toDateObject(n),this.trigger=i.flatMap(u=>u.getElementsToTriggerPopup());for(let u of this.trigger)u.addEventListener("click",this.#s),u.addEventListener("mouseenter",this.#i),u.addEventListener("mouseleave",this.#e),u.classList.add("popupTriggerArea");for(let u of i)u.container?.addEventListener("keydown",this.#t);this.#n.hidden=!0,h&&this.#A()}render(){if(this.#u)return;let e=this.#u=document.createElement("div");if(e.className="popup",this.#r){let n=e.style.outlineColor=E.makeHexColor(...this.#r);CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?e.style.backgroundColor=`color-mix(in srgb, ${n} 30%, white)`:e.style.backgroundColor=E.makeHexColor(...this.#r.map(a=>Math.floor(.7*(255-a)+a)))}let t=document.createElement("span");t.className="header";let i=document.createElement("h1");if(t.append(i),{dir:i.dir,str:i.textContent}=this.#f,e.append(t),this.#o){let n=document.createElement("span");n.classList.add("popupDate"),n.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),n.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#o.valueOf()})),t.append(n)}let s=this.#y;if(s)ns.render({xfaHtml:s,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{let n=this._formatContents(this.#c);e.append(n)}this.#n.append(e)}get#y(){let e=this.#g,t=this.#c;return e?.str&&(!t?.str||t.str===e.str)&&this.#g.html||null}get#w(){return this.#y?.attributes?.style?.fontSize||0}get#k(){return this.#y?.attributes?.style?.color||null}#C(e){let t=[],i={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},s={style:{color:this.#k,fontSize:this.#w?`calc(${this.#w}px * var(--scale-factor))`:""}};for(let n of e.split(`
`))t.push({name:"span",value:n,attributes:s});return i}_formatContents({str:e,dir:t}){let i=document.createElement("p");i.classList.add("popupContent"),i.dir=t;let s=e.split(/(?:\r\n?|\n)/);for(let n=0,r=s.length;n<r;++n){let a=s[n];i.append(document.createTextNode(a)),n<r-1&&i.append(document.createElement("br"))}return i}#S(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&this.#a)&&this.#A()}updateEdited({rect:e,popupContent:t}){this.#_||={contentsObj:this.#c,richText:this.#g},e&&(this.#m=null),t&&(this.#g=this.#C(t),this.#c=null),this.#u?.remove(),this.#u=null}resetEdited(){this.#_&&({contentsObj:this.#c,richText:this.#g}=this.#_,this.#_=null,this.#u?.remove(),this.#u=null,this.#m=null)}#T(){if(this.#m!==null)return;let{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:i,pageX:s,pageY:n}}}=this.#l,r=!!this.#h,a=r?this.#h:this.#p;for(let p of this.#d)if(!a||E.intersect(p.data.rect,a)!==null){a=p.data.rect,r=!0;break}let l=E.normalizeRect([a[0],e[3]-a[1]+e[1],a[2],e[3]-a[3]+e[1]]),d=r?a[2]-a[0]+5:0,h=l[0]+d,u=l[1];this.#m=[100*(h-s)/t,100*(u-n)/i];let{style:m}=this.#n;m.left=`${this.#m[0]}%`,m.top=`${this.#m[1]}%`}#A(){this.#a=!this.#a,this.#a?(this.#M(),this.#n.addEventListener("click",this.#s),this.#n.addEventListener("keydown",this.#t)):(this.#E(),this.#n.removeEventListener("click",this.#s),this.#n.removeEventListener("keydown",this.#t))}#M(){this.#u||this.render(),this.isVisible?this.#a&&this.#n.classList.add("focused"):(this.#T(),this.#n.hidden=!1,this.#n.style.zIndex=parseInt(this.#n.style.zIndex)+1e3)}#E(){this.#n.classList.remove("focused"),!(this.#a||!this.isVisible)&&(this.#n.hidden=!0,this.#n.style.zIndex=parseInt(this.#n.style.zIndex)-1e3)}forceHide(){this.#b=this.isVisible,this.#b&&(this.#n.hidden=!0)}maybeShow(){this.#b&&(this.#u||this.#M(),this.#b=!1,this.#n.hidden=!1)}get isVisible(){return this.#n.hidden===!1}},os=class extends K{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=D.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){let e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(let t of this.textContent){let i=document.createElement("span");i.textContent=t,e.append(i)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},Qn=class extends K{#t=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");let e=this.data,{width:t,height:i}=ee(e.rect),s=this.svgFactory.create(t,i,!0),n=this.#t=this.svgFactory.createElement("svg:line");return n.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),n.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),n.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),n.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),n.setAttribute("stroke-width",e.borderStyle.width||1),n.setAttribute("stroke","transparent"),n.setAttribute("fill","transparent"),s.append(n),this.container.append(s),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}},Zn=class extends K{#t=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");let e=this.data,{width:t,height:i}=ee(e.rect),s=this.svgFactory.create(t,i,!0),n=e.borderStyle.width,r=this.#t=this.svgFactory.createElement("svg:rect");return r.setAttribute("x",n/2),r.setAttribute("y",n/2),r.setAttribute("width",t-n),r.setAttribute("height",i-n),r.setAttribute("stroke-width",n||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),s.append(r),this.container.append(s),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}},Jn=class extends K{#t=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");let e=this.data,{width:t,height:i}=ee(e.rect),s=this.svgFactory.create(t,i,!0),n=e.borderStyle.width,r=this.#t=this.svgFactory.createElement("svg:ellipse");return r.setAttribute("cx",t/2),r.setAttribute("cy",i/2),r.setAttribute("rx",t/2-n/2),r.setAttribute("ry",i/2-n/2),r.setAttribute("stroke-width",n||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),s.append(r),this.container.append(s),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}},ls=class extends K{#t=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);let{data:{rect:e,vertices:t,borderStyle:i,popupRef:s}}=this;if(!t)return this.container;let{width:n,height:r}=ee(e),a=this.svgFactory.create(n,r,!0),l=[];for(let d=0,h=t.length;d<h;d+=2){let u=t[d]-e[0],m=e[3]-t[d+1];l.push(`${u},${m}`)}l=l.join(" ");let c=this.#t=this.svgFactory.createElement(this.svgElementName);return c.setAttribute("points",l),c.setAttribute("stroke-width",i.width||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),a.append(c),this.container.append(a),!s&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}},tr=class extends ls{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}},er=class extends K{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},oi=class extends K{#t=null;#e=[];constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?D.HIGHLIGHT:D.INK}#i(e,t){switch(e){case 90:return{transform:`rotate(90) translate(${-t[0]},${t[1]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};case 180:return{transform:`rotate(180) translate(${-t[2]},${t[1]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]};case 270:return{transform:`rotate(270) translate(${-t[2]},${t[3]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};default:return{transform:`translate(${-t[0]},${t[3]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]}}}render(){this.container.classList.add(this.containerClassName);let{data:{rect:e,rotation:t,inkLists:i,borderStyle:s,popupRef:n}}=this,{transform:r,width:a,height:l}=this.#i(t,e),c=this.svgFactory.create(a,l,!0),d=this.#t=this.svgFactory.createElement("svg:g");c.append(d),d.setAttribute("stroke-width",s.width||1),d.setAttribute("stroke-linecap","round"),d.setAttribute("stroke-linejoin","round"),d.setAttribute("stroke-miterlimit",10),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),d.setAttribute("transform",r);for(let h=0,u=i.length;h<u;h++){let m=this.svgFactory.createElement(this.svgElementName);this.#e.push(m),m.setAttribute("points",i[h].join(",")),d.append(m)}return!n&&this.hasPopupData&&this._createPopup(),this.container.append(c),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);let{thickness:t,points:i,rect:s}=e,n=this.#t;if(t>=0&&n.setAttribute("stroke-width",t||1),i)for(let r=0,a=this.#e.length;r<a;r++)this.#e[r].setAttribute("points",i[r].join(","));if(s){let{transform:r,width:a,height:l}=this.#i(this.data.rotation,s);n.parentElement.setAttribute("viewBox",`0 0 ${a} ${l}`),n.setAttribute("transform",r)}}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}},cs=class extends K{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=D.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}},ir=class extends K{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}},sr=class extends K{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}},nr=class extends K{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}},ds=class extends K{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=D.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},rr=class extends K{#t=null;constructor(e){super(e,{isRenderable:!0});let{file:t}=this.data;this.filename=t.filename,this.content=t.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",Y({source:this},t))}render(){this.container.classList.add("fileAttachmentAnnotation");let{container:e,data:t}=this,i;t.hasAppearance||t.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(t.name)?"paperclip":"pushpin"}.svg`,t.fillAlpha&&t.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(t.fillAlpha*100)}%);`)),i.addEventListener("dblclick",this.#e.bind(this)),this.#t=i;let{isMac:s}=ot.platform;return e.addEventListener("keydown",n=>{n.key==="Enter"&&(s?n.metaKey:n.ctrlKey)&&this.#e()}),!t.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),e.append(i),e}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}},ar=class{#t=null;#e=null;#i=new Map;#s=null;constructor({div:e,accessibilityManager:t,annotationCanvasMap:i,annotationEditorUIManager:s,page:n,viewport:r,structTreeLayer:a}){this.div=e,this.#t=t,this.#e=i,this.#s=a||null,this.page=n,this.viewport=r,this.zIndex=0,this._annotationEditorUIManager=s}hasEditableAnnotations(){return this.#i.size>0}#r(e,t){return C(this,null,function*(){let i=e.firstChild||e,s=i.id=`${_r}${t}`,n=yield this.#s?.getAriaAttributes(s);if(n)for(let[r,a]of n)i.setAttribute(r,a);this.div.append(e),this.#t?.moveElementInDOM(this.div,e,i,!1)})}render(e){return C(this,null,function*(){let{annotations:t}=e,i=this.div;ge(i,this.viewport);let s=new Map,n={data:null,layer:i,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new ri,annotationStorage:e.annotationStorage||new ei,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(let r of t){if(r.noHTML)continue;let a=r.annotationType===nt.POPUP;if(a){let d=s.get(r.id);if(!d)continue;n.elements=d}else{let{width:d,height:h}=ee(r.rect);if(d<=0||h<=0)continue}n.data=r;let l=Gn.create(n);if(!l.isRenderable)continue;if(!a&&r.popupRef){let d=s.get(r.popupRef);d?d.push(l):s.set(r.popupRef,[l])}let c=l.render();r.hidden&&(c.style.visibility="hidden"),yield this.#r(c,r.id),l._isEditable&&(this.#i.set(l.data.id,l),this._annotationEditorUIManager?.renderAnnotationElement(l))}this.#n()})}update({viewport:e}){let t=this.div;this.viewport=e,ge(t,{rotation:e.rotation}),this.#n(),t.hidden=!1}#n(){if(!this.#e)return;let e=this.div;for(let[t,i]of this.#e){let s=e.querySelector(`[data-annotation-id="${t}"]`);if(!s)continue;i.className="annotationContent";let{firstChild:n}=s;n?n.nodeName==="CANVAS"?n.replaceWith(i):n.classList.contains("annotationContent")?n.after(i):n.before(i):s.append(i)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#i.values())}getEditableAnnotation(e){return this.#i.get(e)}},Bi=/\r\n?|\n/g,or=class o extends q{#t;#e="";#i=`${this.id}-editor`;#s=null;#r;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){let e=o.prototype,t=n=>n.isEmpty(),i=ti.TRANSLATE_SMALL,s=ti.TRANSLATE_BIG;return B(this,"_keyboardManager",new _e([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-i,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-s,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[i,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[s,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-i],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-s],checker:t}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,i],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,s],checker:t}]]))}static _type="freetext";static _editorType=D.FREETEXT;constructor(e){super(Yt(Y({},e),{name:"freeTextEditor"})),this.#t=e.color||o._defaultColor||q._defaultLineColor,this.#r=e.fontSize||o._defaultFontSize}static initialize(e,t){q.initialize(e,t);let i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,t){switch(e){case z.FREETEXT_SIZE:o._defaultFontSize=t;break;case z.FREETEXT_COLOR:o._defaultColor=t;break}}updateParams(e,t){switch(e){case z.FREETEXT_SIZE:this.#n(t);break;case z.FREETEXT_COLOR:this.#c(t);break}}static get defaultPropertiesToUpdate(){return[[z.FREETEXT_SIZE,o._defaultFontSize],[z.FREETEXT_COLOR,o._defaultColor||q._defaultLineColor]]}get propertiesToUpdate(){return[[z.FREETEXT_SIZE,this.#r],[z.FREETEXT_COLOR,this.#t]]}#n(e){let t=s=>{this.editorDiv.style.fontSize=`calc(${s}px * var(--scale-factor))`,this.translate(0,-(s-this.#r)*this.parentScale),this.#r=s,this.#d()},i=this.#r;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:z.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#c(e){let t=s=>{this.#t=this.editorDiv.style.color=s},i=this.#t;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:z.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(e,t){this._uiManager.translateSelectedEditors(e,t,!0)}getInitialTranslation(){let e=this.parentScale;return[-o._internalPadding*e,-(o._internalPadding+this.#r)*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(D.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#s=new AbortController;let e=this._uiManager.combinedSignal(this.#s);this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e})}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#i),this._isDraggable=!0,this.#s?.abort(),this.#s=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){this.width||(this.enableEditMode(),this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#o(){let e=[];this.editorDiv.normalize();let t=null;for(let i of this.editorDiv.childNodes)t?.nodeType===Node.TEXT_NODE&&i.nodeName==="BR"||(e.push(o.#l(i)),t=i);return e.join(`
`)}#d(){let[e,t]=this.parentDimensions,i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{let{currentLayer:s,div:n}=this,r=n.style.display,a=n.classList.contains("hidden");n.classList.remove("hidden"),n.style.display="hidden",s.div.append(this.div),i=n.getBoundingClientRect(),n.remove(),n.style.display=r,n.classList.toggle("hidden",a)}this.rotation%180===this.parentRotation%180?(this.width=i.width/e,this.height=i.height/t):(this.width=i.height/e,this.height=i.width/t),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();let e=this.#e,t=this.#e=this.#o().trimEnd();if(e===t)return;let i=s=>{if(this.#e=s,!s){this.remove();return}this.#h(),this._uiManager.rebuild(this),this.#d()};this.addCommands({cmd:()=>{i(t)},undo:()=>{i(e)},mustExec:!1}),this.#d()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(e){this.enterInEditMode()}keydown(e){e.target===this.div&&e.key==="Enter"&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){o._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let e,t;this.width&&(e=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#i),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;let{style:i}=this.editorDiv;if(i.fontSize=`calc(${this.#r}px * var(--scale-factor))`,i.color=this.#t,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),Ui(this,this.div,["dblclick","keydown"]),this.width){let[s,n]=this.parentDimensions;if(this.annotationElementId){let{position:r}=this._initialData,[a,l]=this.getInitialTranslation();[a,l]=this.pageTranslationToScreen(a,l);let[c,d]=this.pageDimensions,[h,u]=this.pageTranslation,m,p;switch(this.rotation){case 0:m=e+(r[0]-h)/c,p=t+this.height-(r[1]-u)/d;break;case 90:m=e+(r[0]-h)/c,p=t-(r[1]-u)/d,[a,l]=[l,-a];break;case 180:m=e-this.width+(r[0]-h)/c,p=t-(r[1]-u)/d,[a,l]=[-a,-l];break;case 270:m=e+(r[0]-h-this.height*d)/c,p=t+(r[1]-u-this.width*c)/d,[a,l]=[-l,a];break}this.setAt(m*s,p*n,a,l)}else this.setAt(e*s,t*n,this.width*s,this.height*n);this.#h(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#l(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(Bi,"")}editorDivPaste(e){let t=e.clipboardData||window.clipboardData,{types:i}=t;if(i.length===1&&i[0]==="text/plain")return;e.preventDefault();let s=o.#u(t.getData("text")||"").replaceAll(Bi,`
`);if(!s)return;let n=window.getSelection();if(!n.rangeCount)return;this.editorDiv.normalize(),n.deleteFromDocument();let r=n.getRangeAt(0);if(!s.includes(`
`)){r.insertNode(document.createTextNode(s)),this.editorDiv.normalize(),n.collapseToStart();return}let{startContainer:a,startOffset:l}=r,c=[],d=[];if(a.nodeType===Node.TEXT_NODE){let m=a.parentElement;if(d.push(a.nodeValue.slice(l).replaceAll(Bi,"")),m!==this.editorDiv){let p=c;for(let f of this.editorDiv.childNodes){if(f===m){p=d;continue}p.push(o.#l(f))}}c.push(a.nodeValue.slice(0,l).replaceAll(Bi,""))}else if(a===this.editorDiv){let m=c,p=0;for(let f of this.editorDiv.childNodes)p++===l&&(m=d),m.push(o.#l(f))}this.#e=`${c.join(`
`)}${s}${d.join(`
`)}`,this.#h();let h=new Range,u=c.reduce((m,p)=>m+p.length,0);for(let{firstChild:m}of this.editorDiv.childNodes)if(m.nodeType===Node.TEXT_NODE){let p=m.nodeValue.length;if(u<=p){h.setStart(m,u),h.setEnd(m,u);break}u-=p}n.removeAllRanges(),n.addRange(h)}#h(){if(this.editorDiv.replaceChildren(),!!this.#e)for(let e of this.#e.split(`
`)){let t=document.createElement("div");t.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(t)}}#a(){return this.#e.replaceAll("\xA0"," ")}static#u(e){return e.replaceAll(" ","\xA0")}get contentDiv(){return this.editorDiv}static deserialize(e,t,i){return C(this,null,function*(){let s=null;if(e instanceof os){let{data:{defaultAppearanceData:{fontSize:r,fontColor:a},rect:l,rotation:c,id:d,popupRef:h},textContent:u,textPosition:m,parent:{page:{pageNumber:p}}}=e;if(!u||u.length===0)return null;s=e={annotationType:D.FREETEXT,color:Array.from(a),fontSize:r,value:u.join(`
`),position:m,pageIndex:p-1,rect:l.slice(0),rotation:c,id:d,deleted:!1,popupRef:h}}let n=yield ne(o,this,"deserialize").call(this,e,t,i);return n.#r=e.fontSize,n.#t=E.makeHexColor(...e.color),n.#e=o.#u(e.value),n.annotationElementId=e.id||null,n._initialData=s,n})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let t=o._internalPadding*this.parentScale,i=this.getRect(t,t),s=q._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#t),n={annotationType:D.FREETEXT,color:s,fontSize:this.#r,value:this.#a(),pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?n:this.annotationElementId&&!this.#m(n)?null:(n.id=this.annotationElementId,n)}#m(e){let{value:t,fontSize:i,color:s,pageIndex:n}=this._initialData;return this._hasBeenMoved||e.value!==t||e.fontSize!==i||e.color.some((r,a)=>r!==s[a])||e.pageIndex!==n}renderAnnotationElement(e){let t=super.renderAnnotationElement(e);if(this.deleted)return t;let{style:i}=t;i.fontSize=`calc(${this.#r}px * var(--scale-factor))`,i.color=this.#t,t.replaceChildren();for(let n of this.#e.split(`
`)){let r=document.createElement("div");r.append(n?document.createTextNode(n):document.createElement("br")),t.append(r)}let s=o._internalPadding*this.parentScale;return e.updateEdited({rect:this.getRect(s,s),popupContent:this.#e}),t}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}},k=(()=>{class o{static PRECISION=1e-4;toSVGPath(){G("Abstract method `toSVGPath` must be implemented.")}get box(){G("Abstract getter `box` must be implemented.")}serialize(t,i){G("Abstract method `serialize` must be implemented.")}static _rescale(t,i,s,n,r,a){a||=new Float32Array(t.length);for(let l=0,c=t.length;l<c;l+=2)a[l]=i+t[l]*n,a[l+1]=s+t[l+1]*r;return a}static _rescaleAndSwap(t,i,s,n,r,a){a||=new Float32Array(t.length);for(let l=0,c=t.length;l<c;l+=2)a[l]=i+t[l+1]*n,a[l+1]=s+t[l]*r;return a}static _translate(t,i,s,n){n||=new Float32Array(t.length);for(let r=0,a=t.length;r<a;r+=2)n[r]=i+t[r],n[r+1]=s+t[r+1];return n}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,i,s,n,r){switch(r){case 90:return[1-i/s,t/n];case 180:return[1-t/s,1-i/n];case 270:return[i/s,1-t/n];default:return[t/s,i/n]}}static _normalizePagePoint(t,i,s){switch(s){case 90:return[1-i,t];case 180:return[1-t,1-i];case 270:return[i,1-t];default:return[t,i]}}static createBezierPoints(t,i,s,n,r,a){return[(t+5*s)/6,(i+5*n)/6,(5*s+r)/6,(5*n+a)/6,(s+r)/2,(n+a)/2]}}return o})(),hs=class o{#t;#e=[];#i;#s;#r=[];#n=new Float32Array(18);#c;#o;#d;#l;#h;#a;#u=[];static#m=8;static#p=2;static#g=o.#m+o.#p;constructor({x:e,y:t},i,s,n,r,a=0){this.#t=i,this.#a=n*s,this.#s=r,this.#n.set([NaN,NaN,NaN,NaN,e,t],6),this.#i=a,this.#l=o.#m*s,this.#d=o.#g*s,this.#h=s,this.#u.push(e,t)}isEmpty(){return isNaN(this.#n[8])}#f(){let e=this.#n.subarray(4,6),t=this.#n.subarray(16,18),[i,s,n,r]=this.#t;return[(this.#c+(e[0]-t[0])/2-i)/n,(this.#o+(e[1]-t[1])/2-s)/r,(this.#c+(t[0]-e[0])/2-i)/n,(this.#o+(t[1]-e[1])/2-s)/r]}add({x:e,y:t}){this.#c=e,this.#o=t;let[i,s,n,r]=this.#t,[a,l,c,d]=this.#n.subarray(8,12),h=e-c,u=t-d,m=Math.hypot(h,u);if(m<this.#d)return!1;let p=m-this.#l,f=p/m,_=f*h,g=f*u,b=a,v=l;a=c,l=d,c+=_,d+=g,this.#u?.push(e,t);let y=-g/p,w=_/p,A=y*this.#a,x=w*this.#a;return this.#n.set(this.#n.subarray(2,8),0),this.#n.set([c+A,d+x],4),this.#n.set(this.#n.subarray(14,18),12),this.#n.set([c-A,d-x],16),isNaN(this.#n[6])?(this.#r.length===0&&(this.#n.set([a+A,l+x],2),this.#r.push(NaN,NaN,NaN,NaN,(a+A-i)/n,(l+x-s)/r),this.#n.set([a-A,l-x],14),this.#e.push(NaN,NaN,NaN,NaN,(a-A-i)/n,(l-x-s)/r)),this.#n.set([b,v,a,l,c,d],6),!this.isEmpty()):(this.#n.set([b,v,a,l,c,d],6),Math.abs(Math.atan2(v-l,b-a)-Math.atan2(g,_))<Math.PI/2?([a,l,c,d]=this.#n.subarray(2,6),this.#r.push(NaN,NaN,NaN,NaN,((a+c)/2-i)/n,((l+d)/2-s)/r),[a,l,b,v]=this.#n.subarray(14,18),this.#e.push(NaN,NaN,NaN,NaN,((b+a)/2-i)/n,((v+l)/2-s)/r),!0):([b,v,a,l,c,d]=this.#n.subarray(0,6),this.#r.push(((b+5*a)/6-i)/n,((v+5*l)/6-s)/r,((5*a+c)/6-i)/n,((5*l+d)/6-s)/r,((a+c)/2-i)/n,((l+d)/2-s)/r),[c,d,a,l,b,v]=this.#n.subarray(12,18),this.#e.push(((b+5*a)/6-i)/n,((v+5*l)/6-s)/r,((5*a+c)/6-i)/n,((5*l+d)/6-s)/r,((a+c)/2-i)/n,((l+d)/2-s)/r),!0))}toSVGPath(){if(this.isEmpty())return"";let e=this.#r,t=this.#e;if(isNaN(this.#n[6])&&!this.isEmpty())return this.#_();let i=[];i.push(`M${e[4]} ${e[5]}`);for(let s=6;s<e.length;s+=6)isNaN(e[s])?i.push(`L${e[s+4]} ${e[s+5]}`):i.push(`C${e[s]} ${e[s+1]} ${e[s+2]} ${e[s+3]} ${e[s+4]} ${e[s+5]}`);this.#y(i);for(let s=t.length-6;s>=6;s-=6)isNaN(t[s])?i.push(`L${t[s+4]} ${t[s+5]}`):i.push(`C${t[s]} ${t[s+1]} ${t[s+2]} ${t[s+3]} ${t[s+4]} ${t[s+5]}`);return this.#b(i),i.join(" ")}#_(){let[e,t,i,s]=this.#t,[n,r,a,l]=this.#f();return`M${(this.#n[2]-e)/i} ${(this.#n[3]-t)/s} L${(this.#n[4]-e)/i} ${(this.#n[5]-t)/s} L${n} ${r} L${a} ${l} L${(this.#n[16]-e)/i} ${(this.#n[17]-t)/s} L${(this.#n[14]-e)/i} ${(this.#n[15]-t)/s} Z`}#b(e){let t=this.#e;e.push(`L${t[4]} ${t[5]} Z`)}#y(e){let[t,i,s,n]=this.#t,r=this.#n.subarray(4,6),a=this.#n.subarray(16,18),[l,c,d,h]=this.#f();e.push(`L${(r[0]-t)/s} ${(r[1]-i)/n} L${l} ${c} L${d} ${h} L${(a[0]-t)/s} ${(a[1]-i)/n}`)}newFreeDrawOutline(e,t,i,s,n,r){return new us(e,t,i,s,n,r)}getOutlines(){let e=this.#r,t=this.#e,i=this.#n,[s,n,r,a]=this.#t,l=new Float32Array((this.#u?.length??0)+2);for(let h=0,u=l.length-2;h<u;h+=2)l[h]=(this.#u[h]-s)/r,l[h+1]=(this.#u[h+1]-n)/a;if(l[l.length-2]=(this.#c-s)/r,l[l.length-1]=(this.#o-n)/a,isNaN(i[6])&&!this.isEmpty())return this.#w(l);let c=new Float32Array(this.#r.length+24+this.#e.length),d=e.length;for(let h=0;h<d;h+=2){if(isNaN(e[h])){c[h]=c[h+1]=NaN;continue}c[h]=e[h],c[h+1]=e[h+1]}d=this.#C(c,d);for(let h=t.length-6;h>=6;h-=6)for(let u=0;u<6;u+=2){if(isNaN(t[h+u])){c[d]=c[d+1]=NaN,d+=2;continue}c[d]=t[h+u],c[d+1]=t[h+u+1],d+=2}return this.#k(c,d),this.newFreeDrawOutline(c,l,this.#t,this.#h,this.#i,this.#s)}#w(e){let t=this.#n,[i,s,n,r]=this.#t,[a,l,c,d]=this.#f(),h=new Float32Array(36);return h.set([NaN,NaN,NaN,NaN,(t[2]-i)/n,(t[3]-s)/r,NaN,NaN,NaN,NaN,(t[4]-i)/n,(t[5]-s)/r,NaN,NaN,NaN,NaN,a,l,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,(t[16]-i)/n,(t[17]-s)/r,NaN,NaN,NaN,NaN,(t[14]-i)/n,(t[15]-s)/r],0),this.newFreeDrawOutline(h,e,this.#t,this.#h,this.#i,this.#s)}#k(e,t){let i=this.#e;return e.set([NaN,NaN,NaN,NaN,i[4],i[5]],t),t+=6}#C(e,t){let i=this.#n.subarray(4,6),s=this.#n.subarray(16,18),[n,r,a,l]=this.#t,[c,d,h,u]=this.#f();return e.set([NaN,NaN,NaN,NaN,(i[0]-n)/a,(i[1]-r)/l,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,h,u,NaN,NaN,NaN,NaN,(s[0]-n)/a,(s[1]-r)/l],t),t+=24}},us=class extends k{#t;#e=new Float32Array(4);#i;#s;#r;#n;#c;constructor(e,t,i,s,n,r){super(),this.#c=e,this.#r=t,this.#t=i,this.#n=s,this.#i=n,this.#s=r,this.lastPoint=[NaN,NaN],this.#o(r);let[a,l,c,d]=this.#e;for(let h=0,u=e.length;h<u;h+=2)e[h]=(e[h]-a)/c,e[h+1]=(e[h+1]-l)/d;for(let h=0,u=t.length;h<u;h+=2)t[h]=(t[h]-a)/c,t[h+1]=(t[h+1]-l)/d}toSVGPath(){let e=[`M${this.#c[4]} ${this.#c[5]}`];for(let t=6,i=this.#c.length;t<i;t+=6){if(isNaN(this.#c[t])){e.push(`L${this.#c[t+4]} ${this.#c[t+5]}`);continue}e.push(`C${this.#c[t]} ${this.#c[t+1]} ${this.#c[t+2]} ${this.#c[t+3]} ${this.#c[t+4]} ${this.#c[t+5]}`)}return e.push("Z"),e.join(" ")}serialize([e,t,i,s],n){let r=i-e,a=s-t,l,c;switch(n){case 0:l=k._rescale(this.#c,e,s,r,-a),c=k._rescale(this.#r,e,s,r,-a);break;case 90:l=k._rescaleAndSwap(this.#c,e,t,r,a),c=k._rescaleAndSwap(this.#r,e,t,r,a);break;case 180:l=k._rescale(this.#c,i,t,-r,a),c=k._rescale(this.#r,i,t,-r,a);break;case 270:l=k._rescaleAndSwap(this.#c,i,s,-r,-a),c=k._rescaleAndSwap(this.#r,i,s,-r,-a);break}return{outline:Array.from(l),points:[Array.from(c)]}}#o(e){let t=this.#c,i=t[4],s=t[5],n=i,r=s,a=i,l=s,c=i,d=s,h=e?Math.max:Math.min;for(let m=6,p=t.length;m<p;m+=6){if(isNaN(t[m]))n=Math.min(n,t[m+4]),r=Math.min(r,t[m+5]),a=Math.max(a,t[m+4]),l=Math.max(l,t[m+5]),d<t[m+5]?(c=t[m+4],d=t[m+5]):d===t[m+5]&&(c=h(c,t[m+4]));else{let f=E.bezierBoundingBox(i,s,...t.slice(m,m+6));n=Math.min(n,f[0]),r=Math.min(r,f[1]),a=Math.max(a,f[2]),l=Math.max(l,f[3]),d<f[3]?(c=f[2],d=f[3]):d===f[3]&&(c=h(c,f[2]))}i=t[m+4],s=t[m+5]}let u=this.#e;u[0]=n-this.#i,u[1]=r-this.#i,u[2]=a-n+2*this.#i,u[3]=l-r+2*this.#i,this.lastPoint=[c,d]}get box(){return this.#e}newOutliner(e,t,i,s,n,r=0){return new hs(e,t,i,s,n,r)}getNewOutline(e,t){let[i,s,n,r]=this.#e,[a,l,c,d]=this.#t,h=n*c,u=r*d,m=i*c+a,p=s*d+l,f=this.newOutliner({x:this.#r[0]*h+m,y:this.#r[1]*u+p},this.#t,this.#n,e,this.#s,t??this.#i);for(let _=2;_<this.#r.length;_+=2)f.add({x:this.#r[_]*h+m,y:this.#r[_+1]*u+p});return f.getOutlines()}},li=class{#t;#e;#i=[];#s=[];constructor(e,t=0,i=0,s=!0){let n=1/0,r=-1/0,a=1/0,l=-1/0,d=10**-4;for(let{x:g,y:b,width:v,height:y}of e){let w=Math.floor((g-t)/d)*d,A=Math.ceil((g+v+t)/d)*d,x=Math.floor((b-t)/d)*d,M=Math.ceil((b+y+t)/d)*d,P=[w,x,M,!0],j=[A,x,M,!1];this.#i.push(P,j),n=Math.min(n,w),r=Math.max(r,A),a=Math.min(a,x),l=Math.max(l,M)}let h=r-n+2*i,u=l-a+2*i,m=n-i,p=a-i,f=this.#i.at(s?-1:-2),_=[f[0],f[2]];for(let g of this.#i){let[b,v,y]=g;g[0]=(b-m)/h,g[1]=(v-p)/u,g[2]=(y-p)/u}this.#t=new Float32Array([m,p,h,u]),this.#e=_}getOutlines(){this.#i.sort((t,i)=>t[0]-i[0]||t[1]-i[1]||t[2]-i[2]);let e=[];for(let t of this.#i)t[3]?(e.push(...this.#d(t)),this.#c(t)):(this.#o(t),e.push(...this.#d(t)));return this.#r(e)}#r(e){let t=[],i=new Set;for(let r of e){let[a,l,c]=r;t.push([a,l,r],[a,c,r])}t.sort((r,a)=>r[1]-a[1]||r[0]-a[0]);for(let r=0,a=t.length;r<a;r+=2){let l=t[r][2],c=t[r+1][2];l.push(c),c.push(l),i.add(l),i.add(c)}let s=[],n;for(;i.size>0;){let r=i.values().next().value,[a,l,c,d,h]=r;i.delete(r);let u=a,m=l;for(n=[a,c],s.push(n);;){let p;if(i.has(d))p=d;else if(i.has(h))p=h;else break;i.delete(p),[a,l,c,d,h]=p,u!==a&&(n.push(u,m,a,m===l?l:c),u=a),m=m===l?c:l}n.push(u,m)}return new lr(s,this.#t,this.#e)}#n(e){let t=this.#s,i=0,s=t.length-1;for(;i<=s;){let n=i+s>>1,r=t[n][0];if(r===e)return n;r<e?i=n+1:s=n-1}return s+1}#c([,e,t]){let i=this.#n(e);this.#s.splice(i,0,[e,t])}#o([,e,t]){let i=this.#n(e);for(let s=i;s<this.#s.length;s++){let[n,r]=this.#s[s];if(n!==e)break;if(n===e&&r===t){this.#s.splice(s,1);return}}for(let s=i-1;s>=0;s--){let[n,r]=this.#s[s];if(n!==e)break;if(n===e&&r===t){this.#s.splice(s,1);return}}}#d(e){let[t,i,s]=e,n=[[t,i,s]],r=this.#n(s);for(let a=0;a<r;a++){let[l,c]=this.#s[a];for(let d=0,h=n.length;d<h;d++){let[,u,m]=n[d];if(!(c<=u||m<=l)){if(u>=l){if(m>c)n[d][1]=c;else{if(h===1)return[];n.splice(d,1),d--,h--}continue}n[d][2]=l,m>c&&n.push([t,c,m])}}}return n}},lr=class extends k{#t;#e;constructor(e,t,i){super(),this.#e=e,this.#t=t,this.lastPoint=i}toSVGPath(){let e=[];for(let t of this.#e){let[i,s]=t;e.push(`M${i} ${s}`);for(let n=2;n<t.length;n+=2){let r=t[n],a=t[n+1];r===i?(e.push(`V${a}`),s=a):a===s&&(e.push(`H${r}`),i=r)}e.push("Z")}return e.join(" ")}serialize([e,t,i,s],n){let r=[],a=i-e,l=s-t;for(let c of this.#e){let d=new Array(c.length);for(let h=0;h<c.length;h+=2)d[h]=e+c[h]*a,d[h+1]=s-c[h+1]*l;r.push(d)}return r}get box(){return this.#t}get classNamesForOutlining(){return["highlightOutline"]}},ci=class extends hs{newFreeDrawOutline(e,t,i,s,n,r){return new cr(e,t,i,s,n,r)}},cr=class extends us{newOutliner(e,t,i,s,n,r=0){return new ci(e,t,i,s,n,r)}},ms=class o{#t=null;#e=null;#i;#s=null;#r=!1;#n=!1;#c=null;#o;#d=null;#l=null;#h;static#a=null;static get _keyboardManager(){return B(this,"_keyboardManager",new _e([[["Escape","mac+Escape"],o.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],o.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],o.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],o.prototype._moveToPrevious],[["Home","mac+Home"],o.prototype._moveToBeginning],[["End","mac+End"],o.prototype._moveToEnd]]))}constructor({editor:e=null,uiManager:t=null}){e?(this.#n=!1,this.#h=z.HIGHLIGHT_COLOR,this.#c=e):(this.#n=!0,this.#h=z.HIGHLIGHT_DEFAULT_COLOR),this.#l=e?._uiManager||t,this.#o=this.#l._eventBus,this.#i=e?.color||this.#l?.highlightColors.values().next().value||"#FFFF98",o.#a||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){let e=this.#t=document.createElement("button");e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);let t=this.#l._signal;e.addEventListener("click",this.#g.bind(this),{signal:t}),e.addEventListener("keydown",this.#p.bind(this),{signal:t});let i=this.#e=document.createElement("span");return i.className="swatch",i.setAttribute("aria-hidden",!0),i.style.backgroundColor=this.#i,e.append(i),e}renderMainDropdown(){let e=this.#s=this.#u();return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}#u(){let e=document.createElement("div"),t=this.#l._signal;e.addEventListener("contextmenu",Rt,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(let[i,s]of this.#l.highlightColors){let n=document.createElement("button");n.tabIndex="0",n.role="option",n.setAttribute("data-color",s),n.title=i,n.setAttribute("data-l10n-id",o.#a[i]);let r=document.createElement("span");n.append(r),r.className="swatch",r.style.backgroundColor=s,n.setAttribute("aria-selected",s===this.#i),n.addEventListener("click",this.#m.bind(this,s),{signal:t}),e.append(n)}return e.addEventListener("keydown",this.#p.bind(this),{signal:t}),e}#m(e,t){t.stopPropagation(),this.#o.dispatch("switchannotationeditorparams",{source:this,type:this.#h,value:e})}_colorSelectFromKeyboard(e){if(e.target===this.#t){this.#g(e);return}let t=e.target.getAttribute("data-color");t&&this.#m(t,e)}_moveToNext(e){if(!this.#_){this.#g(e);return}if(e.target===this.#t){this.#s.firstChild?.focus();return}e.target.nextSibling?.focus()}_moveToPrevious(e){if(e.target===this.#s?.firstChild||e.target===this.#t){this.#_&&this._hideDropdownFromKeyboard();return}this.#_||this.#g(e),e.target.previousSibling?.focus()}_moveToBeginning(e){if(!this.#_){this.#g(e);return}this.#s.firstChild?.focus()}_moveToEnd(e){if(!this.#_){this.#g(e);return}this.#s.lastChild?.focus()}#p(e){o._keyboardManager.exec(this,e)}#g(e){if(this.#_){this.hideDropdown();return}if(this.#r=e.detail===0,this.#d||(this.#d=new AbortController,window.addEventListener("pointerdown",this.#f.bind(this),{signal:this.#l.combinedSignal(this.#d)})),this.#s){this.#s.classList.remove("hidden");return}let t=this.#s=this.#u();this.#t.append(t)}#f(e){this.#s?.contains(e.target)||this.hideDropdown()}hideDropdown(){this.#s?.classList.add("hidden"),this.#d?.abort(),this.#d=null}get#_(){return this.#s&&!this.#s.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#n){if(!this.#_){this.#c?.unselect();return}this.hideDropdown(),this.#t.focus({preventScroll:!0,focusVisible:this.#r})}}updateColor(e){if(this.#e&&(this.#e.style.backgroundColor=e),!this.#s)return;let t=this.#l.highlightColors.values();for(let i of this.#s.children)i.setAttribute("aria-selected",t.next().value===e)}destroy(){this.#t?.remove(),this.#t=null,this.#e=null,this.#s?.remove(),this.#s=null}},ps=class o extends q{#t=null;#e=0;#i;#s=null;#r=null;#n=null;#c=null;#o=0;#d=null;#l=null;#h=null;#a=!1;#u=null;#m;#p=null;#g="";#f;#_="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=D.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){let e=o.prototype;return B(this,"_keyboardManager",new _e([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}constructor(e){super(Yt(Y({},e),{name:"highlightEditor"})),this.color=e.color||o._defaultColor,this.#f=e.thickness||o._defaultThickness,this.#m=e.opacity||o._defaultOpacity,this.#i=e.boxes||null,this.#_=e.methodOfCreation||"",this.#g=e.text||"",this._isDraggable=!1,e.highlightId>-1?(this.#a=!0,this.#y(e),this.#T()):this.#i&&(this.#t=e.anchorNode,this.#e=e.anchorOffset,this.#c=e.focusNode,this.#o=e.focusOffset,this.#b(),this.#T(),this.rotate(this.rotation))}get telemetryInitialData(){return{action:"added",type:this.#a?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:this.#f,methodOfCreation:this.#_}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}#b(){let e=new li(this.#i,.001);this.#l=e.getOutlines(),[this.x,this.y,this.width,this.height]=this.#l.box;let t=new li(this.#i,.0025,.001,this._uiManager.direction==="ltr");this.#n=t.getOutlines();let{lastPoint:i}=this.#n;this.#u=[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height]}#y({highlightOutlines:e,highlightId:t,clipPathId:i}){this.#l=e;let s=1.5;if(this.#n=e.getNewOutline(this.#f/2+s,.0025),t>=0)this.#h=t,this.#s=i,this.parent.drawLayer.finalizeDraw(t,{bbox:e.box,path:{d:e.toSVGPath()}}),this.#p=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#n.box,path:{d:this.#n.toSVGPath()}},!0);else if(this.parent){let d=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#h,{bbox:o.#A(this.#l.box,(d-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#p,{bbox:o.#A(this.#n.box,d),path:{d:this.#n.toSVGPath()}})}let[n,r,a,l]=e.box;switch(this.rotation){case 0:this.x=n,this.y=r,this.width=a,this.height=l;break;case 90:{let[d,h]=this.parentDimensions;this.x=r,this.y=1-n,this.width=a*h/d,this.height=l*d/h;break}case 180:this.x=1-n,this.y=1-r,this.width=a,this.height=l;break;case 270:{let[d,h]=this.parentDimensions;this.x=1-r,this.y=n,this.width=a*h/d,this.height=l*d/h;break}}let{lastPoint:c}=this.#n;this.#u=[(c[0]-n)/a,(c[1]-r)/l]}static initialize(e,t){q.initialize(e,t),o._defaultColor||=t.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(e,t){switch(e){case z.HIGHLIGHT_DEFAULT_COLOR:o._defaultColor=t;break;case z.HIGHLIGHT_THICKNESS:o._defaultThickness=t;break}}translateInPage(e,t){}get toolbarPosition(){return this.#u}updateParams(e,t){switch(e){case z.HIGHLIGHT_COLOR:this.#w(t);break;case z.HIGHLIGHT_THICKNESS:this.#k(t);break}}static get defaultPropertiesToUpdate(){return[[z.HIGHLIGHT_DEFAULT_COLOR,o._defaultColor],[z.HIGHLIGHT_THICKNESS,o._defaultThickness]]}get propertiesToUpdate(){return[[z.HIGHLIGHT_COLOR,this.color||o._defaultColor],[z.HIGHLIGHT_THICKNESS,this.#f||o._defaultThickness],[z.HIGHLIGHT_FREE,this.#a]]}#w(e){let t=(n,r)=>{this.color=n,this.#m=r,this.parent?.drawLayer.updateProperties(this.#h,{root:{fill:n,"fill-opacity":r}}),this.#r?.updateColor(n)},i=this.color,s=this.#m;this.addCommands({cmd:t.bind(this,e,o._defaultOpacity),undo:t.bind(this,i,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:z.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(e)},!0)}#k(e){let t=this.#f,i=s=>{this.#f=s,this.#C(s)};this.addCommands({cmd:i.bind(this,e),undo:i.bind(this,t),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:z.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)}addEditToolbar(){return C(this,null,function*(){let e=yield ne(o.prototype,this,"addEditToolbar").call(this);return e?(this._uiManager.highlightColors&&(this.#r=new ms({editor:this}),e.addColorPicker(this.#r)),e):null})}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#P())}getBaseTranslation(){return[0,0]}getRect(e,t){return super.getRect(e,t,this.#P())}onceAdded(){this.annotationElementId||this.parent.addUndoableEditor(this),this.div.focus()}remove(){this.#S(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#T(),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?this.#S():e&&(this.#T(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),this.show(this._isVisible),t&&this.select()}#C(e){if(!this.#a)return;this.#y({highlightOutlines:this.#l.getNewOutline(e/2)}),this.fixAndSetPosition();let[t,i]=this.parentDimensions;this.setDims(this.width*t,this.height*i)}#S(){this.#h===null||!this.parent||(this.parent.drawLayer.remove(this.#h),this.#h=null,this.parent.drawLayer.remove(this.#p),this.#p=null)}#T(e=this.parent){this.#h===null&&({id:this.#h,clipPathId:this.#s}=e.drawLayer.draw({bbox:this.#l.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.#m},rootClass:{highlight:!0,free:this.#a},path:{d:this.#l.toSVGPath()}},!1,!0),this.#p=e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#a},bbox:this.#n.box,path:{d:this.#n.toSVGPath()}},this.#a),this.#d&&(this.#d.style.clipPath=this.#s))}static#A([e,t,i,s],n){switch(n){case 90:return[1-t-s,e,s,i];case 180:return[1-e-i,1-t-s,i,s];case 270:return[t,1-e-i,s,i]}return[e,t,i,s]}rotate(e){let{drawLayer:t}=this.parent,i;this.#a?(e=(e-this.rotation+360)%360,i=o.#A(this.#l.box,e)):i=o.#A([this.x,this.y,this.width,this.height],e),t.updateProperties(this.#h,{bbox:i,root:{"data-main-rotation":e}}),t.updateProperties(this.#p,{bbox:o.#A(this.#n.box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;let e=super.render();this.#g&&(e.setAttribute("aria-label",this.#g),e.setAttribute("role","mark")),this.#a?e.classList.add("free"):this.div.addEventListener("keydown",this.#M.bind(this),{signal:this._uiManager._signal});let t=this.#d=document.createElement("div");e.append(t),t.setAttribute("aria-hidden","true"),t.className="internal",t.style.clipPath=this.#s;let[i,s]=this.parentDimensions;return this.setDims(this.width*i,this.height*s),Ui(this,this.#d,["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1}})}#M(e){o._keyboardManager.exec(this,e)}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:this.#E(!0);break;case 1:case 3:this.#E(!1);break}}#E(e){if(!this.#t)return;let t=window.getSelection();e?t.setPosition(this.#t,this.#e):t.setPosition(this.#c,this.#o)}select(){super.select(),this.#p&&this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#p&&(this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{selected:!1}}),this.#a||this.#E(!1))}get _mustFixPosition(){return!this.#a}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(this.#h,{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(this.#p,{rootClass:{hidden:!e}}))}#P(){return this.#a?this.rotation:0}#D(){if(this.#a)return null;let[e,t]=this.pageDimensions,[i,s]=this.pageTranslation,n=this.#i,r=new Float32Array(n.length*8),a=0;for(let{x:l,y:c,width:d,height:h}of n){let u=l*e+i,m=(1-c)*t+s;r[a]=r[a+4]=u,r[a+1]=r[a+3]=m,r[a+2]=r[a+6]=u+d*e,r[a+5]=r[a+7]=m-h*t,a+=8}return r}#B(e){return this.#l.serialize(e,this.#P())}static startHighlighting(e,t,{target:i,x:s,y:n}){let{x:r,y:a,width:l,height:c}=i.getBoundingClientRect(),d=new AbortController,h=e.combinedSignal(d),u=m=>{d.abort(),this.#v(e,m)};window.addEventListener("blur",u,{signal:h}),window.addEventListener("pointerup",u,{signal:h}),window.addEventListener("pointerdown",Lt,{capture:!0,passive:!1,signal:h}),window.addEventListener("contextmenu",Rt,{signal:h}),i.addEventListener("pointermove",this.#x.bind(this,e),{signal:h}),this._freeHighlight=new ci({x:s,y:n},[r,a,l,c],e.scale,this._defaultThickness/2,t,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#x(e,t){this._freeHighlight.add(t)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#v(e,t){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(t,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static deserialize(e,t,i){return C(this,null,function*(){let s=null;if(e instanceof cs){let{data:{quadPoints:p,rect:f,rotation:_,id:g,color:b,opacity:v,popupRef:y},parent:{page:{pageNumber:w}}}=e;s=e={annotationType:D.HIGHLIGHT,color:Array.from(b),opacity:v,quadPoints:p,boxes:null,pageIndex:w-1,rect:f.slice(0),rotation:_,id:g,deleted:!1,popupRef:y}}else if(e instanceof oi){let{data:{inkLists:p,rect:f,rotation:_,id:g,color:b,borderStyle:{rawWidth:v},popupRef:y},parent:{page:{pageNumber:w}}}=e;s=e={annotationType:D.HIGHLIGHT,color:Array.from(b),thickness:v,inkLists:p,boxes:null,pageIndex:w-1,rect:f.slice(0),rotation:_,id:g,deleted:!1,popupRef:y}}let{color:n,quadPoints:r,inkLists:a,opacity:l}=e,c=yield ne(o,this,"deserialize").call(this,e,t,i);c.color=E.makeHexColor(...n),c.#m=l||1,a&&(c.#f=e.thickness),c.annotationElementId=e.id||null,c._initialData=s;let[d,h]=c.pageDimensions,[u,m]=c.pageTranslation;if(r){let p=c.#i=[];for(let f=0;f<r.length;f+=8)p.push({x:(r[f]-u)/d,y:1-(r[f+1]-m)/h,width:(r[f+2]-r[f])/d,height:(r[f+1]-r[f+5])/h});c.#b(),c.#T(),c.rotate(c.rotation)}else if(a){c.#a=!0;let p=a[0],f={x:p[0]-u,y:h-(p[1]-m)},_=new ci(f,[0,0,d,h],1,c.#f/2,!0,.001);for(let v=0,y=p.length;v<y;v+=2)f.x=p[v]-u,f.y=h-(p[v+1]-m),_.add(f);let{id:g,clipPathId:b}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:c.color,"fill-opacity":c._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:_.toSVGPath()}},!0,!0);c.#y({highlightOutlines:_.getOutlines(),highlightId:g,clipPathId:b}),c.#T()}return c})}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();let t=this.getRect(0,0),i=q._colorManager.convert(this.color),s={annotationType:D.HIGHLIGHT,color:i,opacity:this.#m,thickness:this.#f,quadPoints:this.#D(),outlines:this.#B(t),pageIndex:this.pageIndex,rect:t,rotation:this.#P(),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!this.#R(s)?null:(s.id=this.annotationElementId,s)}#R(e){let{color:t}=this._initialData;return e.color.some((i,s)=>i!==t[s])}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}},dr=class{#t=Object.create(null);updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(let[t,i]of Object.entries(e))this.updateProperty(t,i)}updateSVGProperty(e,t){this.#t[e]=t}toSVGProperties(){let e=this.#t;return this.#t=Object.create(null),{root:e}}reset(){this.#t=Object.create(null)}updateAll(e=this){this.updateProperties(e)}clone(){G("Not implemented")}},Nl=(()=>{class o extends q{#t=null;#e;_drawId=null;static _currentDrawId=-1;static _currentDraw=null;static _currentDrawingOptions=null;static _currentParent=null;static _INNER_MARGIN=3;constructor(t){super(t),this.#e=t.mustBeCommitted||!1,t.drawOutlines&&(this.#i(t),this.#n())}#i({drawOutlines:t,drawId:i,drawingOptions:s}){this.#t=t,this._drawingOptions||=s,i>=0?(this._drawId=i,this.parent.drawLayer.finalizeDraw(i,t.defaultProperties)):this._drawId=this.#s(t,this.parent),this.#d(t.box)}#s(t,i){let{id:s}=i.drawLayer.draw(o._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return s}static _mergeSVGProperties(t,i){let s=new Set(Object.keys(t));for(let[n,r]of Object.entries(i))s.has(n)?Object.assign(t[n],r):t[n]=r;return t}static getDefaultDrawingOptions(t){G("Not implemented")}static get typesMap(){G("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,i){let s=this.typesMap.get(t);s&&this._defaultDrawingOptions.updateProperty(s,i),this._currentParent&&(this._currentDraw.updateProperty(s,i),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,i){let s=this.constructor.typesMap.get(t);s&&this._updateProperty(t,s,i)}static get defaultPropertiesToUpdate(){let t=[],i=this._defaultDrawingOptions;for(let[s,n]of this.typesMap)t.push([s,i[n]]);return t}get propertiesToUpdate(){let t=[],{_drawingOptions:i}=this;for(let[s,n]of this.constructor.typesMap)t.push([s,i[n]]);return t}_updateProperty(t,i,s){let n=this._drawingOptions,r=n[i],a=l=>{n.updateProperty(i,l);let c=this.#t.updateProperty(i,l);c&&this.#d(c),this.parent?.drawLayer.updateProperties(this._drawId,n.toSVGProperties())};this.addCommands({cmd:a.bind(this,s),undo:a.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,o._mergeSVGProperties(this.#t.getPathResizingSVGProperties(this.#o()),{bbox:this.#l()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,o._mergeSVGProperties(this.#t.getPathResizedSVGProperties(this.#o()),{bbox:this.#l()}))}_onTranslating(t,i){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#l(t,i)})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,o._mergeSVGProperties(this.#t.getPathTranslatedSVGProperties(this.#o(),this.parentDimensions),{bbox:this.#l()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#e&&(this.#e=!1,this.commit(),this.parent.setSelected(this),this.isOnScreen&&this.div.focus())}remove(){this.#r(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#n(),this.#d(this.#t.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let i=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),this.#r()):t&&(this._uiManager.addShouldRescale(this),this.#n(t),i=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),i&&this.select()}#r(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#n(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#s(this.#t,t)}}#c([t,i,s,n]){let{parentDimensions:[r,a],rotation:l}=this;switch(l){case 90:return[i,1-t,s*(a/r),n*(r/a)];case 180:return[1-t,1-i,s,n];case 270:return[1-i,t,s*(a/r),n*(r/a)];default:return[t,i,s,n]}}#o(){let{x:t,y:i,width:s,height:n,parentDimensions:[r,a],rotation:l}=this;switch(l){case 90:return[1-i,t,s*(r/a),n*(a/r)];case 180:return[1-t,1-i,s,n];case 270:return[i,1-t,s*(r/a),n*(a/r)];default:return[t,i,s,n]}}#d(t){if([this.x,this.y,this.width,this.height]=this.#c(t),this.div){this.fixAndSetPosition();let[i,s]=this.parentDimensions;this.setDims(this.width*i,this.height*s)}this._onResized()}#l(){let{x:t,y:i,width:s,height:n,rotation:r,parentRotation:a,parentDimensions:[l,c]}=this;switch((r*4+a)/90){case 1:return[1-i-n,t,n,s];case 2:return[1-t-s,1-i-n,s,n];case 3:return[i,1-t-s,n,s];case 4:return[t,i-s*(l/c),n*(c/l),s*(l/c)];case 5:return[1-i,t,s*(l/c),n*(c/l)];case 6:return[1-t-n*(c/l),1-i,n*(c/l),s*(l/c)];case 7:return[i-s*(l/c),1-t-n*(c/l),s*(l/c),n*(c/l)];case 8:return[t-s,i-n,s,n];case 9:return[1-i,t-s,n,s];case 10:return[1-t,1-i,s,n];case 11:return[i-n,1-t,n,s];case 12:return[t-n*(c/l),i,n*(c/l),s*(l/c)];case 13:return[1-i-s*(l/c),t-n*(c/l),s*(l/c),n*(c/l)];case 14:return[1-t,1-i-s*(l/c),n*(c/l),s*(l/c)];case 15:return[i,1-t,s*(l/c),n*(c/l)];default:return[t,i,s,n]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,o._mergeSVGProperties({bbox:this.#l()},this.#t.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#d(this.#t.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t=super.render();t.classList.add("draw");let i=document.createElement("div");t.append(i),i.setAttribute("aria-hidden","true"),i.className="internal";let[s,n]=this.parentDimensions;return this.setDims(this.width*s,this.height*n),this._uiManager.addShouldRescale(this),this.disableEditing(),t}static createDrawerInstance(t,i,s,n,r){G("Not implemented")}static startDrawing(t,i,s,{target:n,offsetX:r,offsetY:a}){let{viewport:{rotation:l}}=t,{width:c,height:d}=n.getBoundingClientRect(),h=new AbortController,u=t.combinedSignal(h);if(window.addEventListener("pointerup",m=>{h.abort(),t.toggleDrawing(!0),this._endDraw(m)},{signal:u}),window.addEventListener("pointerdown",Lt,{capture:!0,passive:!1,signal:u}),window.addEventListener("contextmenu",Rt,{signal:u}),n.addEventListener("pointermove",this._drawMove.bind(this),{signal:u}),t.toggleDrawing(),i._editorUndoBar?.hide(),this._currentDraw){t.drawLayer.updateProperties(this._currentDrawId,this._currentDraw.startNew(r,a,c,d,l));return}i.updateUIForDefaultProperties(this),this._currentDraw=this.createDrawerInstance(r,a,c,d,l),this._currentDrawingOptions=this.getDefaultDrawingOptions(),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(this._currentDrawingOptions.toSVGProperties(),this._currentDraw.defaultSVGProperties),!0,!1)}static _drawMove({offsetX:t,offsetY:i}){this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._currentDraw.add(t,i))}static _endDraw({offsetX:t,offsetY:i}){let s=this._currentParent;if(s.drawLayer.updateProperties(this._currentDrawId,this._currentDraw.end(t,i)),this.supportMultipleDrawings){let n=this._currentDraw,r=this._currentDrawId,a=n.getLastElement();s.addCommands({cmd:()=>{s.drawLayer.updateProperties(r,n.setLastElement(a))},undo:()=>{s.drawLayer.updateProperties(r,n.removeLastElement())},mustExec:!1,type:z.DRAW_STEP});return}this.endDrawing(!1)}static endDrawing(t){let i=this._currentParent;if(!i)return null;if(i.toggleDrawing(!0),i.cleanUndoStack(z.DRAW_STEP),!this._currentDraw.isEmpty()){let{pageDimensions:[s,n],scale:r}=i,a=i.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:this._currentDraw.getOutlines(s*r,n*r,r,this._INNER_MARGIN),drawingOptions:this._currentDrawingOptions,mustBeCommitted:!t});return this._cleanup(),a}return i.drawLayer.remove(this._currentDrawId),this._cleanup(),null}static _cleanup(){this._currentDrawId=-1,this._currentDraw=null,this._currentDrawingOptions=null,this._currentParent=null}createDrawingOptions(t){}static deserializeDraw(t,i,s,n,r,a){G("Not implemented")}static deserialize(t,i,s){return C(this,null,function*(){let{rawDims:{pageWidth:n,pageHeight:r,pageX:a,pageY:l}}=i.viewport,c=this.deserializeDraw(a,l,n,r,this._INNER_MARGIN,t),d=yield ne(o,this,"deserialize").call(this,t,i,s);return d.createDrawingOptions(t),d.#i({drawOutlines:c}),d.#n(),d.onScaleChanging(),d.rotate(),d})}serializeDraw(t){let[i,s]=this.pageTranslation,[n,r]=this.pageDimensions;return this.#t.serialize([i,s,n,r],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}}return o})(),hr=class{#t=new Float64Array(6);#e;#i;#s;#r;#n;#c="";#o=0;#d=new fs;#l;#h;constructor(e,t,i,s,n,r){this.#l=i,this.#h=s,this.#s=n,this.#r=r,[e,t]=this.#a(e,t);let a=this.#e=[NaN,NaN,NaN,NaN,e,t];this.#n=[e,t],this.#i=[{line:a,points:this.#n}],this.#t.set(a,0)}updateProperty(e,t){e==="stroke-width"&&(this.#r=t)}#a(e,t){return k._normalizePoint(e,t,this.#l,this.#h,this.#s)}isEmpty(){return!this.#i||this.#i.length===0}add(e,t){[e,t]=this.#a(e,t);let[i,s,n,r]=this.#t.subarray(2,6),a=e-n,l=t-r;return Math.hypot(this.#l*a,this.#h*l)<=2?null:(this.#n.push(e,t),isNaN(i)?(this.#t.set([n,r,e,t],2),this.#e.push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(this.#t[0])&&this.#e.splice(6,6),this.#t.set([i,s,n,r,e,t],0),this.#e.push(...k.createBezierPoints(i,s,n,r,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){let i=this.add(e,t);return i||(this.#n.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,i,s,n){this.#l=i,this.#h=s,this.#s=n,[e,t]=this.#a(e,t);let r=this.#e=[NaN,NaN,NaN,NaN,e,t];this.#n=[e,t];let a=this.#i.at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),this.#i.push({line:r,points:this.#n}),this.#t.set(r,0),this.#o=0,this.toSVGPath(),null}getLastElement(){return this.#i.at(-1)}setLastElement(e){return this.#i?(this.#i.push(e),this.#e=e.line,this.#n=e.points,this.#o=0,{path:{d:this.toSVGPath()}}):this.#d.setLastElement(e)}removeLastElement(){if(!this.#i)return this.#d.removeLastElement();this.#i.pop(),this.#c="";for(let e=0,t=this.#i.length;e<t;e++){let{line:i,points:s}=this.#i[e];this.#e=i,this.#n=s,this.#o=0,this.toSVGPath()}return{path:{d:this.#c}}}toSVGPath(){let e=k.svgRound(this.#e[4]),t=k.svgRound(this.#e[5]);if(this.#n.length===2)return this.#c=`${this.#c} M ${e} ${t} Z`,this.#c;if(this.#n.length<=6){let s=this.#c.lastIndexOf("M");this.#c=`${this.#c.slice(0,s)} M ${e} ${t}`,this.#o=6}if(this.#n.length===4){let s=k.svgRound(this.#e[10]),n=k.svgRound(this.#e[11]);return this.#c=`${this.#c} L ${s} ${n}`,this.#o=12,this.#c}let i=[];this.#o===0&&(i.push(`M ${e} ${t}`),this.#o=6);for(let s=this.#o,n=this.#e.length;s<n;s+=6){let[r,a,l,c,d,h]=this.#e.slice(s,s+6).map(k.svgRound);i.push(`C${r} ${a} ${l} ${c} ${d} ${h}`)}return this.#c+=i.join(" "),this.#o=this.#e.length,this.#c}getOutlines(e,t,i,s){let n=this.#i.at(-1);return n.line=new Float32Array(n.line),n.points=new Float32Array(n.points),this.#d.build(this.#i,e,t,i,this.#s,this.#r,s),this.#t=null,this.#e=null,this.#i=null,this.#c=null,this.#d}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}},fs=class o extends k{#t;#e=0;#i;#s;#r;#n;#c;#o;#d;build(e,t,i,s,n,r,a){this.#r=t,this.#n=i,this.#c=s,this.#o=n,this.#d=r,this.#i=a??0,this.#s=e,this.#a()}setLastElement(e){return this.#s.push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#s.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){let e=[];for(let{line:t}of this.#s){if(e.push(`M${k.svgRound(t[4])} ${k.svgRound(t[5])}`),t.length===6){e.push("Z");continue}if(t.length===12){e.push(`L${k.svgRound(t[10])} ${k.svgRound(t[11])}`);continue}for(let i=6,s=t.length;i<s;i+=6){let[n,r,a,l,c,d]=t.subarray(i,i+6).map(k.svgRound);e.push(`C${n} ${r} ${a} ${l} ${c} ${d}`)}}return e.join("")}serialize([e,t,i,s],n){let r=[],a=[],[l,c,d,h]=this.#h(),u,m,p,f,_,g,b,v,y;switch(this.#o){case 0:y=k._rescale,u=e,m=t+s,p=i,f=-s,_=e+l*i,g=t+(1-c-h)*s,b=e+(l+d)*i,v=t+(1-c)*s;break;case 90:y=k._rescaleAndSwap,u=e,m=t,p=i,f=s,_=e+c*i,g=t+l*s,b=e+(c+h)*i,v=t+(l+d)*s;break;case 180:y=k._rescale,u=e+i,m=t,p=-i,f=s,_=e+(1-l-d)*i,g=t+c*s,b=e+(1-l)*i,v=t+(c+h)*s;break;case 270:y=k._rescaleAndSwap,u=e+i,m=t+s,p=-i,f=-s,_=e+(1-c-h)*i,g=t+(1-l-d)*s,b=e+(1-c)*i,v=t+(1-l)*s;break}for(let{line:w,points:A}of this.#s)r.push(y(w,u,m,p,f,n?new Array(w.length):null)),a.push(y(A,u,m,p,f,n?new Array(A.length):null));return{lines:r,points:a,rect:[_,g,b,v]}}static deserialize(e,t,i,s,n,{paths:{lines:r,points:a},rotation:l,thickness:c}){let d=[],h,u,m,p,f;switch(l){case 0:f=k._rescale,h=-e/i,u=t/s+1,m=1/i,p=-1/s;break;case 90:f=k._rescaleAndSwap,h=-t/s,u=-e/i,m=1/s,p=1/i;break;case 180:f=k._rescale,h=e/i+1,u=-t/s,m=-1/i,p=1/s;break;case 270:f=k._rescaleAndSwap,h=t/s+1,u=e/i+1,m=-1/s,p=-1/i;break}if(!r){r=[];for(let g of a){let b=g.length;if(b===2){r.push(new Float32Array([NaN,NaN,NaN,NaN,g[0],g[1]]));continue}if(b===4){r.push(new Float32Array([NaN,NaN,NaN,NaN,g[0],g[1],NaN,NaN,NaN,NaN,g[2],g[3]]));continue}let v=new Float32Array(3*(b-2));r.push(v);let[y,w,A,x]=g.subarray(0,4);v.set([NaN,NaN,NaN,NaN,y,w],0);for(let M=4;M<b;M+=2){let P=g[M],j=g[M+1];v.set(k.createBezierPoints(y,w,A,x,P,j),(M-2)*3),[y,w,A,x]=[A,x,P,j]}}}for(let g=0,b=r.length;g<b;g++)d.push({line:f(r[g].map(v=>v??NaN),h,u,m,p),points:f(a[g].map(v=>v??NaN),h,u,m,p)});let _=new o;return _.build(d,i,s,1,l,c,n),_}#l(e=this.#d){let t=this.#i+e/2*this.#c;return this.#o%180===0?[t/this.#r,t/this.#n]:[t/this.#n,t/this.#r]}#h(){let[e,t,i,s]=this.#t,[n,r]=this.#l(0);return[e+n,t+r,i-2*n,s-2*r]}#a(){let e=this.#t=new Float32Array([1/0,1/0,-1/0,-1/0]);for(let{line:s}of this.#s){if(s.length<=12){for(let a=4,l=s.length;a<l;a+=6){let[c,d]=s.subarray(a,a+2);e[0]=Math.min(e[0],c),e[1]=Math.min(e[1],d),e[2]=Math.max(e[2],c),e[3]=Math.max(e[3],d)}continue}let n=s[4],r=s[5];for(let a=6,l=s.length;a<l;a+=6){let[c,d,h,u,m,p]=s.subarray(a,a+6);E.bezierBoundingBox(n,r,c,d,h,u,m,p,e),n=m,r=p}}let[t,i]=this.#l();e[0]=Math.min(1,Math.max(0,e[0]-t)),e[1]=Math.min(1,Math.max(0,e[1]-i)),e[2]=Math.min(1,Math.max(0,e[2]+t)),e[3]=Math.min(1,Math.max(0,e[3]+i)),e[2]-=e[0],e[3]-=e[1]}get box(){return this.#t}updateProperty(e,t){return e==="stroke-width"?this.#u(t):null}#u(e){let[t,i]=this.#l();this.#d=e;let[s,n]=this.#l(),[r,a]=[s-t,n-i],l=this.#t;return l[0]-=r,l[1]-=a,l[2]+=2*r,l[3]+=2*a,l}updateParentDimensions([e,t],i){let[s,n]=this.#l();this.#r=e,this.#n=t,this.#c=i;let[r,a]=this.#l(),l=r-s,c=a-n,d=this.#t;return d[0]-=l,d[1]-=c,d[2]+=2*l,d[3]+=2*c,d}updateRotation(e){return this.#e=e,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#t.map(k.svgRound).join(" ")}get defaultProperties(){let[e,t]=this.#t;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${k.svgRound(e)} ${k.svgRound(t)}`}}}get rotationTransform(){let[,,e,t]=this.#t,i=0,s=0,n=0,r=0,a=0,l=0;switch(this.#e){case 90:s=t/e,n=-e/t,a=e;break;case 180:i=-1,r=-1,a=e,l=t;break;case 270:s=-t/e,n=e/t,l=t;break;default:return""}return`matrix(${i} ${s} ${n} ${r} ${k.svgRound(a)} ${k.svgRound(l)})`}getPathResizingSVGProperties([e,t,i,s]){let[n,r]=this.#l(),[a,l,c,d]=this.#t;if(Math.abs(c-n)<=k.PRECISION||Math.abs(d-r)<=k.PRECISION){let f=e+i/2-(a+c/2),_=t+s/2-(l+d/2);return{path:{"transform-origin":`${k.svgRound(e)} ${k.svgRound(t)}`,transform:`${this.rotationTransform} translate(${f} ${_})`}}}let h=(i-2*n)/(c-2*n),u=(s-2*r)/(d-2*r),m=c/i,p=d/s;return{path:{"transform-origin":`${k.svgRound(a)} ${k.svgRound(l)}`,transform:`${this.rotationTransform} scale(${m} ${p}) translate(${k.svgRound(n)} ${k.svgRound(r)}) scale(${h} ${u}) translate(${k.svgRound(-n)} ${k.svgRound(-r)})`}}}getPathResizedSVGProperties([e,t,i,s]){let[n,r]=this.#l(),a=this.#t,[l,c,d,h]=a;if(a[0]=e,a[1]=t,a[2]=i,a[3]=s,Math.abs(d-n)<=k.PRECISION||Math.abs(h-r)<=k.PRECISION){let _=e+i/2-(l+d/2),g=t+s/2-(c+h/2);for(let{line:b,points:v}of this.#s)k._translate(b,_,g,b),k._translate(v,_,g,v);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${k.svgRound(e)} ${k.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}let u=(i-2*n)/(d-2*n),m=(s-2*r)/(h-2*r),p=-u*(l+n)+e+n,f=-m*(c+r)+t+r;if(u!==1||m!==1||p!==0||f!==0)for(let{line:_,points:g}of this.#s)k._rescale(_,p,f,u,m,_),k._rescale(g,p,f,u,m,g);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${k.svgRound(e)} ${k.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,t],i){let[s,n]=i,r=this.#t,a=e-r[0],l=t-r[1];if(this.#r===s&&this.#n===n)for(let{line:c,points:d}of this.#s)k._translate(c,a,l,c),k._translate(d,a,l,d);else{let c=this.#r/s,d=this.#n/n;this.#r=s,this.#n=n;for(let{line:h,points:u}of this.#s)k._rescale(h,a,l,c,d,h),k._rescale(u,a,l,c,d,u);r[2]*=c,r[3]*=d}return r[0]=e,r[1]=t,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${k.svgRound(e)} ${k.svgRound(t)}`}}}get defaultSVGProperties(){let e=this.#t;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${k.svgRound(e[0])} ${k.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}},ur=class o extends dr{#t;constructor(e){super(),this.#t=e,super.updateProperties({fill:"none",stroke:q._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??=this["stroke-width"],t*=this.#t.realScale),super.updateSVGProperty(e,t)}clone(){let e=new o(this.#t);return e.updateAll(this),e}},mr=class o extends Nl{static _type="ink";static _editorType=D.INK;static _defaultDrawingOptions=null;constructor(e){super(Yt(Y({},e),{name:"inkEditor"})),this._willKeepAspectRatio=!0}static initialize(e,t){q.initialize(e,t),this._defaultDrawingOptions=new ur(t.viewParameters)}static getDefaultDrawingOptions(e){let t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!0}static get typesMap(){return B(this,"typesMap",new Map([[z.INK_THICKNESS,"stroke-width"],[z.INK_COLOR,"stroke"],[z.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,t,i,s,n){return new hr(e,t,i,s,n,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,t,i,s,n,r){return fs.deserialize(e,t,i,s,n,r)}static deserialize(e,t,i){return C(this,null,function*(){let s=null;if(e instanceof oi){let{data:{inkLists:r,rect:a,rotation:l,id:c,color:d,opacity:h,borderStyle:{rawWidth:u},popupRef:m},parent:{page:{pageNumber:p}}}=e;s=e={annotationType:D.INK,color:Array.from(d),thickness:u,opacity:h,paths:{points:r},boxes:null,pageIndex:p-1,rect:a.slice(0),rotation:l,id:c,deleted:!1,popupRef:m}}let n=yield ne(o,this,"deserialize").call(this,e,t,i);return n.annotationElementId=e.id||null,n._initialData=s,n})}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();let{_drawId:e,_drawingOptions:t,parent:i}=this;t.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(e,t.toSVGProperties())}static onScaleChangingWhenDrawing(){let e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:e,thickness:t,opacity:i}){this._drawingOptions=o.getDefaultDrawingOptions({stroke:E.makeHexColor(...e),"stroke-width":t,"stroke-opacity":i})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let{lines:t,points:i,rect:s}=this.serializeDraw(e),{_drawingOptions:{stroke:n,"stroke-opacity":r,"stroke-width":a}}=this,l={annotationType:D.INK,color:q._colorManager.convert(n),opacity:r,thickness:a,paths:{lines:t,points:i},pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?l:this.annotationElementId&&!this.#t(l)?null:(l.id=this.annotationElementId,l)}#t(e){let{color:t,thickness:i,opacity:s,pageIndex:n}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||e.color.some((r,a)=>r!==t[a])||e.thickness!==i||e.opacity!==s||e.pageIndex!==n}renderAnnotationElement(e){let{points:t,rect:i}=this.serializeDraw(!1);return e.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:t}),null}},pr=class o extends q{#t=null;#e=null;#i=null;#s=null;#r=null;#n="";#c=null;#o=null;#d=null;#l=!1;#h=!1;static _type="stamp";static _editorType=D.STAMP;constructor(e){super(Yt(Y({},e),{name:"stampEditor"})),this.#s=e.bitmapUrl,this.#r=e.bitmapFile}static initialize(e,t){q.initialize(e,t)}static get supportedTypes(){return B(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(t=>`image/${t}`))}static get supportedTypesStr(){return B(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(e){return this.supportedTypes.includes(e)}static paste(e,t){t.pasteEditor(D.STAMP,{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(e){let t=e.get("hasAltText");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}#a(e,t=!1){if(!e){this.remove();return}this.#t=e.bitmap,t||(this.#e=e.id,this.#l=e.isSvg),e.file&&(this.#n=e.file.name),this.#p()}#u(){if(this.#i=null,this._uiManager.enableWaiting(!1),!!this.#c){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}mlGuessAltText(e=null,t=!0){return C(this,null,function*(){if(this.hasAltTextData())return null;let{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!(yield i.isEnabledFor("altText")))throw new Error("ML isn't enabled for alt text.");let{data:s,width:n,height:r}=e||this.copyCanvas(null,null,!0).imageData,a=yield i.guess({name:"altText",request:{data:s,width:n,height:r,channels:s.length/(n*r)}});if(!a)throw new Error("No response from the AI service.");if(a.error)throw new Error("Error from the AI service.");if(a.cancel)return null;if(!a.output)throw new Error("No valid response from the AI service.");let l=a.output;return yield this.setGuessedAltText(l),t&&!this.hasAltTextData()&&(this.altTextData={alt:l,decorative:!1}),l})}#m(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(i=>this.#a(i,!0)).finally(()=>this.#u());return}if(this.#s){let i=this.#s;this.#s=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromUrl(i).then(s=>this.#a(s)).finally(()=>this.#u());return}if(this.#r){let i=this.#r;this.#r=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromFile(i).then(s=>this.#a(s)).finally(()=>this.#u());return}let e=document.createElement("input");e.type="file",e.accept=o.supportedTypesStr;let t=this._uiManager._signal;this.#i=new Promise(i=>{e.addEventListener("change",()=>C(this,null,function*(){if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);let s=yield this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#a(s)}i()}),{signal:t}),e.addEventListener("cancel",()=>{this.remove(),i()},{signal:t})}).finally(()=>this.#u()),e.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#c?.remove(),this.#c=null,this.#o?.disconnect(),this.#o=null,this.#d&&(clearTimeout(this.#d),this.#d=null)),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#m();return}super.rebuild(),this.div!==null&&(this.#e&&this.#c===null&&this.#m(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(this.#i||this.#t||this.#s||this.#r||this.#e)}get isResizable(){return!0}render(){if(this.div)return this.div;let e,t;if(this.width&&(e=this.x,t=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),this.#t?this.#p():this.#m(),this.width&&!this.annotationElementId){let[i,s]=this.parentDimensions;this.setAt(e*i,t*s,this.width*i,this.height*s)}return this.div}#p(){let{div:e}=this,{width:t,height:i}=this.#t,[s,n]=this.pageDimensions,r=.75;if(this.width)t=this.width*s,i=this.height*n;else if(t>r*s||i>r*n){let d=Math.min(r*s/t,r*n/i);t*=d,i*=d}let[a,l]=this.parentDimensions;this.setDims(t*a/s,i*l/n),this._uiManager.enableWaiting(!1);let c=this.#c=document.createElement("canvas");c.setAttribute("role","img"),this.addContainer(c),(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(e.hidden=!1),this.#_(t,i),this.#y(),this.#h||(this.parent.addUndoableEditor(this),this.#h=!0),this._reportTelemetry({action:"inserted_image"}),this.#n&&c.setAttribute("aria-label",this.#n)}copyCanvas(e,t,i=!1){e||(e=224);let{width:s,height:n}=this.#t,r=new Je,a=this.#t,l=s,c=n,d=null;if(t){if(s>t||n>t){let A=Math.min(t/s,t/n);l=Math.floor(s*A),c=Math.floor(n*A)}d=document.createElement("canvas");let u=d.width=Math.ceil(l*r.sx),m=d.height=Math.ceil(c*r.sy);this.#l||(a=this.#f(u,m));let p=d.getContext("2d");p.filter=this._uiManager.hcmFilter;let f="white",_="#cfcfd8";this._uiManager.hcmFilter!=="none"?_="black":window.matchMedia?.("(prefers-color-scheme: dark)").matches&&(f="#8f8f9d",_="#42414d");let g=15,b=g*r.sx,v=g*r.sy,y=new OffscreenCanvas(b*2,v*2),w=y.getContext("2d");w.fillStyle=f,w.fillRect(0,0,b*2,v*2),w.fillStyle=_,w.fillRect(0,0,b,v),w.fillRect(b,v,b,v),p.fillStyle=p.createPattern(y,"repeat"),p.fillRect(0,0,u,m),p.drawImage(a,0,0,a.width,a.height,0,0,u,m)}let h=null;if(i){let u,m;if(r.symmetric&&a.width<e&&a.height<e)u=a.width,m=a.height;else if(a=this.#t,s>e||n>e){let _=Math.min(e/s,e/n);u=Math.floor(s*_),m=Math.floor(n*_),this.#l||(a=this.#f(u,m))}let f=new OffscreenCanvas(u,m).getContext("2d",{willReadFrequently:!0});f.drawImage(a,0,0,a.width,a.height,0,0,u,m),h={width:u,height:m,data:f.getImageData(0,0,u,m).data}}return{canvas:d,width:l,height:c,imageData:h}}#g(e,t){let[i,s]=this.parentDimensions;this.width=e/i,this.height=t/s,this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,this.#d!==null&&clearTimeout(this.#d);let n=200;this.#d=setTimeout(()=>{this.#d=null,this.#_(e,t)},n)}#f(e,t){let{width:i,height:s}=this.#t,n=i,r=s,a=this.#t;for(;n>2*e||r>2*t;){let l=n,c=r;n>2*e&&(n=n>=16384?Math.floor(n/2)-1:Math.ceil(n/2)),r>2*t&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2));let d=new OffscreenCanvas(n,r);d.getContext("2d").drawImage(a,0,0,l,c,0,0,n,r),a=d.transferToImageBitmap()}return a}#_(e,t){let i=new Je,s=Math.ceil(e*i.sx),n=Math.ceil(t*i.sy),r=this.#c;if(!r||r.width===s&&r.height===n)return;r.width=s,r.height=n;let a=this.#l?this.#t:this.#f(s,n),l=r.getContext("2d");l.filter=this._uiManager.hcmFilter,l.drawImage(a,0,0,a.width,a.height,0,0,s,n)}getImageForAltText(){return this.#c}#b(e){if(e){if(this.#l){let s=this._uiManager.imageManager.getSvgUrl(this.#e);if(s)return s}let t=document.createElement("canvas");return{width:t.width,height:t.height}=this.#t,t.getContext("2d").drawImage(this.#t,0,0),t.toDataURL()}if(this.#l){let[t,i]=this.pageDimensions,s=Math.round(this.width*t*ie.PDF_TO_CSS_UNITS),n=Math.round(this.height*i*ie.PDF_TO_CSS_UNITS),r=new OffscreenCanvas(s,n);return r.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,s,n),r.transferToImageBitmap()}return structuredClone(this.#t)}#y(){this._uiManager._signal&&(this.#o=new ResizeObserver(e=>{let t=e[0].contentRect;t.width&&t.height&&this.#g(t.width,t.height)}),this.#o.observe(this.div),this._uiManager._signal.addEventListener("abort",()=>{this.#o?.disconnect(),this.#o=null},{once:!0}))}static deserialize(e,t,i){return C(this,null,function*(){let s=null;if(e instanceof ds){let{data:{rect:p,rotation:f,id:_,structParent:g,popupRef:b},container:v,parent:{page:{pageNumber:y}}}=e,w=v.querySelector("canvas"),A=i.imageManager.getFromCanvas(v.id,w);w.remove();let x=(yield t._structTree.getAriaAttributes(`${_r}${_}`))?.get("aria-label")||"";s=e={annotationType:D.STAMP,bitmapId:A.id,bitmap:A.bitmap,pageIndex:y-1,rect:p.slice(0),rotation:f,id:_,deleted:!1,accessibilityData:{decorative:!1,altText:x},isSvg:!1,structParent:g,popupRef:b}}let n=yield ne(o,this,"deserialize").call(this,e,t,i),{rect:r,bitmap:a,bitmapUrl:l,bitmapId:c,isSvg:d,accessibilityData:h}=e;c&&i.imageManager.isValidId(c)?(n.#e=c,a&&(n.#t=a)):n.#s=l,n.#l=d;let[u,m]=n.pageDimensions;return n.width=(r[2]-r[0])/u,n.height=(r[3]-r[1])/m,n.annotationElementId=e.id||null,h&&(n.altTextData=h),n._initialData=s,n.#h=!!s,n})}serialize(e=!1,t=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let i={annotationType:D.STAMP,bitmapId:this.#e,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#l,structTreeParentId:this._structTreeParentId};if(e)return i.bitmapUrl=this.#b(!0),i.accessibilityData=this.serializeAltText(!0),i;let{decorative:s,altText:n}=this.serializeAltText(!1);if(!s&&n&&(i.accessibilityData={type:"Figure",alt:n}),this.annotationElementId){let a=this.#w(i);if(a.isSame)return null;a.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1}if(i.id=this.annotationElementId,t===null)return i;t.stamps||=new Map;let r=this.#l?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!t.stamps.has(this.#e))t.stamps.set(this.#e,{area:r,serialized:i}),i.bitmap=this.#b(!1);else if(this.#l){let a=t.stamps.get(this.#e);r>a.area&&(a.area=r,a.serialized.bitmap.close(),a.serialized.bitmap=this.#b(!1))}return i}#w(e){let{pageIndex:t,accessibilityData:{altText:i}}=this._initialData,s=e.pageIndex===t,n=(e.accessibilityData?.alt||"")===i;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&s&&n,isSameAltText:n}}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}},Bl=(()=>{class o{#t;#e=!1;#i=null;#s=null;#r=null;#n=new Map;#c=!1;#o=!1;#d=null;#l=null;#h=null;#a;static _initialized=!1;static#u=new Map([or,mr,pr,ps].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:i,div:s,structTreeLayer:n,accessibilityManager:r,annotationLayer:a,drawLayer:l,textLayer:c,viewport:d,l10n:h}){let u=[...o.#u.values()];if(!o._initialized){o._initialized=!0;for(let m of u)m.initialize(h,t)}t.registerEditorTypes(u),this.#a=t,this.pageIndex=i,this.div=s,this.#t=r,this.#i=a,this.viewport=d,this.#l=c,this.drawLayer=l,this._structTree=n,this.#a.addLayer(this)}get isEmpty(){return this.#n.size===0}get isInvisible(){return this.isEmpty&&this.#a.getMode()===D.NONE}updateToolbar(t){this.#a.updateToolbar(t)}updateMode(t=this.#a.getMode()){switch(this.#_(),t){case D.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case D.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case D.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);let{classList:i}=this.div;for(let s of o.#u.values())i.toggle(`${s._type}Editing`,t===s._editorType);this.div.hidden=!1}hasTextLayer(t){return t===this.#l?.div}setEditingState(t){this.#a.setEditingState(t)}addCommands(t){this.#a.addCommands(t)}cleanUndoStack(t){this.#a.cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#i?.div.classList.toggle("disabled",!t)}enable(){return C(this,null,function*(){this.div.tabIndex=0,this.togglePointerEvents(!0);let t=new Set;for(let s of this.#n.values())s.enableEditing(),s.show(!0),s.annotationElementId&&(this.#a.removeChangedExistingAnnotation(s),t.add(s.annotationElementId));if(!this.#i)return;let i=this.#i.getEditableAnnotations();for(let s of i){if(s.hide(),this.#a.isDeletedAnnotationElement(s.data.id)||t.has(s.data.id))continue;let n=yield this.deserialize(s);n&&(this.addOrRebuild(n),n.enableEditing())}})}disable(){this.#o=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1);let t=new Map,i=new Map;for(let n of this.#n.values())if(n.disableEditing(),!!n.annotationElementId){if(n.serialize()!==null){t.set(n.annotationElementId,n);continue}else i.set(n.annotationElementId,n);this.getEditableAnnotation(n.annotationElementId)?.show(),n.remove()}if(this.#i){let n=this.#i.getEditableAnnotations();for(let r of n){let{id:a}=r.data;if(this.#a.isDeletedAnnotationElement(a))continue;let l=i.get(a);if(l){l.resetAnnotationElement(r),l.show(!1),r.show();continue}l=t.get(a),l&&(this.#a.addChangedExistingAnnotation(l),l.renderAnnotationElement(r)&&l.show(!1)),r.show()}}this.#_(),this.isEmpty&&(this.div.hidden=!0);let{classList:s}=this.div;for(let n of o.#u.values())s.remove(`${n._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#o=!1}getEditableAnnotation(t){return this.#i?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#a.getActive()!==t&&this.#a.setActiveEditor(t)}enableTextSelection(){if(this.div.tabIndex=-1,this.#l?.div&&!this.#h){this.#h=new AbortController;let t=this.#a.combinedSignal(this.#h);this.#l.div.addEventListener("pointerdown",this.#m.bind(this),{signal:t}),this.#l.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#l?.div&&this.#h&&(this.#h.abort(),this.#h=null,this.#l.div.classList.remove("highlighting"))}#m(t){this.#a.unselectAll();let{target:i}=t;if(i===this.#l.div||(i.getAttribute("role")==="img"||i.classList.contains("endOfContent"))&&this.#l.div.contains(i)){let{isMac:s}=ot.platform;if(t.button!==0||t.ctrlKey&&s)return;this.#a.showAllEditors("highlight",!0,!0),this.#l.div.classList.add("free"),this.toggleDrawing(),ps.startHighlighting(this,this.#a.direction==="ltr",{target:this.#l.div,x:t.x,y:t.y}),this.#l.div.addEventListener("pointerup",()=>{this.#l.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#a._signal}),t.preventDefault()}}enableClick(){if(this.#s)return;this.#s=new AbortController;let t=this.#a.combinedSignal(this.#s);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t}),this.div.addEventListener("pointerup",this.pointerup.bind(this),{signal:t})}disableClick(){this.#s?.abort(),this.#s=null}attach(t){this.#n.set(t.id,t);let{annotationElementId:i}=t;i&&this.#a.isDeletedAnnotationElement(i)&&this.#a.removeDeletedAnnotationElement(t)}detach(t){this.#n.delete(t.id),this.#t?.removePointerInTextLayer(t.contentDiv),!this.#o&&t.annotationElementId&&this.#a.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#a.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#a.addDeletedAnnotationElement(t.annotationElementId),q.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),this.#a.addEditor(t),this.attach(t),!t.isAttachedToDOM){let i=t.render();this.div.append(i),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(),this.#a.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;let{activeElement:i}=document;t.div.contains(i)&&!this.#r&&(t._focusEventsAllowed=!1,this.#r=setTimeout(()=>{this.#r=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this.#a._signal}),i.focus())},0)),t._structTreeParentId=this.#t?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){let i=()=>t._uiManager.rebuild(t),s=()=>{t.remove()};this.addCommands({cmd:i,undo:s,mustExec:!1})}getNextId(){return this.#a.getId()}get#p(){return o.#u.get(this.#a.getMode())}combinedSignal(t){return this.#a.combinedSignal(t)}#g(t){let i=this.#p;return i?new i.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#p?.canCreateNewEmptyEditor()}pasteEditor(t,i){this.#a.updateToolbar(t),this.#a.updateMode(t);let{offsetX:s,offsetY:n}=this.#f(),r=this.getNextId(),a=this.#g(Y({parent:this,id:r,x:s,y:n,uiManager:this.#a,isCentered:!0},i));a&&this.add(a)}deserialize(t){return C(this,null,function*(){return(yield o.#u.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#a))||null})}createAndAddNewEditor(t,i,s={}){let n=this.getNextId(),r=this.#g(Y({parent:this,id:n,x:t.offsetX,y:t.offsetY,uiManager:this.#a,isCentered:i},s));return r&&this.add(r),r}#f(){let{x:t,y:i,width:s,height:n}=this.div.getBoundingClientRect(),r=Math.max(0,t),a=Math.max(0,i),l=Math.min(window.innerWidth,t+s),c=Math.min(window.innerHeight,i+n),d=(r+l)/2-t,h=(a+c)/2-i,[u,m]=this.viewport.rotation%180===0?[d,h]:[h,d];return{offsetX:u,offsetY:m}}addNewEditor(){this.createAndAddNewEditor(this.#f(),!0)}setSelected(t){this.#a.setSelected(t)}toggleSelected(t){this.#a.toggleSelected(t)}unselect(t){this.#a.unselect(t)}pointerup(t){let{isMac:i}=ot.platform;if(!(t.button!==0||t.ctrlKey&&i)&&t.target===this.div&&this.#c&&(this.#c=!1,!(this.#p?.isDrawer&&this.#p.supportMultipleDrawings))){if(!this.#e){this.#e=!0;return}if(this.#a.getMode()===D.STAMP){this.#a.unselectAll();return}this.createAndAddNewEditor(t,!1)}}pointerdown(t){if(this.#a.getMode()===D.HIGHLIGHT&&this.enableTextSelection(),this.#c){this.#c=!1;return}let{isMac:i}=ot.platform;if(t.button!==0||t.ctrlKey&&i||t.target!==this.div)return;if(this.#c=!0,this.#p?.isDrawer){this.startDrawingSession(t);return}let s=this.#a.getActive();this.#e=!s||s.isEmpty()}startDrawingSession(t){if(this.div.focus(),this.#d){this.#p.startDrawing(this,this.#a,!1,t);return}this.#a.setCurrentDrawingSession(this),this.#d=new AbortController;let i=this.#a.combinedSignal(this.#d);this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&this.commitOrRemove()},{signal:i}),this.#p.startDrawing(this,this.#a,!1,t)}endDrawingSession(t=!1){return this.#d?(this.#a.setCurrentDrawingSession(null),this.#d.abort(),this.#d=null,this.#p.endDrawing(t)):null}findNewParent(t,i,s){let n=this.#a.findParent(i,s);return n===null||n===this?!1:(n.changeParent(t),!0)}commitOrRemove(){return this.#d?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#d&&this.#p.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#a.getActive()?.parent===this&&(this.#a.commitOrRemove(),this.#a.setActiveEditor(null)),this.#r&&(clearTimeout(this.#r),this.#r=null);for(let t of this.#n.values())this.#t?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#n.clear(),this.#a.removeLayer(this)}#_(){for(let t of this.#n.values())t.isEmpty()&&t.remove()}render({viewport:t}){this.viewport=t,ge(this.div,t);for(let i of this.#a.getEditors(this.pageIndex))this.add(i),i.rebuild();this.updateMode()}update({viewport:t}){this.#a.commitOrRemove(),this.#_();let i=this.viewport.rotation,s=t.rotation;if(this.viewport=t,ge(this.div,{rotation:s}),i!==s)for(let n of this.#n.values())n.rotate(s)}get pageDimensions(){let{pageWidth:t,pageHeight:i}=this.viewport.rawDims;return[t,i]}get scale(){return this.#a.viewParameters.realScale}}return o})(),fr=class o{#t=null;#e=0;#i=new Map;#s=new Map;constructor({pageIndex:e}){this.pageIndex=e}setParent(e){if(!this.#t){this.#t=e;return}if(this.#t!==e){if(this.#i.size>0)for(let t of this.#i.values())t.remove(),e.append(t);this.#t=e}}static get _svgFactory(){return B(this,"_svgFactory",new ri)}static#r(e,[t,i,s,n]){let{style:r}=e;r.top=`${100*i}%`,r.left=`${100*t}%`,r.width=`${100*s}%`,r.height=`${100*n}%`}#n(){let e=o._svgFactory.create(1,1,!0);return this.#t.append(e),e.setAttribute("aria-hidden",!0),e}#c(e,t){let i=o._svgFactory.createElement("clipPath");e.append(i);let s=`clip_${t}`;i.setAttribute("id",s),i.setAttribute("clipPathUnits","objectBoundingBox");let n=o._svgFactory.createElement("use");return i.append(n),n.setAttribute("href",`#${t}`),n.classList.add("clip"),s}#o(e,t){for(let[i,s]of Object.entries(t))s===null?e.removeAttribute(i):e.setAttribute(i,s)}draw(e,t=!1,i=!1){let s=this.#e++,n=this.#n(),r=o._svgFactory.createElement("defs");n.append(r);let a=o._svgFactory.createElement("path");r.append(a);let l=`path_p${this.pageIndex}_${s}`;a.setAttribute("id",l),a.setAttribute("vector-effect","non-scaling-stroke"),t&&this.#s.set(s,a);let c=i?this.#c(r,l):null,d=o._svgFactory.createElement("use");return n.append(d),d.setAttribute("href",`#${l}`),this.updateProperties(n,e),this.#i.set(s,n),{id:s,clipPathId:`url(#${c})`}}drawOutline(e,t){let i=this.#e++,s=this.#n(),n=o._svgFactory.createElement("defs");s.append(n);let r=o._svgFactory.createElement("path");n.append(r);let a=`path_p${this.pageIndex}_${i}`;r.setAttribute("id",a),r.setAttribute("vector-effect","non-scaling-stroke");let l;if(t){let h=o._svgFactory.createElement("mask");n.append(h),l=`mask_p${this.pageIndex}_${i}`,h.setAttribute("id",l),h.setAttribute("maskUnits","objectBoundingBox");let u=o._svgFactory.createElement("rect");h.append(u),u.setAttribute("width","1"),u.setAttribute("height","1"),u.setAttribute("fill","white");let m=o._svgFactory.createElement("use");h.append(m),m.setAttribute("href",`#${a}`),m.setAttribute("stroke","none"),m.setAttribute("fill","black"),m.setAttribute("fill-rule","nonzero"),m.classList.add("mask")}let c=o._svgFactory.createElement("use");s.append(c),c.setAttribute("href",`#${a}`),l&&c.setAttribute("mask",`url(#${l})`);let d=c.cloneNode();return s.append(d),c.classList.add("mainOutline"),d.classList.add("secondaryOutline"),this.updateProperties(s,e),this.#i.set(i,s),i}finalizeDraw(e,t){this.#s.delete(e),this.updateProperties(e,t)}updateProperties(e,t){if(!t)return;let{root:i,bbox:s,rootClass:n,path:r}=t,a=typeof e=="number"?this.#i.get(e):e;if(a){if(i&&this.#o(a,i),s&&o.#r(a,s),n){let{classList:l}=a;for(let[c,d]of Object.entries(n))l.toggle(c,d)}if(r){let c=a.firstChild.firstChild;this.#o(c,r)}}}updateParent(e,t){if(t===this)return;let i=this.#i.get(e);i&&(t.#t.append(i),this.#i.delete(e),t.#i.set(e,i))}remove(e){this.#s.delete(e),this.#t!==null&&(this.#i.get(e).remove(),this.#i.delete(e))}destroy(){this.#t=null;for(let e of this.#i.values())e.remove();this.#i.clear(),this.#s.clear()}};globalThis.pdfjsTestingUtils={HighlightOutliner:li};var md=L.AbortException,pd=L.AnnotationEditorLayer,fd=L.AnnotationEditorParamsType,gd=L.AnnotationEditorType,_d=L.AnnotationEditorUIManager,bd=L.AnnotationLayer,vd=L.AnnotationMode,yd=L.ColorPicker,wd=L.DOMSVGFactory,Ad=L.DrawLayer,xd=L.FeatureTest,io=L.GlobalWorkerOptions,kd=L.ImageKind,Cd=L.InvalidPDFException,Sd=L.MissingPDFException,Ed=L.OPS,Td=L.OutputScale,Md=L.PDFDataRangeTransport,Pd=L.PDFDateString,Id=L.PDFWorker,Ld=L.PasswordResponses,Rd=L.PermissionFlag,Dd=L.PixelsPerInch,Od=L.RenderingCancelledException,Fd=L.TextLayer,Nd=L.UnexpectedResponseException,Bd=L.Util,zd=L.VerbosityLevel,Hd=L.XfaLayer,jd=L.build,Vd=L.createValidAbsoluteUrl,Gd=L.fetchData,so=L.getDocument,Ud=L.getFilenameFromUrl,$d=L.getPdfFilenameFromUrl,Wd=L.getXfaPageViewport,Xd=L.isDataScheme,qd=L.isPdfFile,Yd=L.noContextMenu,Kd=L.normalizeUnicode,Qd=L.setLayerDimensions,Zd=L.shadow,Jd=L.stopEvent,no=L.version;var ks=class o{constructor(e){this.data=e}static \u0275fac=function(t){return new(t||o)(Ae(zs))};static \u0275cmp=Z({type:o,selectors:[["app-page-preview-dialog"]],decls:2,vars:2,consts:[[1,"preview-dialog"],[3,"src","alt"]],template:function(t,i){t&1&&(R(0,"div",0),J(1,"img",1),O()),t&2&&(H(),st("src",i.data.pageUrl,bi)("alt","Page "+i.data.pageNumber))},dependencies:[Zt,Ri],styles:[".preview-dialog[_ngcontent-%COMP%]{padding:16px}.preview-dialog[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:80vh;object-fit:contain}"]})};function Gl(o,e){o&1&&(R(0,"div",4),J(1,"mat-spinner",5),O())}function Ul(o,e){if(o&1){let t=le();R(0,"mat-list-item",7),J(1,"img",8),R(2,"span",9),ct(3),O(),R(4,"button",10),Ht("click",function(){let s=Nt(t).index,n=At(2);return Bt(n.openPreview(s))}),R(5,"mat-icon"),ct(6,"zoom_in"),O()()()}if(o&2){let t=e.$implicit,i=e.index;H(),st("src",t,bi)("alt","Page "+(i+1)),H(2),ke("Page ",i+1,"")}}function $l(o,e){if(o&1&&(R(0,"mat-list"),lt(1,Ul,7,3,"mat-list-item",6),O()),o&2){let t=At();H(),st("ngForOf",t.pages)}}function Wl(o,e){if(o&1&&(R(0,"div",11),ct(1),O()),o&2){let t=At();H(),ke(" ",t.error," ")}}io.workerSrc=`https://cdn.jsdelivr.net/npm/pdfjs-dist@${no}/build/pdf.worker.min.mjs`;var Ie=class o{constructor(e){this.dialog=e}file=null;pages=[];isLoading=!1;error=null;ngOnChanges(e){e.file&&this.file&&this.loadPdfPreview()}loadPdfPreview(){return C(this,null,function*(){if(this.file){this.isLoading=!0,this.error=null,this.pages=[];try{let e=yield this.file.arrayBuffer(),t=yield so(e).promise,i=[];for(let s=1;s<=t.numPages;s++)i.push(this.renderPage(t,s));this.pages=yield Promise.all(i)}catch(e){console.error("Error loading PDF preview:",e),this.error="Failed to load PDF preview"}finally{this.isLoading=!1}}})}openPreview(e){this.dialog.open(ks,{data:{pageUrl:this.pages[e],pageNumber:e+1},maxWidth:"90vw",maxHeight:"90vh"})}renderPage(e,t){return C(this,null,function*(){let i=yield e.getPage(t),n=i.getViewport({scale:1}),r=document.createElement("canvas"),a=r.getContext("2d");if(!a)throw new Error("Could not get canvas context");return r.width=n.width,r.height=n.height,yield i.render({canvasContext:a,viewport:n}).promise,r.toDataURL()})}static \u0275fac=function(t){return new(t||o)(Ae(Hs))};static \u0275cmp=Z({type:o,selectors:[["app-pdf-preview"]],inputs:{file:"file"},features:[gi],decls:4,vars:3,consts:[[1,"preview-container"],["class","loading-overlay",4,"ngIf"],[4,"ngIf"],["class","error-message",4,"ngIf"],[1,"loading-overlay"],["diameter","40"],["class","page-item",4,"ngFor","ngForOf"],[1,"page-item"],["matListItemAvatar","",1,"page-thumbnail",3,"src","alt"],["matListItemTitle",""],["mat-icon-button","","matListItemMeta","",3,"click"],[1,"error-message"]],template:function(t,i){t&1&&(R(0,"div",0),lt(1,Gl,2,0,"div",1)(2,$l,2,1,"mat-list",2)(3,Wl,2,1,"div",3),O()),t&2&&(H(),st("ngIf",i.isLoading),H(),st("ngIf",i.pages.length),H(),st("ngIf",i.error))},dependencies:[Zt,Rr,Ai,Pi,Pa,Ma,Ea,Ca,Sa,Us,Vs,Gs,Ti,Ei,Si,Kr,Ri],styles:[".preview-container[_ngcontent-%COMP%]{position:relative;min-height:200px}.loading-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;justify-content:center;align-items:center;background:#fffc;z-index:1}.page-item[_ngcontent-%COMP%]{border-bottom:1px solid rgba(0,0,0,.12)}.page-thumbnail[_ngcontent-%COMP%]{width:40px;height:40px;object-fit:cover;border-radius:4px}.error-message[_ngcontent-%COMP%]{color:var(--mat-warn-500);text-align:center;padding:16px}"]})};function Xl(o,e){o&1&&J(0,"div",2)}var ql=new ut("MAT_PROGRESS_BAR_DEFAULT_OPTIONS");var ao=(()=>{class o{_elementRef=T(Tt);_ngZone=T(we);_changeDetectorRef=T(Be);_renderer=T(Fe);_cleanupTransitionEnd;_animationMode=T(Kt,{optional:!0});constructor(){let t=T(ql,{optional:!0});this._isNoopAnimation=this._animationMode==="NoopAnimations",t&&(t.color&&(this.color=this._defaultColor=t.color),this.mode=t.mode||this.mode)}_isNoopAnimation=!1;get color(){return this._color||this._defaultColor}set color(t){this._color=t}_color;_defaultColor="primary";get value(){return this._value}set value(t){this._value=ro(t||0),this._changeDetectorRef.markForCheck()}_value=0;get bufferValue(){return this._bufferValue||0}set bufferValue(t){this._bufferValue=ro(t||0),this._changeDetectorRef.markForCheck()}_bufferValue=0;animationEnd=new Oe;get mode(){return this._mode}set mode(t){this._mode=t,this._changeDetectorRef.markForCheck()}_mode="determinate";ngAfterViewInit(){this._ngZone.runOutsideAngular(()=>{this._cleanupTransitionEnd=this._renderer.listen(this._elementRef.nativeElement,"transitionend",this._transitionendHandler)})}ngOnDestroy(){this._cleanupTransitionEnd?.()}_getPrimaryBarTransform(){return`scaleX(${this._isIndeterminate()?1:this.value/100})`}_getBufferBarFlexBasis(){return`${this.mode==="buffer"?this.bufferValue:100}%`}_isIndeterminate(){return this.mode==="indeterminate"||this.mode==="query"}_transitionendHandler=t=>{this.animationEnd.observers.length===0||!t.target||!t.target.classList.contains("mdc-linear-progress__primary-bar")||(this.mode==="determinate"||this.mode==="buffer")&&this._ngZone.run(()=>this.animationEnd.next({value:this.value}))};static \u0275fac=function(i){return new(i||o)};static \u0275cmp=Z({type:o,selectors:[["mat-progress-bar"]],hostAttrs:["role","progressbar","aria-valuemin","0","aria-valuemax","100","tabindex","-1",1,"mat-mdc-progress-bar","mdc-linear-progress"],hostVars:10,hostBindings:function(i,s){i&2&&(at("aria-valuenow",s._isIndeterminate()?null:s.value)("mode",s.mode),yi("mat-"+s.color),Mt("_mat-animation-noopable",s._isNoopAnimation)("mdc-linear-progress--animation-ready",!s._isNoopAnimation)("mdc-linear-progress--indeterminate",s._isIndeterminate()))},inputs:{color:"color",value:[2,"value","value",ue],bufferValue:[2,"bufferValue","bufferValue",ue],mode:"mode"},outputs:{animationEnd:"animationEnd"},exportAs:["matProgressBar"],features:[vi],decls:7,vars:5,consts:[["aria-hidden","true",1,"mdc-linear-progress__buffer"],[1,"mdc-linear-progress__buffer-bar"],[1,"mdc-linear-progress__buffer-dots"],["aria-hidden","true",1,"mdc-linear-progress__bar","mdc-linear-progress__primary-bar"],[1,"mdc-linear-progress__bar-inner"],["aria-hidden","true",1,"mdc-linear-progress__bar","mdc-linear-progress__secondary-bar"]],template:function(i,s){i&1&&(R(0,"div",0),J(1,"div",1),lt(2,Xl,1,0,"div",2),O(),R(3,"div",3),J(4,"span",4),O(),R(5,"div",5),J(6,"span",4),O()),i&2&&(H(),oe("flex-basis",s._getBufferBarFlexBasis()),H(),Es(s.mode==="buffer"?2:-1),H(),oe("transform",s._getPrimaryBarTransform()))},styles:[`.mat-mdc-progress-bar{display:block;text-align:start}.mat-mdc-progress-bar[mode=query]{transform:scaleX(-1)}.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__buffer-dots,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__primary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__secondary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__bar-inner.mdc-linear-progress__bar-inner{animation:none}.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__primary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__buffer-bar{transition:transform 1ms}.mdc-linear-progress{position:relative;width:100%;transform:translateZ(0);outline:1px solid rgba(0,0,0,0);overflow-x:hidden;transition:opacity 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1);height:max(var(--mdc-linear-progress-track-height, 4px),var(--mdc-linear-progress-active-indicator-height, 4px))}@media(forced-colors: active){.mdc-linear-progress{outline-color:CanvasText}}.mdc-linear-progress__bar{position:absolute;top:0;bottom:0;margin:auto 0;width:100%;animation:none;transform-origin:top left;transition:transform 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1);height:var(--mdc-linear-progress-active-indicator-height, 4px)}.mdc-linear-progress--indeterminate .mdc-linear-progress__bar{transition:none}[dir=rtl] .mdc-linear-progress__bar{right:0;transform-origin:center right}.mdc-linear-progress__bar-inner{display:inline-block;position:absolute;width:100%;animation:none;border-top-style:solid;border-color:var(--mdc-linear-progress-active-indicator-color, var(--mat-sys-primary));border-top-width:var(--mdc-linear-progress-active-indicator-height, 4px)}.mdc-linear-progress__buffer{display:flex;position:absolute;top:0;bottom:0;margin:auto 0;width:100%;overflow:hidden;height:var(--mdc-linear-progress-track-height, 4px);border-radius:var(--mdc-linear-progress-track-shape, var(--mat-sys-corner-none))}.mdc-linear-progress__buffer-dots{-webkit-mask-image:url("data:image/svg+xml,%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' enable-background='new 0 0 5 2' xml:space='preserve' viewBox='0 0 5 2' preserveAspectRatio='xMinYMin slice'%3E%3Ccircle cx='1' cy='1' r='1'/%3E%3C/svg%3E");mask-image:url("data:image/svg+xml,%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' enable-background='new 0 0 5 2' xml:space='preserve' viewBox='0 0 5 2' preserveAspectRatio='xMinYMin slice'%3E%3Ccircle cx='1' cy='1' r='1'/%3E%3C/svg%3E");background-repeat:repeat-x;flex:auto;transform:rotate(180deg);animation:mdc-linear-progress-buffering 250ms infinite linear;background-color:var(--mdc-linear-progress-track-color, var(--mat-sys-surface-variant))}@media(forced-colors: active){.mdc-linear-progress__buffer-dots{background-color:ButtonBorder}}[dir=rtl] .mdc-linear-progress__buffer-dots{animation:mdc-linear-progress-buffering-reverse 250ms infinite linear;transform:rotate(0)}.mdc-linear-progress__buffer-bar{flex:0 1 100%;transition:flex-basis 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1);background-color:var(--mdc-linear-progress-track-color, var(--mat-sys-surface-variant))}.mdc-linear-progress__primary-bar{transform:scaleX(0)}.mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar{left:-145.166611%}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar{animation:mdc-linear-progress-primary-indeterminate-translate 2s infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar>.mdc-linear-progress__bar-inner{animation:mdc-linear-progress-primary-indeterminate-scale 2s infinite linear}[dir=rtl] .mdc-linear-progress.mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar{animation-name:mdc-linear-progress-primary-indeterminate-translate-reverse}[dir=rtl] .mdc-linear-progress.mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar{right:-145.166611%;left:auto}.mdc-linear-progress__secondary-bar{display:none}.mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar{left:-54.888891%;display:block}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar{animation:mdc-linear-progress-secondary-indeterminate-translate 2s infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar>.mdc-linear-progress__bar-inner{animation:mdc-linear-progress-secondary-indeterminate-scale 2s infinite linear}[dir=rtl] .mdc-linear-progress.mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar{animation-name:mdc-linear-progress-secondary-indeterminate-translate-reverse}[dir=rtl] .mdc-linear-progress.mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar{right:-54.888891%;left:auto}@keyframes mdc-linear-progress-buffering{from{transform:rotate(180deg) translateX(calc(var(--mdc-linear-progress-track-height, 4px) * -2.5))}}@keyframes mdc-linear-progress-primary-indeterminate-translate{0%{transform:translateX(0)}20%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(0)}59.15%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(83.67142%)}100%{transform:translateX(200.611057%)}}@keyframes mdc-linear-progress-primary-indeterminate-scale{0%{transform:scaleX(0.08)}36.65%{animation-timing-function:cubic-bezier(0.334731, 0.12482, 0.785844, 1);transform:scaleX(0.08)}69.15%{animation-timing-function:cubic-bezier(0.06, 0.11, 0.6, 1);transform:scaleX(0.661479)}100%{transform:scaleX(0.08)}}@keyframes mdc-linear-progress-secondary-indeterminate-translate{0%{animation-timing-function:cubic-bezier(0.15, 0, 0.515058, 0.409685);transform:translateX(0)}25%{animation-timing-function:cubic-bezier(0.31033, 0.284058, 0.8, 0.733712);transform:translateX(37.651913%)}48.35%{animation-timing-function:cubic-bezier(0.4, 0.627035, 0.6, 0.902026);transform:translateX(84.386165%)}100%{transform:translateX(160.277782%)}}@keyframes mdc-linear-progress-secondary-indeterminate-scale{0%{animation-timing-function:cubic-bezier(0.205028, 0.057051, 0.57661, 0.453971);transform:scaleX(0.08)}19.15%{animation-timing-function:cubic-bezier(0.152313, 0.196432, 0.648374, 1.004315);transform:scaleX(0.457104)}44.15%{animation-timing-function:cubic-bezier(0.257759, -0.003163, 0.211762, 1.38179);transform:scaleX(0.72796)}100%{transform:scaleX(0.08)}}@keyframes mdc-linear-progress-primary-indeterminate-translate-reverse{0%{transform:translateX(0)}20%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(0)}59.15%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(-83.67142%)}100%{transform:translateX(-200.611057%)}}@keyframes mdc-linear-progress-secondary-indeterminate-translate-reverse{0%{animation-timing-function:cubic-bezier(0.15, 0, 0.515058, 0.409685);transform:translateX(0)}25%{animation-timing-function:cubic-bezier(0.31033, 0.284058, 0.8, 0.733712);transform:translateX(-37.651913%)}48.35%{animation-timing-function:cubic-bezier(0.4, 0.627035, 0.6, 0.902026);transform:translateX(-84.386165%)}100%{transform:translateX(-160.277782%)}}@keyframes mdc-linear-progress-buffering-reverse{from{transform:translateX(-10px)}}`],encapsulation:2,changeDetection:0})}return o})();function ro(o,e=0,t=100){return Math.max(e,Math.min(t,o))}var oo=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=gt({type:o});static \u0275inj=ft({imports:[Ct]})}return o})();var lo={selectedFile:null,isProcessing:!1,error:null},Cs=class o{state=new xr(lo);get state$(){return this.state.asObservable()}setSelectedFile(e){this.updateState({selectedFile:e,error:null})}setProcessing(e){this.updateState({isProcessing:e})}setError(e){this.updateState({error:e})}reset(){this.state.next(lo)}updateState(e){this.state.next(Y(Y({},this.state.value),e))}static \u0275fac=function(t){return new(t||o)};static \u0275prov=ye({token:o,factory:o.\u0275fac,providedIn:"root"})};function Ql(o,e){o&1&&J(0,"mat-progress-bar",12)}function Zl(o,e){if(o&1){let t=le();R(0,"div",7)(1,"p"),ct(2),O(),lt(3,Ql,1,0,"mat-progress-bar",8),de(4,"async"),R(5,"mat-form-field",9)(6,"mat-label"),ct(7,"New filenames (one per line)"),O(),R(8,"textarea",10),Pr("ngModelChange",function(s){Nt(t);let n=At();return Mr(n.newNames,s)||(n.newNames=s),Bt(s)}),Ht("input",function(){Nt(t);let s=At();return Bt(s.updateFileNames())}),O(),R(9,"mat-hint"),ct(10,"Each line will be used as a filename for the corresponding page"),O()(),J(11,"app-pdf-preview",11),O()}if(o&2){let t,i=e.ngIf,s=At();H(2),ke("Selected file: ",i.name,""),H(),st("ngIf",(t=he(4,4,s.state$))==null?null:t.isProcessing),H(5),Tr("ngModel",s.newNames),H(3),st("file",i)}}function Jl(o,e){if(o&1&&(R(0,"p",13),ct(1),de(2,"async"),O()),o&2){let t,i=At();H(),ke(" ",(t=he(2,1,i.state$))==null?null:t.error," ")}}var Le=class o{constructor(e){this.pdfSplitterService=e;this.state$=this.pdfSplitterService.state$}state$;newNames="";fileNames=[];ngOnInit(){this.pdfSplitterService.reset()}onFileSelected(e){let t=e.target;t.files?.length&&this.pdfSplitterService.setSelectedFile(t.files[0])}updateFileNames(){this.fileNames=this.newNames.split(`
`).map(e=>e.trim()).filter(e=>e.length>0)}splitPdf(){return C(this,null,function*(){this.pdfSplitterService.setProcessing(!0);try{console.log("Splitting PDF with names:",this.fileNames)}catch(e){this.pdfSplitterService.setError("Failed to split PDF"),console.error("Error splitting PDF:",e)}finally{this.pdfSplitterService.setProcessing(!1)}})}static \u0275fac=function(t){return new(t||o)(Ae(Cs))};static \u0275cmp=Z({type:o,selectors:[["app-pdf-splitter"]],decls:26,vars:11,consts:[["fileInput",""],["mat-card-avatar",""],["class","file-info",4,"ngIf"],["class","error-message",4,"ngIf"],["type","file","accept",".pdf",2,"display","none",3,"change"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"file-info"],["mode","indeterminate","color","primary",4,"ngIf"],[1,"names-input"],["matInput","","placeholder","Enter names (one per line)",3,"ngModelChange","input","ngModel"],[3,"file"],["mode","indeterminate","color","primary"],[1,"error-message"]],template:function(t,i){if(t&1){let s=le();R(0,"mat-card")(1,"mat-card-header")(2,"mat-icon",1),ct(3,"file_copy"),O(),R(4,"mat-card-title"),ct(5,"PDF Splitter"),O(),R(6,"mat-card-subtitle"),ct(7,"Split PDF into single pages"),O()(),R(8,"mat-card-content"),lt(9,Zl,12,6,"div",2),de(10,"async"),lt(11,Jl,3,3,"p",3),de(12,"async"),O(),R(13,"mat-card-actions")(14,"input",4,0),Ht("change",function(r){return Nt(s),Bt(i.onFileSelected(r))}),O(),R(16,"button",5),Ht("click",function(){Nt(s);let r=Ne(15);return Bt(r.click())}),R(17,"mat-icon"),ct(18,"upload_file"),O(),ct(19," Select PDF "),O(),R(20,"button",6),de(21,"async"),de(22,"async"),Ht("click",function(){return Nt(s),Bt(i.splitPdf())}),R(23,"mat-icon"),ct(24,"call_split"),O(),ct(25," Split PDF "),O()()()}if(t&2){let s,n,r;H(9),st("ngIf",(s=he(10,3,i.state$))==null?null:s.selectedFile),H(2),st("ngIf",(n=he(12,5,i.state$))==null?null:n.error),H(9),st("disabled",!((r=he(21,7,i.state$))!=null&&r.selectedFile)||((r=he(22,9,i.state$))==null?null:r.isProcessing))}},dependencies:[Zt,Ai,Or,ha,la,ca,da,Si,Yr,Ti,Ei,Pi,ea,ra,oa,sa,aa,na,ia,oo,ao,fa,pa,ua,ma,_a,ga,Ie],styles:["mat-card[_ngcontent-%COMP%]{max-width:600px;margin:20px auto}mat-card-actions[_ngcontent-%COMP%]{display:flex;gap:8px;padding:16px}.file-info[_ngcontent-%COMP%]{padding:16px}.error-message[_ngcontent-%COMP%]{color:var(--mat-warn-500);padding:8px 16px}.names-input[_ngcontent-%COMP%]{width:100%;margin:16px 0}"]})};var hi=class o{static \u0275fac=function(t){return new(t||o)};static \u0275cmp=Z({type:o,selectors:[["app-pdf-tools"]],decls:1,vars:0,template:function(t,i){t&1&&J(0,"app-pdf-splitter")},dependencies:[Le],encapsulation:2})};var co=class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=gt({type:o});static \u0275inj=ft({imports:[Zt,Fr.forChild([{path:"",component:hi}]),Ie,Le,hi]})};export{co as PdfToolsModule};
