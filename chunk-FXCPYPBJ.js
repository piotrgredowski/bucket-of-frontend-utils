import{d as As,e as ja,f as Va,g as De,h as Re,i as Ga,j as Ua,k as xs,l as we,o as vi}from"./chunk-WP6FF7MB.js";import{a as ir,b as sr,c as dr,d as hr}from"./chunk-J6FNEUSQ.js";import{A as cr,b as Za,f as Ja,i as tr,p as er,r as nr,s as ar,w as rr,x as or,z as lr}from"./chunk-DD4DSKAS.js";import{$ as di,$a as oe,$b as fi,Ab as Sa,Bb as mi,D as oi,Da as B,Ea as j,Fa as _t,Fb as Pe,Ha as re,Ia as ba,Ib as Ea,J as ge,Ja as It,K as Et,Ka as Dt,Kb as pi,L as yt,La as bs,Lb as ye,Ma as qt,Mb as Ie,Mc as $a,N as I,Na as be,Nc as Wa,Oa as Le,Oc as qa,P as li,Pa as Rt,Pc as Xa,Q as Tt,Qa as Ot,Qb as Ta,Qc as Ya,R as Mt,Rb as Ma,Rc as Ka,Sc as Qa,Ta as vs,Tc as yi,U as ie,Ua as at,V as se,Wa as ve,Wb as La,X as gs,Xa as va,Xb as Pa,Y as ci,Ya as ya,Z as ne,Za as wa,Zb as Ia,_a as Aa,_b as Da,a as X,ab as le,ac as ws,b as Wt,ca as ga,cb as ys,cc as Yt,da as hi,ea as Q,fa as _e,fc as Ra,g as ee,ga as _a,gc as Oa,h as k,hc as Fa,ia as _s,jc as Na,kb as xa,kc as Ba,l as ma,n as St,nb as Ca,o as pa,oa as nt,ob as ui,pa as Lt,qa as Pt,qb as ka,r as fa,ra as Ht,rb as Xt,t as ni,ta as gt,tc as Ha,vc as za,w as ai,wa as zt,wc as gi,x as Me,xa as lt,xc as _i,yc as bi,z as ri,za as ae}from"./chunk-WU3Y37UP.js";function Jr(o,e){}var Kt=class{viewContainerRef;injector;id;role="dialog";panelClass="";hasBackdrop=!0;backdropClass="";disableClose=!1;width="";height="";minWidth;minHeight;maxWidth;maxHeight;positionStrategy;data=null;direction;ariaDescribedBy=null;ariaLabelledBy=null;ariaLabel=null;ariaModal=!0;autoFocus="first-tabbable";restoreFocus=!0;scrollStrategy;closeOnNavigation=!0;closeOnDestroy=!0;closeOnOverlayDetachments=!0;componentFactoryResolver;providers;container;templateContext};var Ss=(()=>{class o extends Va{_elementRef=I(ne);_focusTrapFactory=I(Pa);_config;_interactivityChecker=I(La);_ngZone=I(ci);_overlayRef=I(xs);_focusMonitor=I(Ia);_renderer=I(_s);_platform=I(mi);_document=I(xa,{optional:!0});_portalOutlet;_focusTrap=null;_elementFocusedBeforeDialogWasOpened=null;_closeInteractionType=null;_ariaLabelledByQueue=[];_changeDetectorRef=I(ys);_injector=I(se);_isDestroyed=!1;constructor(){super(),this._config=I(Kt,{optional:!0})||new Kt,this._config.ariaLabelledBy&&this._ariaLabelledByQueue.push(this._config.ariaLabelledBy)}_addAriaLabelledBy(t){this._ariaLabelledByQueue.push(t),this._changeDetectorRef.markForCheck()}_removeAriaLabelledBy(t){let i=this._ariaLabelledByQueue.indexOf(t);i>-1&&(this._ariaLabelledByQueue.splice(i,1),this._changeDetectorRef.markForCheck())}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._isDestroyed=!0,this._restoreFocus()}attachComponentPortal(t){this._portalOutlet.hasAttached();let i=this._portalOutlet.attachComponentPortal(t);return this._contentAttached(),i}attachTemplatePortal(t){this._portalOutlet.hasAttached();let i=this._portalOutlet.attachTemplatePortal(t);return this._contentAttached(),i}attachDomPortal=t=>{this._portalOutlet.hasAttached();let i=this._portalOutlet.attachDomPortal(t);return this._contentAttached(),i};_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(t,i){this._interactivityChecker.isFocusable(t)||(t.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{let s=()=>{n(),a(),t.removeAttribute("tabindex")},n=this._renderer.listen(t,"blur",s),a=this._renderer.listen(t,"mousedown",s)})),t.focus(i)}_focusByCssSelector(t,i){let s=this._elementRef.nativeElement.querySelector(t);s&&this._forceFocus(s,i)}_trapFocus(){this._isDestroyed||ga(()=>{let t=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||t.focus();break;case!0:case"first-tabbable":this._focusTrap?.focusInitialElement()||this._focusDialogContainer();break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus);break}},{injector:this._injector})}_restoreFocus(){let t=this._config.restoreFocus,i=null;if(typeof t=="string"?i=this._document.querySelector(t):typeof t=="boolean"?i=t?this._elementFocusedBeforeDialogWasOpened:null:t&&(i=t),this._config.restoreFocus&&i&&typeof i.focus=="function"){let s=Pe(),n=this._elementRef.nativeElement;(!s||s===this._document.body||s===n||n.contains(s))&&(this._focusMonitor?(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null):i.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){let t=this._elementRef.nativeElement,i=Pe();return t===i||t.contains(i)}_initializeFocusTrap(){this._platform.isBrowser&&(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=Pe()))}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}static \u0275fac=function(i){return new(i||o)};static \u0275cmp=nt({type:o,selectors:[["cdk-dialog-container"]],viewQuery:function(i,s){if(i&1&&Le(De,7),i&2){let n;Rt(n=Ot())&&(s._portalOutlet=n.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(i,s){i&2&&zt("id",s._config.id||null)("role",s._config.role)("aria-modal",s._config.ariaModal)("aria-labelledby",s._config.ariaLabel?null:s._ariaLabelledByQueue[0])("aria-label",s._config.ariaLabel)("aria-describedby",s._config.ariaDescribedBy||null)},features:[Ht],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(i,s){i&1&&gt(0,Jr,0,0,"ng-template",0)},dependencies:[De],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2})}return o})(),Oe=class{overlayRef;config;componentInstance;componentRef;containerInstance;disableClose;closed=new St;backdropClick;keydownEvents;outsidePointerEvents;id;_detachSubscription;constructor(e,t){this.overlayRef=e,this.config=t,this.disableClose=t.disableClose,this.backdropClick=e.backdropClick(),this.keydownEvents=e.keydownEvents(),this.outsidePointerEvents=e.outsidePointerEvents(),this.id=t.id,this.keydownEvents.subscribe(i=>{i.keyCode===27&&!this.disableClose&&!pi(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})}),this._detachSubscription=e.detachments().subscribe(()=>{t.closeOnOverlayDetachments!==!1&&this.close()})}close(e,t){if(this.containerInstance){let i=this.closed;this.containerInstance._closeInteractionType=t?.focusOrigin||"program",this._detachSubscription.unsubscribe(),this.overlayRef.dispose(),i.next(e),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(e="",t=""){return this.overlayRef.updateSize({width:e,height:t}),this}addPanelClass(e){return this.overlayRef.addPanelClass(e),this}removePanelClass(e){return this.overlayRef.removePanelClass(e),this}},to=new yt("DialogScrollStrategy",{providedIn:"root",factory:()=>{let o=I(we);return()=>o.scrollStrategies.block()}}),eo=new yt("DialogData"),io=new yt("DefaultDialogConfig");var Es=(()=>{class o{_overlay=I(we);_injector=I(se);_defaultOptions=I(io,{optional:!0});_parentDialog=I(o,{optional:!0,skipSelf:!0});_overlayContainer=I(Ua);_idGenerator=I(fi);_openDialogsAtThisLevel=[];_afterAllClosedAtThisLevel=new St;_afterOpenedAtThisLevel=new St;_ariaHiddenElements=new Map;_scrollStrategy=I(to);get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}afterAllClosed=ni(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(oi(void 0)));constructor(){}open(t,i){let s=this._defaultOptions||new Kt;i=X(X({},s),i),i.id=i.id||this._idGenerator.getId("cdk-dialog-"),i.id&&this.getDialogById(i.id);let n=this._getOverlayConfig(i),a=this._overlay.create(n),r=new Oe(a,i),l=this._attachContainer(a,r,i);return r.containerInstance=l,this._attachDialogContent(t,r,l,i),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(r),r.closed.subscribe(()=>this._removeOpenDialog(r,!0)),this.afterOpened.next(r),r}closeAll(){Cs(this.openDialogs,t=>t.close())}getDialogById(t){return this.openDialogs.find(i=>i.id===t)}ngOnDestroy(){Cs(this._openDialogsAtThisLevel,t=>{t.config.closeOnDestroy===!1&&this._removeOpenDialog(t,!1)}),Cs(this._openDialogsAtThisLevel,t=>t.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(t){let i=new Ga({positionStrategy:t.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:t.scrollStrategy||this._scrollStrategy(),panelClass:t.panelClass,hasBackdrop:t.hasBackdrop,direction:t.direction,minWidth:t.minWidth,minHeight:t.minHeight,maxWidth:t.maxWidth,maxHeight:t.maxHeight,width:t.width,height:t.height,disposeOnNavigation:t.closeOnNavigation});return t.backdropClass&&(i.backdropClass=t.backdropClass),i}_attachContainer(t,i,s){let n=s.injector||s.viewContainerRef?.injector,a=[{provide:Kt,useValue:s},{provide:Oe,useValue:i},{provide:xs,useValue:t}],r;s.container?typeof s.container=="function"?r=s.container:(r=s.container.type,a.push(...s.container.providers(s))):r=Ss;let l=new As(r,s.viewContainerRef,se.create({parent:n||this._injector,providers:a}));return t.attach(l).instance}_attachDialogContent(t,i,s,n){if(t instanceof _a){let a=this._createInjector(n,i,s,void 0),r={$implicit:n.data,dialogRef:i};n.templateContext&&(r=X(X({},r),typeof n.templateContext=="function"?n.templateContext():n.templateContext)),s.attachTemplatePortal(new ja(t,null,r,a))}else{let a=this._createInjector(n,i,s,this._injector),r=s.attachComponentPortal(new As(t,n.viewContainerRef,a));i.componentRef=r,i.componentInstance=r.instance}}_createInjector(t,i,s,n){let a=t.injector||t.viewContainerRef?.injector,r=[{provide:eo,useValue:t.data},{provide:Oe,useValue:i}];return t.providers&&(typeof t.providers=="function"?r.push(...t.providers(i,t,s)):r.push(...t.providers)),t.direction&&(!a||!a.get(ws,null,{optional:!0}))&&r.push({provide:ws,useValue:{value:t.direction,change:fa()}}),se.create({parent:a||n,providers:r})}_removeOpenDialog(t,i){let s=this.openDialogs.indexOf(t);s>-1&&(this.openDialogs.splice(s,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((n,a)=>{n?a.setAttribute("aria-hidden",n):a.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),i&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){let t=this._overlayContainer.getContainerElement();if(t.parentElement){let i=t.parentElement.children;for(let s=i.length-1;s>-1;s--){let n=i[s];n!==t&&n.nodeName!=="SCRIPT"&&n.nodeName!=="STYLE"&&!n.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(n,n.getAttribute("aria-hidden")),n.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){let t=this._parentDialog;return t?t._getAfterAllClosed():this._afterAllClosedAtThisLevel}static \u0275fac=function(i){return new(i||o)};static \u0275prov=ge({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();function Cs(o,e){let t=o.length;for(;t--;)e(o[t])}var ur=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=Lt({type:o});static \u0275inj=Et({providers:[Es],imports:[vi,Re,Da,Re]})}return o})();function so(o,e){}var Ai=class{viewContainerRef;injector;id;role="dialog";panelClass="";hasBackdrop=!0;backdropClass="";disableClose=!1;width="";height="";minWidth;minHeight;maxWidth;maxHeight;position;data=null;direction;ariaDescribedBy=null;ariaLabelledBy=null;ariaLabel=null;ariaModal=!0;autoFocus="first-tabbable";restoreFocus=!0;delayFocusTrap=!0;scrollStrategy;closeOnNavigation=!0;componentFactoryResolver;enterAnimationDuration;exitAnimationDuration},Ts="mdc-dialog--open",mr="mdc-dialog--opening",pr="mdc-dialog--closing",no=150,ao=75,ro=(()=>{class o extends Ss{_animationMode=I(di,{optional:!0});_animationStateChanged=new gs;_animationsEnabled=this._animationMode!=="NoopAnimations";_actionSectionCount=0;_hostElement=this._elementRef.nativeElement;_enterAnimationDuration=this._animationsEnabled?gr(this._config.enterAnimationDuration)??no:0;_exitAnimationDuration=this._animationsEnabled?gr(this._config.exitAnimationDuration)??ao:0;_animationTimer=null;_contentAttached(){super._contentAttached(),this._startOpenAnimation()}_startOpenAnimation(){this._animationStateChanged.emit({state:"opening",totalTime:this._enterAnimationDuration}),this._animationsEnabled?(this._hostElement.style.setProperty(fr,`${this._enterAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(mr,Ts)),this._waitForAnimationToComplete(this._enterAnimationDuration,this._finishDialogOpen)):(this._hostElement.classList.add(Ts),Promise.resolve().then(()=>this._finishDialogOpen()))}_startExitAnimation(){this._animationStateChanged.emit({state:"closing",totalTime:this._exitAnimationDuration}),this._hostElement.classList.remove(Ts),this._animationsEnabled?(this._hostElement.style.setProperty(fr,`${this._exitAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(pr)),this._waitForAnimationToComplete(this._exitAnimationDuration,this._finishDialogClose)):Promise.resolve().then(()=>this._finishDialogClose())}_updateActionSectionCount(t){this._actionSectionCount+=t,this._changeDetectorRef.markForCheck()}_finishDialogOpen=()=>{this._clearAnimationClasses(),this._openAnimationDone(this._enterAnimationDuration)};_finishDialogClose=()=>{this._clearAnimationClasses(),this._animationStateChanged.emit({state:"closed",totalTime:this._exitAnimationDuration})};_clearAnimationClasses(){this._hostElement.classList.remove(mr,pr)}_waitForAnimationToComplete(t,i){this._animationTimer!==null&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(i,t)}_requestAnimationFrame(t){this._ngZone.runOutsideAngular(()=>{typeof requestAnimationFrame=="function"?requestAnimationFrame(t):t()})}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_openAnimationDone(t){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:t})}ngOnDestroy(){super.ngOnDestroy(),this._animationTimer!==null&&clearTimeout(this._animationTimer)}attachComponentPortal(t){let i=super.attachComponentPortal(t);return i.location.nativeElement.classList.add("mat-mdc-dialog-component-host"),i}static \u0275fac=(()=>{let t;return function(s){return(t||(t=ie(o)))(s||o)}})();static \u0275cmp=nt({type:o,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1",1,"mat-mdc-dialog-container","mdc-dialog"],hostVars:10,hostBindings:function(i,s){i&2&&(ba("id",s._config.id),zt("aria-modal",s._config.ariaModal)("role",s._config.role)("aria-labelledby",s._config.ariaLabel?null:s._ariaLabelledByQueue[0])("aria-label",s._config.ariaLabel)("aria-describedby",s._config.ariaDescribedBy||null),ae("_mat-animation-noopable",!s._animationsEnabled)("mat-mdc-dialog-container-with-actions",s._actionSectionCount>0))},features:[Ht],decls:3,vars:0,consts:[[1,"mat-mdc-dialog-inner-container","mdc-dialog__container"],[1,"mat-mdc-dialog-surface","mdc-dialog__surface"],["cdkPortalOutlet",""]],template:function(i,s){i&1&&(B(0,"div",0)(1,"div",1),gt(2,so,0,0,"ng-template",2),j()())},dependencies:[De],styles:['.mat-mdc-dialog-container{width:100%;height:100%;display:block;box-sizing:border-box;max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit;outline:0}.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-max-width, 560px);min-width:var(--mat-dialog-container-min-width, 280px)}@media(max-width: 599px){.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-small-max-width, calc(100vw - 32px))}}.mat-mdc-dialog-inner-container{display:flex;flex-direction:row;align-items:center;justify-content:space-around;box-sizing:border-box;height:100%;opacity:0;transition:opacity linear var(--mat-dialog-transition-duration, 0ms);max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit}.mdc-dialog--closing .mat-mdc-dialog-inner-container{transition:opacity 75ms linear;transform:none}.mdc-dialog--open .mat-mdc-dialog-inner-container{opacity:1}._mat-animation-noopable .mat-mdc-dialog-inner-container{transition:none}.mat-mdc-dialog-surface{display:flex;flex-direction:column;flex-grow:0;flex-shrink:0;box-sizing:border-box;width:100%;height:100%;position:relative;overflow-y:auto;outline:0;transform:scale(0.8);transition:transform var(--mat-dialog-transition-duration, 0ms) cubic-bezier(0, 0, 0.2, 1);max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit;box-shadow:var(--mat-dialog-container-elevation-shadow, none);border-radius:var(--mdc-dialog-container-shape, var(--mat-sys-corner-extra-large, 4px));background-color:var(--mdc-dialog-container-color, var(--mat-sys-surface, white))}[dir=rtl] .mat-mdc-dialog-surface{text-align:right}.mdc-dialog--open .mat-mdc-dialog-surface,.mdc-dialog--closing .mat-mdc-dialog-surface{transform:none}._mat-animation-noopable .mat-mdc-dialog-surface{transition:none}.mat-mdc-dialog-surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:2px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}.mat-mdc-dialog-title{display:block;position:relative;flex-shrink:0;box-sizing:border-box;margin:0 0 1px;padding:var(--mat-dialog-headline-padding, 6px 24px 13px)}.mat-mdc-dialog-title::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}[dir=rtl] .mat-mdc-dialog-title{text-align:right}.mat-mdc-dialog-container .mat-mdc-dialog-title{color:var(--mdc-dialog-subhead-color, var(--mat-sys-on-surface, rgba(0, 0, 0, 0.87)));font-family:var(--mdc-dialog-subhead-font, var(--mat-sys-headline-small-font, inherit));line-height:var(--mdc-dialog-subhead-line-height, var(--mat-sys-headline-small-line-height, 1.5rem));font-size:var(--mdc-dialog-subhead-size, var(--mat-sys-headline-small-size, 1rem));font-weight:var(--mdc-dialog-subhead-weight, var(--mat-sys-headline-small-weight, 400));letter-spacing:var(--mdc-dialog-subhead-tracking, var(--mat-sys-headline-small-tracking, 0.03125em))}.mat-mdc-dialog-content{display:block;flex-grow:1;box-sizing:border-box;margin:0;overflow:auto;max-height:65vh}.mat-mdc-dialog-content>:first-child{margin-top:0}.mat-mdc-dialog-content>:last-child{margin-bottom:0}.mat-mdc-dialog-container .mat-mdc-dialog-content{color:var(--mdc-dialog-supporting-text-color, var(--mat-sys-on-surface-variant, rgba(0, 0, 0, 0.6)));font-family:var(--mdc-dialog-supporting-text-font, var(--mat-sys-body-medium-font, inherit));line-height:var(--mdc-dialog-supporting-text-line-height, var(--mat-sys-body-medium-line-height, 1.5rem));font-size:var(--mdc-dialog-supporting-text-size, var(--mat-sys-body-medium-size, 1rem));font-weight:var(--mdc-dialog-supporting-text-weight, var(--mat-sys-body-medium-weight, 400));letter-spacing:var(--mdc-dialog-supporting-text-tracking, var(--mat-sys-body-medium-tracking, 0.03125em))}.mat-mdc-dialog-container .mat-mdc-dialog-content{padding:var(--mat-dialog-content-padding, 20px 24px)}.mat-mdc-dialog-container-with-actions .mat-mdc-dialog-content{padding:var(--mat-dialog-with-actions-content-padding, 20px 24px 0)}.mat-mdc-dialog-container .mat-mdc-dialog-title+.mat-mdc-dialog-content{padding-top:0}.mat-mdc-dialog-actions{display:flex;position:relative;flex-shrink:0;flex-wrap:wrap;align-items:center;justify-content:flex-end;box-sizing:border-box;min-height:52px;margin:0;padding:8px;border-top:1px solid rgba(0,0,0,0);padding:var(--mat-dialog-actions-padding, 16px 24px);justify-content:var(--mat-dialog-actions-alignment, flex-end)}@media(forced-colors: active){.mat-mdc-dialog-actions{border-top-color:CanvasText}}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-start,.mat-mdc-dialog-actions[align=start]{justify-content:start}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-center,.mat-mdc-dialog-actions[align=center]{justify-content:center}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-end,.mat-mdc-dialog-actions[align=end]{justify-content:flex-end}.mat-mdc-dialog-actions .mat-button-base+.mat-button-base,.mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-mdc-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}.mat-mdc-dialog-component-host{display:contents}'],encapsulation:2})}return o})(),fr="--mat-dialog-transition-duration";function gr(o){return o==null?null:typeof o=="number"?o:o.endsWith("ms")?Ie(o.substring(0,o.length-2)):o.endsWith("s")?Ie(o.substring(0,o.length-1))*1e3:o==="0"?0:null}var wi=function(o){return o[o.OPEN=0]="OPEN",o[o.CLOSING=1]="CLOSING",o[o.CLOSED=2]="CLOSED",o}(wi||{}),Ms=class{_ref;_containerInstance;componentInstance;componentRef;disableClose;id;_afterOpened=new St;_beforeClosed=new St;_result;_closeFallbackTimeout;_state=wi.OPEN;_closeInteractionType;constructor(e,t,i){this._ref=e,this._containerInstance=i,this.disableClose=t.disableClose,this.id=e.id,e.addPanelClass("mat-mdc-dialog-panel"),i._animationStateChanged.pipe(Me(s=>s.state==="opened"),ri(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),i._animationStateChanged.pipe(Me(s=>s.state==="closed"),ri(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),e.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),ai(this.backdropClick(),this.keydownEvents().pipe(Me(s=>s.keyCode===27&&!this.disableClose&&!pi(s)))).subscribe(s=>{this.disableClose||(s.preventDefault(),oo(this,s.type==="keydown"?"keyboard":"mouse"))})}close(e){this._result=e,this._containerInstance._animationStateChanged.pipe(Me(t=>t.state==="closing"),ri(1)).subscribe(t=>{this._beforeClosed.next(e),this._beforeClosed.complete(),this._ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),t.totalTime+100)}),this._state=wi.CLOSING,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}updatePosition(e){let t=this._ref.config.positionStrategy;return e&&(e.left||e.right)?e.left?t.left(e.left):t.right(e.right):t.centerHorizontally(),e&&(e.top||e.bottom)?e.top?t.top(e.top):t.bottom(e.bottom):t.centerVertically(),this._ref.updatePosition(),this}updateSize(e="",t=""){return this._ref.updateSize(e,t),this}addPanelClass(e){return this._ref.addPanelClass(e),this}removePanelClass(e){return this._ref.removePanelClass(e),this}getState(){return this._state}_finishDialogClose(){this._state=wi.CLOSED,this._ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}};function oo(o,e,t){return o._closeInteractionType=e,o.close(t)}var Ls=new yt("MatMdcDialogData"),lo=new yt("mat-mdc-dialog-default-options"),co=new yt("mat-mdc-dialog-scroll-strategy",{providedIn:"root",factory:()=>{let o=I(we);return()=>o.scrollStrategies.block()}});var Ps=(()=>{class o{_overlay=I(we);_defaultOptions=I(lo,{optional:!0});_scrollStrategy=I(co);_parentDialog=I(o,{optional:!0,skipSelf:!0});_idGenerator=I(fi);_dialog=I(Es);_openDialogsAtThisLevel=[];_afterAllClosedAtThisLevel=new St;_afterOpenedAtThisLevel=new St;dialogConfigClass=Ai;_dialogRefConstructor;_dialogContainerType;_dialogDataToken;get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){let t=this._parentDialog;return t?t._getAfterAllClosed():this._afterAllClosedAtThisLevel}afterAllClosed=ni(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(oi(void 0)));constructor(){this._dialogRefConstructor=Ms,this._dialogContainerType=ro,this._dialogDataToken=Ls}open(t,i){let s;i=X(X({},this._defaultOptions||new Ai),i),i.id=i.id||this._idGenerator.getId("mat-mdc-dialog-"),i.scrollStrategy=i.scrollStrategy||this._scrollStrategy();let n=this._dialog.open(t,Wt(X({},i),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,closeOnOverlayDetachments:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:this.dialogConfigClass,useValue:i},{provide:Kt,useValue:i}]},templateContext:()=>({dialogRef:s}),providers:(a,r,l)=>(s=new this._dialogRefConstructor(a,i,l),s.updatePosition(i?.position),[{provide:this._dialogContainerType,useValue:l},{provide:this._dialogDataToken,useValue:r.data},{provide:this._dialogRefConstructor,useValue:s}])}));return s.componentRef=n.componentRef,s.componentInstance=n.componentInstance,this.openDialogs.push(s),this.afterOpened.next(s),s.afterClosed().subscribe(()=>{let a=this.openDialogs.indexOf(s);a>-1&&(this.openDialogs.splice(a,1),this.openDialogs.length||this._getAfterAllClosed().next())}),s}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(t){return this.openDialogs.find(i=>i.id===t)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(t){let i=t.length;for(;i--;)t[i].close()}static \u0275fac=function(i){return new(i||o)};static \u0275prov=ge({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var xi=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=Lt({type:o});static \u0275inj=Et({providers:[Ps],imports:[ur,vi,Re,Yt,Yt]})}return o})();var _r=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=Lt({type:o});static \u0275inj=Et({imports:[Yt,Yt]})}return o})();var uo=["*"],mo='.mdc-list{margin:0;padding:8px 0;list-style-type:none}.mdc-list:focus{outline:none}.mdc-list-item{display:flex;position:relative;justify-content:flex-start;overflow:hidden;padding:0;align-items:stretch;cursor:pointer;padding-left:16px;padding-right:16px;background-color:var(--mdc-list-list-item-container-color, transparent);border-radius:var(--mdc-list-list-item-container-shape, var(--mat-sys-corner-none))}.mdc-list-item.mdc-list-item--selected{background-color:var(--mdc-list-list-item-selected-container-color)}.mdc-list-item:focus{outline:0}.mdc-list-item.mdc-list-item--disabled{cursor:auto}.mdc-list-item.mdc-list-item--with-one-line{height:var(--mdc-list-list-item-one-line-container-height, 48px)}.mdc-list-item.mdc-list-item--with-one-line .mdc-list-item__start{align-self:center;margin-top:0}.mdc-list-item.mdc-list-item--with-one-line .mdc-list-item__end{align-self:center;margin-top:0}.mdc-list-item.mdc-list-item--with-two-lines{height:var(--mdc-list-list-item-two-line-container-height, 64px)}.mdc-list-item.mdc-list-item--with-two-lines .mdc-list-item__start{align-self:flex-start;margin-top:16px}.mdc-list-item.mdc-list-item--with-two-lines .mdc-list-item__end{align-self:center;margin-top:0}.mdc-list-item.mdc-list-item--with-three-lines{height:var(--mdc-list-list-item-three-line-container-height, 88px)}.mdc-list-item.mdc-list-item--with-three-lines .mdc-list-item__start{align-self:flex-start;margin-top:16px}.mdc-list-item.mdc-list-item--with-three-lines .mdc-list-item__end{align-self:flex-start;margin-top:16px}.mdc-list-item.mdc-list-item--selected::before,.mdc-list-item.mdc-list-item--selected:focus::before,.mdc-list-item:not(.mdc-list-item--selected):focus::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;content:"";pointer-events:none}a.mdc-list-item{color:inherit;text-decoration:none}.mdc-list-item__start{fill:currentColor;flex-shrink:0;pointer-events:none}.mdc-list-item--with-leading-icon .mdc-list-item__start{color:var(--mdc-list-list-item-leading-icon-color, var(--mat-sys-on-surface-variant));width:var(--mdc-list-list-item-leading-icon-size, 24px);height:var(--mdc-list-list-item-leading-icon-size, 24px);margin-left:16px;margin-right:32px}[dir=rtl] .mdc-list-item--with-leading-icon .mdc-list-item__start{margin-left:32px;margin-right:16px}.mdc-list-item--with-leading-icon:hover .mdc-list-item__start{color:var(--mdc-list-list-item-hover-leading-icon-color)}.mdc-list-item--with-leading-avatar .mdc-list-item__start{width:var(--mdc-list-list-item-leading-avatar-size, 40px);height:var(--mdc-list-list-item-leading-avatar-size, 40px);margin-left:16px;margin-right:16px;border-radius:50%}.mdc-list-item--with-leading-avatar .mdc-list-item__start,[dir=rtl] .mdc-list-item--with-leading-avatar .mdc-list-item__start{margin-left:16px;margin-right:16px;border-radius:50%}.mdc-list-item__end{flex-shrink:0;pointer-events:none}.mdc-list-item--with-trailing-meta .mdc-list-item__end{font-family:var(--mdc-list-list-item-trailing-supporting-text-font, var(--mat-sys-label-small-font));line-height:var(--mdc-list-list-item-trailing-supporting-text-line-height, var(--mat-sys-label-small-line-height));font-size:var(--mdc-list-list-item-trailing-supporting-text-size, var(--mat-sys-label-small-size));font-weight:var(--mdc-list-list-item-trailing-supporting-text-weight, var(--mat-sys-label-small-weight));letter-spacing:var(--mdc-list-list-item-trailing-supporting-text-tracking, var(--mat-sys-label-small-tracking))}.mdc-list-item--with-trailing-icon .mdc-list-item__end{color:var(--mdc-list-list-item-trailing-icon-color, var(--mat-sys-on-surface-variant));width:var(--mdc-list-list-item-trailing-icon-size, 24px);height:var(--mdc-list-list-item-trailing-icon-size, 24px)}.mdc-list-item--with-trailing-icon:hover .mdc-list-item__end{color:var(--mdc-list-list-item-hover-trailing-icon-color)}.mdc-list-item.mdc-list-item--with-trailing-meta .mdc-list-item__end{color:var(--mdc-list-list-item-trailing-supporting-text-color, var(--mat-sys-on-surface-variant))}.mdc-list-item--selected.mdc-list-item--with-trailing-icon .mdc-list-item__end{color:var(--mdc-list-list-item-selected-trailing-icon-color, var(--mat-sys-primary))}.mdc-list-item__content{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;align-self:center;flex:1;pointer-events:none}.mdc-list-item--with-two-lines .mdc-list-item__content,.mdc-list-item--with-three-lines .mdc-list-item__content{align-self:stretch}.mdc-list-item__primary-text{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;color:var(--mdc-list-list-item-label-text-color, var(--mat-sys-on-surface));font-family:var(--mdc-list-list-item-label-text-font, var(--mat-sys-body-large-font));line-height:var(--mdc-list-list-item-label-text-line-height, var(--mat-sys-body-large-line-height));font-size:var(--mdc-list-list-item-label-text-size, var(--mat-sys-body-large-size));font-weight:var(--mdc-list-list-item-label-text-weight, var(--mat-sys-body-large-weight));letter-spacing:var(--mdc-list-list-item-label-text-tracking, var(--mat-sys-body-large-tracking))}.mdc-list-item:hover .mdc-list-item__primary-text{color:var(--mdc-list-list-item-hover-label-text-color, var(--mat-sys-on-surface))}.mdc-list-item:focus .mdc-list-item__primary-text{color:var(--mdc-list-list-item-focus-label-text-color, var(--mat-sys-on-surface))}.mdc-list-item--with-two-lines .mdc-list-item__primary-text,.mdc-list-item--with-three-lines .mdc-list-item__primary-text{display:block;margin-top:0;line-height:normal;margin-bottom:-20px}.mdc-list-item--with-two-lines .mdc-list-item__primary-text::before,.mdc-list-item--with-three-lines .mdc-list-item__primary-text::before{display:inline-block;width:0;height:28px;content:"";vertical-align:0}.mdc-list-item--with-two-lines .mdc-list-item__primary-text::after,.mdc-list-item--with-three-lines .mdc-list-item__primary-text::after{display:inline-block;width:0;height:20px;content:"";vertical-align:-20px}.mdc-list-item__secondary-text{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;display:block;margin-top:0;color:var(--mdc-list-list-item-supporting-text-color, var(--mat-sys-on-surface-variant));font-family:var(--mdc-list-list-item-supporting-text-font, var(--mat-sys-body-medium-font));line-height:var(--mdc-list-list-item-supporting-text-line-height, var(--mat-sys-body-medium-line-height));font-size:var(--mdc-list-list-item-supporting-text-size, var(--mat-sys-body-medium-size));font-weight:var(--mdc-list-list-item-supporting-text-weight, var(--mat-sys-body-medium-weight));letter-spacing:var(--mdc-list-list-item-supporting-text-tracking, var(--mat-sys-body-medium-tracking))}.mdc-list-item__secondary-text::before{display:inline-block;width:0;height:20px;content:"";vertical-align:0}.mdc-list-item--with-three-lines .mdc-list-item__secondary-text{white-space:normal;line-height:20px}.mdc-list-item--with-overline .mdc-list-item__secondary-text{white-space:nowrap;line-height:auto}.mdc-list-item--with-leading-radio.mdc-list-item,.mdc-list-item--with-leading-checkbox.mdc-list-item,.mdc-list-item--with-leading-icon.mdc-list-item,.mdc-list-item--with-leading-avatar.mdc-list-item{padding-left:0;padding-right:16px}[dir=rtl] .mdc-list-item--with-leading-radio.mdc-list-item,[dir=rtl] .mdc-list-item--with-leading-checkbox.mdc-list-item,[dir=rtl] .mdc-list-item--with-leading-icon.mdc-list-item,[dir=rtl] .mdc-list-item--with-leading-avatar.mdc-list-item{padding-left:16px;padding-right:0}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines .mdc-list-item__primary-text,.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines .mdc-list-item__primary-text,.mdc-list-item--with-leading-icon.mdc-list-item--with-two-lines .mdc-list-item__primary-text,.mdc-list-item--with-leading-avatar.mdc-list-item--with-two-lines .mdc-list-item__primary-text{display:block;margin-top:0;line-height:normal;margin-bottom:-20px}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines .mdc-list-item__primary-text::before,.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines .mdc-list-item__primary-text::before,.mdc-list-item--with-leading-icon.mdc-list-item--with-two-lines .mdc-list-item__primary-text::before,.mdc-list-item--with-leading-avatar.mdc-list-item--with-two-lines .mdc-list-item__primary-text::before{display:inline-block;width:0;height:32px;content:"";vertical-align:0}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines .mdc-list-item__primary-text::after,.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines .mdc-list-item__primary-text::after,.mdc-list-item--with-leading-icon.mdc-list-item--with-two-lines .mdc-list-item__primary-text::after,.mdc-list-item--with-leading-avatar.mdc-list-item--with-two-lines .mdc-list-item__primary-text::after{display:inline-block;width:0;height:20px;content:"";vertical-align:-20px}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end,.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end,.mdc-list-item--with-leading-icon.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end,.mdc-list-item--with-leading-avatar.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end{display:block;margin-top:0;line-height:normal}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end::before,.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end::before,.mdc-list-item--with-leading-icon.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end::before,.mdc-list-item--with-leading-avatar.mdc-list-item--with-two-lines.mdc-list-item--with-trailing-meta .mdc-list-item__end::before{display:inline-block;width:0;height:32px;content:"";vertical-align:0}.mdc-list-item--with-trailing-icon.mdc-list-item,[dir=rtl] .mdc-list-item--with-trailing-icon.mdc-list-item{padding-left:0;padding-right:0}.mdc-list-item--with-trailing-icon .mdc-list-item__end{margin-left:16px;margin-right:16px}.mdc-list-item--with-trailing-meta.mdc-list-item{padding-left:16px;padding-right:0}[dir=rtl] .mdc-list-item--with-trailing-meta.mdc-list-item{padding-left:0;padding-right:16px}.mdc-list-item--with-trailing-meta .mdc-list-item__end{-webkit-user-select:none;user-select:none;margin-left:28px;margin-right:16px}[dir=rtl] .mdc-list-item--with-trailing-meta .mdc-list-item__end{margin-left:16px;margin-right:28px}.mdc-list-item--with-trailing-meta.mdc-list-item--with-three-lines .mdc-list-item__end,.mdc-list-item--with-trailing-meta.mdc-list-item--with-two-lines .mdc-list-item__end{display:block;line-height:normal;align-self:flex-start;margin-top:0}.mdc-list-item--with-trailing-meta.mdc-list-item--with-three-lines .mdc-list-item__end::before,.mdc-list-item--with-trailing-meta.mdc-list-item--with-two-lines .mdc-list-item__end::before{display:inline-block;width:0;height:28px;content:"";vertical-align:0}.mdc-list-item--with-leading-radio .mdc-list-item__start,.mdc-list-item--with-leading-checkbox .mdc-list-item__start{margin-left:8px;margin-right:24px}[dir=rtl] .mdc-list-item--with-leading-radio .mdc-list-item__start,[dir=rtl] .mdc-list-item--with-leading-checkbox .mdc-list-item__start{margin-left:24px;margin-right:8px}.mdc-list-item--with-leading-radio.mdc-list-item--with-two-lines .mdc-list-item__start,.mdc-list-item--with-leading-checkbox.mdc-list-item--with-two-lines .mdc-list-item__start{align-self:flex-start;margin-top:8px}.mdc-list-item--with-trailing-radio.mdc-list-item,.mdc-list-item--with-trailing-checkbox.mdc-list-item{padding-left:16px;padding-right:0}[dir=rtl] .mdc-list-item--with-trailing-radio.mdc-list-item,[dir=rtl] .mdc-list-item--with-trailing-checkbox.mdc-list-item{padding-left:0;padding-right:16px}.mdc-list-item--with-trailing-radio.mdc-list-item--with-leading-icon,.mdc-list-item--with-trailing-radio.mdc-list-item--with-leading-avatar,.mdc-list-item--with-trailing-checkbox.mdc-list-item--with-leading-icon,.mdc-list-item--with-trailing-checkbox.mdc-list-item--with-leading-avatar{padding-left:0}[dir=rtl] .mdc-list-item--with-trailing-radio.mdc-list-item--with-leading-icon,[dir=rtl] .mdc-list-item--with-trailing-radio.mdc-list-item--with-leading-avatar,[dir=rtl] .mdc-list-item--with-trailing-checkbox.mdc-list-item--with-leading-icon,[dir=rtl] .mdc-list-item--with-trailing-checkbox.mdc-list-item--with-leading-avatar{padding-right:0}.mdc-list-item--with-trailing-radio .mdc-list-item__end,.mdc-list-item--with-trailing-checkbox .mdc-list-item__end{margin-left:24px;margin-right:8px}[dir=rtl] .mdc-list-item--with-trailing-radio .mdc-list-item__end,[dir=rtl] .mdc-list-item--with-trailing-checkbox .mdc-list-item__end{margin-left:8px;margin-right:24px}.mdc-list-item--with-trailing-radio.mdc-list-item--with-three-lines .mdc-list-item__end,.mdc-list-item--with-trailing-checkbox.mdc-list-item--with-three-lines .mdc-list-item__end{align-self:flex-start;margin-top:8px}.mdc-list-group__subheader{margin:.75rem 16px}.mdc-list-item--disabled .mdc-list-item__start,.mdc-list-item--disabled .mdc-list-item__content,.mdc-list-item--disabled .mdc-list-item__end{opacity:1}.mdc-list-item--disabled .mdc-list-item__primary-text,.mdc-list-item--disabled .mdc-list-item__secondary-text{opacity:var(--mdc-list-list-item-disabled-label-text-opacity, 0.3)}.mdc-list-item--disabled.mdc-list-item--with-leading-icon .mdc-list-item__start{color:var(--mdc-list-list-item-disabled-leading-icon-color, var(--mat-sys-on-surface));opacity:var(--mdc-list-list-item-disabled-leading-icon-opacity, 0.38)}.mdc-list-item--disabled.mdc-list-item--with-trailing-icon .mdc-list-item__end{color:var(--mdc-list-list-item-disabled-trailing-icon-color, var(--mat-sys-on-surface));opacity:var(--mdc-list-list-item-disabled-trailing-icon-opacity, 0.38)}.mat-mdc-list-item.mat-mdc-list-item-both-leading-and-trailing,[dir=rtl] .mat-mdc-list-item.mat-mdc-list-item-both-leading-and-trailing{padding-left:0;padding-right:0}.mdc-list-item.mdc-list-item--disabled .mdc-list-item__primary-text{color:var(--mdc-list-list-item-disabled-label-text-color, var(--mat-sys-on-surface))}.mdc-list-item:hover::before{background-color:var(--mdc-list-list-item-hover-state-layer-color, var(--mat-sys-on-surface));opacity:var(--mdc-list-list-item-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mdc-list-item.mdc-list-item--disabled::before{background-color:var(--mdc-list-list-item-disabled-state-layer-color, var(--mat-sys-on-surface));opacity:var(--mdc-list-list-item-disabled-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mdc-list-item:focus::before{background-color:var(--mdc-list-list-item-focus-state-layer-color, var(--mat-sys-on-surface));opacity:var(--mdc-list-list-item-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mdc-list-item--disabled .mdc-radio,.mdc-list-item--disabled .mdc-checkbox{opacity:var(--mdc-list-list-item-disabled-label-text-opacity, 0.3)}.mdc-list-item--with-leading-avatar .mat-mdc-list-item-avatar{border-radius:var(--mdc-list-list-item-leading-avatar-shape, var(--mat-sys-corner-full));background-color:var(--mdc-list-list-item-leading-avatar-color, var(--mat-sys-primary-container))}.mat-mdc-list-item-icon{font-size:var(--mdc-list-list-item-leading-icon-size, 24px)}@media(forced-colors: active){a.mdc-list-item--activated::after{content:"";position:absolute;top:50%;right:16px;transform:translateY(-50%);width:10px;height:0;border-bottom:solid 10px;border-radius:10px}a.mdc-list-item--activated [dir=rtl]::after{right:auto;left:16px}}.mat-mdc-list-base{display:block}.mat-mdc-list-base .mdc-list-item__start,.mat-mdc-list-base .mdc-list-item__end,.mat-mdc-list-base .mdc-list-item__content{pointer-events:auto}.mat-mdc-list-item,.mat-mdc-list-option{width:100%;box-sizing:border-box;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-list-item:not(.mat-mdc-list-item-interactive),.mat-mdc-list-option:not(.mat-mdc-list-item-interactive){cursor:default}.mat-mdc-list-item .mat-divider-inset,.mat-mdc-list-option .mat-divider-inset{position:absolute;left:0;right:0;bottom:0}.mat-mdc-list-item .mat-mdc-list-item-avatar~.mat-divider-inset,.mat-mdc-list-option .mat-mdc-list-item-avatar~.mat-divider-inset{margin-left:72px}[dir=rtl] .mat-mdc-list-item .mat-mdc-list-item-avatar~.mat-divider-inset,[dir=rtl] .mat-mdc-list-option .mat-mdc-list-item-avatar~.mat-divider-inset{margin-right:72px}.mat-mdc-list-item-interactive::before{top:0;left:0;right:0;bottom:0;position:absolute;content:"";opacity:0;pointer-events:none;border-radius:inherit}.mat-mdc-list-item>.mat-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-mdc-list-item:focus>.mat-focus-indicator::before{content:""}.mat-mdc-list-item.mdc-list-item--with-three-lines .mat-mdc-list-item-line.mdc-list-item__secondary-text{white-space:nowrap;line-height:normal}.mat-mdc-list-item.mdc-list-item--with-three-lines .mat-mdc-list-item-unscoped-content.mdc-list-item__secondary-text{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2}mat-action-list button{background:none;color:inherit;border:none;font:inherit;outline:inherit;-webkit-tap-highlight-color:rgba(0,0,0,0);text-align:start}mat-action-list button::-moz-focus-inner{border:0}.mdc-list-item--with-leading-icon .mdc-list-item__start{margin-inline-start:var(--mat-list-list-item-leading-icon-start-space, 16px);margin-inline-end:var(--mat-list-list-item-leading-icon-end-space, 16px)}.mat-mdc-nav-list .mat-mdc-list-item{border-radius:var(--mat-list-active-indicator-shape, var(--mat-sys-corner-full));--mat-focus-indicator-border-radius:var(--mat-list-active-indicator-shape, var(--mat-sys-corner-full))}.mat-mdc-nav-list .mat-mdc-list-item.mdc-list-item--activated{background-color:var(--mat-list-active-indicator-color, var(--mat-sys-secondary-container))}',po=["unscopedContent"],fo=["text"],go=[[["","matListItemAvatar",""],["","matListItemIcon",""]],[["","matListItemTitle",""]],[["","matListItemLine",""]],"*",[["","matListItemMeta",""]],[["mat-divider"]]],_o=["[matListItemAvatar],[matListItemIcon]","[matListItemTitle]","[matListItemLine]","*","[matListItemMeta]","mat-divider"];var bo=new yt("ListOption"),Ds=(()=>{class o{_elementRef=I(ne);constructor(){}static \u0275fac=function(i){return new(i||o)};static \u0275dir=Pt({type:o,selectors:[["","matListItemTitle",""]],hostAttrs:[1,"mat-mdc-list-item-title","mdc-list-item__primary-text"]})}return o})(),vo=(()=>{class o{_elementRef=I(ne);constructor(){}static \u0275fac=function(i){return new(i||o)};static \u0275dir=Pt({type:o,selectors:[["","matListItemLine",""]],hostAttrs:[1,"mat-mdc-list-item-line","mdc-list-item__secondary-text"]})}return o})(),Rs=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275dir=Pt({type:o,selectors:[["","matListItemMeta",""]],hostAttrs:[1,"mat-mdc-list-item-meta","mdc-list-item__end"]})}return o})(),br=(()=>{class o{_listOption=I(bo,{optional:!0});constructor(){}_isAlignedAtStart(){return!this._listOption||this._listOption?._getTogglePosition()==="after"}static \u0275fac=function(i){return new(i||o)};static \u0275dir=Pt({type:o,hostVars:4,hostBindings:function(i,s){i&2&&ae("mdc-list-item__start",s._isAlignedAtStart())("mdc-list-item__end",!s._isAlignedAtStart())}})}return o})(),Os=(()=>{class o extends br{static \u0275fac=(()=>{let t;return function(s){return(t||(t=ie(o)))(s||o)}})();static \u0275dir=Pt({type:o,selectors:[["","matListItemAvatar",""]],hostAttrs:[1,"mat-mdc-list-item-avatar"],features:[Ht]})}return o})(),yo=(()=>{class o extends br{static \u0275fac=(()=>{let t;return function(s){return(t||(t=ie(o)))(s||o)}})();static \u0275dir=Pt({type:o,selectors:[["","matListItemIcon",""]],hostAttrs:[1,"mat-mdc-list-item-icon"],features:[Ht]})}return o})(),wo=new yt("MAT_LIST_CONFIG"),Is=(()=>{class o{_isNonInteractive=!0;get disableRipple(){return this._disableRipple}set disableRipple(t){this._disableRipple=ye(t)}_disableRipple=!1;get disabled(){return this._disabled}set disabled(t){this._disabled=ye(t)}_disabled=!1;_defaultOptions=I(wo,{optional:!0});static \u0275fac=function(i){return new(i||o)};static \u0275dir=Pt({type:o,hostVars:1,hostBindings:function(i,s){i&2&&zt("aria-disabled",s.disabled)},inputs:{disableRipple:"disableRipple",disabled:"disabled"}})}return o})(),Ao=(()=>{class o{_elementRef=I(ne);_ngZone=I(ci);_listBase=I(Is,{optional:!0});_platform=I(mi);_hostElement;_isButtonElement;_noopAnimations;_avatars;_icons;set lines(t){this._explicitLines=Ie(t,null),this._updateItemLines(!1)}_explicitLines=null;get disableRipple(){return this.disabled||this._disableRipple||this._noopAnimations||!!this._listBase?.disableRipple}set disableRipple(t){this._disableRipple=ye(t)}_disableRipple=!1;get disabled(){return this._disabled||!!this._listBase?.disabled}set disabled(t){this._disabled=ye(t)}_disabled=!1;_subscriptions=new ma;_rippleRenderer=null;_hasUnscopedTextContent=!1;rippleConfig;get rippleDisabled(){return this.disableRipple||!!this.rippleConfig.disabled}constructor(){I(Ea).load(Ra);let t=I(Fa,{optional:!0}),i=I(di,{optional:!0});this.rippleConfig=t||{},this._hostElement=this._elementRef.nativeElement,this._isButtonElement=this._hostElement.nodeName.toLowerCase()==="button",this._noopAnimations=i==="NoopAnimations",this._listBase&&!this._listBase._isNonInteractive&&this._initInteractiveListItem(),this._isButtonElement&&!this._hostElement.hasAttribute("type")&&this._hostElement.setAttribute("type","button")}ngAfterViewInit(){this._monitorProjectedLinesAndTitle(),this._updateItemLines(!0)}ngOnDestroy(){this._subscriptions.unsubscribe(),this._rippleRenderer!==null&&this._rippleRenderer._removeTriggerEvents()}_hasIconOrAvatar(){return!!(this._avatars.length||this._icons.length)}_initInteractiveListItem(){this._hostElement.classList.add("mat-mdc-list-item-interactive"),this._rippleRenderer=new Oa(this,this._ngZone,this._hostElement,this._platform,I(se)),this._rippleRenderer.setupTriggerEvents(this._hostElement)}_monitorProjectedLinesAndTitle(){this._ngZone.runOutsideAngular(()=>{this._subscriptions.add(ai(this._lines.changes,this._titles.changes).subscribe(()=>this._updateItemLines(!1)))})}_updateItemLines(t){if(!this._lines||!this._titles||!this._unscopedContent)return;t&&this._checkDomForUnscopedTextContent();let i=this._explicitLines??this._inferLinesFromContent(),s=this._unscopedContent.nativeElement;if(this._hostElement.classList.toggle("mat-mdc-list-item-single-line",i<=1),this._hostElement.classList.toggle("mdc-list-item--with-one-line",i<=1),this._hostElement.classList.toggle("mdc-list-item--with-two-lines",i===2),this._hostElement.classList.toggle("mdc-list-item--with-three-lines",i===3),this._hasUnscopedTextContent){let n=this._titles.length===0&&i===1;s.classList.toggle("mdc-list-item__primary-text",n),s.classList.toggle("mdc-list-item__secondary-text",!n)}else s.classList.remove("mdc-list-item__primary-text"),s.classList.remove("mdc-list-item__secondary-text")}_inferLinesFromContent(){let t=this._titles.length+this._lines.length;return this._hasUnscopedTextContent&&(t+=1),t}_checkDomForUnscopedTextContent(){this._hasUnscopedTextContent=Array.from(this._unscopedContent.nativeElement.childNodes).filter(t=>t.nodeType!==t.COMMENT_NODE).some(t=>!!(t.textContent&&t.textContent.trim()))}static \u0275fac=function(i){return new(i||o)};static \u0275dir=Pt({type:o,contentQueries:function(i,s,n){if(i&1&&(be(n,Os,4),be(n,yo,4)),i&2){let a;Rt(a=Ot())&&(s._avatars=a),Rt(a=Ot())&&(s._icons=a)}},hostVars:4,hostBindings:function(i,s){i&2&&(zt("aria-disabled",s.disabled)("disabled",s._isButtonElement&&s.disabled||null),ae("mdc-list-item--disabled",s.disabled))},inputs:{lines:"lines",disableRipple:"disableRipple",disabled:"disabled"}})}return o})();var vr=(()=>{class o extends Is{static \u0275fac=(()=>{let t;return function(s){return(t||(t=ie(o)))(s||o)}})();static \u0275cmp=nt({type:o,selectors:[["mat-list"]],hostAttrs:[1,"mat-mdc-list","mat-mdc-list-base","mdc-list"],exportAs:["matList"],features:[Aa([{provide:Is,useExisting:o}]),Ht],ngContentSelectors:uo,decls:1,vars:0,template:function(i,s){i&1&&(bs(),qt(0))},styles:[mo],encapsulation:2,changeDetection:0})}return o})(),yr=(()=>{class o extends Ao{_lines;_titles;_meta;_unscopedContent;_itemText;get activated(){return this._activated}set activated(t){this._activated=ye(t)}_activated=!1;_getAriaCurrent(){return this._hostElement.nodeName==="A"&&this._activated?"page":null}_hasBothLeadingAndTrailing(){return this._meta.length!==0&&(this._avatars.length!==0||this._icons.length!==0)}static \u0275fac=(()=>{let t;return function(s){return(t||(t=ie(o)))(s||o)}})();static \u0275cmp=nt({type:o,selectors:[["mat-list-item"],["a","mat-list-item",""],["button","mat-list-item",""]],contentQueries:function(i,s,n){if(i&1&&(be(n,vo,5),be(n,Ds,5),be(n,Rs,5)),i&2){let a;Rt(a=Ot())&&(s._lines=a),Rt(a=Ot())&&(s._titles=a),Rt(a=Ot())&&(s._meta=a)}},viewQuery:function(i,s){if(i&1&&(Le(po,5),Le(fo,5)),i&2){let n;Rt(n=Ot())&&(s._unscopedContent=n.first),Rt(n=Ot())&&(s._itemText=n.first)}},hostAttrs:[1,"mat-mdc-list-item","mdc-list-item"],hostVars:13,hostBindings:function(i,s){i&2&&(zt("aria-current",s._getAriaCurrent()),ae("mdc-list-item--activated",s.activated)("mdc-list-item--with-leading-avatar",s._avatars.length!==0)("mdc-list-item--with-leading-icon",s._icons.length!==0)("mdc-list-item--with-trailing-meta",s._meta.length!==0)("mat-mdc-list-item-both-leading-and-trailing",s._hasBothLeadingAndTrailing())("_mat-animation-noopable",s._noopAnimations))},inputs:{activated:"activated"},exportAs:["matListItem"],features:[Ht],ngContentSelectors:_o,decls:10,vars:0,consts:[["unscopedContent",""],[1,"mdc-list-item__content"],[1,"mat-mdc-list-item-unscoped-content",3,"cdkObserveContent"],[1,"mat-focus-indicator"]],template:function(i,s){if(i&1){let n=re();bs(go),qt(0),B(1,"span",1),qt(2,1),qt(3,2),B(4,"span",2,0),It("cdkObserveContent",function(){return Tt(n),Mt(s._updateItemLines(!0))}),qt(6,3),j()(),qt(7,4),qt(8,5),_t(9,"div",3)}},dependencies:[Ta],encapsulation:2,changeDetection:0})}return o})();var wr=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=Lt({type:o});static \u0275inj=Et({imports:[Ma,Yt,Na,Ba,_r]})}return o})();var ze={};ze.d=(o,e)=>{for(var t in e)ze.o(e,t)&&!ze.o(o,t)&&Object.defineProperty(o,t,{enumerable:!0,get:e[t]})};ze.o=(o,e)=>Object.prototype.hasOwnProperty.call(o,e);var P=globalThis.pdfjsLib={};ze.d(P,{AbortException:()=>Ut,AnnotationEditorLayer:()=>yl,AnnotationEditorParamsType:()=>N,AnnotationEditorType:()=>D,AnnotationEditorUIManager:()=>We,AnnotationLayer:()=>Qn,AnnotationMode:()=>Qt,ColorPicker:()=>ss,DOMSVGFactory:()=>Qe,DrawLayer:()=>ra,FeatureTest:()=>st,GlobalWorkerOptions:()=>de,ImageKind:()=>Li,InvalidPDFException:()=>Pi,MissingPDFException:()=>he,OPS:()=>wt,OutputScale:()=>$e,PDFDataRangeTransport:()=>$i,PDFDateString:()=>Di,PDFWorker:()=>Ce,PasswordResponses:()=>To,PermissionFlag:()=>Eo,PixelsPerInch:()=>Jt,RenderingCancelledException:()=>Ue,TextLayer:()=>Ye,UnexpectedResponseException:()=>ke,Util:()=>E,VerbosityLevel:()=>rs,XfaLayer:()=>Xi,build:()=>_l,createValidAbsoluteUrl:()=>Io,fetchData:()=>ds,getDocument:()=>ml,getFilenameFromUrl:()=>zo,getPdfFilenameFromUrl:()=>jo,getXfaPageViewport:()=>Vo,isDataScheme:()=>hs,isPdfFile:()=>ca,noContextMenu:()=>xt,normalizeUnicode:()=>No,setLayerDimensions:()=>ue,shadow:()=>F,stopEvent:()=>At,version:()=>gl});var ct=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Br=[1,0,0,1,0,0],js=[.001,0,0,.001,0,0],Co=1e7,Mi=1.35,ko=.35,zc=ko/Mi,mt={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Qt={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},So="pdfjs_internal_editor_",D={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},N={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},Eo={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},rt={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Li={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},et={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};var Fe={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};var rs={ERRORS:0,WARNINGS:1,INFOS:5},wt={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},To={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},os=rs.WARNINGS;function Mo(o){Number.isInteger(o)&&(os=o)}function Lo(){return os}function ls(o){os>=rs.INFOS&&console.log(`Info: ${o}`)}function R(o){os>=rs.WARNINGS&&console.log(`Warning: ${o}`)}function V(o){throw new Error(o)}function J(o,e){o||V(e)}function Po(o){switch(o?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Io(o,e=null,t=null){if(!o)return null;try{if(t&&typeof o=="string"&&(t.addDefaultProtocol&&o.startsWith("www.")&&o.match(/\./g)?.length>=2&&(o=`http://${o}`),t.tryConvertEncoding))try{o=Fo(o)}catch{}let i=e?new URL(o,e):new URL(o);if(Po(i))return i}catch{}return null}function F(o,e,t,i=!1){return Object.defineProperty(o,e,{value:t,enumerable:!i,configurable:!0,writable:!1}),t}var te=function(){function e(t,i){this.message=t,this.name=i}return e.prototype=new Error,e.constructor=e,e}(),je=class extends te{constructor(e,t){super(e,"PasswordException"),this.code=t}},Ve=class extends te{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}},Pi=class extends te{constructor(e){super(e,"InvalidPDFException")}},he=class extends te{constructor(e){super(e,"MissingPDFException")}},ke=class extends te{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}},Vs=class extends te{constructor(e){super(e,"FormatError")}},Ut=class extends te{constructor(e){super(e,"AbortException")}};function Hr(o){(typeof o!="object"||o?.length===void 0)&&V("Invalid argument for bytesToString");let e=o.length,t=8192;if(e<t)return String.fromCharCode.apply(null,o);let i=[];for(let s=0;s<e;s+=t){let n=Math.min(s+t,e),a=o.subarray(s,n);i.push(String.fromCharCode.apply(null,a))}return i.join("")}function cs(o){typeof o!="string"&&V("Invalid argument for stringToBytes");let e=o.length,t=new Uint8Array(e);for(let i=0;i<e;++i)t[i]=o.charCodeAt(i)&255;return t}function Do(o){return String.fromCharCode(o>>24&255,o>>16&255,o>>8&255,o&255)}function oa(o){let e=Object.create(null);for(let[t,i]of o)e[t]=i;return e}function Ro(){let o=new Uint8Array(4);return o[0]=1,new Uint32Array(o.buffer,0,1)[0]===1}function Oo(){try{return new Function(""),!0}catch{return!1}}var st=class{static get isLittleEndian(){return F(this,"isLittleEndian",Ro())}static get isEvalSupported(){return F(this,"isEvalSupported",Oo())}static get isOffscreenCanvasSupported(){return F(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return F(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){return typeof navigator<"u"&&typeof navigator?.platform=="string"?F(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof navigator?.userAgent=="string"&&navigator.userAgent.includes("Firefox")}):F(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){return F(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}},Fs=Array.from(Array(256).keys(),o=>o.toString(16).padStart(2,"0")),E=class{static makeHexColor(e,t,i){return`#${Fs[e]}${Fs[t]}${Fs[i]}`}static scaleMinMax(e,t){let i;e[0]?(e[0]<0&&(i=t[0],t[0]=t[2],t[2]=i),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(i=t[1],t[1]=t[3],t[3]=i),t[1]*=e[3],t[3]*=e[3]):(i=t[0],t[0]=t[1],t[1]=i,i=t[2],t[2]=t[3],t[3]=i,e[1]<0&&(i=t[1],t[1]=t[3],t[3]=i),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(i=t[0],t[0]=t[2],t[2]=i),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){let i=e[0]*t[0]+e[1]*t[2]+t[4],s=e[0]*t[1]+e[1]*t[3]+t[5];return[i,s]}static applyInverseTransform(e,t){let i=t[0]*t[3]-t[1]*t[2],s=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/i,n=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/i;return[s,n]}static getAxialAlignedBoundingBox(e,t){let i=this.applyTransform(e,t),s=this.applyTransform(e.slice(2,4),t),n=this.applyTransform([e[0],e[3]],t),a=this.applyTransform([e[2],e[1]],t);return[Math.min(i[0],s[0],n[0],a[0]),Math.min(i[1],s[1],n[1],a[1]),Math.max(i[0],s[0],n[0],a[0]),Math.max(i[1],s[1],n[1],a[1])]}static inverseTransform(e){let t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){let t=[e[0],e[2],e[1],e[3]],i=e[0]*t[0]+e[1]*t[2],s=e[0]*t[1]+e[1]*t[3],n=e[2]*t[0]+e[3]*t[2],a=e[2]*t[1]+e[3]*t[3],r=(i+a)/2,l=Math.sqrt((i+a)**2-4*(i*a-n*s))/2,c=r+l||1,d=r-l||1;return[Math.sqrt(c),Math.sqrt(d)]}static normalizeRect(e){let t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){let i=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),s=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(i>s)return null;let n=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),a=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return n>a?null:[i,n,s,a]}static#t(e,t,i,s,n,a,r,l,c,d){if(c<=0||c>=1)return;let h=1-c,u=c*c,m=u*c,p=h*(h*(h*e+3*c*t)+3*u*i)+m*s,f=h*(h*(h*n+3*c*a)+3*u*r)+m*l;d[0]=Math.min(d[0],p),d[1]=Math.min(d[1],f),d[2]=Math.max(d[2],p),d[3]=Math.max(d[3],f)}static#e(e,t,i,s,n,a,r,l,c,d,h,u){if(Math.abs(c)<1e-12){Math.abs(d)>=1e-12&&this.#t(e,t,i,s,n,a,r,l,-h/d,u);return}let m=d**2-4*h*c;if(m<0)return;let p=Math.sqrt(m),f=2*c;this.#t(e,t,i,s,n,a,r,l,(-d+p)/f,u),this.#t(e,t,i,s,n,a,r,l,(-d-p)/f,u)}static bezierBoundingBox(e,t,i,s,n,a,r,l,c){return c?(c[0]=Math.min(c[0],e,r),c[1]=Math.min(c[1],t,l),c[2]=Math.max(c[2],e,r),c[3]=Math.max(c[3],t,l)):c=[Math.min(e,r),Math.min(t,l),Math.max(e,r),Math.max(t,l)],this.#e(e,i,n,r,t,s,a,l,3*(-e+3*(i-n)+r),6*(e-2*i+n),3*(i-e),c),this.#e(e,i,n,r,t,s,a,l,3*(-t+3*(s-a)+l),6*(t-2*s+a),3*(s-t),c),c}};function Fo(o){return decodeURIComponent(escape(o))}var Ns=null,Ar=null;function No(o){return Ns||(Ns=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Ar=new Map([["\uFB05","\u017Ft"]])),o.replaceAll(Ns,(e,t,i)=>t?t.normalize("NFKC"):Ar.get(i))}function Bo(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();let o=new Uint8Array(32);return crypto.getRandomValues(o),Hr(o)}var la="pdfjs_internal_id_",Vt={BEZIER_CURVE_TO:0,MOVE_TO:1,LINE_TO:2,QUADRATIC_CURVE_TO:3,RESTORE:4,SAVE:5,SCALE:6,TRANSFORM:7,TRANSLATE:8};function Ho(o){return Uint8Array.prototype.toBase64?o.toBase64():btoa(Hr(o))}typeof Promise.try!="function"&&(Promise.try=function(o,...e){return new Promise(t=>{t(o(...e))})});var Gt="http://www.w3.org/2000/svg",Jt=class{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF};function ds(o,e="text"){return k(this,null,function*(){if(He(o,document.baseURI)){let t=yield fetch(o);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,i)=>{let s=new XMLHttpRequest;s.open("GET",o,!0),s.responseType=e,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(s.status===200||s.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(s.response);return}t(s.responseText);return}i(new Error(s.statusText))}},s.send(null)})})}var Ge=class o{constructor({viewBox:e,scale:t,rotation:i,offsetX:s=0,offsetY:n=0,dontFlip:a=!1}){this.viewBox=e,this.scale=t,this.rotation=i,this.offsetX=s,this.offsetY=n;let r=(e[2]+e[0])/2,l=(e[3]+e[1])/2,c,d,h,u;switch(i%=360,i<0&&(i+=360),i){case 180:c=-1,d=0,h=0,u=1;break;case 90:c=0,d=1,h=1,u=0;break;case 270:c=0,d=-1,h=-1,u=0;break;case 0:c=1,d=0,h=0,u=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(h=-h,u=-u);let m,p,f,_;c===0?(m=Math.abs(l-e[1])*t+s,p=Math.abs(r-e[0])*t+n,f=(e[3]-e[1])*t,_=(e[2]-e[0])*t):(m=Math.abs(r-e[0])*t+s,p=Math.abs(l-e[1])*t+n,f=(e[2]-e[0])*t,_=(e[3]-e[1])*t),this.transform=[c*t,d*t,h*t,u*t,m-c*t*r-h*t*l,p-d*t*r-u*t*l],this.width=f,this.height=_}get rawDims(){let{viewBox:e}=this;return F(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:i=this.offsetX,offsetY:s=this.offsetY,dontFlip:n=!1}={}){return new o({viewBox:this.viewBox.slice(),scale:e,rotation:t,offsetX:i,offsetY:s,dontFlip:n})}convertToViewportPoint(e,t){return E.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){let t=E.applyTransform([e[0],e[1]],this.transform),i=E.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],i[0],i[1]]}convertToPdfPoint(e,t){return E.applyInverseTransform([e,t],this.transform)}},Ue=class extends te{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}};function hs(o){let e=o.length,t=0;for(;t<e&&o[t].trim()==="";)t++;return o.substring(t,t+5).toLowerCase()==="data:"}function ca(o){return typeof o=="string"&&/\.pdf$/i.test(o)}function zo(o){return[o]=o.split(/[#?]/,1),o.substring(o.lastIndexOf("/")+1)}function jo(o,e="document.pdf"){if(typeof o!="string")return e;if(hs(o))return R('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;let t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,i=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,s=t.exec(o),n=i.exec(s[1])||i.exec(s[2])||i.exec(s[3]);if(n&&(n=n[0],n.includes("%")))try{n=i.exec(decodeURIComponent(n))[0]}catch{}return n||e}var Ii=class{started=Object.create(null);times=[];time(e){e in this.started&&R(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||R(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){let e=[],t=0;for(let{name:i}of this.times)t=Math.max(i.length,t);for(let{name:i,start:s,end:n}of this.times)e.push(`${i.padEnd(t)} ${n-s}ms
`);return e.join("")}};function He(o,e){try{let{protocol:t}=e?new URL(o,e):new URL(o);return t==="http:"||t==="https:"}catch{return!1}}function xt(o){o.preventDefault()}function At(o){o.preventDefault(),o.stopPropagation()}function xr(o){console.log("Deprecated API usage: "+o)}var Di=class{static#t;static toDateObject(e){if(!e||typeof e!="string")return null;this.#t||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");let t=this.#t.exec(e);if(!t)return null;let i=parseInt(t[1],10),s=parseInt(t[2],10);s=s>=1&&s<=12?s-1:0;let n=parseInt(t[3],10);n=n>=1&&n<=31?n:1;let a=parseInt(t[4],10);a=a>=0&&a<=23?a:0;let r=parseInt(t[5],10);r=r>=0&&r<=59?r:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;let c=t[7]||"Z",d=parseInt(t[8],10);d=d>=0&&d<=23?d:0;let h=parseInt(t[9],10)||0;return h=h>=0&&h<=59?h:0,c==="-"?(a+=d,r+=h):c==="+"&&(a-=d,r-=h),new Date(Date.UTC(i,s,n,a,r,l))}};function Vo(o,{scale:e=1,rotation:t=0}){let{width:i,height:s}=o.attributes.style,n=[0,0,parseInt(i),parseInt(s)];return new Ge({viewBox:n,scale:e,rotation:t})}function da(o){if(o.startsWith("#")){let e=parseInt(o.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return o.startsWith("rgb(")?o.slice(4,-1).split(",").map(e=>parseInt(e)):o.startsWith("rgba(")?o.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(R(`Not a valid color format: "${o}"`),[0,0,0])}function Go(o){let e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);for(let t of o.keys()){e.style.color=t;let i=window.getComputedStyle(e).color;o.set(t,da(i))}e.remove()}function W(o){let{a:e,b:t,c:i,d:s,e:n,f:a}=o.getTransform();return[e,t,i,s,n,a]}function Ft(o){let{a:e,b:t,c:i,d:s,e:n,f:a}=o.getTransform().invertSelf();return[e,t,i,s,n,a]}function ue(o,e,t=!1,i=!0){if(e instanceof Ge){let{pageWidth:s,pageHeight:n}=e.rawDims,{style:a}=o,r=st.isCSSRoundSupported,l=`var(--scale-factor) * ${s}px`,c=`var(--scale-factor) * ${n}px`,d=r?`round(down, ${l}, var(--scale-round-x, 1px))`:`calc(${l})`,h=r?`round(down, ${c}, var(--scale-round-y, 1px))`:`calc(${c})`;!t||e.rotation%180===0?(a.width=d,a.height=h):(a.width=h,a.height=d)}i&&o.setAttribute("data-main-rotation",e.rotation)}var $e=class{constructor(){let e=window.devicePixelRatio||1;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}},Gs=class o{#t=null;#e=null;#i;#s=null;#a=null;static#n=null;constructor(e){this.#i=e,o.#n||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"})}render(){let e=this.#t=document.createElement("div");e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");let t=this.#i._uiManager._signal;e.addEventListener("contextmenu",xt,{signal:t}),e.addEventListener("pointerdown",o.#c,{signal:t});let i=this.#s=document.createElement("div");i.className="buttons",e.append(i);let s=this.#i.toolbarPosition;if(s){let{style:n}=e,a=this.#i._uiManager.direction==="ltr"?1-s[0]:s[0];n.insetInlineEnd=`${100*a}%`,n.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`}return this.#h(),e}get div(){return this.#t}static#c(e){e.stopPropagation()}#o(e){this.#i._focusEventsAllowed=!1,At(e)}#d(e){this.#i._focusEventsAllowed=!0,At(e)}#l(e){let t=this.#i._uiManager._signal;e.addEventListener("focusin",this.#o.bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",this.#d.bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",xt,{signal:t})}hide(){this.#t.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#t.classList.remove("hidden"),this.#a?.shown()}#h(){let{editorType:e,_uiManager:t}=this.#i,i=document.createElement("button");i.className="delete",i.tabIndex=0,i.setAttribute("data-l10n-id",o.#n[e]),this.#l(i),i.addEventListener("click",s=>{t.delete()},{signal:t._signal}),this.#s.append(i)}get#r(){let e=document.createElement("div");return e.className="divider",e}addAltText(e){return k(this,null,function*(){let t=yield e.render();this.#l(t),this.#s.prepend(t,this.#r),this.#a=e})}addColorPicker(e){this.#e=e;let t=e.renderButton();this.#l(t),this.#s.prepend(t,this.#r)}remove(){this.#t.remove(),this.#e?.destroy(),this.#e=null}},Us=class{#t=null;#e=null;#i;constructor(e){this.#i=e}#s(){let e=this.#e=document.createElement("div");e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",xt,{signal:this.#i._signal});let t=this.#t=document.createElement("div");return t.className="buttons",e.append(t),this.#n(),e}#a(e,t){let i=0,s=0;for(let n of e){let a=n.y+n.height;if(a<i)continue;let r=n.x+(t?n.width:0);if(a>i){s=r,i=a;continue}t?r>s&&(s=r):r<s&&(s=r)}return[t?1-s:s,i]}show(e,t,i){let[s,n]=this.#a(t,i),{style:a}=this.#e||=this.#s();e.append(this.#e),a.insetInlineEnd=`${100*s}%`,a.top=`calc(${100*n}% + var(--editor-toolbar-vert-offset))`}hide(){this.#e.remove()}#n(){let e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");let t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");let i=this.#i._signal;e.addEventListener("contextmenu",xt,{signal:i}),e.addEventListener("click",()=>{this.#i.highlightSelection("floating_button")},{signal:i}),this.#t.append(e)}};function Ri(o,e,t){for(let i of t)e.addEventListener(i,o[i].bind(o))}var $s=class{#t=0;get id(){return`${So}${this.#t++}`}},Ws=class o{#t=Bo();#e=0;#i=null;static get _isSVGFittingCanvas(){let e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',i=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),s=new Image;s.src=e;let n=s.decode().then(()=>(i.drawImage(s,0,0,1,1,0,0,1,3),new Uint32Array(i.getImageData(0,0,1,1).data.buffer)[0]===0));return F(this,"_isSVGFittingCanvas",n)}#s(e,t){return k(this,null,function*(){this.#i||=new Map;let i=this.#i.get(e);if(i===null)return null;if(i?.bitmap)return i.refCounter+=1,i;try{i||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let s;if(typeof t=="string"?(i.url=t,s=yield ds(t,"blob")):t instanceof File?s=i.file=t:t instanceof Blob&&(s=t),s.type==="image/svg+xml"){let n=o._isSVGFittingCanvas,a=new FileReader,r=new Image,l=new Promise((c,d)=>{r.onload=()=>{i.bitmap=r,i.isSvg=!0,c()},a.onload=()=>k(this,null,function*(){let h=i.svgUrl=a.result;r.src=(yield n)?`${h}#svgView(preserveAspectRatio(none))`:h}),r.onerror=a.onerror=d});a.readAsDataURL(s),yield l}else i.bitmap=yield createImageBitmap(s);i.refCounter=1}catch(s){R(s),i=null}return this.#i.set(e,i),i&&this.#i.set(i.id,i),i})}getFromFile(e){return k(this,null,function*(){let{lastModified:t,name:i,size:s,type:n}=e;return this.#s(`${t}_${i}_${s}_${n}`,e)})}getFromUrl(e){return k(this,null,function*(){return this.#s(e,e)})}getFromBlob(e,t){return k(this,null,function*(){let i=yield t;return this.#s(e,i)})}getFromId(e){return k(this,null,function*(){this.#i||=new Map;let t=this.#i.get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){let{blobPromise:i}=t;return delete t.blobPromise,this.getFromBlob(t.id,i)}return this.getFromUrl(t.url)})}getFromCanvas(e,t){this.#i||=new Map;let i=this.#i.get(e);if(i?.bitmap)return i.refCounter+=1,i;let s=new OffscreenCanvas(t.width,t.height);return s.getContext("2d").drawImage(t,0,0),i={bitmap:s.transferToImageBitmap(),id:`image_${this.#t}_${this.#e++}`,refCounter:1,isSvg:!1},this.#i.set(e,i),this.#i.set(i.id,i),i}getSvgUrl(e){let t=this.#i.get(e);return t?.isSvg?t.svgUrl:null}deleteId(e){this.#i||=new Map;let t=this.#i.get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;let{bitmap:i}=t;if(!t.url&&!t.file){let s=new OffscreenCanvas(i.width,i.height);s.getContext("bitmaprenderer").transferFromImageBitmap(i),t.blobPromise=s.convertToBlob()}i.close?.(),t.bitmap=null}isValidId(e){return e.startsWith(`image_${this.#t}_`)}},qs=class{#t=[];#e=!1;#i;#s=-1;constructor(e=128){this.#i=e}add({cmd:e,undo:t,post:i,mustExec:s,type:n=NaN,overwriteIfSameType:a=!1,keepUndo:r=!1}){if(s&&e(),this.#e)return;let l={cmd:e,undo:t,post:i,type:n};if(this.#s===-1){this.#t.length>0&&(this.#t.length=0),this.#s=0,this.#t.push(l);return}if(a&&this.#t[this.#s].type===n){r&&(l.undo=this.#t[this.#s].undo),this.#t[this.#s]=l;return}let c=this.#s+1;c===this.#i?this.#t.splice(0,1):(this.#s=c,c<this.#t.length&&this.#t.splice(c)),this.#t.push(l)}undo(){if(this.#s===-1)return;this.#e=!0;let{undo:e,post:t}=this.#t[this.#s];e(),t?.(),this.#e=!1,this.#s-=1}redo(){if(this.#s<this.#t.length-1){this.#s+=1,this.#e=!0;let{cmd:e,post:t}=this.#t[this.#s];e(),t?.(),this.#e=!1}}hasSomethingToUndo(){return this.#s!==-1}hasSomethingToRedo(){return this.#s<this.#t.length-1}cleanType(e){if(this.#s!==-1){for(let t=this.#s;t>=0;t--)if(this.#t[t].type!==e){this.#t.splice(t+1,this.#s-t),this.#s=t;return}this.#t.length=0,this.#s=-1}}destroy(){this.#t=null}},me=class{constructor(e){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;let{isMac:t}=st.platform;for(let[i,s,n={}]of e)for(let a of i){let r=a.startsWith("mac+");t&&r?(this.callbacks.set(a.slice(4),{callback:s,options:n}),this.allKeys.add(a.split("+").at(-1))):!t&&!r&&(this.callbacks.set(a,{callback:s,options:n}),this.allKeys.add(a.split("+").at(-1)))}}#t(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);let t=this.buffer.join("+");return this.buffer.length=0,t}exec(e,t){if(!this.allKeys.has(t.key))return;let i=this.callbacks.get(this.#t(t));if(!i)return;let{callback:s,options:{bubbles:n=!1,args:a=[],checker:r=null}}=i;r&&!r(e,t)||(s.bind(e,...a,t)(),n||At(t))}},Xs=class o{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){let e=new Map([["CanvasText",null],["Canvas",null]]);return Go(e),F(this,"_colors",e)}convert(e){let t=da(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(let[i,s]of this._colors)if(s.every((n,a)=>n===t[a]))return o._colorsMapping.get(i);return t}getHexCode(e){let t=this._colors.get(e);return t?E.makeHexColor(...t):e}},We=(()=>{class o{#t=new AbortController;#e=null;#i=new Map;#s=new Map;#a=null;#n=null;#c=null;#o=new qs;#d=null;#l=null;#h=0;#r=new Set;#u=null;#m=null;#p=new Set;_editorUndoBar=null;#g=!1;#f=!1;#_=!1;#b=null;#y=null;#w=null;#C=null;#k=!1;#S=null;#T=new $s;#A=!1;#M=!1;#E=null;#L=null;#R=null;#B=null;#x=D.NONE;#v=new Set;#D=null;#H=null;#j=null;#V={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#F=[0,0];#I=null;#z=null;#W=null;#O=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){let t=o.prototype,i=r=>r.#z.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&r.hasSomethingToControl(),s=(r,{target:l})=>{if(l instanceof HTMLInputElement){let{type:c}=l;return c!=="text"&&c!=="number"}return!0},n=this.TRANSLATE_SMALL,a=this.TRANSLATE_BIG;return F(this,"_keyboardManager",new me([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],t.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:s}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(r,{target:l})=>!(l instanceof HTMLButtonElement)&&r.#z.contains(l)&&!r.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(r,{target:l})=>!(l instanceof HTMLButtonElement)&&r.#z.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-n,0],checker:i}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-a,0],checker:i}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[n,0],checker:i}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[a,0],checker:i}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-n],checker:i}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-a],checker:i}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,n],checker:i}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,a],checker:i}]]))}constructor(t,i,s,n,a,r,l,c,d,h,u,m){let p=this._signal=this.#t.signal;this.#z=t,this.#W=i,this.#a=s,this._eventBus=n,n._on("editingaction",this.onEditingAction.bind(this),{signal:p}),n._on("pagechanging",this.onPageChanging.bind(this),{signal:p}),n._on("scalechanging",this.onScaleChanging.bind(this),{signal:p}),n._on("rotationchanging",this.onRotationChanging.bind(this),{signal:p}),n._on("setpreference",this.onSetPreference.bind(this),{signal:p}),n._on("switchannotationeditorparams",f=>this.updateParams(f.type,f.value),{signal:p}),this.#et(),this.#at(),this.#X(),this.#n=a.annotationStorage,this.#b=a.filterFactory,this.#H=r,this.#C=l||null,this.#g=c,this.#f=d,this.#_=h,this.#B=u||null,this.viewParameters={realScale:Jt.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=m||null}destroy(){this.#O?.resolve(),this.#O=null,this.#t?.abort(),this.#t=null,this._signal=null;for(let t of this.#s.values())t.destroy();this.#s.clear(),this.#i.clear(),this.#p.clear(),this.#e=null,this.#v.clear(),this.#o.destroy(),this.#a?.destroy(),this.#S?.hide(),this.#S=null,this.#y&&(clearTimeout(this.#y),this.#y=null),this.#I&&(clearTimeout(this.#I),this.#I=null),this._editorUndoBar?.destroy()}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return this.#B}get useNewAltTextFlow(){return this.#f}get useNewAltTextWhenAddingImage(){return this.#_}get hcmFilter(){return F(this,"hcmFilter",this.#H?this.#b.addHCMFilter(this.#H.foreground,this.#H.background):"none")}get direction(){return F(this,"direction",getComputedStyle(this.#z).direction)}get highlightColors(){return F(this,"highlightColors",this.#C?new Map(this.#C.split(",").map(t=>t.split("=").map(i=>i.trim()))):null)}get highlightColorNames(){return F(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#l=t}setMainHighlightColorPicker(t){this.#R=t}editAltText(t,i=!1){this.#a?.editAltText(this,t,i)}switchToMode(t,i){this._eventBus.on("annotationeditormodechanged",i,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,i){this._eventBus.dispatch("setpreference",{source:this,name:t,value:i})}onSetPreference({name:t,value:i}){switch(t){case"enableNewAltTextWhenAddingImage":this.#_=i;break}}onPageChanging({pageNumber:t}){this.#h=t-1}focusMainContainer(){this.#z.focus()}findParent(t,i){for(let s of this.#s.values()){let{x:n,y:a,width:r,height:l}=s.div.getBoundingClientRect();if(t>=n&&t<=n+r&&i>=a&&i<=a+l)return s}return null}disableUserSelect(t=!1){this.#W.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#p.add(t)}removeShouldRescale(t){this.#p.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove(),this.viewParameters.realScale=t*Jt.PDF_TO_CSS_UNITS;for(let i of this.#p)i.onScaleChanging();this.#l?.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}#U({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#q(t){let{currentLayer:i}=this;if(i.hasTextLayer(t))return i;for(let s of this.#s.values())if(s.hasTextLayer(t))return s;return null}highlightSelection(t=""){let i=document.getSelection();if(!i||i.isCollapsed)return;let{anchorNode:s,anchorOffset:n,focusNode:a,focusOffset:r}=i,l=i.toString(),d=this.#U(i).closest(".textLayer"),h=this.getSelectionBoxes(d);if(!h)return;i.empty();let u=this.#q(d),m=this.#x===D.NONE,p=()=>{u?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:h,anchorNode:s,anchorOffset:n,focusNode:a,focusOffset:r,text:l}),m&&this.showAllEditors("highlight",!0,!0)};if(m){this.switchToMode(D.HIGHLIGHT,p);return}p()}#J(){let t=document.getSelection();if(!t||t.isCollapsed)return;let s=this.#U(t).closest(".textLayer"),n=this.getSelectionBoxes(s);n&&(this.#S||=new Us(this),this.#S.show(s,n,this.direction==="ltr"))}addToAnnotationStorage(t){!t.isEmpty()&&this.#n&&!this.#n.has(t.id)&&this.#n.setValue(t.id,t)}#tt(){let t=document.getSelection();if(!t||t.isCollapsed){this.#D&&(this.#S?.hide(),this.#D=null,this.#P({hasSelectedText:!1}));return}let{anchorNode:i}=t;if(i===this.#D)return;let n=this.#U(t).closest(".textLayer");if(!n){this.#D&&(this.#S?.hide(),this.#D=null,this.#P({hasSelectedText:!1}));return}if(this.#S?.hide(),this.#D=i,this.#P({hasSelectedText:!0}),!(this.#x!==D.HIGHLIGHT&&this.#x!==D.NONE)&&(this.#x===D.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#k=this.isShiftKeyDown,!this.isShiftKeyDown)){let a=this.#x===D.HIGHLIGHT?this.#q(n):null;a?.toggleDrawing();let r=new AbortController,l=this.combinedSignal(r),c=d=>{d.type==="pointerup"&&d.button!==0||(r.abort(),a?.toggleDrawing(!0),d.type==="pointerup"&&this.#$("main_toolbar"))};window.addEventListener("pointerup",c,{signal:l}),window.addEventListener("blur",c,{signal:l})}}#$(t=""){this.#x===D.HIGHLIGHT?this.highlightSelection(t):this.#g&&this.#J()}#et(){document.addEventListener("selectionchange",this.#tt.bind(this),{signal:this._signal})}#it(){if(this.#w)return;this.#w=new AbortController;let t=this.combinedSignal(this.#w);window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})}#st(){this.#w?.abort(),this.#w=null}blur(){if(this.isShiftKeyDown=!1,this.#k&&(this.#k=!1,this.#$("main_toolbar")),!this.hasSelection)return;let{activeElement:t}=document;for(let i of this.#v)if(i.div.contains(t)){this.#L=[i,t],i._focusEventsAllowed=!1;break}}focus(){if(!this.#L)return;let[t,i]=this.#L;this.#L=null,i.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),i.focus()}#X(){if(this.#E)return;this.#E=new AbortController;let t=this.combinedSignal(this.#E);window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}#nt(){this.#E?.abort(),this.#E=null}#Y(){if(this.#d)return;this.#d=new AbortController;let t=this.combinedSignal(this.#d);document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})}#K(){this.#d?.abort(),this.#d=null}#at(){let t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#X(),this.#Y()}removeEditListeners(){this.#nt(),this.#K()}dragOver(t){for(let{type:i}of t.dataTransfer.items)for(let s of this.#m)if(s.isHandlingMimeForPasting(i)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(let i of t.dataTransfer.items)for(let s of this.#m)if(s.isHandlingMimeForPasting(i.type)){s.paste(i,this.currentLayer),t.preventDefault();return}}copy(t){if(t.preventDefault(),this.#e?.commitOrRemove(),!this.hasSelection)return;let i=[];for(let s of this.#v){let n=s.serialize(!0);n&&i.push(n)}i.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(i))}cut(t){this.copy(t),this.delete()}paste(t){return k(this,null,function*(){t.preventDefault();let{clipboardData:i}=t;for(let a of i.items)for(let r of this.#m)if(r.isHandlingMimeForPasting(a.type)){r.paste(a,this.currentLayer);return}let s=i.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(a){R(`paste: "${a.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();let n=this.currentLayer;try{let a=[];for(let c of s){let d=yield n.deserialize(c);if(!d)return;a.push(d)}let r=()=>{for(let c of a)this.#Q(c);this.#Z(a)},l=()=>{for(let c of a)c.remove()};this.addCommands({cmd:r,undo:l,mustExec:!0})}catch(a){R(`paste: "${a.message}".`)}})}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),this.#x!==D.NONE&&!this.isEditorHandlingKeyboard&&o._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,this.#k&&(this.#k=!1,this.#$("main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}#P(t){Object.entries(t).some(([s,n])=>this.#V[s]!==n)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#V,t)}),this.#x===D.HIGHLIGHT&&t.hasSelectedEditor===!1&&this.#N([[N.HIGHLIGHT_FREE,!0]]))}#N(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){t?(this.#it(),this.#Y(),this.#P({isEditing:this.#x!==D.NONE,isEmpty:this.#G(),hasSomethingToUndo:this.#o.hasSomethingToUndo(),hasSomethingToRedo:this.#o.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#st(),this.#K(),this.#P({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!this.#m){this.#m=t;for(let i of this.#m)this.#N(i.defaultPropertiesToUpdate)}}getId(){return this.#T.id}get currentLayer(){return this.#s.get(this.#h)}getLayer(t){return this.#s.get(t)}get currentPageIndex(){return this.#h}addLayer(t){this.#s.set(t.pageIndex,t),this.#A?t.enable():t.disable()}removeLayer(t){this.#s.delete(t.pageIndex)}updateMode(t,i=null,s=!1){return k(this,null,function*(){if(this.#x!==t&&!(this.#O&&(yield this.#O.promise,!this.#O))){if(this.#O=Promise.withResolvers(),this.#x=t,t===D.NONE){this.setEditingState(!1),this.#ot(),this._editorUndoBar?.hide(),this.#O.resolve();return}this.setEditingState(!0),yield this.#rt(),this.unselectAll();for(let n of this.#s.values())n.updateMode(t);if(!i){s&&this.addNewEditorFromKeyboard(),this.#O.resolve();return}for(let n of this.#i.values())n.annotationElementId===i?(this.setSelected(n),n.enterInEditMode()):n.unselect();this.#O.resolve()}})}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t!==this.#x&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:t})}updateParams(t,i){if(this.#m){switch(t){case N.CREATE:this.currentLayer.addNewEditor();return;case N.HIGHLIGHT_DEFAULT_COLOR:this.#R?.updateColor(i);break;case N.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#j||=new Map).set(t,i),this.showAllEditors("highlight",i);break}for(let s of this.#v)s.updateParams(t,i);for(let s of this.#m)s.updateDefaultParams(t,i)}}showAllEditors(t,i,s=!1){for(let a of this.#i.values())a.editorType===t&&a.show(i);(this.#j?.get(N.HIGHLIGHT_SHOW_ALL)??!0)!==i&&this.#N([[N.HIGHLIGHT_SHOW_ALL,i]])}enableWaiting(t=!1){if(this.#M!==t){this.#M=t;for(let i of this.#s.values())t?i.disableClick():i.enableClick(),i.div.classList.toggle("waiting",t)}}#rt(){return k(this,null,function*(){if(!this.#A){this.#A=!0;let t=[];for(let i of this.#s.values())t.push(i.enable());yield Promise.all(t);for(let i of this.#i.values())i.enable()}})}#ot(){if(this.unselectAll(),this.#A){this.#A=!1;for(let t of this.#s.values())t.disable();for(let t of this.#i.values())t.disable()}}getEditors(t){let i=[];for(let s of this.#i.values())s.pageIndex===t&&i.push(s);return i}getEditor(t){return this.#i.get(t)}addEditor(t){this.#i.set(t.id,t)}removeEditor(t){t.div.contains(document.activeElement)&&(this.#y&&clearTimeout(this.#y),this.#y=setTimeout(()=>{this.focusMainContainer(),this.#y=null},0)),this.#i.delete(t.id),this.unselect(t),(!t.annotationElementId||!this.#r.has(t.annotationElementId))&&this.#n?.remove(t.id)}addDeletedAnnotationElement(t){this.#r.add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return this.#r.has(t)}removeDeletedAnnotationElement(t){this.#r.delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}#Q(t){let i=this.#s.get(t.pageIndex);i?i.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}setActiveEditor(t){this.#e!==t&&(this.#e=t,t&&this.#N(t.propertiesToUpdate))}get#lt(){let t=null;for(t of this.#v);return t}updateUI(t){this.#lt===t&&this.#N(t.propertiesToUpdate)}updateUIForDefaultProperties(t){this.#N(t.defaultPropertiesToUpdate)}toggleSelected(t){if(this.#v.has(t)){this.#v.delete(t),t.unselect(),this.#P({hasSelectedEditor:this.hasSelection});return}this.#v.add(t),t.select(),this.#N(t.propertiesToUpdate),this.#P({hasSelectedEditor:!0})}setSelected(t){this.#l?.commitOrRemove();for(let i of this.#v)i!==t&&i.unselect();this.#v.clear(),this.#v.add(t),t.select(),this.#N(t.propertiesToUpdate),this.#P({hasSelectedEditor:!0})}isSelected(t){return this.#v.has(t)}get firstSelectedEditor(){return this.#v.values().next().value}unselect(t){t.unselect(),this.#v.delete(t),this.#P({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#v.size!==0}get isEnterHandled(){return this.#v.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#o.undo(),this.#P({hasSomethingToUndo:this.#o.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#G()}),this._editorUndoBar?.hide()}redo(){this.#o.redo(),this.#P({hasSomethingToUndo:!0,hasSomethingToRedo:this.#o.hasSomethingToRedo(),isEmpty:this.#G()})}addCommands(t){this.#o.add(t),this.#P({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#G()})}cleanUndoStack(t){this.#o.cleanType(t)}#G(){if(this.#i.size===0)return!0;if(this.#i.size===1)for(let t of this.#i.values())return t.isEmpty();return!1}delete(){this.commitOrRemove();let t=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!t)return;let i=t?[t]:[...this.#v],s=()=>{this._editorUndoBar?.show(n,i.length===1?i[0].editorType:i.length);for(let a of i)a.remove()},n=()=>{for(let a of i)this.#Q(a)};this.addCommands({cmd:s,undo:n,mustExec:!0})}commitOrRemove(){this.#e?.commitOrRemove()}hasSomethingToControl(){return this.#e||this.hasSelection}#Z(t){for(let i of this.#v)i.unselect();this.#v.clear();for(let i of t)i.isEmpty()||(this.#v.add(i),i.select());this.#P({hasSelectedEditor:this.hasSelection})}selectAll(){for(let t of this.#v)t.commit();this.#Z(this.#i.values())}unselectAll(){if(!(this.#e&&(this.#e.commitOrRemove(),this.#x!==D.NONE))&&!this.#l?.commitOrRemove()&&this.hasSelection){for(let t of this.#v)t.unselect();this.#v.clear(),this.#P({hasSelectedEditor:!1})}}translateSelectedEditors(t,i,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;this.#F[0]+=t,this.#F[1]+=i;let[n,a]=this.#F,r=[...this.#v],l=1e3;this.#I&&clearTimeout(this.#I),this.#I=setTimeout(()=>{this.#I=null,this.#F[0]=this.#F[1]=0,this.addCommands({cmd:()=>{for(let c of r)this.#i.has(c.id)&&c.translateInPage(n,a)},undo:()=>{for(let c of r)this.#i.has(c.id)&&c.translateInPage(-n,-a)},mustExec:!1})},l);for(let c of r)c.translateInPage(t,i)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#u=new Map;for(let t of this.#v)this.#u.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#u)return!1;this.disableUserSelect(!1);let t=this.#u;this.#u=null;let i=!1;for(let[{x:n,y:a,pageIndex:r},l]of t)l.newX=n,l.newY=a,l.newPageIndex=r,i||=n!==l.savedX||a!==l.savedY||r!==l.savedPageIndex;if(!i)return!1;let s=(n,a,r,l)=>{if(this.#i.has(n.id)){let c=this.#s.get(l);c?n._setParentAndPosition(c,a,r):(n.pageIndex=l,n.x=a,n.y=r)}};return this.addCommands({cmd:()=>{for(let[n,{newX:a,newY:r,newPageIndex:l}]of t)s(n,a,r,l)},undo:()=>{for(let[n,{savedX:a,savedY:r,savedPageIndex:l}]of t)s(n,a,r,l)},mustExec:!0}),!0}dragSelectedEditors(t,i){if(this.#u)for(let s of this.#u.keys())s.drag(t,i)}rebuild(t){if(t.parent===null){let i=this.getLayer(t.pageIndex);i?(i.changeParent(t),i.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#v.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#e===t}getActive(){return this.#e}getMode(){return this.#x}get imageManager(){return F(this,"imageManager",new Ws)}getSelectionBoxes(t){if(!t)return null;let i=document.getSelection();for(let d=0,h=i.rangeCount;d<h;d++)if(!t.contains(i.getRangeAt(d).commonAncestorContainer))return null;let{x:s,y:n,width:a,height:r}=t.getBoundingClientRect(),l;switch(t.getAttribute("data-main-rotation")){case"90":l=(d,h,u,m)=>({x:(h-n)/r,y:1-(d+u-s)/a,width:m/r,height:u/a});break;case"180":l=(d,h,u,m)=>({x:1-(d+u-s)/a,y:1-(h+m-n)/r,width:u/a,height:m/r});break;case"270":l=(d,h,u,m)=>({x:1-(h+m-n)/r,y:(d-s)/a,width:m/r,height:u/a});break;default:l=(d,h,u,m)=>({x:(d-s)/a,y:(h-n)/r,width:u/a,height:m/r});break}let c=[];for(let d=0,h=i.rangeCount;d<h;d++){let u=i.getRangeAt(d);if(!u.collapsed)for(let{x:m,y:p,width:f,height:_}of u.getClientRects())f===0||_===0||c.push(l(m,p,f,_))}return c.length===0?null:c}addChangedExistingAnnotation({annotationElementId:t,id:i}){(this.#c||=new Map).set(t,i)}removeChangedExistingAnnotation({annotationElementId:t}){this.#c?.delete(t)}renderAnnotationElement(t){let i=this.#c?.get(t.data.id);if(!i)return;let s=this.#n.getRawValue(i);s&&(this.#x===D.NONE&&!s.hasBeenModified||s.renderAnnotationElement(t))}}return o})(),Cr=(()=>{class o{#t=null;#e=!1;#i=null;#s=null;#a=null;#n=null;#c=!1;#o=null;#d=null;#l=null;#h=null;#r=!1;static#u=null;static _l10n=null;constructor(t){this.#d=t,this.#r=t._uiManager.useNewAltTextFlow,o.#u||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(t){o._l10n??=t}render(){return k(this,null,function*(){let t=this.#i=document.createElement("button");t.className="altText",t.tabIndex="0";let i=this.#s=document.createElement("span");t.append(i),this.#r?(t.classList.add("new"),t.setAttribute("data-l10n-id",o.#u.missing),i.setAttribute("data-l10n-id",o.#u["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),i.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));let s=this.#d._uiManager._signal;t.addEventListener("contextmenu",xt,{signal:s}),t.addEventListener("pointerdown",a=>a.stopPropagation(),{signal:s});let n=a=>{a.preventDefault(),this.#d._uiManager.editAltText(this.#d),this.#r&&this.#d._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#m}})};return t.addEventListener("click",n,{capture:!0,signal:s}),t.addEventListener("keydown",a=>{a.target===t&&a.key==="Enter"&&(this.#c=!0,n(a))},{signal:s}),yield this.#p(),t})}get#m(){return this.#t&&"added"||this.#t===null&&this.guessedText&&"review"||"missing"}finish(){this.#i&&(this.#i.focus({focusVisible:this.#c}),this.#c=!1)}isEmpty(){return this.#r?this.#t===null:!this.#t&&!this.#e}hasData(){return this.#r?this.#t!==null||!!this.#l:this.isEmpty()}get guessedText(){return this.#l}setGuessedText(t){return k(this,null,function*(){this.#t===null&&(this.#l=t,this.#h=yield o._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t}),this.#p())})}toggleAltTextBadge(t=!1){if(!this.#r||this.#t){this.#o?.remove(),this.#o=null;return}if(!this.#o){let i=this.#o=document.createElement("div");i.className="noAltTextBadge",this.#d.div.append(i)}this.#o.classList.toggle("hidden",!t)}serialize(t){let i=this.#t;return!t&&this.#l===i&&(i=this.#h),{altText:i,decorative:this.#e,guessedText:this.#l,textWithDisclaimer:this.#h}}get data(){return{altText:this.#t,decorative:this.#e}}set data({altText:t,decorative:i,guessedText:s,textWithDisclaimer:n,cancel:a=!1}){s&&(this.#l=s,this.#h=n),!(this.#t===t&&this.#e===i)&&(a||(this.#t=t,this.#e=i),this.#p())}toggle(t=!1){this.#i&&(!t&&this.#n&&(clearTimeout(this.#n),this.#n=null),this.#i.disabled=!t)}shown(){this.#d._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#m}})}destroy(){this.#i?.remove(),this.#i=null,this.#s=null,this.#a=null,this.#o?.remove(),this.#o=null}#p(){return k(this,null,function*(){let t=this.#i;if(!t)return;if(this.#r){if(t.classList.toggle("done",!!this.#t),t.setAttribute("data-l10n-id",o.#u[this.#m]),this.#s?.setAttribute("data-l10n-id",o.#u[`${this.#m}-label`]),!this.#t){this.#a?.remove();return}}else{if(!this.#t&&!this.#e){t.classList.remove("done"),this.#a?.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let i=this.#a;if(!i){this.#a=i=document.createElement("span"),i.className="tooltip",i.setAttribute("role","tooltip"),i.id=`alt-text-tooltip-${this.#d.id}`;let n=100,a=this.#d._uiManager._signal;a.addEventListener("abort",()=>{clearTimeout(this.#n),this.#n=null},{once:!0}),t.addEventListener("mouseenter",()=>{this.#n=setTimeout(()=>{this.#n=null,this.#a.classList.add("show"),this.#d._reportTelemetry({action:"alt_text_tooltip"})},n)},{signal:a}),t.addEventListener("mouseleave",()=>{this.#n&&(clearTimeout(this.#n),this.#n=null),this.#a?.classList.remove("show")},{signal:a})}this.#e?i.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(i.removeAttribute("data-l10n-id"),i.textContent=this.#t),i.parentNode||t.append(i),this.#d.getImageForAltText()?.setAttribute("aria-describedby",i.id)})}}return o})(),q=class o{#t=null;#e=null;#i=null;#s=!1;#a=null;#n="";#c=!1;#o=null;#d=null;#l=null;#h=null;#r="";#u=!1;#m=null;#p=!1;#g=!1;#f=!1;#_=null;#b=0;#y=0;#w=null;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#C=!1;#k=o._zIndex++;static _borderLineWidth=-1;static _colorManager=new Xs;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){let e=o.prototype._resizeWithKeyboard,t=We.TRANSLATE_SMALL,i=We.TRANSLATE_BIG;return F(this,"_resizerKeyboardManager",new me([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-i,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[i,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-i]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,i]}],[["Escape","mac+Escape"],o.prototype._stopResizingWithKeyboard]]))}constructor(e){this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;let{rotation:t,rawDims:{pageWidth:i,pageHeight:s,pageX:n,pageY:a}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[i,s],this.pageTranslation=[n,a];let[r,l]=this.parentDimensions;this.x=e.x/r,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return F(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){let t=new Ys({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(o._l10n??=e,o._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),o._borderLineWidth!==-1)return;let i=getComputedStyle(document.documentElement);o._borderLineWidth=parseFloat(i.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){V("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#C}set _isDraggable(e){this.#C=e,this.div?.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){let[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#k}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):this.#I(),this.parent=e}focusin(e){this._focusEventsAllowed&&(this.#u?this.#u=!1:this.parent.setSelected(this))}focusout(e){!this._focusEventsAllowed||!this.isAttachedToDOM||e.relatedTarget?.closest(`#${this.id}`)||(e.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,i,s){let[n,a]=this.parentDimensions;[i,s]=this.screenToPageTranslation(i,s),this.x=(e+i)/n,this.y=(t+s)/a,this.fixAndSetPosition()}#S([e,t],i,s){[i,s]=this.screenToPageTranslation(i,s),this.x+=i/e,this.y+=s/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(e,t){this.#S(this.parentDimensions,e,t)}translateInPage(e,t){this.#m||=[this.x,this.y,this.width,this.height],this.#S(this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}drag(e,t){this.#m||=[this.x,this.y,this.width,this.height];let{div:i,parentDimensions:[s,n]}=this;if(this.x+=e/s,this.y+=t/n,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){let{x:h,y:u}=this.div.getBoundingClientRect();this.parent.findNewParent(this,h,u)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:a,y:r}=this,[l,c]=this.getBaseTranslation();a+=l,r+=c;let{style:d}=i;d.left=`${(100*a).toFixed(2)}%`,d.top=`${(100*r).toFixed(2)}%`,this._onTranslating(a,r),i.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!this.#m&&(this.#m[0]!==this.x||this.#m[1]!==this.y)}get _hasBeenResized(){return!!this.#m&&(this.#m[2]!==this.width||this.#m[3]!==this.height)}getBaseTranslation(){let[e,t]=this.parentDimensions,{_borderLineWidth:i}=o,s=i/e,n=i/t;switch(this.rotation){case 90:return[-s,n];case 180:return[s,n];case 270:return[s,-n];default:return[-s,-n]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){let{div:{style:t},pageDimensions:[i,s]}=this,{x:n,y:a,width:r,height:l}=this;if(r*=i,l*=s,n*=i,a*=s,this._mustFixPosition)switch(e){case 0:n=Math.max(0,Math.min(i-r,n)),a=Math.max(0,Math.min(s-l,a));break;case 90:n=Math.max(0,Math.min(i-l,n)),a=Math.min(s,Math.max(r,a));break;case 180:n=Math.min(i,Math.max(r,n)),a=Math.min(s,Math.max(l,a));break;case 270:n=Math.min(i,Math.max(l,n)),a=Math.max(0,Math.min(s-r,a));break}this.x=n/=i,this.y=a/=s;let[c,d]=this.getBaseTranslation();n+=c,a+=d,t.left=`${(100*n).toFixed(2)}%`,t.top=`${(100*a).toFixed(2)}%`,this.moveInDOM()}static#T(e,t,i){switch(i){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}}screenToPageTranslation(e,t){return o.#T(e,t,this.parentRotation)}pageTranslationToScreen(e,t){return o.#T(e,t,360-this.parentRotation)}#A(e){switch(e){case 90:{let[t,i]=this.pageDimensions;return[0,-t/i,i/t,0]}case 180:return[-1,0,0,-1];case 270:{let[t,i]=this.pageDimensions;return[0,t/i,-i/t,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){let{parentScale:e,pageDimensions:[t,i]}=this;return[t*e,i*e]}setDims(e,t){let[i,s]=this.parentDimensions,{style:n}=this.div;n.width=`${(100*e/i).toFixed(2)}%`,this.#c||(n.height=`${(100*t/s).toFixed(2)}%`)}fixDims(){let{style:e}=this.div,{height:t,width:i}=e,s=i.endsWith("%"),n=!this.#c&&t.endsWith("%");if(s&&n)return;let[a,r]=this.parentDimensions;s||(e.width=`${(100*parseFloat(i)/a).toFixed(2)}%`),!this.#c&&!n&&(e.height=`${(100*parseFloat(t)/r).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#M(){if(this.#o)return;this.#o=document.createElement("div"),this.#o.classList.add("resizers");let e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(let i of e){let s=document.createElement("div");this.#o.append(s),s.classList.add("resizer",i),s.setAttribute("data-resizer-name",i),s.addEventListener("pointerdown",this.#E.bind(this,i),{signal:t}),s.addEventListener("contextmenu",xt,{signal:t}),s.tabIndex=-1}this.div.prepend(this.#o)}#E(e,t){t.preventDefault();let{isMac:i}=st.platform;if(t.button!==0||t.ctrlKey&&i)return;this.#i?.toggle(!1);let s=this._isDraggable;this._isDraggable=!1,this.#d=[t.screenX,t.screenY];let n=new AbortController,a=this._uiManager.combinedSignal(n);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#B.bind(this,e),{passive:!0,capture:!0,signal:a}),window.addEventListener("touchmove",At,{passive:!1,signal:a}),window.addEventListener("contextmenu",xt,{signal:a}),this.#l={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};let r=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;let c=()=>{n.abort(),this.parent.togglePointerEvents(!0),this.#i?.toggle(!0),this._isDraggable=s,this.parent.div.style.cursor=r,this.div.style.cursor=l,this.#R()};window.addEventListener("pointerup",c,{signal:a}),window.addEventListener("blur",c,{signal:a})}#L(e,t,i,s){this.width=i,this.height=s,this.x=e,this.y=t;let[n,a]=this.parentDimensions;this.setDims(n*i,a*s),this.fixAndSetPosition(),this._onResized()}_onResized(){}#R(){if(!this.#l)return;let{savedX:e,savedY:t,savedWidth:i,savedHeight:s}=this.#l;this.#l=null;let n=this.x,a=this.y,r=this.width,l=this.height;n===e&&a===t&&r===i&&l===s||this.addCommands({cmd:this.#L.bind(this,n,a,r,l),undo:this.#L.bind(this,e,t,i,s),mustExec:!0})}#B(e,t){let[i,s]=this.parentDimensions,n=this.x,a=this.y,r=this.width,l=this.height,c=o.MIN_SIZE/i,d=o.MIN_SIZE/s,h=S=>Math.round(S*1e4)/1e4,u=this.#A(this.rotation),m=(S,L)=>[u[0]*S+u[2]*L,u[1]*S+u[3]*L],p=this.#A(360-this.rotation),f=(S,L)=>[p[0]*S+p[2]*L,p[1]*S+p[3]*L],_,g,b=!1,v=!1;switch(e){case"topLeft":b=!0,_=(S,L)=>[0,0],g=(S,L)=>[S,L];break;case"topMiddle":_=(S,L)=>[S/2,0],g=(S,L)=>[S/2,L];break;case"topRight":b=!0,_=(S,L)=>[S,0],g=(S,L)=>[0,L];break;case"middleRight":v=!0,_=(S,L)=>[S,L/2],g=(S,L)=>[0,L/2];break;case"bottomRight":b=!0,_=(S,L)=>[S,L],g=(S,L)=>[0,0];break;case"bottomMiddle":_=(S,L)=>[S/2,L],g=(S,L)=>[S/2,0];break;case"bottomLeft":b=!0,_=(S,L)=>[0,L],g=(S,L)=>[S,0];break;case"middleLeft":v=!0,_=(S,L)=>[0,L/2],g=(S,L)=>[S,L/2];break}let y=_(r,l),w=g(r,l),A=m(...w),x=h(n+A[0]),T=h(a+A[1]),M=1,H=1,O,G;if(t.fromKeyboard)({deltaX:O,deltaY:G}=t);else{let{screenX:S,screenY:L}=t,[Ct,Bt]=this.#d;[O,G]=this.screenToPageTranslation(S-Ct,L-Bt),this.#d[0]=S,this.#d[1]=L}if([O,G]=f(O/i,G/s),b){let S=Math.hypot(r,l);M=H=Math.max(Math.min(Math.hypot(w[0]-y[0]-O,w[1]-y[1]-G)/S,1/r,1/l),c/r,d/l)}else v?M=Math.max(c,Math.min(1,Math.abs(w[0]-y[0]-O)))/r:H=Math.max(d,Math.min(1,Math.abs(w[1]-y[1]-G)))/l;let tt=h(r*M),z=h(l*H);A=m(...g(tt,z));let dt=x-A[0],U=T-A[1];this.#m||=[this.x,this.y,this.width,this.height],this.width=tt,this.height=z,this.x=dt,this.y=U,this.setDims(i*tt,s*z),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#i?.finish()}addEditToolbar(){return k(this,null,function*(){return this._editToolbar||this.#g?this._editToolbar:(this._editToolbar=new Gs(this),this.div.append(this._editToolbar.render()),this.#i&&(yield this._editToolbar.addAltText(this.#i)),this._editToolbar)})}removeEditToolbar(){this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,this.#i?.destroy())}addContainer(e){let t=this._editToolbar?.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}addAltTextButton(){return k(this,null,function*(){this.#i||(Cr.initialize(o._l10n),this.#i=new Cr(this),this.#t&&(this.#i.data=this.#t,this.#t=null),yield this.addEditToolbar())})}get altTextData(){return this.#i?.data}set altTextData(e){this.#i&&(this.#i.data=e)}get guessedAltText(){return this.#i?.guessedText}setGuessedAltText(e){return k(this,null,function*(){yield this.#i?.setGuessedText(e)})}serializeAltText(e){return this.#i?.serialize(e)}hasAltText(){return!!this.#i&&!this.#i.isEmpty()}hasAltTextData(){return this.#i?.hasData()??!1}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=this.#s?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),this.#D();let[e,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*t/e).toFixed(2)}%`,this.div.style.maxHeight=`${(100*e/t).toFixed(2)}%`);let[i,s]=this.getInitialTranslation();return this.translate(i,s),Ri(this,this.div,["pointerdown"]),this._uiManager._editorUndoBar?.hide(),this.div}pointerdown(e){let{isMac:t}=st.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(this.#u=!0,this._isDraggable){this.#v(e);return}this.#x(e)}get isSelected(){return this._uiManager.isSelected(this)}#x(e){let{isMac:t}=st.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)}#v(e){let{isSelected:t}=this;this._uiManager.setUpDragSession();let i=new AbortController,s=this._uiManager.combinedSignal(i),n={capture:!0,passive:!1,signal:s},a=l=>{i.abort(),this.#a=null,this.#u=!1,this._uiManager.endDragSession()||this.#x(l)};t&&(this.#b=e.clientX,this.#y=e.clientY,this.#a=e.pointerId,this.#n=e.pointerType,window.addEventListener("pointermove",l=>{let{clientX:c,clientY:d,pointerId:h}=l;if(h!==this.#a){At(l);return}let[u,m]=this.screenToPageTranslation(c-this.#b,d-this.#y);this.#b=c,this.#y=d,this._uiManager.dragSelectedEditors(u,m)},n),window.addEventListener("touchmove",At,n),window.addEventListener("pointerdown",l=>{l.isPrimary&&l.pointerType===this.#n&&a(l),At(l)},n)),this._onStartDragging();let r=l=>{if(!this.#a||this.#a===l.pointerId){a(l),this._onStopDragging();return}At(l)};window.addEventListener("pointerup",r,{signal:s}),window.addEventListener("blur",r,{signal:s})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#_&&clearTimeout(this.#_),this.#_=setTimeout(()=>{this.#_=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(e,t,i){e.changeParent(this),this.x=t,this.y=i,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,i=this.rotation){let s=this.parentScale,[n,a]=this.pageDimensions,[r,l]=this.pageTranslation,c=e/s,d=t/s,h=this.x*n,u=this.y*a,m=this.width*n,p=this.height*a;switch(i){case 0:return[h+c+r,a-u-d-p+l,h+c+m+r,a-u-d+l];case 90:return[h+d+r,a-u+c+l,h+d+p+r,a-u+c+m+l];case 180:return[h-c-m+r,a-u+d+l,h-c+r,a-u+d+p+l];case 270:return[h-d-p+r,a-u-c-m+l,h-d+r,a-u-c+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){let[i,s,n,a]=e,r=n-i,l=a-s;switch(this.rotation){case 0:return[i,t-a,r,l];case 90:return[i,t-s,l,r];case 180:return[n,t-s,r,l];case 270:return[n,t-a,l,r];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){this.#g=!0}disableEditMode(){this.#g=!1}isInEditMode(){return this.#g}shouldGetKeyboardEvents(){return this.#f}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){let{top:e,left:t,bottom:i,right:s}=this.getClientDimensions(),{innerHeight:n,innerWidth:a}=window;return t<a&&s>0&&e<n&&i>0}#D(){if(this.#h||!this.div)return;this.#h=new AbortController;let e=this._uiManager.combinedSignal(this.#h);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})}rebuild(){this.#D()}rotate(e){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(e=!1,t=null){V("An editor must be serializable")}static deserialize(e,t,i){return k(this,null,function*(){let s=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:i});s.rotation=e.rotation,s.#t=e.accessibilityData;let[n,a]=s.pageDimensions,[r,l,c,d]=s.getRectInCurrentCoords(e.rect,a);return s.x=r/n,s.y=l/a,s.width=c/n,s.height=d/a,s})}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#h?.abort(),this.#h=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#_&&(clearTimeout(this.#_),this.#_=null),this.#I(),this.removeEditToolbar(),this.#w){for(let e of this.#w.values())clearTimeout(e);this.#w=null}this.parent=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#M(),this.#o.classList.remove("hidden"),Ri(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),this.#l={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};let t=this.#o.children;if(!this.#e){this.#e=Array.from(t);let a=this.#H.bind(this),r=this.#j.bind(this),l=this._uiManager._signal;for(let c of this.#e){let d=c.getAttribute("data-resizer-name");c.setAttribute("role","spinbutton"),c.addEventListener("keydown",a,{signal:l}),c.addEventListener("blur",r,{signal:l}),c.addEventListener("focus",this.#V.bind(this,d),{signal:l}),c.setAttribute("data-l10n-id",o._l10nResizer[d])}}let i=this.#e[0],s=0;for(let a of t){if(a===i)break;s++}let n=(360-this.rotation+this.parentRotation)%360/90*(this.#e.length/4);if(n!==s){if(n<s)for(let r=0;r<s-n;r++)this.#o.append(this.#o.firstChild);else if(n>s)for(let r=0;r<n-s;r++)this.#o.firstChild.before(this.#o.lastChild);let a=0;for(let r of t){let c=this.#e[a++].getAttribute("data-resizer-name");r.setAttribute("data-l10n-id",o._l10nResizer[c])}}this.#F(0),this.#f=!0,this.#o.firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}#H(e){o._resizerKeyboardManager.exec(this,e)}#j(e){this.#f&&e.relatedTarget?.parentNode!==this.#o&&this.#I()}#V(e){this.#r=this.#f?e:""}#F(e){if(this.#e)for(let t of this.#e)t.tabIndex=e}_resizeWithKeyboard(e,t){this.#f&&this.#B(this.#r,{deltaX:e,deltaY:t,fromKeyboard:!0})}#I(){this.#f=!1,this.#F(-1),this.#R()}_stopResizingWithKeyboard(){this.#I(),this.div.focus()}select(){if(this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#i?.toggleAltTextBadge(!1)}unselect(){this.#o?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#i?.toggleAltTextBadge(!0)}updateParams(e,t){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return this.#p}set isEditing(e){this.#p=e,this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){this.#c=!0;let i=e/t,{style:s}=this.div;s.aspectRatio=i,s.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){this.#w||=new Map;let{action:i}=e,s=this.#w.get(i);s&&clearTimeout(s),s=setTimeout(()=>{this._reportTelemetry(e),this.#w.delete(i),this.#w.size===0&&(this.#w=null)},o._telemetryTimeout),this.#w.set(i,s);return}e.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),this.#s=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#s=!0}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){let i=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),i.before(t)}return t}resetAnnotationElement(e){let{firstChild:t}=e.container;t?.nodeName==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}},Ys=class extends q{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}},kr=3285377520,bt=4294901760,Nt=65535,Oi=class{constructor(e){this.h1=e?e&4294967295:kr,this.h2=e?e&4294967295:kr}update(e){let t,i;if(typeof e=="string"){t=new Uint8Array(e.length*2),i=0;for(let f=0,_=e.length;f<_;f++){let g=e.charCodeAt(f);g<=255?t[i++]=g:(t[i++]=g>>>8,t[i++]=g&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),i=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");let s=i>>2,n=i-s*4,a=new Uint32Array(t.buffer,0,s),r=0,l=0,c=this.h1,d=this.h2,h=3432918353,u=461845907,m=h&Nt,p=u&Nt;for(let f=0;f<s;f++)f&1?(r=a[f],r=r*h&bt|r*m&Nt,r=r<<15|r>>>17,r=r*u&bt|r*p&Nt,c^=r,c=c<<13|c>>>19,c=c*5+3864292196):(l=a[f],l=l*h&bt|l*m&Nt,l=l<<15|l>>>17,l=l*u&bt|l*p&Nt,d^=l,d=d<<13|d>>>19,d=d*5+3864292196);switch(r=0,n){case 3:r^=t[s*4+2]<<16;case 2:r^=t[s*4+1]<<8;case 1:r^=t[s*4],r=r*h&bt|r*m&Nt,r=r<<15|r>>>17,r=r*u&bt|r*p&Nt,s&1?c^=r:d^=r}this.h1=c,this.h2=d}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&bt|e*36045&Nt,t=t*4283543511&bt|((t<<16|e>>>16)*2950163797&bt)>>>16,e^=t>>>1,e=e*444984403&bt|e*60499&Nt,t=t*3301882366&bt|((t<<16|e>>>16)*3120437893&bt)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}},Ks=Object.freeze({map:null,hash:"",transfer:void 0}),qe=class{#t=!1;#e=null;#i=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){let i=this.#i.get(e);return i===void 0?t:Object.assign(t,i)}getRawValue(e){return this.#i.get(e)}remove(e){if(this.#i.delete(e),this.#i.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(let t of this.#i.values())if(t instanceof q)return;this.onAnnotationEditor(null)}}setValue(e,t){let i=this.#i.get(e),s=!1;if(i!==void 0)for(let[n,a]of Object.entries(t))i[n]!==a&&(s=!0,i[n]=a);else s=!0,this.#i.set(e,t);s&&this.#s(),t instanceof q&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return this.#i.has(e)}getAll(){return this.#i.size>0?oa(this.#i):null}setAll(e){for(let[t,i]of Object.entries(e))this.setValue(t,i)}get size(){return this.#i.size}#s(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new Fi(this)}get serializable(){if(this.#i.size===0)return Ks;let e=new Map,t=new Oi,i=[],s=Object.create(null),n=!1;for(let[a,r]of this.#i){let l=r instanceof q?r.serialize(!1,s):r;l&&(e.set(a,l),t.update(`${a}:${JSON.stringify(l)}`),n||=!!l.bitmap)}if(n)for(let a of e.values())a.bitmap&&i.push(a.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:i}:Ks}get editorStats(){let e=null,t=new Map;for(let i of this.#i.values()){if(!(i instanceof q))continue;let s=i.telemetryFinalData;if(!s)continue;let{type:n}=s;t.has(n)||t.set(n,Object.getPrototypeOf(i).constructor),e||=Object.create(null);let a=e[n]||=new Map;for(let[r,l]of Object.entries(s)){if(r==="type")continue;let c=a.get(r);c||(c=new Map,a.set(r,c));let d=c.get(l)??0;c.set(l,d+1)}}for(let[i,s]of t)e[i]=s.computeTelemetryFinalData(e[i]);return e}resetModifiedIds(){this.#e=null}get modifiedIds(){if(this.#e)return this.#e;let e=[];for(let t of this.#i.values())!(t instanceof q)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return this.#e={ids:new Set(e),hash:e.join(",")}}},Fi=class extends qe{#t;constructor(e){super();let{map:t,hash:i,transfer:s}=e.serializable,n=structuredClone(t,s?{transfer:s}:null);this.#t={map:n,hash:i,transfer:s}}get print(){V("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}get modifiedIds(){return F(this,"modifiedIds",{ids:new Set,hash:""})}},Qs=class{#t=new Set;constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));let t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(let e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}loadSystemFont(i){return k(this,arguments,function*({systemFontInfo:e,_inspectFont:t}){if(!(!e||this.#t.has(e.loadedName))){if(J(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){let{loadedName:s,src:n,style:a}=e,r=new FontFace(s,n,a);this.addNativeFontFace(r);try{yield r.load(),this.#t.add(s),t?.(e)}catch{R(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(r)}return}V("Not implemented: loadSystemFont without the Font Loading API.")}})}bind(e){return k(this,null,function*(){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){yield this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){let i=e.createNativeFontFace();if(i){this.addNativeFontFace(i);try{yield i.loaded}catch(s){throw R(`Failed to load font '${i.family}': '${s}'.`),e.disableFontFace=!0,s}}return}let t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;yield new Promise(i=>{let s=this._queueLoadingCallback(i);this._prepareFontLoadEvent(e,s)})}})}get isFontLoadingAPISupported(){let e=!!this._document?.fonts;return F(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){let e=!1;return(ct||typeof navigator<"u"&&typeof navigator?.userAgent=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),F(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){function t(){for(J(!s.done,"completeRequest() cannot be called twice."),s.done=!0;i.length>0&&i[0].done;){let n=i.shift();setTimeout(n.callback,0)}}let{loadingRequests:i}=this,s={done:!1,complete:t,callback:e};return i.push(s),s}get _loadTestFont(){let e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return F(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function i(y,w){return y.charCodeAt(w)<<24|y.charCodeAt(w+1)<<16|y.charCodeAt(w+2)<<8|y.charCodeAt(w+3)&255}function s(y,w,A,x){let T=y.substring(0,w),M=y.substring(w+A);return T+x+M}let n,a,r=this._document.createElement("canvas");r.width=1,r.height=1;let l=r.getContext("2d"),c=0;function d(y,w){if(++c>30){R("Load test font never loaded."),w();return}if(l.font="30px "+y,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){w();return}setTimeout(d.bind(null,y,w))}let h=`lt${Date.now()}${this.loadTestFontId++}`,u=this._loadTestFont;u=s(u,976,h.length,h);let p=16,f=1482184792,_=i(u,p);for(n=0,a=h.length-3;n<a;n+=4)_=_-f+i(h,n)|0;n<h.length&&(_=_-f+i(h+"XXX",n)|0),u=s(u,p,4,Do(_));let g=`url(data:font/opentype;base64,${btoa(u)});`,b=`@font-face {font-family:"${h}";src:${g}}`;this.insertRule(b);let v=this._document.createElement("div");v.style.visibility="hidden",v.style.width=v.style.height="10px",v.style.position="absolute",v.style.top=v.style.left="0px";for(let y of[e.loadedName,h]){let w=this._document.createElement("span");w.textContent="Hi",w.style.fontFamily=y,v.append(w)}this._document.body.append(v),d(h,()=>{v.remove(),t.complete()})}},Zs=class{constructor(e,{disableFontFace:t=!1,inspectFont:i=null}){this.compiledGlyphs=Object.create(null);for(let s in e)this[s]=e[s];this.disableFontFace=t===!0,this._inspectFont=i}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{let t={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(t.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,t)}return this._inspectFont?.(this),e}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;let e=`url(data:${this.mimetype};base64,${Ho(this.data)});`,t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${e}}`}return this._inspectFont?.(this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];let i;try{i=e.get(this.loadedName+"_path_"+t)}catch(n){R(`getPathGenerator - ignoring character: "${n}".`)}if(!Array.isArray(i)||i.length===0)return this.compiledGlyphs[t]=function(n,a){};let s=[];for(let n=0,a=i.length;n<a;)switch(i[n++]){case Vt.BEZIER_CURVE_TO:{let[r,l,c,d,h,u]=i.slice(n,n+6);s.push(m=>m.bezierCurveTo(r,l,c,d,h,u)),n+=6}break;case Vt.MOVE_TO:{let[r,l]=i.slice(n,n+2);s.push(c=>c.moveTo(r,l)),n+=2}break;case Vt.LINE_TO:{let[r,l]=i.slice(n,n+2);s.push(c=>c.lineTo(r,l)),n+=2}break;case Vt.QUADRATIC_CURVE_TO:{let[r,l,c,d]=i.slice(n,n+4);s.push(h=>h.quadraticCurveTo(r,l,c,d)),n+=4}break;case Vt.RESTORE:s.push(r=>r.restore());break;case Vt.SAVE:s.push(r=>r.save());break;case Vt.SCALE:J(s.length===2,"Scale command is only valid at the third position.");break;case Vt.TRANSFORM:{let[r,l,c,d,h,u]=i.slice(n,n+6);s.push(m=>m.transform(r,l,c,d,h,u)),n+=6}break;case Vt.TRANSLATE:{let[r,l]=i.slice(n,n+2);s.push(c=>c.translate(r,l)),n+=2}break}return s.push(n=>n.closePath()),this.compiledGlyphs[t]=function(a,r){s[0](a),s[1](a),a.scale(r,-r);for(let l=2,c=s.length;l<c;l++)s[l](a)}}},Ni=class{#t=!1;constructor({enableHWA:e=!1}){this.#t=e}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");let i=this._createCanvas(e,t);return{canvas:i,context:i.getContext("2d",{willReadFrequently:!this.#t})}}reset(e,t,i){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||i<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=i}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){V("Abstract method `_createCanvas` called.")}},Js=class extends Ni{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){let i=this._document.createElement("canvas");return i.width=e,i.height=t,i}},Bi=class{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}fetch(t){return k(this,arguments,function*({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");let i=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(i).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${i}`)})})}_fetch(e){return k(this,null,function*(){V("Abstract method `_fetch` called.")})}},Hi=class extends Bi{_fetch(e){return k(this,null,function*(){let t=yield ds(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):cs(t)})}},zi=class{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,i,s,n){return"none"}destroy(e=!1){}},tn=class extends zi{#t;#e;#i;#s;#a;#n;#c=0;constructor({docId:e,ownerDocument:t=globalThis.document}){super(),this.#s=e,this.#a=t}get#o(){return this.#e||=new Map}get#d(){return this.#n||=new Map}get#l(){if(!this.#i){let e=this.#a.createElement("div"),{style:t}=e;t.visibility="hidden",t.contain="strict",t.width=t.height=0,t.position="absolute",t.top=t.left=0,t.zIndex=-1;let i=this.#a.createElementNS(Gt,"svg");i.setAttribute("width",0),i.setAttribute("height",0),this.#i=this.#a.createElementNS(Gt,"defs"),e.append(i),i.append(this.#i),this.#a.body.append(e)}return this.#i}#h(e){if(e.length===1){let l=e[0],c=new Array(256);for(let h=0;h<256;h++)c[h]=l[h]/255;let d=c.join(",");return[d,d,d]}let[t,i,s]=e,n=new Array(256),a=new Array(256),r=new Array(256);for(let l=0;l<256;l++)n[l]=t[l]/255,a[l]=i[l]/255,r[l]=s[l]/255;return[n.join(","),a.join(","),r.join(",")]}#r(e){if(this.#t===void 0){this.#t="";let t=this.#a.URL;t!==this.#a.baseURI&&(hs(t)?R('#createUrl: ignore "data:"-URL for performance reasons.'):this.#t=t.split("#",1)[0])}return`url(${this.#t}#${e})`}addFilter(e){if(!e)return"none";let t=this.#o.get(e);if(t)return t;let[i,s,n]=this.#h(e),a=e.length===1?i:`${i}${s}${n}`;if(t=this.#o.get(a),t)return this.#o.set(e,t),t;let r=`g_${this.#s}_transfer_map_${this.#c++}`,l=this.#r(r);this.#o.set(e,l),this.#o.set(a,l);let c=this.#p(r);return this.#f(i,s,n,c),l}addHCMFilter(e,t){let i=`${e}-${t}`,s="base",n=this.#d.get(s);if(n?.key===i||(n?(n.filter?.remove(),n.key=i,n.url="none",n.filter=null):(n={key:i,url:"none",filter:null},this.#d.set(s,n)),!e||!t))return n.url;let a=this.#b(e);e=E.makeHexColor(...a);let r=this.#b(t);if(t=E.makeHexColor(...r),this.#l.style.color="",e==="#000000"&&t==="#ffffff"||e===t)return n.url;let l=new Array(256);for(let m=0;m<=255;m++){let p=m/255;l[m]=p<=.03928?p/12.92:((p+.055)/1.055)**2.4}let c=l.join(","),d=`g_${this.#s}_hcm_filter`,h=n.filter=this.#p(d);this.#f(c,c,c,h),this.#m(h);let u=(m,p)=>{let f=a[m]/255,_=r[m]/255,g=new Array(p+1);for(let b=0;b<=p;b++)g[b]=f+b/p*(_-f);return g.join(",")};return this.#f(u(0,5),u(1,5),u(2,5),h),n.url=this.#r(d),n.url}addAlphaFilter(e){let t=this.#o.get(e);if(t)return t;let[i]=this.#h([e]),s=`alpha_${i}`;if(t=this.#o.get(s),t)return this.#o.set(e,t),t;let n=`g_${this.#s}_alpha_map_${this.#c++}`,a=this.#r(n);this.#o.set(e,a),this.#o.set(s,a);let r=this.#p(n);return this.#_(i,r),a}addLuminosityFilter(e){let t=this.#o.get(e||"luminosity");if(t)return t;let i,s;if(e?([i]=this.#h([e]),s=`luminosity_${i}`):s="luminosity",t=this.#o.get(s),t)return this.#o.set(e,t),t;let n=`g_${this.#s}_luminosity_map_${this.#c++}`,a=this.#r(n);this.#o.set(e,a),this.#o.set(s,a);let r=this.#p(n);return this.#u(r),e&&this.#_(i,r),a}addHighlightHCMFilter(e,t,i,s,n){let a=`${t}-${i}-${s}-${n}`,r=this.#d.get(e);if(r?.key===a||(r?(r.filter?.remove(),r.key=a,r.url="none",r.filter=null):(r={key:a,url:"none",filter:null},this.#d.set(e,r)),!t||!i))return r.url;let[l,c]=[t,i].map(this.#b.bind(this)),d=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),h=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),[u,m]=[s,n].map(this.#b.bind(this));h<d&&([d,h,u,m]=[h,d,m,u]),this.#l.style.color="";let p=(g,b,v)=>{let y=new Array(256),w=(h-d)/v,A=g/255,x=(b-g)/(255*v),T=0;for(let M=0;M<=v;M++){let H=Math.round(d+M*w),O=A+M*x;for(let G=T;G<=H;G++)y[G]=O;T=H+1}for(let M=T;M<256;M++)y[M]=y[T-1];return y.join(",")},f=`g_${this.#s}_hcm_${e}_filter`,_=r.filter=this.#p(f);return this.#m(_),this.#f(p(u[0],m[0],5),p(u[1],m[1],5),p(u[2],m[2],5),_),r.url=this.#r(f),r.url}destroy(e=!1){e&&this.#n?.size||(this.#i?.parentNode.parentNode.remove(),this.#i=null,this.#e?.clear(),this.#e=null,this.#n?.clear(),this.#n=null,this.#c=0)}#u(e){let t=this.#a.createElementNS(Gt,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(t)}#m(e){let t=this.#a.createElementNS(Gt,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(t)}#p(e){let t=this.#a.createElementNS(Gt,"filter");return t.setAttribute("color-interpolation-filters","sRGB"),t.setAttribute("id",e),this.#l.append(t),t}#g(e,t,i){let s=this.#a.createElementNS(Gt,t);s.setAttribute("type","discrete"),s.setAttribute("tableValues",i),e.append(s)}#f(e,t,i,s){let n=this.#a.createElementNS(Gt,"feComponentTransfer");s.append(n),this.#g(n,"feFuncR",e),this.#g(n,"feFuncG",t),this.#g(n,"feFuncB",i)}#_(e,t){let i=this.#a.createElementNS(Gt,"feComponentTransfer");t.append(i),this.#g(i,"feFuncA",e)}#b(e){return this.#l.style.color=e,da(getComputedStyle(this.#l).getPropertyValue("color"))}},ji=class{constructor({baseUrl:e=null}){this.baseUrl=e}fetch(t){return k(this,arguments,function*({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");let i=`${this.baseUrl}${e}`;return this._fetch(i).catch(s=>{throw new Error(`Unable to load font data at: ${i}`)})})}_fetch(e){return k(this,null,function*(){V("Abstract method `_fetch` called.")})}},Vi=class extends ji{_fetch(e){return k(this,null,function*(){let t=yield ds(e,"arraybuffer");return new Uint8Array(t)})}};function zr(o){return k(this,null,function*(){let t=yield process.getBuiltinModule("fs").promises.readFile(o);return new Uint8Array(t)})}var en=class extends zi{},sn=class extends Ni{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}},nn=class extends Bi{_fetch(e){return k(this,null,function*(){return zr(e)})}},an=class extends ji{_fetch(e){return k(this,null,function*(){return zr(e)})}},ot={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function rn(o,e){if(!e)return;let t=e[2]-e[0],i=e[3]-e[1],s=new Path2D;s.rect(e[0],e[1],t,i),o.clip(s)}var Xe=class{getPattern(){V("Abstract method `getPattern` called.")}},on=class extends Xe{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(let i of this._colorStops)t.addColorStop(i[0],i[1]);return t}getPattern(e,t,i,s){let n;if(s===ot.STROKE||s===ot.FILL){let a=t.current.getClippedPathBoundingBox(s,W(e))||[0,0,0,0],r=Math.ceil(a[2]-a[0])||1,l=Math.ceil(a[3]-a[1])||1,c=t.cachedCanvases.getCanvas("pattern",r,l),d=c.context;d.clearRect(0,0,d.canvas.width,d.canvas.height),d.beginPath(),d.rect(0,0,d.canvas.width,d.canvas.height),d.translate(-a[0],-a[1]),i=E.transform(i,[1,0,0,1,a[0],a[1]]),d.transform(...t.baseTransform),this.matrix&&d.transform(...this.matrix),rn(d,this._bbox),d.fillStyle=this._createGradient(d),d.fill(),n=e.createPattern(c.canvas,"no-repeat");let h=new DOMMatrix(i);n.setTransform(h)}else rn(e,this._bbox),n=this._createGradient(e);return n}};function Bs(o,e,t,i,s,n,a,r){let l=e.coords,c=e.colors,d=o.data,h=o.width*4,u;l[t+1]>l[i+1]&&(u=t,t=i,i=u,u=n,n=a,a=u),l[i+1]>l[s+1]&&(u=i,i=s,s=u,u=a,a=r,r=u),l[t+1]>l[i+1]&&(u=t,t=i,i=u,u=n,n=a,a=u);let m=(l[t]+e.offsetX)*e.scaleX,p=(l[t+1]+e.offsetY)*e.scaleY,f=(l[i]+e.offsetX)*e.scaleX,_=(l[i+1]+e.offsetY)*e.scaleY,g=(l[s]+e.offsetX)*e.scaleX,b=(l[s+1]+e.offsetY)*e.scaleY;if(p>=b)return;let v=c[n],y=c[n+1],w=c[n+2],A=c[a],x=c[a+1],T=c[a+2],M=c[r],H=c[r+1],O=c[r+2],G=Math.round(p),tt=Math.round(b),z,dt,U,S,L,Ct,Bt,pt;for(let it=G;it<=tt;it++){if(it<_){let $=it<p?0:(p-it)/(p-_);z=m-(m-f)*$,dt=v-(v-A)*$,U=y-(y-x)*$,S=w-(w-T)*$}else{let $;it>b?$=1:_===b?$=0:$=(_-it)/(_-b),z=f-(f-g)*$,dt=A-(A-M)*$,U=x-(x-H)*$,S=T-(T-O)*$}let K;it<p?K=0:it>b?K=1:K=(p-it)/(p-b),L=m-(m-g)*K,Ct=v-(v-M)*K,Bt=y-(y-H)*K,pt=w-(w-O)*K;let fe=Math.round(Math.min(z,L)),Te=Math.round(Math.max(z,L)),ft=h*it+fe*4;for(let $=fe;$<=Te;$++)K=(z-$)/(z-L),K<0?K=0:K>1&&(K=1),d[ft++]=dt-(dt-Ct)*K|0,d[ft++]=U-(U-Bt)*K|0,d[ft++]=S-(S-pt)*K|0,d[ft++]=255}}function Uo(o,e,t){let i=e.coords,s=e.colors,n,a;switch(e.type){case"lattice":let r=e.verticesPerRow,l=Math.floor(i.length/r)-1,c=r-1;for(n=0;n<l;n++){let d=n*r;for(let h=0;h<c;h++,d++)Bs(o,t,i[d],i[d+1],i[d+r],s[d],s[d+1],s[d+r]),Bs(o,t,i[d+r+1],i[d+1],i[d+r],s[d+r+1],s[d+1],s[d+r])}break;case"triangles":for(n=0,a=i.length;n<a;n+=3)Bs(o,t,i[n],i[n+1],i[n+2],s[n],s[n+1],s[n+2]);break;default:throw new Error("illegal figure")}}var ln=class extends Xe{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,i){let r=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),c=Math.ceil(this._bounds[2])-r,d=Math.ceil(this._bounds[3])-l,h=Math.min(Math.ceil(Math.abs(c*e[0]*1.1)),3e3),u=Math.min(Math.ceil(Math.abs(d*e[1]*1.1)),3e3),m=c/h,p=d/u,f={coords:this._coords,colors:this._colors,offsetX:-r,offsetY:-l,scaleX:1/m,scaleY:1/p},_=h+2*2,g=u+2*2,b=i.getCanvas("mesh",_,g),v=b.context,y=v.createImageData(h,u);if(t){let A=y.data;for(let x=0,T=A.length;x<T;x+=4)A[x]=t[0],A[x+1]=t[1],A[x+2]=t[2],A[x+3]=255}for(let A of this._figures)Uo(y,A,f);return v.putImageData(y,2,2),{canvas:b.canvas,offsetX:r-2*m,offsetY:l-2*p,scaleX:m,scaleY:p}}getPattern(e,t,i,s){rn(e,this._bbox);let n;if(s===ot.SHADING)n=E.singularValueDecompose2dScale(W(e));else if(n=E.singularValueDecompose2dScale(t.baseTransform),this.matrix){let r=E.singularValueDecompose2dScale(this.matrix);n=[n[0]*r[0],n[1]*r[1]]}let a=this._createMeshCanvas(n,s===ot.SHADING?null:this._background,t.cachedCanvases);return s!==ot.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(a.offsetX,a.offsetY),e.scale(a.scaleX,a.scaleY),e.createPattern(a.canvas,"no-repeat")}},cn=class extends Xe{getPattern(){return"hotpink"}};function $o(o){switch(o[0]){case"RadialAxial":return new on(o);case"Mesh":return new ln(o);case"Dummy":return new cn}throw new Error(`Unknown IR type: ${o[0]}`)}var Sr={COLORED:1,UNCOLORED:2},Wo=(()=>{class o{static MAX_PATTERN_SIZE=3e3;constructor(t,i,s,n,a){this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.color=i,this.ctx=s,this.canvasGraphicsFactory=n,this.baseTransform=a}createPatternCanvas(t){let{bbox:i,operatorList:s,paintType:n,tilingType:a,color:r,canvasGraphicsFactory:l}=this,{xstep:c,ystep:d}=this;c=Math.abs(c),d=Math.abs(d),ls("TilingType: "+a);let h=i[0],u=i[1],m=i[2],p=i[3],f=m-h,_=p-u,g=E.singularValueDecompose2dScale(this.matrix),b=E.singularValueDecompose2dScale(this.baseTransform),v=g[0]*b[0],y=g[1]*b[1],w=f,A=_,x=!1,T=!1,M=Math.ceil(c*v),H=Math.ceil(d*y),O=Math.ceil(f*v),G=Math.ceil(_*y);M>=O?w=c:x=!0,H>=G?A=d:T=!0;let tt=this.getSizeAndScale(w,this.ctx.canvas.width,v),z=this.getSizeAndScale(A,this.ctx.canvas.height,y),dt=t.cachedCanvases.getCanvas("pattern",tt.size,z.size),U=dt.context,S=l.createCanvasGraphics(U);if(S.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(S,n,r),U.translate(-tt.scale*h,-z.scale*u),S.transform(tt.scale,0,0,z.scale,0,0),U.save(),this.clipBbox(S,h,u,m,p),S.baseTransform=W(S.ctx),S.executeOperatorList(s),S.endDrawing(),U.restore(),x||T){let L=dt.canvas;x&&(w=c),T&&(A=d);let Ct=this.getSizeAndScale(w,this.ctx.canvas.width,v),Bt=this.getSizeAndScale(A,this.ctx.canvas.height,y),pt=Ct.size,it=Bt.size,K=t.cachedCanvases.getCanvas("pattern-workaround",pt,it),fe=K.context,Te=x?Math.floor(f/c):0,ft=T?Math.floor(_/d):0;for(let $=0;$<=Te;$++)for(let kt=0;kt<=ft;kt++)fe.drawImage(L,pt*$,it*kt,pt,it,0,0,pt,it);return{canvas:K.canvas,scaleX:Ct.scale,scaleY:Bt.scale,offsetX:h,offsetY:u}}return{canvas:dt.canvas,scaleX:tt.scale,scaleY:z.scale,offsetX:h,offsetY:u}}getSizeAndScale(t,i,s){let n=Math.max(o.MAX_PATTERN_SIZE,i),a=Math.ceil(t*s);return a>=n?a=n:s=a/t,{scale:s,size:a}}clipBbox(t,i,s,n,a){let r=n-i,l=a-s;t.ctx.rect(i,s,r,l),t.current.updateRectMinMax(W(t.ctx),[i,s,n,a]),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,i,s){let n=t.ctx,a=t.current;switch(i){case Sr.COLORED:let r=this.ctx;n.fillStyle=r.fillStyle,n.strokeStyle=r.strokeStyle,a.fillColor=r.fillStyle,a.strokeColor=r.strokeStyle;break;case Sr.UNCOLORED:let l=E.makeHexColor(s[0],s[1],s[2]);n.fillStyle=l,n.strokeStyle=l,a.fillColor=l,a.strokeColor=l;break;default:throw new Vs(`Unsupported paint type: ${i}`)}}getPattern(t,i,s,n){let a=s;n!==ot.SHADING&&(a=E.transform(a,i.baseTransform),this.matrix&&(a=E.transform(a,this.matrix)));let r=this.createPatternCanvas(i),l=new DOMMatrix(a);l=l.translate(r.offsetX,r.offsetY),l=l.scale(1/r.scaleX,1/r.scaleY);let c=t.createPattern(r.canvas,"repeat");return c.setTransform(l),c}}return o})();function qo({src:o,srcPos:e=0,dest:t,width:i,height:s,nonBlackColor:n=4294967295,inverseDecode:a=!1}){let r=st.isLittleEndian?4278190080:255,[l,c]=a?[n,r]:[r,n],d=i>>3,h=i&7,u=o.length;t=new Uint32Array(t.buffer);let m=0;for(let p=0;p<s;p++){for(let _=e+d;e<_;e++){let g=e<u?o[e]:255;t[m++]=g&128?c:l,t[m++]=g&64?c:l,t[m++]=g&32?c:l,t[m++]=g&16?c:l,t[m++]=g&8?c:l,t[m++]=g&4?c:l,t[m++]=g&2?c:l,t[m++]=g&1?c:l}if(h===0)continue;let f=e<u?o[e++]:255;for(let _=0;_<h;_++)t[m++]=f&1<<7-_?c:l}return{srcPos:e,destPos:m}}var Er=16,Tr=100,Xo=15,Mr=10,Lr=1e3,ut=16;function Yo(o,e){if(o._removeMirroring)throw new Error("Context is already forwarding operations.");o.__originalSave=o.save,o.__originalRestore=o.restore,o.__originalRotate=o.rotate,o.__originalScale=o.scale,o.__originalTranslate=o.translate,o.__originalTransform=o.transform,o.__originalSetTransform=o.setTransform,o.__originalResetTransform=o.resetTransform,o.__originalClip=o.clip,o.__originalMoveTo=o.moveTo,o.__originalLineTo=o.lineTo,o.__originalBezierCurveTo=o.bezierCurveTo,o.__originalRect=o.rect,o.__originalClosePath=o.closePath,o.__originalBeginPath=o.beginPath,o._removeMirroring=()=>{o.save=o.__originalSave,o.restore=o.__originalRestore,o.rotate=o.__originalRotate,o.scale=o.__originalScale,o.translate=o.__originalTranslate,o.transform=o.__originalTransform,o.setTransform=o.__originalSetTransform,o.resetTransform=o.__originalResetTransform,o.clip=o.__originalClip,o.moveTo=o.__originalMoveTo,o.lineTo=o.__originalLineTo,o.bezierCurveTo=o.__originalBezierCurveTo,o.rect=o.__originalRect,o.closePath=o.__originalClosePath,o.beginPath=o.__originalBeginPath,delete o._removeMirroring},o.save=function(){e.save(),this.__originalSave()},o.restore=function(){e.restore(),this.__originalRestore()},o.translate=function(i,s){e.translate(i,s),this.__originalTranslate(i,s)},o.scale=function(i,s){e.scale(i,s),this.__originalScale(i,s)},o.transform=function(i,s,n,a,r,l){e.transform(i,s,n,a,r,l),this.__originalTransform(i,s,n,a,r,l)},o.setTransform=function(i,s,n,a,r,l){e.setTransform(i,s,n,a,r,l),this.__originalSetTransform(i,s,n,a,r,l)},o.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},o.rotate=function(i){e.rotate(i),this.__originalRotate(i)},o.clip=function(i){e.clip(i),this.__originalClip(i)},o.moveTo=function(t,i){e.moveTo(t,i),this.__originalMoveTo(t,i)},o.lineTo=function(t,i){e.lineTo(t,i),this.__originalLineTo(t,i)},o.bezierCurveTo=function(t,i,s,n,a,r){e.bezierCurveTo(t,i,s,n,a,r),this.__originalBezierCurveTo(t,i,s,n,a,r)},o.rect=function(t,i,s,n){e.rect(t,i,s,n),this.__originalRect(t,i,s,n)},o.closePath=function(){e.closePath(),this.__originalClosePath()},o.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}var dn=class{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,i){let s;return this.cache[e]!==void 0?(s=this.cache[e],this.canvasFactory.reset(s,t,i)):(s=this.canvasFactory.create(t,i),this.cache[e]=s),s}delete(e){delete this.cache[e]}clear(){for(let e in this.cache){let t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}};function Ci(o,e,t,i,s,n,a,r,l,c){let[d,h,u,m,p,f]=W(o);if(h===0&&u===0){let b=a*d+p,v=Math.round(b),y=r*m+f,w=Math.round(y),A=(a+l)*d+p,x=Math.abs(Math.round(A)-v)||1,T=(r+c)*m+f,M=Math.abs(Math.round(T)-w)||1;return o.setTransform(Math.sign(d),0,0,Math.sign(m),v,w),o.drawImage(e,t,i,s,n,0,0,x,M),o.setTransform(d,h,u,m,p,f),[x,M]}if(d===0&&m===0){let b=r*u+p,v=Math.round(b),y=a*h+f,w=Math.round(y),A=(r+c)*u+p,x=Math.abs(Math.round(A)-v)||1,T=(a+l)*h+f,M=Math.abs(Math.round(T)-w)||1;return o.setTransform(0,Math.sign(h),Math.sign(u),0,v,w),o.drawImage(e,t,i,s,n,0,0,M,x),o.setTransform(d,h,u,m,p,f),[M,x]}o.drawImage(e,t,i,s,n,a,r,l,c);let _=Math.hypot(d,h),g=Math.hypot(u,m);return[_*l,g*c]}function Ko(o){let{width:e,height:t}=o;if(e>Lr||t>Lr)return null;let i=1e3,s=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),n=e+1,a=new Uint8Array(n*(t+1)),r,l,c,d=e+7&-8,h=new Uint8Array(d*t),u=0;for(let g of o.data){let b=128;for(;b>0;)h[u++]=g&b?0:255,b>>=1}let m=0;for(u=0,h[u]!==0&&(a[0]=1,++m),l=1;l<e;l++)h[u]!==h[u+1]&&(a[l]=h[u]?2:1,++m),u++;for(h[u]!==0&&(a[l]=2,++m),r=1;r<t;r++){u=r*d,c=r*n,h[u-d]!==h[u]&&(a[c]=h[u]?1:8,++m);let g=(h[u]?4:0)+(h[u-d]?8:0);for(l=1;l<e;l++)g=(g>>2)+(h[u+1]?4:0)+(h[u-d+1]?8:0),s[g]&&(a[c+l]=s[g],++m),u++;if(h[u-d]!==h[u]&&(a[c+l]=h[u]?2:4,++m),m>i)return null}for(u=d*(t-1),c=r*n,h[u]!==0&&(a[c]=8,++m),l=1;l<e;l++)h[u]!==h[u+1]&&(a[c+l]=h[u]?4:8,++m),u++;if(h[u]!==0&&(a[c+l]=4,++m),m>i)return null;let p=new Int32Array([0,n,-1,0,-n,0,0,0,1]),f=new Path2D;for(r=0;m&&r<=t;r++){let g=r*n,b=g+e;for(;g<b&&!a[g];)g++;if(g===b)continue;f.moveTo(g%n,r);let v=g,y=a[g];do{let w=p[y];do g+=w;while(!a[g]);let A=a[g];A!==5&&A!==10?(y=A,a[g]=0):(y=A&51*y>>4,a[g]&=y>>2|y<<2),f.lineTo(g%n,g/n|0),a[g]||--m}while(v!==g);--r}return h=null,a=null,function(g){g.save(),g.scale(1/e,-1/t),g.translate(0,-t),g.fill(f),g.beginPath(),g.restore()}}var Gi=class{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=Br,this.textMatrixScale=1,this.fontMatrix=js,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=rt.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){let e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,i){[t,i]=E.applyTransform([t,i],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,i),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,i)}updateRectMinMax(e,t){let i=E.applyTransform(t,e),s=E.applyTransform(t.slice(2),e),n=E.applyTransform([t[0],t[3]],e),a=E.applyTransform([t[2],t[1]],e);this.minX=Math.min(this.minX,i[0],s[0],n[0],a[0]),this.minY=Math.min(this.minY,i[1],s[1],n[1],a[1]),this.maxX=Math.max(this.maxX,i[0],s[0],n[0],a[0]),this.maxY=Math.max(this.maxY,i[1],s[1],n[1],a[1])}updateScalingPathMinMax(e,t){E.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.minY=Math.min(this.minY,t[1]),this.maxX=Math.max(this.maxX,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,i,s,n,a,r,l,c,d){let h=E.bezierBoundingBox(t,i,s,n,a,r,l,c,d);d||this.updateRectMinMax(e,h)}getPathBoundingBox(e=ot.FILL,t=null){let i=[this.minX,this.minY,this.maxX,this.maxY];if(e===ot.STROKE){t||V("Stroke bounding box must include transform.");let s=E.singularValueDecompose2dScale(t),n=s[0]*this.lineWidth/2,a=s[1]*this.lineWidth/2;i[0]-=n,i[1]-=a,i[2]+=n,i[3]+=a}return i}updateClipFromPath(){let e=E.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=ot.FILL,t=null){return E.intersect(this.clipBox,this.getPathBoundingBox(e,t))}};function Pr(o,e){if(e instanceof ImageData){o.putImageData(e,0,0);return}let t=e.height,i=e.width,s=t%ut,n=(t-s)/ut,a=s===0?n:n+1,r=o.createImageData(i,ut),l=0,c,d=e.data,h=r.data,u,m,p,f;if(e.kind===Li.GRAYSCALE_1BPP){let _=d.byteLength,g=new Uint32Array(h.buffer,0,h.byteLength>>2),b=g.length,v=i+7>>3,y=4294967295,w=st.isLittleEndian?4278190080:255;for(u=0;u<a;u++){for(p=u<n?ut:s,c=0,m=0;m<p;m++){let A=_-l,x=0,T=A>v?i:A*8-7,M=T&-8,H=0,O=0;for(;x<M;x+=8)O=d[l++],g[c++]=O&128?y:w,g[c++]=O&64?y:w,g[c++]=O&32?y:w,g[c++]=O&16?y:w,g[c++]=O&8?y:w,g[c++]=O&4?y:w,g[c++]=O&2?y:w,g[c++]=O&1?y:w;for(;x<T;x++)H===0&&(O=d[l++],H=128),g[c++]=O&H?y:w,H>>=1}for(;c<b;)g[c++]=0;o.putImageData(r,0,u*ut)}}else if(e.kind===Li.RGBA_32BPP){for(m=0,f=i*ut*4,u=0;u<n;u++)h.set(d.subarray(l,l+f)),l+=f,o.putImageData(r,0,m),m+=ut;u<a&&(f=i*s*4,h.set(d.subarray(l,l+f)),o.putImageData(r,0,m))}else if(e.kind===Li.RGB_24BPP)for(p=ut,f=i*p,u=0;u<a;u++){for(u>=n&&(p=s,f=i*p),c=0,m=f;m--;)h[c++]=d[l++],h[c++]=d[l++],h[c++]=d[l++],h[c++]=255;o.putImageData(r,0,u*ut)}else throw new Error(`bad image kind: ${e.kind}`)}function Ir(o,e){if(e.bitmap){o.drawImage(e.bitmap,0,0);return}let t=e.height,i=e.width,s=t%ut,n=(t-s)/ut,a=s===0?n:n+1,r=o.createImageData(i,ut),l=0,c=e.data,d=r.data;for(let h=0;h<a;h++){let u=h<n?ut:s;({srcPos:l}=qo({src:c,srcPos:l,dest:d,width:i,height:u,nonBlackColor:0})),o.putImageData(r,0,h*ut)}}function Ne(o,e){let t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(let i of t)o[i]!==void 0&&(e[i]=o[i]);o.setLineDash!==void 0&&(e.setLineDash(o.getLineDash()),e.lineDashOffset=o.lineDashOffset)}function ki(o){if(o.strokeStyle=o.fillStyle="#000000",o.fillRule="nonzero",o.globalAlpha=1,o.lineWidth=1,o.lineCap="butt",o.lineJoin="miter",o.miterLimit=10,o.globalCompositeOperation="source-over",o.font="10px sans-serif",o.setLineDash!==void 0&&(o.setLineDash([]),o.lineDashOffset=0),!ct){let{filter:e}=o;e!=="none"&&e!==""&&(o.filter="none")}}function Dr(o,e){if(e)return!0;let t=E.singularValueDecompose2dScale(o);t[0]=Math.fround(t[0]),t[1]=Math.fround(t[1]);let i=Math.fround((globalThis.devicePixelRatio||1)*Jt.PDF_TO_CSS_UNITS);return t[0]<=i&&t[1]<=i}var Qo=["butt","round","square"],Zo=["miter","round","bevel"],Jo={},Rr={},xe=class o{constructor(e,t,i,s,n,{optionalContentConfig:a,markedContentStack:r=null},l,c){this.ctx=e,this.current=new Gi(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=i,this.canvasFactory=s,this.filterFactory=n,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=r||[],this.optionalContentConfig=a,this.cachedCanvases=new dn(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=c,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:i=!1,background:s=null}){let n=this.ctx.canvas.width,a=this.ctx.canvas.height,r=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,n,a),this.ctx.fillStyle=r,i){let l=this.cachedCanvases.getCanvas("transparent",n,a);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...W(this.compositeCtx))}this.ctx.save(),ki(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=W(this.ctx)}executeOperatorList(e,t,i,s){let n=e.argsArray,a=e.fnArray,r=t||0,l=n.length;if(l===r)return r;let c=l-r>Mr&&typeof i=="function",d=c?Date.now()+Xo:0,h=0,u=this.commonObjs,m=this.objs,p;for(;;){if(s!==void 0&&r===s.nextBreakPoint)return s.breakIt(r,i),r;if(p=a[r],p!==wt.dependency)this[p].apply(this,n[r]);else for(let f of n[r]){let _=f.startsWith("g_")?u:m;if(!_.has(f))return _.get(f,i),r}if(r++,r===l)return r;if(c&&++h>Mr){if(Date.now()>d)return i(),r;h=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(let e of this._cachedBitmapsMap.values()){for(let t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){let e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){let t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}}_scaleImage(e,t){let i=e.width??e.displayWidth,s=e.height??e.displayHeight,n=Math.max(Math.hypot(t[0],t[1]),1),a=Math.max(Math.hypot(t[2],t[3]),1),r=i,l=s,c="prescale1",d,h;for(;n>2&&r>1||a>2&&l>1;){let u=r,m=l;n>2&&r>1&&(u=r>=16384?Math.floor(r/2)-1||1:Math.ceil(r/2),n/=r/u),a>2&&l>1&&(m=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,a/=l/m),d=this.cachedCanvases.getCanvas(c,u,m),h=d.context,h.clearRect(0,0,u,m),h.drawImage(e,0,0,r,l,0,0,u,m),e=d.canvas,r=u,l=m,c=c==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:r,paintHeight:l}}_createMaskCanvas(e){let t=this.ctx,{width:i,height:s}=e,n=this.current.fillColor,a=this.current.patternFill,r=W(t),l,c,d,h;if((e.bitmap||e.data)&&e.count>1){let T=e.bitmap||e.data.buffer;c=JSON.stringify(a?r:[r.slice(0,4),n]),l=this._cachedBitmapsMap.get(T),l||(l=new Map,this._cachedBitmapsMap.set(T,l));let M=l.get(c);if(M&&!a){let H=Math.round(Math.min(r[0],r[2])+r[4]),O=Math.round(Math.min(r[1],r[3])+r[5]);return{canvas:M,offsetX:H,offsetY:O}}d=M}d||(h=this.cachedCanvases.getCanvas("maskCanvas",i,s),Ir(h.context,e));let u=E.transform(r,[1/i,0,0,-1/s,0,0]);u=E.transform(u,[1,0,0,1,0,-s]);let[m,p,f,_]=E.getAxialAlignedBoundingBox([0,0,i,s],u),g=Math.round(f-m)||1,b=Math.round(_-p)||1,v=this.cachedCanvases.getCanvas("fillCanvas",g,b),y=v.context,w=m,A=p;y.translate(-w,-A),y.transform(...u),d||(d=this._scaleImage(h.canvas,Ft(y)),d=d.img,l&&a&&l.set(c,d)),y.imageSmoothingEnabled=Dr(W(y),e.interpolate),Ci(y,d,0,0,d.width,d.height,0,0,i,s),y.globalCompositeOperation="source-in";let x=E.transform(Ft(y),[1,0,0,1,-w,-A]);return y.fillStyle=a?n.getPattern(t,this,x,ot.FILL):n,y.fillRect(0,0,i,s),l&&!a&&(this.cachedCanvases.delete("fillCanvas"),l.set(c,v.canvas)),{canvas:v.canvas,offsetX:Math.round(w),offsetY:Math.round(A)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=Qo[e]}setLineJoin(e){this.ctx.lineJoin=Zo[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){let i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(e),i.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(let[t,i]of e)switch(t){case"LW":this.setLineWidth(i);break;case"LC":this.setLineCap(i);break;case"LJ":this.setLineJoin(i);break;case"ML":this.setMiterLimit(i);break;case"D":this.setDash(i[0],i[1]);break;case"RI":this.setRenderingIntent(i);break;case"FL":this.setFlatness(i);break;case"Font":this.setFont(i[0],i[1]);break;case"CA":this.current.strokeAlpha=i;break;case"ca":this.current.fillAlpha=i,this.ctx.globalAlpha=i;break;case"BM":this.ctx.globalCompositeOperation=i;break;case"SMask":this.current.activeSMask=i?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(i);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");let e=this.ctx.canvas.width,t=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,s=this.cachedCanvases.getCanvas(i,e,t);this.suspendedCtx=this.ctx,this.ctx=s.context;let n=this.ctx;n.setTransform(...W(this.suspendedCtx)),Ne(this.suspendedCtx,n),Yo(n,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Ne(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let t=this.current.activeSMask,i=this.suspendedCtx;this.composeSMask(i,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,i,s){let n=s[0],a=s[1],r=s[2]-n,l=s[3]-a;r===0||l===0||(this.genericComposeSMask(t.context,i,r,l,t.subtype,t.backdrop,t.transferMap,n,a,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(i.canvas,0,0),e.restore())}genericComposeSMask(e,t,i,s,n,a,r,l,c,d,h){let u=e.canvas,m=l-d,p=c-h;if(a){let _=E.makeHexColor(...a);if(m<0||p<0||m+i>u.width||p+s>u.height){let g=this.cachedCanvases.getCanvas("maskExtension",i,s),b=g.context;b.drawImage(u,-m,-p),b.globalCompositeOperation="destination-atop",b.fillStyle=_,b.fillRect(0,0,i,s),b.globalCompositeOperation="source-over",u=g.canvas,m=p=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);let g=new Path2D;g.rect(m,p,i,s),e.clip(g),e.globalCompositeOperation="destination-atop",e.fillStyle=_,e.fillRect(m,p,i,s),e.restore()}}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),n==="Alpha"&&r?t.filter=this.filterFactory.addAlphaFilter(r):n==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(r));let f=new Path2D;f.rect(l,c,i,s),t.clip(f),t.globalCompositeOperation="destination-in",t.drawImage(u,m,p,i,s,l,c,i,s),t.restore()}save(){this.inSMaskMode?(Ne(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();let e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),Ne(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,i,s,n,a){this.ctx.transform(e,t,i,s,n,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,i){let s=this.ctx,n=this.current,a=n.x,r=n.y,l,c,d=W(s),h=d[0]===0&&d[3]===0||d[1]===0&&d[2]===0,u=h?i.slice(0):null;for(let m=0,p=0,f=e.length;m<f;m++)switch(e[m]|0){case wt.rectangle:a=t[p++],r=t[p++];let _=t[p++],g=t[p++],b=a+_,v=r+g;s.moveTo(a,r),_===0||g===0?s.lineTo(b,v):(s.lineTo(b,r),s.lineTo(b,v),s.lineTo(a,v)),h||n.updateRectMinMax(d,[a,r,b,v]),s.closePath();break;case wt.moveTo:a=t[p++],r=t[p++],s.moveTo(a,r),h||n.updatePathMinMax(d,a,r);break;case wt.lineTo:a=t[p++],r=t[p++],s.lineTo(a,r),h||n.updatePathMinMax(d,a,r);break;case wt.curveTo:l=a,c=r,a=t[p+4],r=t[p+5],s.bezierCurveTo(t[p],t[p+1],t[p+2],t[p+3],a,r),n.updateCurvePathMinMax(d,l,c,t[p],t[p+1],t[p+2],t[p+3],a,r,u),p+=6;break;case wt.curveTo2:l=a,c=r,s.bezierCurveTo(a,r,t[p],t[p+1],t[p+2],t[p+3]),n.updateCurvePathMinMax(d,l,c,a,r,t[p],t[p+1],t[p+2],t[p+3],u),a=t[p+2],r=t[p+3],p+=4;break;case wt.curveTo3:l=a,c=r,a=t[p+2],r=t[p+3],s.bezierCurveTo(t[p],t[p+1],a,r,a,r),n.updateCurvePathMinMax(d,l,c,t[p],t[p+1],a,r,a,r,u),p+=4;break;case wt.closePath:s.closePath();break}h&&n.updateScalingPathMinMax(d,u),n.setCurrentPoint(a,r)}closePath(){this.ctx.closePath()}stroke(e=!0){let t=this.ctx,i=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof i=="object"&&i?.getPattern?(t.save(),t.strokeStyle=i.getPattern(t,this,Ft(t),ot.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){let t=this.ctx,i=this.current.fillColor,s=this.current.patternFill,n=!1;s&&(t.save(),t.fillStyle=i.getPattern(t,this,Ft(t),ot.FILL),n=!0);let a=this.current.getClippedPathBoundingBox();this.contentVisible&&a!==null&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),n&&t.restore(),e&&this.consumePath(a)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=Jo}eoClip(){this.pendingClip=Rr}beginText(){this.current.textMatrix=Br,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){let e=this.pendingTextPaths,t=this.ctx;if(e===void 0){t.beginPath();return}t.save(),t.beginPath();for(let i of e)t.setTransform(...i.transform),t.translate(i.x,i.y),i.addToPath(t,i.fontSize);t.restore(),t.clip(),t.beginPath(),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){let i=this.commonObjs.get(e),s=this.current;if(!i)throw new Error(`Can't find font for ${e}`);if(s.fontMatrix=i.fontMatrix||js,(s.fontMatrix[0]===0||s.fontMatrix[3]===0)&&R("Invalid font matrix for font "+e),t<0?(t=-t,s.fontDirection=-1):s.fontDirection=1,this.current.font=i,this.current.fontSize=t,i.isType3Font)return;let n=i.loadedName||"sans-serif",a=i.systemFontInfo?.css||`"${n}", ${i.fallbackName}`,r="normal";i.black?r="900":i.bold&&(r="bold");let l=i.italic?"italic":"normal",c=t;t<Er?c=Er:t>Tr&&(c=Tr),this.current.fontSizeScale=t/c,this.ctx.font=`${l} ${r} ${c}px ${a}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,i,s,n,a){this.current.textMatrix=[e,t,i,s,n,a],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,i,s,n){let a=this.ctx,r=this.current,l=r.font,c=r.textRenderingMode,d=r.fontSize/r.fontSizeScale,h=c&rt.FILL_STROKE_MASK,u=!!(c&rt.ADD_TO_PATH_FLAG),m=r.patternFill&&!l.missingFile,p=r.patternStroke&&!l.missingFile,f;(l.disableFontFace||u||m||p)&&(f=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||m||p?(a.save(),a.translate(t,i),a.beginPath(),f(a,d),(h===rt.FILL||h===rt.FILL_STROKE)&&(s&&a.setTransform(...s),a.fill()),(h===rt.STROKE||h===rt.FILL_STROKE)&&(n&&a.setTransform(...n),a.stroke()),a.restore()):((h===rt.FILL||h===rt.FILL_STROKE)&&a.fillText(e,t,i),(h===rt.STROKE||h===rt.FILL_STROKE)&&a.strokeText(e,t,i)),u&&(this.pendingTextPaths||=[]).push({transform:W(a),x:t,y:i,fontSize:d,addToPath:f})}get isFontSubpixelAAEnabled(){let{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);let t=e.getImageData(0,0,10,10).data,i=!1;for(let s=3;s<t.length;s+=4)if(t[s]>0&&t[s]<255){i=!0;break}return F(this,"isFontSubpixelAAEnabled",i)}showText(e){let t=this.current,i=t.font;if(i.isType3Font)return this.showType3Text(e);let s=t.fontSize;if(s===0)return;let n=this.ctx,a=t.fontSizeScale,r=t.charSpacing,l=t.wordSpacing,c=t.fontDirection,d=t.textHScale*c,h=e.length,u=i.vertical,m=u?1:-1,p=i.defaultVMetrics,f=s*t.fontMatrix[0],_=t.textRenderingMode===rt.FILL&&!i.disableFontFace&&!t.patternFill;n.save(),n.transform(...t.textMatrix),n.translate(t.x,t.y+t.textRise),c>0?n.scale(d,-1):n.scale(d,1);let g,b;if(t.patternFill){n.save();let x=t.fillColor.getPattern(n,this,Ft(n),ot.FILL);g=W(n),n.restore(),n.fillStyle=x}if(t.patternStroke){n.save();let x=t.strokeColor.getPattern(n,this,Ft(n),ot.STROKE);b=W(n),n.restore(),n.strokeStyle=x}let v=t.lineWidth,y=t.textMatrixScale;if(y===0||v===0){let x=t.textRenderingMode&rt.FILL_STROKE_MASK;(x===rt.STROKE||x===rt.FILL_STROKE)&&(v=this.getSinglePixelWidth())}else v/=y;if(a!==1&&(n.scale(a,a),v/=a),n.lineWidth=v,i.isInvalidPDFjsFont){let x=[],T=0;for(let M of e)x.push(M.unicode),T+=M.width;n.fillText(x.join(""),0,0),t.x+=T*f*d,n.restore(),this.compose();return}let w=0,A;for(A=0;A<h;++A){let x=e[A];if(typeof x=="number"){w+=m*x*s/1e3;continue}let T=!1,M=(x.isSpace?l:0)+r,H=x.fontChar,O=x.accent,G,tt,z=x.width;if(u){let U=x.vmetric||p,S=-(x.vmetric?U[1]:z*.5)*f,L=U[2]*f;z=U?-U[0]:z,G=S/a,tt=(w+L)/a}else G=w/a,tt=0;if(i.remeasure&&z>0){let U=n.measureText(H).width*1e3/s*a;if(z<U&&this.isFontSubpixelAAEnabled){let S=z/U;T=!0,n.save(),n.scale(S,1),G/=S}else z!==U&&(G+=(z-U)/2e3*s/a)}if(this.contentVisible&&(x.isInFont||i.missingFile)){if(_&&!O)n.fillText(H,G,tt);else if(this.paintChar(H,G,tt,g,b),O){let U=G+s*O.offset.x/a,S=tt-s*O.offset.y/a;this.paintChar(O.fontChar,U,S,g,b)}}let dt=u?z*f-M*c:z*f+M*c;w+=dt,T&&n.restore()}u?t.y-=w:t.x+=w*d,n.restore(),this.compose()}showType3Text(e){let t=this.ctx,i=this.current,s=i.font,n=i.fontSize,a=i.fontDirection,r=s.vertical?1:-1,l=i.charSpacing,c=i.wordSpacing,d=i.textHScale*a,h=i.fontMatrix||js,u=e.length,m=i.textRenderingMode===rt.INVISIBLE,p,f,_,g;if(!(m||n===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...i.textMatrix),t.translate(i.x,i.y),t.scale(d,a),p=0;p<u;++p){if(f=e[p],typeof f=="number"){g=r*f*n/1e3,this.ctx.translate(g,0),i.x+=g*d;continue}let b=(f.isSpace?c:0)+l,v=s.charProcOperatorList[f.operatorListId];if(!v){R(`Type3 character "${f.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=f,this.save(),t.scale(n,n),t.transform(...h),this.executeOperatorList(v),this.restore()),_=E.applyTransform([f.width,0],h)[0]*n+b,t.translate(_,0),i.x+=_*d}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,i,s,n,a){this.ctx.rect(i,s,n-i,a-s),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){let i=e[1],s=this.baseTransform||W(this.ctx),n={createCanvasGraphics:a=>new o(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new Wo(e,i,this.ctx,n,s)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,i){this.ctx.strokeStyle=this.current.strokeColor=E.makeHexColor(e,t,i),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t,i){this.ctx.fillStyle=this.current.fillColor=E.makeHexColor(e,t,i),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let i;return this.cachedPatterns.has(e)?i=this.cachedPatterns.get(e):(i=$o(this.getObject(e)),this.cachedPatterns.set(e,i)),t&&(i.matrix=t),i}shadingFill(e){if(!this.contentVisible)return;let t=this.ctx;this.save();let i=this._getPattern(e);t.fillStyle=i.getPattern(t,this,Ft(t),ot.SHADING);let s=Ft(t);if(s){let{width:n,height:a}=t.canvas,[r,l,c,d]=E.getAxialAlignedBoundingBox([0,0,n,a],s);this.ctx.fillRect(r,l,c-r,d-l)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){V("Should not call beginInlineImage")}beginImageData(){V("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=W(this.ctx),t)){let i=t[2]-t[0],s=t[3]-t[1];this.ctx.rect(t[0],t[1],i,s),this.current.updateRectMinMax(W(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let t=this.ctx;e.isolated||ls("TODO: Support non-isolated groups."),e.knockout&&R("Knockout groups not supported.");let i=W(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let s=E.getAxialAlignedBoundingBox(e.bbox,W(t)),n=[0,0,t.canvas.width,t.canvas.height];s=E.intersect(s,n)||[0,0,0,0];let a=Math.floor(s[0]),r=Math.floor(s[1]),l=Math.max(Math.ceil(s[2])-a,1),c=Math.max(Math.ceil(s[3])-r,1);this.current.startNewPathAndClipBox([0,0,l,c]);let d="groupAt"+this.groupLevel;e.smask&&(d+="_smask_"+this.smaskCounter++%2);let h=this.cachedCanvases.getCanvas(d,l,c),u=h.context;u.translate(-a,-r),u.transform(...i),e.smask?this.smaskStack.push({canvas:h.canvas,context:u,offsetX:a,offsetY:r,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(a,r),t.save()),Ne(t,u),this.ctx=u,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;let t=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();let s=W(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...s);let n=E.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],s);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(n)}}beginAnnotation(e,t,i,s,n){if(this.#t(),ki(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){let a=t[2]-t[0],r=t[3]-t[1];if(n&&this.annotationCanvasMap){i=i.slice(),i[4]-=t[0],i[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=a,t[3]=r;let[l,c]=E.singularValueDecompose2dScale(W(this.ctx)),{viewportScale:d}=this,h=Math.ceil(a*this.outputScaleX*d),u=Math.ceil(r*this.outputScaleY*d);this.annotationCanvas=this.canvasFactory.create(h,u);let{canvas:m,context:p}=this.annotationCanvas;this.annotationCanvasMap.set(e,m),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,this.ctx.save(),this.ctx.setTransform(l,0,0,-c,0,r*c),ki(this.ctx)}else ki(this.ctx),this.endPath(),this.ctx.rect(t[0],t[1],a,r),this.ctx.clip(),this.ctx.beginPath()}this.current=new Gi(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...i),this.transform(...s)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;let t=e.count;e=this.getObject(e.data,e),e.count=t;let i=this.ctx,s=this.processingType3;if(s&&(s.compiled===void 0&&(s.compiled=Ko(e)),s.compiled)){s.compiled(i);return}let n=this._createMaskCanvas(e),a=n.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(a,n.offsetX,n.offsetY),i.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,i=0,s=0,n,a){if(!this.contentVisible)return;e=this.getObject(e.data,e);let r=this.ctx;r.save();let l=W(r);r.transform(t,i,s,n,0,0);let c=this._createMaskCanvas(e);r.setTransform(1,0,0,1,c.offsetX-l[4],c.offsetY-l[5]);for(let d=0,h=a.length;d<h;d+=2){let u=E.transform(l,[t,i,s,n,a[d],a[d+1]]),[m,p]=E.applyTransform([0,0],u);r.drawImage(c.canvas,m,p)}r.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;let t=this.ctx,i=this.current.fillColor,s=this.current.patternFill;for(let n of e){let{data:a,width:r,height:l,transform:c}=n,d=this.cachedCanvases.getCanvas("maskCanvas",r,l),h=d.context;h.save();let u=this.getObject(a,n);Ir(h,u),h.globalCompositeOperation="source-in",h.fillStyle=s?i.getPattern(h,this,Ft(t),ot.FILL):i,h.fillRect(0,0,r,l),h.restore(),t.save(),t.transform(...c),t.scale(1,-1),Ci(t,d.canvas,0,0,r,l,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;let t=this.getObject(e);if(!t){R("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,i,s){if(!this.contentVisible)return;let n=this.getObject(e);if(!n){R("Dependent image isn't ready yet");return}let a=n.width,r=n.height,l=[];for(let c=0,d=s.length;c<d;c+=2)l.push({transform:[t,0,0,i,s[c],s[c+1]],x:0,y:0,w:a,h:r});this.paintInlineImageXObjectGroup(n,l)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;let{bitmap:t,width:i,height:s}=e,n=this.cachedCanvases.getCanvas("inlineImage",i,s),a=n.context;return a.filter=this.current.transferMaps,a.drawImage(t,0,0),a.filter="none",n.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;let t=e.width,i=e.height,s=this.ctx;if(this.save(),!ct){let{filter:r}=s;r!=="none"&&r!==""&&(s.filter="none")}s.scale(1/t,-1/i);let n;if(e.bitmap)n=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)n=e;else{let l=this.cachedCanvases.getCanvas("inlineImage",t,i).context;Pr(l,e),n=this.applyTransferMapsToCanvas(l)}let a=this._scaleImage(n,Ft(s));s.imageSmoothingEnabled=Dr(W(s),e.interpolate),Ci(s,a.img,0,0,a.paintWidth,a.paintHeight,0,-i,t,i),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;let i=this.ctx,s;if(e.bitmap)s=e.bitmap;else{let n=e.width,a=e.height,l=this.cachedCanvases.getCanvas("inlineImage",n,a).context;Pr(l,e),s=this.applyTransferMapsToCanvas(l)}for(let n of t)i.save(),i.transform(...n.transform),i.scale(1,-1),Ci(i,s,n.x,n.y,n.w,n.h,0,-1,1,1),i.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){let t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);let i=this.ctx;this.pendingClip&&(t||(this.pendingClip===Rr?i.clip("evenodd"):i.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),i.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let e=W(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{let t=Math.abs(e[0]*e[3]-e[2]*e[1]),i=Math.hypot(e[0],e[2]),s=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(i,s)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){let{lineWidth:e}=this.current,{a:t,b:i,c:s,d:n}=this.ctx.getTransform(),a,r;if(i===0&&s===0){let l=Math.abs(t),c=Math.abs(n);if(l===c)if(e===0)a=r=1/l;else{let d=l*e;a=r=d<1?1/d:1}else if(e===0)a=1/l,r=1/c;else{let d=l*e,h=c*e;a=d<1?1/d:1,r=h<1?1/h:1}}else{let l=Math.abs(t*n-i*s),c=Math.hypot(t,i),d=Math.hypot(s,n);if(e===0)a=d/l,r=c/l;else{let h=e*l;a=d>h?d/h:1,r=c>h?c/h:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=r}return this._cachedScaleForStroking}rescaleAndStroke(e){let{ctx:t}=this,{lineWidth:i}=this.current,[s,n]=this.getScaleForStroking();if(t.lineWidth=i||1,s===1&&n===1){t.stroke();return}let a=t.getLineDash();if(e&&t.save(),t.scale(s,n),a.length>0){let r=Math.max(s,n);t.setLineDash(a.map(l=>l/r)),t.lineDashOffset/=r}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};for(let o in wt)xe.prototype[o]!==void 0&&(xe.prototype[wt[o]]=xe.prototype[o]);var de=class{static#t=null;static#e="";static get workerPort(){return this.#t}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");this.#t=e}static get workerSrc(){return this.#e}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");this.#e=e}},Si={UNKNOWN:0,DATA:1,ERROR:2},Z={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Or(){}function vt(o){switch(o instanceof Error||typeof o=="object"&&o!==null||V('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),o.name){case"AbortException":return new Ut(o.message);case"MissingPDFException":return new he(o.message);case"PasswordException":return new je(o.message,o.code);case"UnexpectedResponseException":return new ke(o.message,o.status);case"UnknownErrorException":return new Ve(o.message,o.details);default:return new Ve(o.message,o.toString())}}var ce=class{#t=new AbortController;constructor(e,t,i){this.sourceName=e,this.targetName=t,this.comObj=i,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),i.addEventListener("message",this.#e.bind(this),{signal:this.#t.signal})}#e({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){this.#s(e);return}if(e.callback){let i=e.callbackId,s=this.callbackCapabilities[i];if(!s)throw new Error(`Cannot resolve callback ${i}`);if(delete this.callbackCapabilities[i],e.callback===Si.DATA)s.resolve(e.data);else if(e.callback===Si.ERROR)s.reject(vt(e.reason));else throw new Error("Unexpected callback case");return}let t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){let i=this.sourceName,s=e.sourceName,n=this.comObj;Promise.try(t,e.data).then(function(a){n.postMessage({sourceName:i,targetName:s,callback:Si.DATA,callbackId:e.callbackId,data:a})},function(a){n.postMessage({sourceName:i,targetName:s,callback:Si.ERROR,callbackId:e.callbackId,reason:vt(a)})});return}if(e.streamId){this.#i(e);return}t(e.data)}on(e,t){let i=this.actionHandler;if(i[e])throw new Error(`There is already an actionName called "${e}"`);i[e]=t}send(e,t,i){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},i)}sendWithPromise(e,t,i){let s=this.callbackId++,n=Promise.withResolvers();this.callbackCapabilities[s]=n;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:s,data:t},i)}catch(a){n.reject(a)}return n.promise}sendWithStream(e,t,i,s){let n=this.streamId++,a=this.sourceName,r=this.targetName,l=this.comObj;return new ReadableStream({start:c=>{let d=Promise.withResolvers();return this.streamControllers[n]={controller:c,startCall:d,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:a,targetName:r,action:e,streamId:n,data:t,desiredSize:c.desiredSize},s),d.promise},pull:c=>{let d=Promise.withResolvers();return this.streamControllers[n].pullCall=d,l.postMessage({sourceName:a,targetName:r,stream:Z.PULL,streamId:n,desiredSize:c.desiredSize}),d.promise},cancel:c=>{J(c instanceof Error,"cancel must have a valid reason");let d=Promise.withResolvers();return this.streamControllers[n].cancelCall=d,this.streamControllers[n].isClosed=!0,l.postMessage({sourceName:a,targetName:r,stream:Z.CANCEL,streamId:n,reason:vt(c)}),d.promise}},i)}#i(e){let t=e.streamId,i=this.sourceName,s=e.sourceName,n=this.comObj,a=this,r=this.actionHandler[e.action],l={enqueue(c,d=1,h){if(this.isCancelled)return;let u=this.desiredSize;this.desiredSize-=d,u>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),n.postMessage({sourceName:i,targetName:s,stream:Z.ENQUEUE,streamId:t,chunk:c},h)},close(){this.isCancelled||(this.isCancelled=!0,n.postMessage({sourceName:i,targetName:s,stream:Z.CLOSE,streamId:t}),delete a.streamSinks[t])},error(c){J(c instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,n.postMessage({sourceName:i,targetName:s,stream:Z.ERROR,streamId:t,reason:vt(c)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(r,e.data,l).then(function(){n.postMessage({sourceName:i,targetName:s,stream:Z.START_COMPLETE,streamId:t,success:!0})},function(c){n.postMessage({sourceName:i,targetName:s,stream:Z.START_COMPLETE,streamId:t,reason:vt(c)})})}#s(e){let t=e.streamId,i=this.sourceName,s=e.sourceName,n=this.comObj,a=this.streamControllers[t],r=this.streamSinks[t];switch(e.stream){case Z.START_COMPLETE:e.success?a.startCall.resolve():a.startCall.reject(vt(e.reason));break;case Z.PULL_COMPLETE:e.success?a.pullCall.resolve():a.pullCall.reject(vt(e.reason));break;case Z.PULL:if(!r){n.postMessage({sourceName:i,targetName:s,stream:Z.PULL_COMPLETE,streamId:t,success:!0});break}r.desiredSize<=0&&e.desiredSize>0&&r.sinkCapability.resolve(),r.desiredSize=e.desiredSize,Promise.try(r.onPull||Or).then(function(){n.postMessage({sourceName:i,targetName:s,stream:Z.PULL_COMPLETE,streamId:t,success:!0})},function(c){n.postMessage({sourceName:i,targetName:s,stream:Z.PULL_COMPLETE,streamId:t,reason:vt(c)})});break;case Z.ENQUEUE:if(J(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(e.chunk);break;case Z.CLOSE:if(J(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),this.#a(a,t);break;case Z.ERROR:J(a,"error should have stream controller"),a.controller.error(vt(e.reason)),this.#a(a,t);break;case Z.CANCEL_COMPLETE:e.success?a.cancelCall.resolve():a.cancelCall.reject(vt(e.reason)),this.#a(a,t);break;case Z.CANCEL:if(!r)break;let l=vt(e.reason);Promise.try(r.onCancel||Or,l).then(function(){n.postMessage({sourceName:i,targetName:s,stream:Z.CANCEL_COMPLETE,streamId:t,success:!0})},function(c){n.postMessage({sourceName:i,targetName:s,stream:Z.CANCEL_COMPLETE,streamId:t,reason:vt(c)})}),r.sinkCapability.reject(l),r.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}#a(e,t){return k(this,null,function*(){yield Promise.allSettled([e.startCall?.promise,e.pullCall?.promise,e.cancelCall?.promise]),delete this.streamControllers[t]})}destroy(){this.#t?.abort(),this.#t=null}},hn=class{#t;#e;constructor({parsedData:e,rawData:t}){this.#t=e,this.#e=t}getRaw(){return this.#e}get(e){return this.#t.get(e)??null}getAll(){return oa(this.#t)}has(e){return this.#t.has(e)}},Ae=Symbol("INTERNAL"),un=class{#t=!1;#e=!1;#i=!1;#s=!0;constructor(e,{name:t,intent:i,usage:s,rbGroups:n}){this.#t=!!(e&mt.DISPLAY),this.#e=!!(e&mt.PRINT),this.name=t,this.intent=i,this.usage=s,this.rbGroups=n}get visible(){if(this.#i)return this.#s;if(!this.#s)return!1;let{print:e,view:t}=this.usage;return this.#t?t?.viewState!=="OFF":this.#e?e?.printState!=="OFF":!0}_setVisible(e,t,i=!1){e!==Ae&&V("Internal method `_setVisible` called."),this.#i=i,this.#s=t}},mn=class{#t=null;#e=new Map;#i=null;#s=null;constructor(e,t=mt.DISPLAY){if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,this.#s=e.order;for(let i of e.groups)this.#e.set(i.id,new un(t,i));if(e.baseState==="OFF")for(let i of this.#e.values())i._setVisible(Ae,!1);for(let i of e.on)this.#e.get(i)._setVisible(Ae,!0);for(let i of e.off)this.#e.get(i)._setVisible(Ae,!1);this.#i=this.getHash()}}#a(e){let t=e.length;if(t<2)return!0;let i=e[0];for(let s=1;s<t;s++){let n=e[s],a;if(Array.isArray(n))a=this.#a(n);else if(this.#e.has(n))a=this.#e.get(n).visible;else return R(`Optional content group not found: ${n}`),!0;switch(i){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return i==="And"}isVisible(e){if(this.#e.size===0)return!0;if(!e)return ls("Optional content group not defined."),!0;if(e.type==="OCG")return this.#e.has(e.id)?this.#e.get(e.id).visible:(R(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return this.#a(e.expression);if(!e.policy||e.policy==="AnyOn"){for(let t of e.ids){if(!this.#e.has(t))return R(`Optional content group not found: ${t}`),!0;if(this.#e.get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(let t of e.ids){if(!this.#e.has(t))return R(`Optional content group not found: ${t}`),!0;if(!this.#e.get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(let t of e.ids){if(!this.#e.has(t))return R(`Optional content group not found: ${t}`),!0;if(!this.#e.get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(let t of e.ids){if(!this.#e.has(t))return R(`Optional content group not found: ${t}`),!0;if(this.#e.get(t).visible)return!1}return!0}return R(`Unknown optional content policy ${e.policy}.`),!0}return R(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,i=!0){let s=this.#e.get(e);if(!s){R(`Optional content group not found: ${e}`);return}if(i&&t&&s.rbGroups.length)for(let n of s.rbGroups)for(let a of n)a!==e&&this.#e.get(a)?._setVisible(Ae,!1,!0);s._setVisible(Ae,!!t,!0),this.#t=null}setOCGState({state:e,preserveRB:t}){let i;for(let s of e){switch(s){case"ON":case"OFF":case"Toggle":i=s;continue}let n=this.#e.get(s);if(n)switch(i){case"ON":this.setVisibility(s,!0,t);break;case"OFF":this.setVisibility(s,!1,t);break;case"Toggle":this.setVisibility(s,!n.visible,t);break}}this.#t=null}get hasInitialVisibility(){return this.#i===null||this.getHash()===this.#i}getOrder(){return this.#e.size?this.#s?this.#s.slice():[...this.#e.keys()]:null}getGroups(){return this.#e.size>0?oa(this.#e):null}getGroup(e){return this.#e.get(e)||null}getHash(){if(this.#t!==null)return this.#t;let e=new Oi;for(let[t,i]of this.#e)e.update(`${t}:${i.visible}`);return this.#t=e.hexdigest()}},pn=class{constructor(e,{disableRange:t=!1,disableStream:i=!1}){J(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');let{length:s,initialData:n,progressiveDone:a,contentDispositionFilename:r}=e;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=r,n?.length>0){let l=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!i,this._isRangeSupported=!t,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((l,c)=>{this._onReceiveData({begin:l,chunk:c})}),e.addProgressListener((l,c)=>{this._onProgress({loaded:l,total:c})}),e.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){let i=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i);else{let s=this._rangeReaders.some(function(n){return n._begin!==e?!1:(n._enqueue(i),!0)});J(s,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(e){e.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:e.loaded}):this._fullRequestReader?.onProgress?.({loaded:e.loaded,total:e.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){let t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){J(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");let e=this._queuedChunks;return this._queuedChunks=null,new fn(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let i=new gn(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeReaders.slice(0))t.cancel(e);this._pdfDataRangeTransport.abort()}},fn=class{constructor(e,t,i=!1,s=null){this._stream=e,this._done=i||!1,this._filename=ca(s)?s:null,this._queuedChunks=t||[],this._loaded=0;for(let n of this._queuedChunks)this._loaded+=n.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}read(){return k(this,null,function*(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise})}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}},gn=class{constructor(e,t,i){this._stream=e,this._begin=t,this._end=i,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(let i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}read(){return k(this,null,function*(){if(this._queuedChunk){let t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise})}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}};function tl(o){let e=!0,t=i("filename\\*","i").exec(o);if(t){t=t[1];let d=r(t);return d=unescape(d),d=l(d),d=c(d),n(d)}if(t=a(o),t){let d=c(t);return n(d)}if(t=i("filename","i").exec(o),t){t=t[1];let d=r(t);return d=c(d),n(d)}function i(d,h){return new RegExp("(?:^|;)\\s*"+d+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',h)}function s(d,h){if(d){if(!/^[\x00-\xFF]+$/.test(h))return h;try{let u=new TextDecoder(d,{fatal:!0}),m=cs(h);h=u.decode(m),e=!1}catch{}}return h}function n(d){return e&&/[\x80-\xff]/.test(d)&&(d=s("utf-8",d),e&&(d=s("iso-8859-1",d))),d}function a(d){let h=[],u,m=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(u=m.exec(d))!==null;){let[,f,_,g]=u;if(f=parseInt(f,10),f in h){if(f===0)break;continue}h[f]=[_,g]}let p=[];for(let f=0;f<h.length&&f in h;++f){let[_,g]=h[f];g=r(g),_&&(g=unescape(g),f===0&&(g=l(g))),p.push(g)}return p.join("")}function r(d){if(d.startsWith('"')){let h=d.slice(1).split('\\"');for(let u=0;u<h.length;++u){let m=h[u].indexOf('"');m!==-1&&(h[u]=h[u].slice(0,m),h.length=u+1),h[u]=h[u].replaceAll(/\\(.)/g,"$1")}d=h.join('"')}return d}function l(d){let h=d.indexOf("'");if(h===-1)return d;let u=d.slice(0,h),p=d.slice(h+1).replace(/^[^']*'/,"");return s(u,p)}function c(d){return!d.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(d)?d:d.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(h,u,m,p){if(m==="q"||m==="Q")return p=p.replaceAll("_"," "),p=p.replaceAll(/=([0-9a-fA-F]{2})/g,function(f,_){return String.fromCharCode(parseInt(_,16))}),s(u,p);try{p=atob(p)}catch{}return s(u,p)})}return""}function jr(o,e){let t=new Headers;if(!o||!e||typeof e!="object")return t;for(let i in e){let s=e[i];s!==void 0&&t.append(i,s)}return t}function us(o){try{return new URL(o).origin}catch{}return null}function Vr({responseHeaders:o,isHttp:e,rangeChunkSize:t,disableRange:i}){let s={allowRangeRequests:!1,suggestedLength:void 0},n=parseInt(o.get("Content-Length"),10);return!Number.isInteger(n)||(s.suggestedLength=n,n<=2*t)||i||!e||o.get("Accept-Ranges")!=="bytes"||(o.get("Content-Encoding")||"identity")!=="identity"||(s.allowRangeRequests=!0),s}function Gr(o){let e=o.get("Content-Disposition");if(e){let t=tl(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(ca(t))return t}return null}function ms(o,e){return o===404||o===0&&e.startsWith("file:")?new he('Missing PDF "'+e+'".'):new ke(`Unexpected server response (${o}) while retrieving PDF "${e}".`,o)}function Ur(o){return o===200||o===206}function $r(o,e,t){return{method:"GET",headers:o,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function Wr(o){return o instanceof Uint8Array?o.buffer:o instanceof ArrayBuffer?o:(R(`getArrayBuffer - unexpected data format: ${o}`),new Uint8Array(o).buffer)}var Ui=class{_responseOrigin=null;constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=jr(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return J(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new _n(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let i=new bn(this,e,t);return this._rangeRequestReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeRequestReaders.slice(0))t.cancel(e)}},_n=class{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;let t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;let i=new Headers(e.headers),s=t.url;fetch(s,$r(i,this._withCredentials,this._abortController)).then(n=>{if(e._responseOrigin=us(n.url),!Ur(n.status))throw ms(n.status,s);this._reader=n.body.getReader(),this._headersCapability.resolve();let a=n.headers,{allowRangeRequests:r,suggestedLength:l}=Vr({responseHeaders:a,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=r,this._contentLength=l||this._contentLength,this._filename=Gr(a),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Ut("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}read(){return k(this,null,function*(){yield this._headersCapability.promise;let{value:e,done:t}=yield this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:Wr(e),done:!1})})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}},bn=class{constructor(e,t,i){this._stream=e,this._reader=null,this._loaded=0;let s=e.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController;let n=new Headers(e.headers);n.append("Range",`bytes=${t}-${i-1}`);let a=s.url;fetch(a,$r(n,this._withCredentials,this._abortController)).then(r=>{let l=us(r.url);if(l!==e._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${e._responseOrigin}".`);if(!Ur(r.status))throw ms(r.status,a);this._readCapability.resolve(),this._reader=r.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}read(){return k(this,null,function*(){yield this._readCapability.promise;let{value:e,done:t}=yield this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded}),{value:Wr(e),done:!1})})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}},Hs=200,zs=206;function el(o){let e=o.response;return typeof e!="string"?e:cs(e).buffer}var vn=class{_responseOrigin=null;constructor({url:e,httpHeaders:t,withCredentials:i}){this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=jr(this.isHttp,t),this.withCredentials=i||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(e,t,i){let s={begin:e,end:t};for(let n in i)s[n]=i[n];return this.request(s)}requestFull(e){return this.request(e)}request(e){let t=new XMLHttpRequest,i=this.currXhrId++,s=this.pendingRequests[i]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(let[n,a]of this.headers)t.setRequestHeader(n,a);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),s.expectedStatus=zs):s.expectedStatus=Hs,t.responseType="arraybuffer",e.onError&&(t.onerror=function(n){e.onError(t.status)}),t.onreadystatechange=this.onStateChange.bind(this,i),t.onprogress=this.onProgress.bind(this,i),s.onHeadersReceived=e.onHeadersReceived,s.onDone=e.onDone,s.onError=e.onError,s.onProgress=e.onProgress,t.send(null),i}onProgress(e,t){let i=this.pendingRequests[e];i&&i.onProgress?.(t)}onStateChange(e,t){let i=this.pendingRequests[e];if(!i)return;let s=i.xhr;if(s.readyState>=2&&i.onHeadersReceived&&(i.onHeadersReceived(),delete i.onHeadersReceived),s.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],s.status===0&&this.isHttp){i.onError?.(s.status);return}let n=s.status||Hs;if(!(n===Hs&&i.expectedStatus===zs)&&n!==i.expectedStatus){i.onError?.(s.status);return}let r=el(s);if(n===zs){let l=s.getResponseHeader("Content-Range"),c=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);i.onDone({begin:parseInt(c[1],10),chunk:r})}else r?i.onDone({begin:0,chunk:r}):i.onError?.(s.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){let t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}},yn=class{constructor(e){this._source=e,this._manager=new vn(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){let t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return J(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new wn(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){let i=new An(this._manager,e,t);return i.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeRequestReaders.slice(0))t.cancel(e)}},wn=class{constructor(e,t){this._manager=e;let i={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=t.url,this._fullRequestId=e.requestFull(i),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=us(t.responseURL);let i=t.getAllResponseHeaders(),s=new Headers(i?i.trim().split(/[\r\n]+/).map(r=>{let[l,...c]=r.split(": ");return[l,c.join(": ")]}):[]),{allowRangeRequests:n,suggestedLength:a}=Vr({responseHeaders:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});n&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=Gr(s),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=ms(e,this._url),this._headersCapability.reject(this._storedError);for(let t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){this.onProgress?.({loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}read(){return k(this,null,function*(){if(yield this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise})}cancel(e){this._done=!0,this._headersCapability.reject(e);for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}},An=class{constructor(e,t,i){this._manager=e;let s={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=e.url,this._requestId=e.requestRange(t,i,s),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){let e=us(this._manager.getRequestXhr(this._requestId)?.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(e){let t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(let i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??=ms(e,this._url);for(let t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){this.isStreamingSupported||this.onProgress?.({loaded:e.loaded})}get isStreamingSupported(){return!1}read(){return k(this,null,function*(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){let t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise})}cancel(e){this._done=!0;for(let t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}},il=/^[a-z][a-z0-9\-+.]+:/i;function sl(o){if(il.test(o))return new URL(o);let e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(o))}var xn=class{constructor(e){this.source=e,this.url=sl(e.url),J(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return J(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Cn(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let i=new kn(this,e,t);return this._rangeRequestReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeRequestReaders.slice(0))t.cancel(e)}},Cn=class{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;let t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();let i=process.getBuiltinModule("fs");i.promises.lstat(this._url).then(s=>{this._contentLength=s.size,this._setReadableStream(i.createReadStream(this._url)),this._headersCapability.resolve()},s=>{s.code==="ENOENT"&&(s=new he(`Missing PDF "${this._url}".`)),this._storedError=s,this._headersCapability.reject(s)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}read(){return k(this,null,function*(){if(yield this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Ut("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}},kn=class{constructor(e,t,i){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();let s=e.source;this._isStreamingSupported=!s.disableStream;let n=process.getBuiltinModule("fs");this._setReadableStream(n.createReadStream(this._url,{start:t,end:i-1}))}get isStreamingSupported(){return this._isStreamingSupported}read(){return k(this,null,function*(){if(yield this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}},nl=1e5,ht=30,al=.8,Ye=class o{#t=Promise.withResolvers();#e=null;#i=!1;#s=!!globalThis.FontInspector?.enabled;#a=null;#n=null;#c=0;#o=0;#d=null;#l=null;#h=0;#r=0;#u=Object.create(null);#m=[];#p=null;#g=[];#f=new WeakMap;#_=null;static#b=new Map;static#y=new Map;static#w=new WeakMap;static#C=null;static#k=new Set;constructor({textContentSource:e,container:t,viewport:i}){if(e instanceof ReadableStream)this.#p=e;else if(typeof e=="object")this.#p=new ReadableStream({start(l){l.enqueue(e),l.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#e=this.#l=t,this.#r=i.scale*(globalThis.devicePixelRatio||1),this.#h=i.rotation,this.#n={div:null,properties:null,ctx:null};let{pageWidth:s,pageHeight:n,pageX:a,pageY:r}=i.rawDims;this.#_=[1,0,0,-1,-a,r+n],this.#o=s,this.#c=n,o.#L(),ue(t,i),this.#t.promise.finally(()=>{o.#k.delete(this),this.#n=null,this.#u=null}).catch(()=>{})}static get fontFamilyMap(){let{isWindows:e,isFirefox:t}=st.platform;return F(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){let e=()=>{this.#d.read().then(({value:t,done:i})=>{if(i){this.#t.resolve();return}this.#a??=t.lang,Object.assign(this.#u,t.styles),this.#S(t.items),e()},this.#t.reject)};return this.#d=this.#p.getReader(),o.#k.add(this),e(),this.#t.promise}update({viewport:e,onBefore:t=null}){let i=e.scale*(globalThis.devicePixelRatio||1),s=e.rotation;if(s!==this.#h&&(t?.(),this.#h=s,ue(this.#l,{rotation:s})),i!==this.#r){t?.(),this.#r=i;let n={div:null,properties:null,ctx:o.#M(this.#a)};for(let a of this.#g)n.properties=this.#f.get(a),n.div=a,this.#A(n)}}cancel(){let e=new Ut("TextLayer task cancelled.");this.#d?.cancel(e).catch(()=>{}),this.#d=null,this.#t.reject(e)}get textDivs(){return this.#g}get textContentItemsStr(){return this.#m}#S(e){if(this.#i)return;this.#n.ctx??=o.#M(this.#a);let t=this.#g,i=this.#m;for(let s of e){if(t.length>nl){R("Ignoring additional textDivs for performance reasons."),this.#i=!0;return}if(s.str===void 0){if(s.type==="beginMarkedContentProps"||s.type==="beginMarkedContent"){let n=this.#e;this.#e=document.createElement("span"),this.#e.classList.add("markedContent"),s.id!==null&&this.#e.setAttribute("id",`${s.id}`),n.append(this.#e)}else s.type==="endMarkedContent"&&(this.#e=this.#e.parentNode);continue}i.push(s.str),this.#T(s)}}#T(e){let t=document.createElement("span"),i={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};this.#g.push(t);let s=E.transform(this.#_,e.transform),n=Math.atan2(s[1],s[0]),a=this.#u[e.fontName];a.vertical&&(n+=Math.PI/2);let r=this.#s&&a.fontSubstitution||a.fontFamily;r=o.fontFamilyMap.get(r)||r;let l=Math.hypot(s[2],s[3]),c=l*o.#R(r,this.#a),d,h;n===0?(d=s[4],h=s[5]-c):(d=s[4]+c*Math.sin(n),h=s[5]-c*Math.cos(n));let u="calc(var(--scale-factor)*",m=t.style;this.#e===this.#l?(m.left=`${(100*d/this.#o).toFixed(2)}%`,m.top=`${(100*h/this.#c).toFixed(2)}%`):(m.left=`${u}${d.toFixed(2)}px)`,m.top=`${u}${h.toFixed(2)}px)`),m.fontSize=`${u}${(o.#C*l).toFixed(2)}px)`,m.fontFamily=r,i.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,this.#s&&(t.dataset.fontName=a.fontSubstitutionLoadedName||e.fontName),n!==0&&(i.angle=n*(180/Math.PI));let p=!1;if(e.str.length>1)p=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){let f=Math.abs(e.transform[0]),_=Math.abs(e.transform[3]);f!==_&&Math.max(f,_)/Math.min(f,_)>1.5&&(p=!0)}if(p&&(i.canvasWidth=a.vertical?e.height:e.width),this.#f.set(t,i),this.#n.div=t,this.#n.properties=i,this.#A(this.#n),i.hasText&&this.#e.append(t),i.hasEOL){let f=document.createElement("br");f.setAttribute("role","presentation"),this.#e.append(f)}}#A(e){let{div:t,properties:i,ctx:s}=e,{style:n}=t,a="";if(o.#C>1&&(a=`scale(${1/o.#C})`),i.canvasWidth!==0&&i.hasText){let{fontFamily:r}=n,{canvasWidth:l,fontSize:c}=i;o.#E(s,c*this.#r,r);let{width:d}=s.measureText(t.textContent);d>0&&(a=`scaleX(${l*this.#r/d}) ${a}`)}i.angle!==0&&(a=`rotate(${i.angle}deg) ${a}`),a.length>0&&(n.transform=a)}static cleanup(){if(!(this.#k.size>0)){this.#b.clear();for(let{canvas:e}of this.#y.values())e.remove();this.#y.clear()}}static#M(e=null){let t=this.#y.get(e||="");if(!t){let i=document.createElement("canvas");i.className="hiddenCanvasElement",i.lang=e,document.body.append(i),t=i.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#y.set(e,t),this.#w.set(t,{size:0,family:""})}return t}static#E(e,t,i){let s=this.#w.get(e);t===s.size&&i===s.family||(e.font=`${t}px ${i}`,s.size=t,s.family=i)}static#L(){if(this.#C!==null)return;let e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),this.#C=e.getBoundingClientRect().height,e.remove()}static#R(e,t){let i=this.#b.get(e);if(i)return i;let s=this.#M(t);s.canvas.width=s.canvas.height=ht,this.#E(s,ht,e);let n=s.measureText(""),a=n.fontBoundingBoxAscent,r=Math.abs(n.fontBoundingBoxDescent);if(a){let d=a/(a+r);return this.#b.set(e,d),s.canvas.width=s.canvas.height=0,d}s.strokeStyle="red",s.clearRect(0,0,ht,ht),s.strokeText("g",0,0);let l=s.getImageData(0,0,ht,ht).data;r=0;for(let d=l.length-1-3;d>=0;d-=4)if(l[d]>0){r=Math.ceil(d/4/ht);break}s.clearRect(0,0,ht,ht),s.strokeText("A",0,ht),l=s.getImageData(0,0,ht,ht).data,a=0;for(let d=0,h=l.length;d<h;d+=4)if(l[d]>0){a=ht-Math.floor(d/4/ht);break}s.canvas.width=s.canvas.height=0;let c=a?a/(a+r):al;return this.#b.set(e,c),c}},Ke=class o{static textContent(e){let t=[],i={items:t,styles:Object.create(null)};function s(n){if(!n)return;let a=null,r=n.name;if(r==="#text")a=n.value;else if(o.shouldBuildText(r))n?.attributes?.textContent?a=n.attributes.textContent:n.value&&(a=n.value);else return;if(a!==null&&t.push({str:a}),!!n.children)for(let l of n.children)s(l)}return s(e),i}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}},rl=65536,ol=100,ll=5e3,cl=ct?sn:Js,dl=ct?nn:Hi,hl=ct?en:tn,ul=ct?an:Vi;function ml(o={}){typeof o=="string"||o instanceof URL?o={url:o}:(o instanceof ArrayBuffer||ArrayBuffer.isView(o))&&(o={data:o});let e=new Sn,{docId:t}=e,i=o.url?pl(o.url):null,s=o.data?fl(o.data):null,n=o.httpHeaders||null,a=o.withCredentials===!0,r=o.password??null,l=o.range instanceof $i?o.range:null,c=Number.isInteger(o.rangeChunkSize)&&o.rangeChunkSize>0?o.rangeChunkSize:rl,d=o.worker instanceof Ce?o.worker:null,h=o.verbosity,u=typeof o.docBaseUrl=="string"&&!hs(o.docBaseUrl)?o.docBaseUrl:null,m=typeof o.cMapUrl=="string"?o.cMapUrl:null,p=o.cMapPacked!==!1,f=o.CMapReaderFactory||dl,_=typeof o.standardFontDataUrl=="string"?o.standardFontDataUrl:null,g=o.StandardFontDataFactory||ul,b=o.stopAtErrors!==!0,v=Number.isInteger(o.maxImageSize)&&o.maxImageSize>-1?o.maxImageSize:-1,y=o.isEvalSupported!==!1,w=typeof o.isOffscreenCanvasSupported=="boolean"?o.isOffscreenCanvasSupported:!ct,A=typeof o.isImageDecoderSupported=="boolean"?o.isImageDecoderSupported:!ct&&(st.platform.isFirefox||!globalThis.chrome),x=Number.isInteger(o.canvasMaxAreaInBytes)?o.canvasMaxAreaInBytes:-1,T=typeof o.disableFontFace=="boolean"?o.disableFontFace:ct,M=o.fontExtraProperties===!0,H=o.enableXfa===!0,O=o.ownerDocument||globalThis.document,G=o.disableRange===!0,tt=o.disableStream===!0,z=o.disableAutoFetch===!0,dt=o.pdfBug===!0,U=o.CanvasFactory||cl,S=o.FilterFactory||hl,L=o.enableHWA===!0,Ct=l?l.length:o.length??NaN,Bt=typeof o.useSystemFonts=="boolean"?o.useSystemFonts:!ct&&!T,pt=typeof o.useWorkerFetch=="boolean"?o.useWorkerFetch:f===Hi&&g===Vi&&m&&_&&He(m,document.baseURI)&&He(_,document.baseURI);o.canvasFactory&&xr("`canvasFactory`-instance option, please use `CanvasFactory` instead."),o.filterFactory&&xr("`filterFactory`-instance option, please use `FilterFactory` instead.");let it=null;Mo(h);let K={canvasFactory:new U({ownerDocument:O,enableHWA:L}),filterFactory:new S({docId:t,ownerDocument:O}),cMapReaderFactory:pt?null:new f({baseUrl:m,isCompressed:p}),standardFontDataFactory:pt?null:new g({baseUrl:_})};if(!d){let ft={verbosity:h,port:de.workerPort};d=ft.port?Ce.fromPort(ft):new Ce(ft),e._worker=d}let fe={docId:t,apiVersion:"4.9.155",data:s,password:r,disableAutoFetch:z,rangeChunkSize:c,length:Ct,docBaseUrl:u,enableXfa:H,evaluatorOptions:{maxImageSize:v,disableFontFace:T,ignoreErrors:b,isEvalSupported:y,isOffscreenCanvasSupported:w,isImageDecoderSupported:A,canvasMaxAreaInBytes:x,fontExtraProperties:M,useSystemFonts:Bt,cMapUrl:pt?m:null,standardFontDataUrl:pt?_:null}},Te={disableFontFace:T,fontExtraProperties:M,ownerDocument:O,pdfBug:dt,styleElement:it,loadingParams:{disableAutoFetch:z,enableXfa:H}};return d.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");let ft=d.messageHandler.sendWithPromise("GetDocRequest",fe,s?[s.buffer]:null),$;if(l)$=new pn(l,{disableRange:G,disableStream:tt});else if(!s){if(!i)throw new Error("getDocument - no `url` parameter provided.");let kt;if(ct)if(He(i)){if(typeof fetch>"u"||typeof Response>"u"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");kt=Ui}else kt=xn;else kt=He(i)?Ui:yn;$=new kt({url:i,length:Ct,httpHeaders:n,withCredentials:a,rangeChunkSize:c,disableRange:G,disableStream:tt})}return ft.then(kt=>{if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");let ua=new ce(t,kt,d.port),Zr=new Ln(ua,e,$,Te,K);e._transport=Zr,ua.send("Ready",null)})}).catch(e._capability.reject),e}function pl(o){if(o instanceof URL)return o.href;try{return new URL(o,window.location).href}catch{if(ct&&typeof o=="string")return o}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function fl(o){if(ct&&typeof Buffer<"u"&&o instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(o instanceof Uint8Array&&o.byteLength===o.buffer.byteLength)return o;if(typeof o=="string")return cs(o);if(o instanceof ArrayBuffer||ArrayBuffer.isView(o)||typeof o=="object"&&!isNaN(o?.length))return new Uint8Array(o);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Fr(o){return typeof o=="object"&&Number.isInteger(o?.num)&&o.num>=0&&Number.isInteger(o?.gen)&&o.gen>=0}var Sn=class o{static#t=0;constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${o.#t++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}destroy(){return k(this,null,function*(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),yield this._transport?.destroy()}catch(e){throw this._worker?.port&&delete this._worker._pendingDestroy,e}this._transport=null,this._worker?.destroy(),this._worker=null})}},$i=class{constructor(e,t,i=!1,s=null){this.length=e,this.initialData=t,this.progressiveDone=i,this.contentDispositionFilename=s,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(let i of this._rangeListeners)i(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(let i of this._progressListeners)i(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(let t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(let e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){V("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}},En=class{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return F(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){let{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}},Tn=class{#t=null;#e=!1;constructor(e,t,i,s=!1){this._pageIndex=e,this._pageInfo=t,this._transport=i,this._stats=s?new Ii:null,this._pdfBug=s,this.commonObjs=i.commonObjs,this.objs=new Wi,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:i=0,offsetY:s=0,dontFlip:n=!1}={}){return new Ge({viewBox:this.view,scale:e,rotation:t,offsetX:i,offsetY:s,dontFlip:n})}getAnnotations({intent:e="display"}={}){let{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return F(this,"isPureXfa",!!this._transport._htmlForXfa)}getXfa(){return k(this,null,function*(){return this._transport._htmlForXfa?.children[this._pageIndex]||null})}render({canvasContext:e,viewport:t,intent:i="display",annotationMode:s=Qt.ENABLE,transform:n=null,background:a=null,optionalContentConfigPromise:r=null,annotationCanvasMap:l=null,pageColors:c=null,printAnnotationStorage:d=null,isEditing:h=!1}){this._stats?.time("Overall");let u=this._transport.getRenderingIntent(i,s,d,h),{renderingIntent:m,cacheKey:p}=u;this.#e=!1,this.#s(),r||=this._transport.getOptionalContentConfig(m);let f=this._intentStates.get(p);f||(f=Object.create(null),this._intentStates.set(p,f)),f.streamReaderCancelTimeout&&(clearTimeout(f.streamReaderCancelTimeout),f.streamReaderCancelTimeout=null);let _=!!(m&mt.PRINT);f.displayReadyCapability||(f.displayReadyCapability=Promise.withResolvers(),f.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(u));let g=y=>{f.renderTasks.delete(b),(this._maybeCleanupAfterRender||_)&&(this.#e=!0),this.#i(!_),y?(b.capability.reject(y),this._abortOperatorList({intentState:f,reason:y instanceof Error?y:new Error(y)})):b.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},b=new In({callback:g,params:{canvasContext:e,viewport:t,transform:n,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:f.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!_,pdfBug:this._pdfBug,pageColors:c});(f.renderTasks||=new Set).add(b);let v=b.task;return Promise.all([f.displayReadyCapability.promise,r]).then(([y,w])=>{if(this.destroyed){g();return}if(this._stats?.time("Rendering"),!(w.renderingIntent&m))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");b.initializeGraphics({transparency:y,optionalContentConfig:w}),b.operatorListChanged()}).catch(g),v}getOperatorList({intent:e="display",annotationMode:t=Qt.ENABLE,printAnnotationStorage:i=null,isEditing:s=!1}={}){function n(){r.operatorList.lastChunk&&(r.opListReadCapability.resolve(r.operatorList),r.renderTasks.delete(l))}let a=this._transport.getRenderingIntent(e,t,i,s,!0),r=this._intentStates.get(a.cacheKey);r||(r=Object.create(null),this._intentStates.set(a.cacheKey,r));let l;return r.opListReadCapability||(l=Object.create(null),l.operatorListChanged=n,r.opListReadCapability=Promise.withResolvers(),(r.renderTasks||=new Set).add(l),r.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(a)),r.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(s){return s.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(i=>Ke.textContent(i));let t=this.streamTextContent(e);return new Promise(function(i,s){function n(){a.read().then(function({value:l,done:c}){if(c){i(r);return}r.lang??=l.lang,Object.assign(r.styles,l.styles),r.items.push(...l.items),n()},s)}let a=t.getReader(),r={items:[],styles:Object.create(null),lang:null};n()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let e=[];for(let t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(let i of t.renderTasks)e.push(i.completed),i.cancel();return this.objs.clear(),this.#e=!1,this.#s(),Promise.all(e)}cleanup(e=!1){this.#e=!0;let t=this.#i(!1);return e&&t&&(this._stats&&=new Ii),t}#i(e=!1){if(this.#s(),!this.#e||this.destroyed)return!1;if(e)return this.#t=setTimeout(()=>{this.#t=null,this.#i(!1)},ll),!1;for(let{renderTasks:t,operatorList:i}of this._intentStates.values())if(t.size>0||!i.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#e=!1,!0}#s(){this.#t&&(clearTimeout(this.#t),this.#t=null)}_startRenderPage(e,t){let i=this._intentStates.get(t);i&&(this._stats?.timeEnd("Page Request"),i.displayReadyCapability?.resolve(e))}_renderPageChunk(e,t){for(let i=0,s=e.length;i<s;i++)t.operatorList.fnArray.push(e.fnArray[i]),t.operatorList.argsArray.push(e.argsArray[i]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(let i of t.renderTasks)i.operatorListChanged();e.lastChunk&&this.#i(!0)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:i,modifiedIds:s}){let{map:n,transfer:a}=i,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:n,modifiedIds:s},a).getReader(),c=this._intentStates.get(t);c.streamReader=l;let d=()=>{l.read().then(({value:h,done:u})=>{if(u){c.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(h,c),d())},h=>{if(c.streamReader=null,!this._transport.destroyed){if(c.operatorList){c.operatorList.lastChunk=!0;for(let u of c.renderTasks)u.operatorListChanged();this.#i(!0)}if(c.displayReadyCapability)c.displayReadyCapability.reject(h);else if(c.opListReadCapability)c.opListReadCapability.reject(h);else throw h}})};d()}_abortOperatorList({intentState:e,reason:t,force:i=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!i){if(e.renderTasks.size>0)return;if(t instanceof Ue){let s=ol;t.extraDelay>0&&t.extraDelay<1e3&&(s+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},s);return}}if(e.streamReader.cancel(new Ut(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(let[s,n]of this._intentStates)if(n===e){this._intentStates.delete(s);break}this.cleanup()}}}get stats(){return this._stats}},Mn=class{#t=new Map;#e=Promise.resolve();postMessage(e,t){let i={data:structuredClone(e,t?{transfer:t}:null)};this.#e.then(()=>{for(let[s]of this.#t)s.call(this,i)})}addEventListener(e,t,i=null){let s=null;if(i?.signal instanceof AbortSignal){let{signal:n}=i;if(n.aborted){R("LoopbackPort - cannot use an `aborted` signal.");return}let a=()=>this.removeEventListener(e,t);s=()=>n.removeEventListener("abort",a),n.addEventListener("abort",a)}this.#t.set(t,s)}removeEventListener(e,t){this.#t.get(t)?.(),this.#t.delete(t)}terminate(){for(let[,e]of this.#t)e?.();this.#t.clear()}},Ce=class o{static#t=0;static#e=!1;static#i;static{ct&&(this.#e=!0,de.workerSrc||="./pdf.worker.mjs"),this._isSameOrigin=(e,t)=>{let i;try{if(i=new URL(e),!i.origin||i.origin==="null")return!1}catch{return!1}let s=new URL(t,i);return i.origin===s.origin},this._createCDNWrapper=e=>{let t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))}}constructor({name:e=null,port:t=null,verbosity:i=Lo()}={}){if(this.name=e,this.destroyed=!1,this.verbosity=i,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,t){if(o.#i?.has(t))throw new Error("Cannot use more than one PDFWorker per port.");(o.#i||=new WeakMap).set(t,this),this._initializeFromPort(t);return}this._initialize()}get promise(){return this._readyCapability.promise}#s(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new ce("main","worker",e),this._messageHandler.on("ready",function(){}),this.#s()}_initialize(){if(o.#e||o.#a){this._setupFakeWorker();return}let{workerSrc:e}=o;try{o._isSameOrigin(window.location.href,e)||(e=o._createCDNWrapper(new URL(e,window.location).href));let t=new Worker(e,{type:"module"}),i=new ce("main","worker",t),s=()=>{n.abort(),i.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},n=new AbortController;t.addEventListener("error",()=>{this._webWorker||s()},{signal:n.signal}),i.on("test",r=>{if(n.abort(),this.destroyed||!r){s();return}this._messageHandler=i,this._port=t,this._webWorker=t,this.#s()}),i.on("ready",r=>{if(n.abort(),this.destroyed){s();return}try{a()}catch{this._setupFakeWorker()}});let a=()=>{let r=new Uint8Array;i.send("test",r,[r.buffer])};a();return}catch{ls("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){o.#e||(R("Setting up fake worker."),o.#e=!0),o._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}let t=new Mn;this._port=t;let i=`fake${o.#t++}`,s=new ce(i+"_worker",i,t);e.setup(s,t),this._messageHandler=new ce(i,i+"_worker",t),this.#s()}).catch(e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){this.destroyed=!0,this._webWorker?.terminate(),this._webWorker=null,o.#i?.delete(this._port),this._port=null,this._messageHandler?.destroy(),this._messageHandler=null}static fromPort(e){if(!e?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");let t=this.#i?.get(e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new o(e)}static get workerSrc(){if(de.workerSrc)return de.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get#a(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){return F(this,"_setupFakeWorkerGlobal",k(this,null,function*(){return this.#a?this.#a:(yield import(this.workerSrc)).WorkerMessageHandler}))}},Ln=class{#t=new Map;#e=new Map;#i=new Map;#s=new Map;#a=null;constructor(e,t,i,s,n){this.messageHandler=e,this.loadingTask=t,this.commonObjs=new Wi,this.fontLoader=new Qs({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this.loadingParams=s.loadingParams,this._params=s,this.canvasFactory=n.canvasFactory,this.filterFactory=n.filterFactory,this.cMapReaderFactory=n.cMapReaderFactory,this.standardFontDataFactory=n.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=i,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}#n(e,t=null){let i=this.#t.get(e);if(i)return i;let s=this.messageHandler.sendWithPromise(e,t);return this.#t.set(e,s),s}get annotationStorage(){return F(this,"annotationStorage",new qe)}getRenderingIntent(e,t=Qt.ENABLE,i=null,s=!1,n=!1){let a=mt.DISPLAY,r=Ks;switch(e){case"any":a=mt.ANY;break;case"display":break;case"print":a=mt.PRINT;break;default:R(`getRenderingIntent - invalid intent: ${e}`)}let l=a&mt.PRINT&&i instanceof Fi?i:this.annotationStorage;switch(t){case Qt.DISABLE:a+=mt.ANNOTATIONS_DISABLE;break;case Qt.ENABLE:break;case Qt.ENABLE_FORMS:a+=mt.ANNOTATIONS_FORMS;break;case Qt.ENABLE_STORAGE:a+=mt.ANNOTATIONS_STORAGE,r=l.serializable;break;default:R(`getRenderingIntent - invalid annotationMode: ${t}`)}s&&(a+=mt.IS_EDITING),n&&(a+=mt.OPLIST);let{ids:c,hash:d}=l.modifiedIds,h=[a,r.hash,d];return{renderingIntent:a,cacheKey:h.join("_"),annotationStorageSerializable:r,modifiedIds:c}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#a?.reject(new Error("Worker was destroyed during onPassword callback"));let e=[];for(let i of this.#e.values())e.push(i._destroy());this.#e.clear(),this.#i.clear(),this.#s.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();let t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),Ye.cleanup(),this._networkStream?.cancelAllRequests(new Ut("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(i,s)=>{J(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=n=>{this._lastProgress={loaded:n.loaded,total:n.total}},s.onPull=()=>{this._fullReader.read().then(function({value:n,done:a}){if(a){s.close();return}J(n instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(n),1,[n])}).catch(n=>{s.error(n)})},s.onCancel=n=>{this._fullReader.cancel(n),s.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("ReaderHeadersReady",i=>k(this,null,function*(){yield this._fullReader.headersReady;let{isStreamingSupported:s,isRangeSupported:n,contentLength:a}=this._fullReader;return(!s||!n)&&(this._lastProgress&&t.onProgress?.(this._lastProgress),this._fullReader.onProgress=r=>{t.onProgress?.({loaded:r.loaded,total:r.total})}),{isStreamingSupported:s,isRangeSupported:n,contentLength:a}})),e.on("GetRangeReader",(i,s)=>{J(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let n=this._networkStream.getRangeReader(i.begin,i.end);if(!n){s.close();return}s.onPull=()=>{n.read().then(function({value:a,done:r}){if(r){s.close();return}J(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{s.error(a)})},s.onCancel=a=>{n.cancel(a),s.ready.catch(r=>{if(!this.destroyed)throw r})}}),e.on("GetDoc",({pdfInfo:i})=>{this._numPages=i.numPages,this._htmlForXfa=i.htmlForXfa,delete i.htmlForXfa,t._capability.resolve(new En(i,this))}),e.on("DocException",function(i){let s;switch(i.name){case"PasswordException":s=new je(i.message,i.code);break;case"InvalidPDFException":s=new Pi(i.message);break;case"MissingPDFException":s=new he(i.message);break;case"UnexpectedResponseException":s=new ke(i.message,i.status);break;case"UnknownErrorException":s=new Ve(i.message,i.details);break;default:V("DocException - expected a valid Error.")}t._capability.reject(s)}),e.on("PasswordRequest",i=>{if(this.#a=Promise.withResolvers(),t.onPassword){let s=n=>{n instanceof Error?this.#a.reject(n):this.#a.resolve({password:n})};try{t.onPassword(s,i.code)}catch(n){this.#a.reject(n)}}else this.#a.reject(new je(i.message,i.code));return this.#a.promise}),e.on("DataLoaded",i=>{t.onProgress?.({loaded:i.length,total:i.length}),this.downloadInfoCapability.resolve(i)}),e.on("StartRenderPage",i=>{if(this.destroyed)return;this.#e.get(i.pageIndex)._startRenderPage(i.transparency,i.cacheKey)}),e.on("commonobj",([i,s,n])=>{if(this.destroyed||this.commonObjs.has(i))return null;switch(s){case"Font":let{disableFontFace:a,fontExtraProperties:r,pdfBug:l}=this._params;if("error"in n){let u=n.error;R(`Error during font loading: ${u}`),this.commonObjs.resolve(i,u);break}let c=l&&globalThis.FontInspector?.enabled?(u,m)=>globalThis.FontInspector.fontAdded(u,m):null,d=new Zs(n,{disableFontFace:a,inspectFont:c});this.fontLoader.bind(d).catch(()=>e.sendWithPromise("FontFallback",{id:i})).finally(()=>{!r&&d.data&&(d.data=null),this.commonObjs.resolve(i,d)});break;case"CopyLocalImage":let{imageRef:h}=n;J(h,"The imageRef must be defined.");for(let u of this.#e.values())for(let[,m]of u.objs)if(m?.ref===h)return m.dataLen?(this.commonObjs.resolve(i,structuredClone(m)),m.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(i,n);break;default:throw new Error(`Got unknown common object type ${s}`)}return null}),e.on("obj",([i,s,n,a])=>{if(this.destroyed)return;let r=this.#e.get(s);if(!r.objs.has(i)){if(r._intentStates.size===0){a?.bitmap?.close();return}switch(n){case"Image":r.objs.resolve(i,a),a?.dataLen>Co&&(r._maybeCleanupAfterRender=!0);break;case"Pattern":r.objs.resolve(i,a);break;default:throw new Error(`Got unknown object type ${n}`)}}}),e.on("DocProgress",i=>{this.destroyed||t.onProgress?.({loaded:i.loaded,total:i.total})}),e.on("FetchBuiltInCMap",i=>k(this,null,function*(){if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(i)})),e.on("FetchStandardFontData",i=>k(this,null,function*(){if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(i)}))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&R("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");let{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:this._fullReader?.filename??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));let t=e-1,i=this.#i.get(t);if(i)return i;let s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(n=>{if(this.destroyed)throw new Error("Transport destroyed");n.refStr&&this.#s.set(n.refStr,e);let a=new Tn(t,n,this,this._params.pdfBug);return this.#e.set(t,a),a});return this.#i.set(t,s),s}getPageIndex(e){return Fr(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return this.#n("GetFieldObjects")}hasJSActions(){return this.#n("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#n("GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return this.#n("GetOptionalContentConfig").then(t=>new mn(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){let e="GetMetadata",t=this.#t.get(e);if(t)return t;let i=this.messageHandler.sendWithPromise(e,null).then(s=>({info:s[0],metadata:s[1]?new hn(s[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#t.set(e,i),i}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}startCleanup(e=!1){return k(this,null,function*(){if(!this.destroyed){yield this.messageHandler.sendWithPromise("Cleanup",null);for(let t of this.#e.values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0),Ye.cleanup()}})}cachedPageNumber(e){if(!Fr(e))return null;let t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return this.#s.get(t)??null}},Ei=Symbol("INITIAL_DATA"),Wi=class{#t=Object.create(null);#e(e){return this.#t[e]||=Wt(X({},Promise.withResolvers()),{data:Ei})}get(e,t=null){if(t){let s=this.#e(e);return s.promise.then(()=>t(s.data)),null}let i=this.#t[e];if(!i||i.data===Ei)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return i.data}has(e){let t=this.#t[e];return!!t&&t.data!==Ei}resolve(e,t=null){let i=this.#e(e);i.data=t,i.resolve()}clear(){for(let e in this.#t){let{data:t}=this.#t[e];t?.bitmap?.close()}this.#t=Object.create(null)}*[Symbol.iterator](){for(let e in this.#t){let{data:t}=this.#t[e];t!==Ei&&(yield[e,t])}}},Pn=class{#t=null;constructor(e){this.#t=e,this.onContinue=null}get promise(){return this.#t.capability.promise}cancel(e=0){this.#t.cancel(null,e)}get separateAnnots(){let{separateAnnots:e}=this.#t.operatorList;if(!e)return!1;let{annotationCanvasMap:t}=this.#t;return e.form||e.canvas&&t?.size>0}},In=class o{#t=null;static#e=new WeakSet;constructor({callback:e,params:t,objs:i,commonObjs:s,annotationCanvasMap:n,operatorList:a,pageIndex:r,canvasFactory:l,filterFactory:c,useRequestAnimationFrame:d=!1,pdfBug:h=!1,pageColors:u=null}){this.callback=e,this.params=t,this.objs=i,this.commonObjs=s,this.annotationCanvasMap=n,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=r,this.canvasFactory=l,this.filterFactory=c,this._pdfBug=h,this.pageColors=u,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=d===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Pn(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){if(this.cancelled)return;if(this._canvas){if(o.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");o.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{canvasContext:i,viewport:s,transform:n,background:a}=this.params;this.gfx=new xe(i,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:n,viewport:s,transparency:e,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(e=null,t=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#t&&(window.cancelAnimationFrame(this.#t),this.#t=null),o.#e.delete(this._canvas),this.callback(e||new Ue(`Rendering cancelled, page ${this._pageIndex+1}`,t))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#t=window.requestAnimationFrame(()=>{this.#t=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}_next(){return k(this,null,function*(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),o.#e.delete(this._canvas),this.callback())))})}},gl="4.9.155",_l="a4eb8407c";function Nr(o){return Math.floor(Math.max(0,Math.min(1,o))*255).toString(16).padStart(2,"0")}function Be(o){return Math.max(0,Math.min(255,255*o))}var qi=class{static CMYK_G([e,t,i,s]){return["G",1-Math.min(1,.3*e+.59*i+.11*t+s)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=Be(e),[e,e,e]}static G_HTML([e]){let t=Nr(e);return`#${t}${t}${t}`}static RGB_G([e,t,i]){return["G",.3*e+.59*t+.11*i]}static RGB_rgb(e){return e.map(Be)}static RGB_HTML(e){return`#${e.map(Nr).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,i,s]){return["RGB",1-Math.min(1,e+s),1-Math.min(1,i+s),1-Math.min(1,t+s)]}static CMYK_rgb([e,t,i,s]){return[Be(1-Math.min(1,e+s)),Be(1-Math.min(1,i+s)),Be(1-Math.min(1,t+s))]}static CMYK_HTML(e){let t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,i]){let s=1-e,n=1-t,a=1-i,r=Math.min(s,n,a);return["CMYK",s,n,a,r]}},Dn=class{create(e,t,i=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");let s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),i||(s.setAttribute("width",`${e}px`),s.setAttribute("height",`${t}px`)),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox",`0 0 ${e} ${t}`),s}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){V("Abstract method `_createSVG` called.")}},Qe=class extends Dn{_createSVG(e){return document.createElementNS(Gt,e)}},Xi=class{static setupStorage(e,t,i,s,n){let a=s.getValue(t,{value:null});switch(i.name){case"textarea":if(a.value!==null&&(e.textContent=a.value),n==="print")break;e.addEventListener("input",r=>{s.setValue(t,{value:r.target.value})});break;case"input":if(i.attributes.type==="radio"||i.attributes.type==="checkbox"){if(a.value===i.attributes.xfaOn?e.setAttribute("checked",!0):a.value===i.attributes.xfaOff&&e.removeAttribute("checked"),n==="print")break;e.addEventListener("change",r=>{s.setValue(t,{value:r.target.checked?r.target.getAttribute("xfaOn"):r.target.getAttribute("xfaOff")})})}else{if(a.value!==null&&e.setAttribute("value",a.value),n==="print")break;e.addEventListener("input",r=>{s.setValue(t,{value:r.target.value})})}break;case"select":if(a.value!==null){e.setAttribute("value",a.value);for(let r of i.children)r.attributes.value===a.value?r.attributes.selected=!0:r.attributes.hasOwnProperty("selected")&&delete r.attributes.selected}e.addEventListener("input",r=>{let l=r.target.options,c=l.selectedIndex===-1?"":l[l.selectedIndex].value;s.setValue(t,{value:c})});break}}static setAttributes({html:e,element:t,storage:i=null,intent:s,linkService:n}){let{attributes:a}=t,r=e instanceof HTMLAnchorElement;a.type==="radio"&&(a.name=`${a.name}-${s}`);for(let[l,c]of Object.entries(a))if(c!=null)switch(l){case"class":c.length&&e.setAttribute(l,c.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",c);break;case"style":Object.assign(e.style,c);break;case"textContent":e.textContent=c;break;default:(!r||l!=="href"&&l!=="newWindow")&&e.setAttribute(l,c)}r&&n.addLinkAttributes(e,a.href,a.newWindow),i&&a.dataId&&this.setupStorage(e,a.dataId,t,i)}static render(e){let t=e.annotationStorage,i=e.linkService,s=e.xfaHtml,n=e.intent||"display",a=document.createElement(s.name);s.attributes&&this.setAttributes({html:a,element:s,intent:n,linkService:i});let r=n!=="richText",l=e.div;if(l.append(a),e.viewport){let h=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=h}r&&l.setAttribute("class","xfaLayer xfaFont");let c=[];if(s.children.length===0){if(s.value){let h=document.createTextNode(s.value);a.append(h),r&&Ke.shouldBuildText(s.name)&&c.push(h)}return{textDivs:c}}let d=[[s,-1,a]];for(;d.length>0;){let[h,u,m]=d.at(-1);if(u+1===h.children.length){d.pop();continue}let p=h.children[++d.at(-1)[1]];if(p===null)continue;let{name:f}=p;if(f==="#text"){let g=document.createTextNode(p.value);c.push(g),m.append(g);continue}let _=p?.attributes?.xmlns?document.createElementNS(p.attributes.xmlns,f):document.createElement(f);if(m.append(_),p.attributes&&this.setAttributes({html:_,element:p,storage:t,intent:n,linkService:i}),p.children?.length>0)d.push([p,-1,_]);else if(p.value){let g=document.createTextNode(p.value);r&&Ke.shouldBuildText(f)&&c.push(g),_.append(g)}}for(let h of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))h.setAttribute("readOnly",!0);return{textDivs:c}}static update(e){let t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}},ii=1e3,bl=9,pe=new WeakSet;function Zt(o){return{width:o[2]-o[0],height:o[3]-o[1]}}var Rn=class{static create(e){switch(e.data.annotationType){case et.LINK:return new Yi(e);case et.TEXT:return new On(e);case et.WIDGET:switch(e.data.fieldType){case"Tx":return new Fn(e);case"Btn":return e.data.radioButton?new Ki(e):e.data.checkBox?new Bn(e):new Hn(e);case"Ch":return new zn(e);case"Sig":return new Nn(e)}return new $t(e);case et.POPUP:return new Ze(e);case et.FREETEXT:return new Qi(e);case et.LINE:return new Vn(e);case et.SQUARE:return new Gn(e);case et.CIRCLE:return new Un(e);case et.POLYLINE:return new Zi(e);case et.CARET:return new Wn(e);case et.INK:return new Je(e);case et.POLYGON:return new $n(e);case et.HIGHLIGHT:return new Ji(e);case et.UNDERLINE:return new qn(e);case et.SQUIGGLY:return new Xn(e);case et.STRIKEOUT:return new Yn(e);case et.STAMP:return new ts(e);case et.FILEATTACHMENT:return new Kn(e);default:return new Y(e)}}},Y=class o{#t=null;#e=!1;#i=null;constructor(e,{isRenderable:t=!1,ignoreBorder:i=!1,createQuadrilaterals:s=!1}={}){this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(i)),s&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:i}){return!!(e?.str||t?.str||i?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return o._hasPopupData(this.data)}updateEdited(e){if(!this.container)return;this.#t||={rect:this.data.rect.slice(0)};let{rect:t}=e;t&&this.#s(t),this.#i?.popup.updateEdited(e)}resetEdited(){this.#t&&(this.#s(this.#t.rect),this.#i?.popup.resetEdited(),this.#t=null)}#s(e){let{container:{style:t},data:{rect:i,rotation:s},parent:{viewport:{rawDims:{pageWidth:n,pageHeight:a,pageX:r,pageY:l}}}}=this;i?.splice(0,4,...e);let{width:c,height:d}=Zt(e);t.left=`${100*(e[0]-r)/n}%`,t.top=`${100*(a-e[3]+l)/a}%`,s===0?(t.width=`${100*c/n}%`,t.height=`${100*d/a}%`):this.setRotation(s)}_createContainer(e){let{data:t,parent:{page:i,viewport:s}}=this,n=document.createElement("section");n.setAttribute("data-annotation-id",t.id),this instanceof $t||(n.tabIndex=ii);let{style:a}=n;if(a.zIndex=this.parent.zIndex++,t.alternativeText&&(n.title=t.alternativeText),t.noRotate&&n.classList.add("norotate"),!t.rect||this instanceof Ze){let{rotation:f}=t;return!t.hasOwnCanvas&&f!==0&&this.setRotation(f,n),n}let{width:r,height:l}=Zt(t.rect);if(!e&&t.borderStyle.width>0){a.borderWidth=`${t.borderStyle.width}px`;let f=t.borderStyle.horizontalCornerRadius,_=t.borderStyle.verticalCornerRadius;if(f>0||_>0){let b=`calc(${f}px * var(--scale-factor)) / calc(${_}px * var(--scale-factor))`;a.borderRadius=b}else if(this instanceof Ki){let b=`calc(${r}px * var(--scale-factor)) / calc(${l}px * var(--scale-factor))`;a.borderRadius=b}switch(t.borderStyle.style){case Fe.SOLID:a.borderStyle="solid";break;case Fe.DASHED:a.borderStyle="dashed";break;case Fe.BEVELED:R("Unimplemented border style: beveled");break;case Fe.INSET:R("Unimplemented border style: inset");break;case Fe.UNDERLINE:a.borderBottomStyle="solid";break;default:break}let g=t.borderColor||null;g?(this.#e=!0,a.borderColor=E.makeHexColor(g[0]|0,g[1]|0,g[2]|0)):a.borderWidth=0}let c=E.normalizeRect([t.rect[0],i.view[3]-t.rect[1]+i.view[1],t.rect[2],i.view[3]-t.rect[3]+i.view[1]]),{pageWidth:d,pageHeight:h,pageX:u,pageY:m}=s.rawDims;a.left=`${100*(c[0]-u)/d}%`,a.top=`${100*(c[1]-m)/h}%`;let{rotation:p}=t;return t.hasOwnCanvas||p===0?(a.width=`${100*r/d}%`,a.height=`${100*l/h}%`):this.setRotation(p,n),n}setRotation(e,t=this.container){if(!this.data.rect)return;let{pageWidth:i,pageHeight:s}=this.parent.viewport.rawDims,{width:n,height:a}=Zt(this.data.rect),r,l;e%180===0?(r=100*n/i,l=100*a/s):(r=100*a/i,l=100*n/s),t.style.width=`${r}%`,t.style.height=`${l}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){let e=(t,i,s)=>{let n=s.detail[t],a=n[0],r=n.slice(1);s.target.style[i]=qi[`${a}_HTML`](r),this.annotationStorage.setValue(this.data.id,{[i]:qi[`${a}_rgb`](r)})};return F(this,"_commonActions",{display:t=>{let{display:i}=t.detail,s=i%2===1;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:s,noPrint:i===1||i===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{let{hidden:i}=t.detail;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:i,noView:i})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{let i=t.detail.rotation;this.setRotation(i),this.annotationStorage.setValue(this.data.id,{rotation:i})}})}_dispatchEventFromSandbox(e,t){let i=this._commonActions;for(let s of Object.keys(t.detail))(e[s]||i[s])?.(t)}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;let t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;let i=this._commonActions;for(let[s,n]of Object.entries(t)){let a=i[s];if(a){let r={detail:{[s]:n},target:e};a(r),delete t[s]}}}_createQuadrilaterals(){if(!this.container)return;let{quadPoints:e}=this.data;if(!e)return;let[t,i,s,n]=this.data.rect.map(f=>Math.fround(f));if(e.length===8){let[f,_,g,b]=e.subarray(2,6);if(s===f&&n===_&&t===g&&i===b)return}let{style:a}=this.container,r;if(this.#e){let{borderColor:f,borderWidth:_}=a;a.borderWidth=0,r=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${f}" stroke-width="${_}">`],this.container.classList.add("hasBorder")}let l=s-t,c=n-i,{svgFactory:d}=this,h=d.createElement("svg");h.classList.add("quadrilateralsContainer"),h.setAttribute("width",0),h.setAttribute("height",0);let u=d.createElement("defs");h.append(u);let m=d.createElement("clipPath"),p=`clippath_${this.data.id}`;m.setAttribute("id",p),m.setAttribute("clipPathUnits","objectBoundingBox"),u.append(m);for(let f=2,_=e.length;f<_;f+=8){let g=e[f],b=e[f+1],v=e[f+2],y=e[f+3],w=d.createElement("rect"),A=(v-t)/l,x=(n-b)/c,T=(g-v)/l,M=(b-y)/c;w.setAttribute("x",A),w.setAttribute("y",x),w.setAttribute("width",T),w.setAttribute("height",M),m.append(w),r?.push(`<rect vector-effect="non-scaling-stroke" x="${A}" y="${x}" width="${T}" height="${M}"/>`)}this.#e&&(r.push("</g></svg>')"),a.backgroundImage=r.join("")),this.container.append(h),this.container.style.clipPath=`url(#${p})`}_createPopup(){let{data:e}=this,t=this.#i=new Ze({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]});this.parent.div.append(t.render())}render(){V("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){let i=[];if(this._fieldObjects){let s=this._fieldObjects[e];if(s)for(let{page:n,id:a,exportValues:r}of s){if(n===-1||a===t)continue;let l=typeof r=="string"?r:null,c=document.querySelector(`[data-element-id="${a}"]`);if(c&&!pe.has(c)){R(`_getElementsByName - element not allowed: ${a}`);continue}i.push({id:a,exportValue:l,domElement:c})}return i}for(let s of document.getElementsByName(e)){let{exportValue:n}=s,a=s.getAttribute("data-element-id");a!==t&&pe.has(s)&&i.push({id:a,exportValue:n,domElement:s})}return i}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){let e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(let t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;let{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}},Yi=class extends Y{constructor(e,t=null){super(e,{isRenderable:!0,ignoreBorder:!!t?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=e.data.isTooltipOnly}render(){let{data:e,linkService:t}=this,i=document.createElement("a");i.setAttribute("data-element-id",e.id);let s=!1;return e.url?(t.addLinkAttributes(i,e.url,e.newWindow),s=!0):e.action?(this._bindNamedAction(i,e.action),s=!0):e.attachment?(this.#e(i,e.attachment,e.attachmentDest),s=!0):e.setOCGState?(this.#i(i,e.setOCGState),s=!0):e.dest?(this._bindLink(i,e.dest),s=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,e),s=!0),e.resetForm?(this._bindResetFormAction(i,e.resetForm),s=!0):this.isTooltipOnly&&!s&&(this._bindLink(i,""),s=!0)),this.container.classList.add("linkAnnotation"),s&&this.container.append(i),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(e,t){e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.goToDestination(t),!1),(t||t==="")&&this.#t()}_bindNamedAction(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),this.#t()}#e(e,t,i=null){e.href=this.linkService.getAnchorUrl(""),t.description&&(e.title=t.description),e.onclick=()=>(this.downloadManager?.openOrDownloadData(t.content,t.filename,i),!1),this.#t()}#i(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(t),!1),this.#t()}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl("");let i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(let s of Object.keys(t.actions)){let n=i.get(s);n&&(e[n]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t.id,name:s}}),!1))}e.onclick||(e.onclick=()=>!1),this.#t()}_bindResetFormAction(e,t){let i=e.onclick;if(i||(e.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){R('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(e.onclick=()=>!1);return}e.onclick=()=>{i?.();let{fields:s,refs:n,include:a}=t,r=[];if(s.length!==0||n.length!==0){let d=new Set(n);for(let h of s){let u=this._fieldObjects[h]||[];for(let{id:m}of u)d.add(m)}for(let h of Object.values(this._fieldObjects))for(let u of h)d.has(u.id)===a&&r.push(u)}else for(let d of Object.values(this._fieldObjects))r.push(...d);let l=this.annotationStorage,c=[];for(let d of r){let{id:h}=d;switch(c.push(h),d.type){case"text":{let m=d.defaultValue||"";l.setValue(h,{value:m});break}case"checkbox":case"radiobutton":{let m=d.defaultValue===d.exportValues;l.setValue(h,{value:m});break}case"combobox":case"listbox":{let m=d.defaultValue||"";l.setValue(h,{value:m});break}default:continue}let u=document.querySelector(`[data-element-id="${h}"]`);if(u){if(!pe.has(u)){R(`_bindResetFormAction - element not allowed: ${h}`);continue}}else continue;u.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:c,name:"ResetForm"}}),!1}}},On=class extends Y{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");let e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}},$t=class extends Y{render(){return this.container}showElementAndHideCanvas(e){this.data.hasOwnCanvas&&(e.previousSibling?.nodeName==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return st.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,i,s,n){i.includes("mouse")?e.addEventListener(i,a=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:n(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):e.addEventListener(i,a=>{if(i==="blur"){if(!t.focused||!a.relatedTarget)return;t.focused=!1}else if(i==="focus"){if(t.focused)return;t.focused=!0}n&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:n(a)}})})}_setEventListeners(e,t,i,s){for(let[n,a]of i)(a==="Action"||this.data.actions?.[a])&&((a==="Focus"||a==="Blur")&&(t||={focused:!1}),this._setEventListener(e,t,n,a,s),a==="Focus"&&!this.data.actions?.Blur?this._setEventListener(e,t,"blur","Blur",null):a==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){let t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":E.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){let t=["left","center","right"],{fontColor:i}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||bl,n=e.style,a,r=2,l=c=>Math.round(10*c)/10;if(this.data.multiLine){let c=Math.abs(this.data.rect[3]-this.data.rect[1]-r),d=Math.round(c/(Mi*s))||1,h=c/d;a=Math.min(s,l(h/Mi))}else{let c=Math.abs(this.data.rect[3]-this.data.rect[1]-r);a=Math.min(s,l(c/Mi))}n.fontSize=`calc(${a}px * var(--scale-factor))`,n.color=E.makeHexColor(i[0],i[1],i[2]),this.data.textAlignment!==null&&(n.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}},Fn=class extends $t{constructor(e){let t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,i,s){let n=this.annotationStorage;for(let a of this._getElementsByName(e.name,e.id))a.domElement&&(a.domElement[t]=i),n.setValue(a.id,{[s]:i})}render(){let e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let i=null;if(this.renderForms){let s=e.getValue(t,{value:this.data.fieldValue}),n=s.value||"",a=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;a&&n.length>a&&(n=n.slice(0,a));let r=s.formattedValue||this.data.textContent?.join(`
`)||null;r&&this.data.comb&&(r=r.replaceAll(/\s+/g,""));let l={userValue:n,formattedValue:r,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(i=document.createElement("textarea"),i.textContent=r??n,this.data.doNotScroll&&(i.style.overflowY="hidden")):(i=document.createElement("input"),i.type="text",i.setAttribute("value",r??n),this.data.doNotScroll&&(i.style.overflowX="hidden")),this.data.hasOwnCanvas&&(i.hidden=!0),pe.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,i.name=this.data.fieldName,i.tabIndex=ii,this._setRequired(i,this.data.required),a&&(i.maxLength=a),i.addEventListener("input",d=>{e.setValue(t,{value:d.target.value}),this.setPropertyOnSiblings(i,"value",d.target.value,"value"),l.formattedValue=null}),i.addEventListener("resetform",d=>{let h=this.data.defaultFieldValue??"";i.value=l.userValue=h,l.formattedValue=null});let c=d=>{let{formattedValue:h}=l;h!=null&&(d.target.value=h),d.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){i.addEventListener("focus",h=>{if(l.focused)return;let{target:u}=h;l.userValue&&(u.value=l.userValue),l.lastCommittedValue=u.value,l.commitKey=1,this.data.actions?.Focus||(l.focused=!0)}),i.addEventListener("updatefromsandbox",h=>{this.showElementAndHideCanvas(h.target);let u={value(m){l.userValue=m.detail.value??"",e.setValue(t,{value:l.userValue.toString()}),m.target.value=l.userValue},formattedValue(m){let{formattedValue:p}=m.detail;l.formattedValue=p,p!=null&&m.target!==document.activeElement&&(m.target.value=p),e.setValue(t,{formattedValue:p})},selRange(m){m.target.setSelectionRange(...m.detail.selRange)},charLimit:m=>{let{charLimit:p}=m.detail,{target:f}=m;if(p===0){f.removeAttribute("maxLength");return}f.setAttribute("maxLength",p);let _=l.userValue;!_||_.length<=p||(_=_.slice(0,p),f.value=l.userValue=_,e.setValue(t,{value:_}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:_,willCommit:!0,commitKey:1,selStart:f.selectionStart,selEnd:f.selectionEnd}}))}};this._dispatchEventFromSandbox(u,h)}),i.addEventListener("keydown",h=>{l.commitKey=1;let u=-1;if(h.key==="Escape"?u=0:h.key==="Enter"&&!this.data.multiLine?u=2:h.key==="Tab"&&(l.commitKey=3),u===-1)return;let{value:m}=h.target;l.lastCommittedValue!==m&&(l.lastCommittedValue=m,l.userValue=m,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:m,willCommit:!0,commitKey:u,selStart:h.target.selectionStart,selEnd:h.target.selectionEnd}}))});let d=c;c=null,i.addEventListener("blur",h=>{if(!l.focused||!h.relatedTarget)return;this.data.actions?.Blur||(l.focused=!1);let{value:u}=h.target;l.userValue=u,l.lastCommittedValue!==u&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:u,willCommit:!0,commitKey:l.commitKey,selStart:h.target.selectionStart,selEnd:h.target.selectionEnd}}),d(h)}),this.data.actions?.Keystroke&&i.addEventListener("beforeinput",h=>{l.lastCommittedValue=null;let{data:u,target:m}=h,{value:p,selectionStart:f,selectionEnd:_}=m,g=f,b=_;switch(h.inputType){case"deleteWordBackward":{let v=p.substring(0,f).match(/\w*[^\w]*$/);v&&(g-=v[0].length);break}case"deleteWordForward":{let v=p.substring(f).match(/^[^\w]*\w*/);v&&(b+=v[0].length);break}case"deleteContentBackward":f===_&&(g-=1);break;case"deleteContentForward":f===_&&(b+=1);break}h.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:p,change:u||"",willCommit:!1,selStart:g,selEnd:b}})}),this._setEventListeners(i,l,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],h=>h.target.value)}if(c&&i.addEventListener("blur",c),this.data.comb){let h=(this.data.rect[2]-this.data.rect[0])/a;i.classList.add("comb"),i.style.letterSpacing=`calc(${h}px * var(--scale-factor) - 1ch)`}}else i=document.createElement("div"),i.textContent=this.data.fieldValue,i.style.verticalAlign="middle",i.style.display="table-cell",this.data.hasOwnCanvas&&(i.hidden=!0);return this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}},Nn=class extends $t{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}},Bn=class extends $t{constructor(e){super(e,{isRenderable:e.renderForms})}render(){let e=this.annotationStorage,t=this.data,i=t.id,s=e.getValue(i,{value:t.exportValue===t.fieldValue}).value;typeof s=="string"&&(s=s!=="Off",e.setValue(i,{value:s})),this.container.classList.add("buttonWidgetAnnotation","checkBox");let n=document.createElement("input");return pe.add(n),n.setAttribute("data-element-id",i),n.disabled=t.readOnly,this._setRequired(n,this.data.required),n.type="checkbox",n.name=t.fieldName,s&&n.setAttribute("checked",!0),n.setAttribute("exportValue",t.exportValue),n.tabIndex=ii,n.addEventListener("change",a=>{let{name:r,checked:l}=a.target;for(let c of this._getElementsByName(r,i)){let d=l&&c.exportValue===t.exportValue;c.domElement&&(c.domElement.checked=d),e.setValue(c.id,{value:d})}e.setValue(i,{value:l})}),n.addEventListener("resetform",a=>{let r=t.defaultFieldValue||"Off";a.target.checked=r===t.exportValue}),this.enableScripting&&this.hasJSActions&&(n.addEventListener("updatefromsandbox",a=>{let r={value(l){l.target.checked=l.detail.value!=="Off",e.setValue(i,{value:l.target.checked})}};this._dispatchEventFromSandbox(r,a)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}},Ki=class extends $t{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");let e=this.annotationStorage,t=this.data,i=t.id,s=e.getValue(i,{value:t.fieldValue===t.buttonValue}).value;if(typeof s=="string"&&(s=s!==t.buttonValue,e.setValue(i,{value:s})),s)for(let a of this._getElementsByName(t.fieldName,i))e.setValue(a.id,{value:!1});let n=document.createElement("input");if(pe.add(n),n.setAttribute("data-element-id",i),n.disabled=t.readOnly,this._setRequired(n,this.data.required),n.type="radio",n.name=t.fieldName,s&&n.setAttribute("checked",!0),n.tabIndex=ii,n.addEventListener("change",a=>{let{name:r,checked:l}=a.target;for(let c of this._getElementsByName(r,i))e.setValue(c.id,{value:!1});e.setValue(i,{value:l})}),n.addEventListener("resetform",a=>{let r=t.defaultFieldValue;a.target.checked=r!=null&&r===t.buttonValue}),this.enableScripting&&this.hasJSActions){let a=t.buttonValue;n.addEventListener("updatefromsandbox",r=>{let l={value:c=>{let d=a===c.detail.value;for(let h of this._getElementsByName(c.target.name)){let u=d&&h.id===i;h.domElement&&(h.domElement.checked=u),e.setValue(h.id,{value:u})}}};this._dispatchEventFromSandbox(l,r)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],r=>r.target.checked)}return this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}},Hn=class extends Yi{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){let e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");let t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",i=>{this._dispatchEventFromSandbox({},i)})),e}},zn=class extends $t{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");let e=this.annotationStorage,t=this.data.id,i=e.getValue(t,{value:this.data.fieldValue}),s=document.createElement("select");pe.add(s),s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,this._setRequired(s,this.data.required),s.name=this.data.fieldName,s.tabIndex=ii;let n=this.data.combo&&this.data.options.length>0;this.data.combo||(s.size=this.data.options.length,this.data.multiSelect&&(s.multiple=!0)),s.addEventListener("resetform",d=>{let h=this.data.defaultFieldValue;for(let u of s.options)u.selected=u.value===h});for(let d of this.data.options){let h=document.createElement("option");h.textContent=d.displayValue,h.value=d.exportValue,i.value.includes(d.exportValue)&&(h.setAttribute("selected",!0),n=!1),s.append(h)}let a=null;if(n){let d=document.createElement("option");d.value=" ",d.setAttribute("hidden",!0),d.setAttribute("selected",!0),s.prepend(d),a=()=>{d.remove(),s.removeEventListener("input",a),a=null},s.addEventListener("input",a)}let r=d=>{let h=d?"value":"textContent",{options:u,multiple:m}=s;return m?Array.prototype.filter.call(u,p=>p.selected).map(p=>p[h]):u.selectedIndex===-1?null:u[u.selectedIndex][h]},l=r(!1),c=d=>{let h=d.target.options;return Array.prototype.map.call(h,u=>({displayValue:u.textContent,exportValue:u.value}))};return this.enableScripting&&this.hasJSActions?(s.addEventListener("updatefromsandbox",d=>{let h={value(u){a?.();let m=u.detail.value,p=new Set(Array.isArray(m)?m:[m]);for(let f of s.options)f.selected=p.has(f.value);e.setValue(t,{value:r(!0)}),l=r(!1)},multipleSelection(u){s.multiple=!0},remove(u){let m=s.options,p=u.detail.remove;m[p].selected=!1,s.remove(p),m.length>0&&Array.prototype.findIndex.call(m,_=>_.selected)===-1&&(m[0].selected=!0),e.setValue(t,{value:r(!0),items:c(u)}),l=r(!1)},clear(u){for(;s.length!==0;)s.remove(0);e.setValue(t,{value:null,items:[]}),l=r(!1)},insert(u){let{index:m,displayValue:p,exportValue:f}=u.detail.insert,_=s.children[m],g=document.createElement("option");g.textContent=p,g.value=f,_?_.before(g):s.append(g),e.setValue(t,{value:r(!0),items:c(u)}),l=r(!1)},items(u){let{items:m}=u.detail;for(;s.length!==0;)s.remove(0);for(let p of m){let{displayValue:f,exportValue:_}=p,g=document.createElement("option");g.textContent=f,g.value=_,s.append(g)}s.options.length>0&&(s.options[0].selected=!0),e.setValue(t,{value:r(!0),items:c(u)}),l=r(!1)},indices(u){let m=new Set(u.detail.indices);for(let p of u.target.options)p.selected=m.has(p.index);e.setValue(t,{value:r(!0)}),l=r(!1)},editable(u){u.target.disabled=!u.detail.editable}};this._dispatchEventFromSandbox(h,d)}),s.addEventListener("input",d=>{let h=r(!0),u=r(!1);e.setValue(t,{value:h}),d.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:u,changeEx:h,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(s,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],d=>d.target.value)):s.addEventListener("input",function(d){e.setValue(t,{value:r(!0)})}),this.data.combo&&this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}},Ze=class extends Y{constructor(e){let{data:t,elements:i}=e;super(e,{isRenderable:Y._hasPopupData(t)}),this.elements=i,this.popup=null}render(){this.container.classList.add("popupAnnotation");let e=this.popup=new jn({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(let i of this.elements)i.popup=e,i.container.ariaHasPopup="dialog",t.push(i.data.id),i.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(i=>`${la}${i}`).join(",")),this.container}},jn=class{#t=this.#S.bind(this);#e=this.#E.bind(this);#i=this.#M.bind(this);#s=this.#A.bind(this);#a=null;#n=null;#c=null;#o=null;#d=null;#l=null;#h=null;#r=!1;#u=null;#m=null;#p=null;#g=null;#f=null;#_=null;#b=!1;constructor({container:e,color:t,elements:i,titleObj:s,modificationDate:n,contentsObj:a,richText:r,parent:l,rect:c,parentRect:d,open:h}){this.#n=e,this.#f=s,this.#c=a,this.#g=r,this.#l=l,this.#a=t,this.#p=c,this.#h=d,this.#d=i,this.#o=Di.toDateObject(n),this.trigger=i.flatMap(u=>u.getElementsToTriggerPopup());for(let u of this.trigger)u.addEventListener("click",this.#s),u.addEventListener("mouseenter",this.#i),u.addEventListener("mouseleave",this.#e),u.classList.add("popupTriggerArea");for(let u of i)u.container?.addEventListener("keydown",this.#t);this.#n.hidden=!0,h&&this.#A()}render(){if(this.#u)return;let e=this.#u=document.createElement("div");if(e.className="popup",this.#a){let n=e.style.outlineColor=E.makeHexColor(...this.#a);CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?e.style.backgroundColor=`color-mix(in srgb, ${n} 30%, white)`:e.style.backgroundColor=E.makeHexColor(...this.#a.map(r=>Math.floor(.7*(255-r)+r)))}let t=document.createElement("span");t.className="header";let i=document.createElement("h1");if(t.append(i),{dir:i.dir,str:i.textContent}=this.#f,e.append(t),this.#o){let n=document.createElement("span");n.classList.add("popupDate"),n.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),n.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#o.valueOf()})),t.append(n)}let s=this.#y;if(s)Xi.render({xfaHtml:s,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{let n=this._formatContents(this.#c);e.append(n)}this.#n.append(e)}get#y(){let e=this.#g,t=this.#c;return e?.str&&(!t?.str||t.str===e.str)&&this.#g.html||null}get#w(){return this.#y?.attributes?.style?.fontSize||0}get#C(){return this.#y?.attributes?.style?.color||null}#k(e){let t=[],i={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},s={style:{color:this.#C,fontSize:this.#w?`calc(${this.#w}px * var(--scale-factor))`:""}};for(let n of e.split(`
`))t.push({name:"span",value:n,attributes:s});return i}_formatContents({str:e,dir:t}){let i=document.createElement("p");i.classList.add("popupContent"),i.dir=t;let s=e.split(/(?:\r\n?|\n)/);for(let n=0,a=s.length;n<a;++n){let r=s[n];i.append(document.createTextNode(r)),n<a-1&&i.append(document.createElement("br"))}return i}#S(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&this.#r)&&this.#A()}updateEdited({rect:e,popupContent:t}){this.#_||={contentsObj:this.#c,richText:this.#g},e&&(this.#m=null),t&&(this.#g=this.#k(t),this.#c=null),this.#u?.remove(),this.#u=null}resetEdited(){this.#_&&({contentsObj:this.#c,richText:this.#g}=this.#_,this.#_=null,this.#u?.remove(),this.#u=null,this.#m=null)}#T(){if(this.#m!==null)return;let{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:i,pageX:s,pageY:n}}}=this.#l,a=!!this.#h,r=a?this.#h:this.#p;for(let p of this.#d)if(!r||E.intersect(p.data.rect,r)!==null){r=p.data.rect,a=!0;break}let l=E.normalizeRect([r[0],e[3]-r[1]+e[1],r[2],e[3]-r[3]+e[1]]),d=a?r[2]-r[0]+5:0,h=l[0]+d,u=l[1];this.#m=[100*(h-s)/t,100*(u-n)/i];let{style:m}=this.#n;m.left=`${this.#m[0]}%`,m.top=`${this.#m[1]}%`}#A(){this.#r=!this.#r,this.#r?(this.#M(),this.#n.addEventListener("click",this.#s),this.#n.addEventListener("keydown",this.#t)):(this.#E(),this.#n.removeEventListener("click",this.#s),this.#n.removeEventListener("keydown",this.#t))}#M(){this.#u||this.render(),this.isVisible?this.#r&&this.#n.classList.add("focused"):(this.#T(),this.#n.hidden=!1,this.#n.style.zIndex=parseInt(this.#n.style.zIndex)+1e3)}#E(){this.#n.classList.remove("focused"),!(this.#r||!this.isVisible)&&(this.#n.hidden=!0,this.#n.style.zIndex=parseInt(this.#n.style.zIndex)-1e3)}forceHide(){this.#b=this.isVisible,this.#b&&(this.#n.hidden=!0)}maybeShow(){this.#b&&(this.#u||this.#M(),this.#b=!1,this.#n.hidden=!1)}get isVisible(){return this.#n.hidden===!1}},Qi=class extends Y{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=D.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){let e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(let t of this.textContent){let i=document.createElement("span");i.textContent=t,e.append(i)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},Vn=class extends Y{#t=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");let e=this.data,{width:t,height:i}=Zt(e.rect),s=this.svgFactory.create(t,i,!0),n=this.#t=this.svgFactory.createElement("svg:line");return n.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),n.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),n.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),n.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),n.setAttribute("stroke-width",e.borderStyle.width||1),n.setAttribute("stroke","transparent"),n.setAttribute("fill","transparent"),s.append(n),this.container.append(s),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}},Gn=class extends Y{#t=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");let e=this.data,{width:t,height:i}=Zt(e.rect),s=this.svgFactory.create(t,i,!0),n=e.borderStyle.width,a=this.#t=this.svgFactory.createElement("svg:rect");return a.setAttribute("x",n/2),a.setAttribute("y",n/2),a.setAttribute("width",t-n),a.setAttribute("height",i-n),a.setAttribute("stroke-width",n||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),s.append(a),this.container.append(s),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}},Un=class extends Y{#t=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");let e=this.data,{width:t,height:i}=Zt(e.rect),s=this.svgFactory.create(t,i,!0),n=e.borderStyle.width,a=this.#t=this.svgFactory.createElement("svg:ellipse");return a.setAttribute("cx",t/2),a.setAttribute("cy",i/2),a.setAttribute("rx",t/2-n/2),a.setAttribute("ry",i/2-n/2),a.setAttribute("stroke-width",n||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),s.append(a),this.container.append(s),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}},Zi=class extends Y{#t=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);let{data:{rect:e,vertices:t,borderStyle:i,popupRef:s}}=this;if(!t)return this.container;let{width:n,height:a}=Zt(e),r=this.svgFactory.create(n,a,!0),l=[];for(let d=0,h=t.length;d<h;d+=2){let u=t[d]-e[0],m=e[3]-t[d+1];l.push(`${u},${m}`)}l=l.join(" ");let c=this.#t=this.svgFactory.createElement(this.svgElementName);return c.setAttribute("points",l),c.setAttribute("stroke-width",i.width||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),r.append(c),this.container.append(r),!s&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}},$n=class extends Zi{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}},Wn=class extends Y{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},Je=class extends Y{#t=null;#e=[];constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?D.HIGHLIGHT:D.INK}#i(e,t){switch(e){case 90:return{transform:`rotate(90) translate(${-t[0]},${t[1]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};case 180:return{transform:`rotate(180) translate(${-t[2]},${t[1]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]};case 270:return{transform:`rotate(270) translate(${-t[2]},${t[3]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};default:return{transform:`translate(${-t[0]},${t[3]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]}}}render(){this.container.classList.add(this.containerClassName);let{data:{rect:e,rotation:t,inkLists:i,borderStyle:s,popupRef:n}}=this,{transform:a,width:r,height:l}=this.#i(t,e),c=this.svgFactory.create(r,l,!0),d=this.#t=this.svgFactory.createElement("svg:g");c.append(d),d.setAttribute("stroke-width",s.width||1),d.setAttribute("stroke-linecap","round"),d.setAttribute("stroke-linejoin","round"),d.setAttribute("stroke-miterlimit",10),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),d.setAttribute("transform",a);for(let h=0,u=i.length;h<u;h++){let m=this.svgFactory.createElement(this.svgElementName);this.#e.push(m),m.setAttribute("points",i[h].join(",")),d.append(m)}return!n&&this.hasPopupData&&this._createPopup(),this.container.append(c),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);let{thickness:t,points:i,rect:s}=e,n=this.#t;if(t>=0&&n.setAttribute("stroke-width",t||1),i)for(let a=0,r=this.#e.length;a<r;a++)this.#e[a].setAttribute("points",i[a].join(","));if(s){let{transform:a,width:r,height:l}=this.#i(this.data.rotation,s);n.parentElement.setAttribute("viewBox",`0 0 ${r} ${l}`),n.setAttribute("transform",a)}}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}},Ji=class extends Y{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=D.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}},qn=class extends Y{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}},Xn=class extends Y{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}},Yn=class extends Y{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}},ts=class extends Y{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=D.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},Kn=class extends Y{#t=null;constructor(e){super(e,{isRenderable:!0});let{file:t}=this.data;this.filename=t.filename,this.content=t.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",X({source:this},t))}render(){this.container.classList.add("fileAttachmentAnnotation");let{container:e,data:t}=this,i;t.hasAppearance||t.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(t.name)?"paperclip":"pushpin"}.svg`,t.fillAlpha&&t.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(t.fillAlpha*100)}%);`)),i.addEventListener("dblclick",this.#e.bind(this)),this.#t=i;let{isMac:s}=st.platform;return e.addEventListener("keydown",n=>{n.key==="Enter"&&(s?n.metaKey:n.ctrlKey)&&this.#e()}),!t.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),e.append(i),e}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}},Qn=class{#t=null;#e=null;#i=new Map;#s=null;constructor({div:e,accessibilityManager:t,annotationCanvasMap:i,annotationEditorUIManager:s,page:n,viewport:a,structTreeLayer:r}){this.div=e,this.#t=t,this.#e=i,this.#s=r||null,this.page=n,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=s}hasEditableAnnotations(){return this.#i.size>0}#a(e,t){return k(this,null,function*(){let i=e.firstChild||e,s=i.id=`${la}${t}`,n=yield this.#s?.getAriaAttributes(s);if(n)for(let[a,r]of n)i.setAttribute(a,r);this.div.append(e),this.#t?.moveElementInDOM(this.div,e,i,!1)})}render(e){return k(this,null,function*(){let{annotations:t}=e,i=this.div;ue(i,this.viewport);let s=new Map,n={data:null,layer:i,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new Qe,annotationStorage:e.annotationStorage||new qe,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(let a of t){if(a.noHTML)continue;let r=a.annotationType===et.POPUP;if(r){let d=s.get(a.id);if(!d)continue;n.elements=d}else{let{width:d,height:h}=Zt(a.rect);if(d<=0||h<=0)continue}n.data=a;let l=Rn.create(n);if(!l.isRenderable)continue;if(!r&&a.popupRef){let d=s.get(a.popupRef);d?d.push(l):s.set(a.popupRef,[l])}let c=l.render();a.hidden&&(c.style.visibility="hidden"),yield this.#a(c,a.id),l._isEditable&&(this.#i.set(l.data.id,l),this._annotationEditorUIManager?.renderAnnotationElement(l))}this.#n()})}update({viewport:e}){let t=this.div;this.viewport=e,ue(t,{rotation:e.rotation}),this.#n(),t.hidden=!1}#n(){if(!this.#e)return;let e=this.div;for(let[t,i]of this.#e){let s=e.querySelector(`[data-annotation-id="${t}"]`);if(!s)continue;i.className="annotationContent";let{firstChild:n}=s;n?n.nodeName==="CANVAS"?n.replaceWith(i):n.classList.contains("annotationContent")?n.after(i):n.before(i):s.append(i)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#i.values())}getEditableAnnotation(e){return this.#i.get(e)}},Ti=/\r\n?|\n/g,Zn=class o extends q{#t;#e="";#i=`${this.id}-editor`;#s=null;#a;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){let e=o.prototype,t=n=>n.isEmpty(),i=We.TRANSLATE_SMALL,s=We.TRANSLATE_BIG;return F(this,"_keyboardManager",new me([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-i,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-s,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[i,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[s,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-i],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-s],checker:t}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,i],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,s],checker:t}]]))}static _type="freetext";static _editorType=D.FREETEXT;constructor(e){super(Wt(X({},e),{name:"freeTextEditor"})),this.#t=e.color||o._defaultColor||q._defaultLineColor,this.#a=e.fontSize||o._defaultFontSize}static initialize(e,t){q.initialize(e,t);let i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,t){switch(e){case N.FREETEXT_SIZE:o._defaultFontSize=t;break;case N.FREETEXT_COLOR:o._defaultColor=t;break}}updateParams(e,t){switch(e){case N.FREETEXT_SIZE:this.#n(t);break;case N.FREETEXT_COLOR:this.#c(t);break}}static get defaultPropertiesToUpdate(){return[[N.FREETEXT_SIZE,o._defaultFontSize],[N.FREETEXT_COLOR,o._defaultColor||q._defaultLineColor]]}get propertiesToUpdate(){return[[N.FREETEXT_SIZE,this.#a],[N.FREETEXT_COLOR,this.#t]]}#n(e){let t=s=>{this.editorDiv.style.fontSize=`calc(${s}px * var(--scale-factor))`,this.translate(0,-(s-this.#a)*this.parentScale),this.#a=s,this.#d()},i=this.#a;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:N.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#c(e){let t=s=>{this.#t=this.editorDiv.style.color=s},i=this.#t;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:N.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(e,t){this._uiManager.translateSelectedEditors(e,t,!0)}getInitialTranslation(){let e=this.parentScale;return[-o._internalPadding*e,-(o._internalPadding+this.#a)*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(D.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#s=new AbortController;let e=this._uiManager.combinedSignal(this.#s);this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e})}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#i),this._isDraggable=!0,this.#s?.abort(),this.#s=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){this.width||(this.enableEditMode(),this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#o(){let e=[];this.editorDiv.normalize();let t=null;for(let i of this.editorDiv.childNodes)t?.nodeType===Node.TEXT_NODE&&i.nodeName==="BR"||(e.push(o.#l(i)),t=i);return e.join(`
`)}#d(){let[e,t]=this.parentDimensions,i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{let{currentLayer:s,div:n}=this,a=n.style.display,r=n.classList.contains("hidden");n.classList.remove("hidden"),n.style.display="hidden",s.div.append(this.div),i=n.getBoundingClientRect(),n.remove(),n.style.display=a,n.classList.toggle("hidden",r)}this.rotation%180===this.parentRotation%180?(this.width=i.width/e,this.height=i.height/t):(this.width=i.height/e,this.height=i.width/t),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();let e=this.#e,t=this.#e=this.#o().trimEnd();if(e===t)return;let i=s=>{if(this.#e=s,!s){this.remove();return}this.#h(),this._uiManager.rebuild(this),this.#d()};this.addCommands({cmd:()=>{i(t)},undo:()=>{i(e)},mustExec:!1}),this.#d()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(e){this.enterInEditMode()}keydown(e){e.target===this.div&&e.key==="Enter"&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){o._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let e,t;this.width&&(e=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#i),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;let{style:i}=this.editorDiv;if(i.fontSize=`calc(${this.#a}px * var(--scale-factor))`,i.color=this.#t,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),Ri(this,this.div,["dblclick","keydown"]),this.width){let[s,n]=this.parentDimensions;if(this.annotationElementId){let{position:a}=this._initialData,[r,l]=this.getInitialTranslation();[r,l]=this.pageTranslationToScreen(r,l);let[c,d]=this.pageDimensions,[h,u]=this.pageTranslation,m,p;switch(this.rotation){case 0:m=e+(a[0]-h)/c,p=t+this.height-(a[1]-u)/d;break;case 90:m=e+(a[0]-h)/c,p=t-(a[1]-u)/d,[r,l]=[l,-r];break;case 180:m=e-this.width+(a[0]-h)/c,p=t-(a[1]-u)/d,[r,l]=[-r,-l];break;case 270:m=e+(a[0]-h-this.height*d)/c,p=t+(a[1]-u-this.width*c)/d,[r,l]=[-l,r];break}this.setAt(m*s,p*n,r,l)}else this.setAt(e*s,t*n,this.width*s,this.height*n);this.#h(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#l(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(Ti,"")}editorDivPaste(e){let t=e.clipboardData||window.clipboardData,{types:i}=t;if(i.length===1&&i[0]==="text/plain")return;e.preventDefault();let s=o.#u(t.getData("text")||"").replaceAll(Ti,`
`);if(!s)return;let n=window.getSelection();if(!n.rangeCount)return;this.editorDiv.normalize(),n.deleteFromDocument();let a=n.getRangeAt(0);if(!s.includes(`
`)){a.insertNode(document.createTextNode(s)),this.editorDiv.normalize(),n.collapseToStart();return}let{startContainer:r,startOffset:l}=a,c=[],d=[];if(r.nodeType===Node.TEXT_NODE){let m=r.parentElement;if(d.push(r.nodeValue.slice(l).replaceAll(Ti,"")),m!==this.editorDiv){let p=c;for(let f of this.editorDiv.childNodes){if(f===m){p=d;continue}p.push(o.#l(f))}}c.push(r.nodeValue.slice(0,l).replaceAll(Ti,""))}else if(r===this.editorDiv){let m=c,p=0;for(let f of this.editorDiv.childNodes)p++===l&&(m=d),m.push(o.#l(f))}this.#e=`${c.join(`
`)}${s}${d.join(`
`)}`,this.#h();let h=new Range,u=c.reduce((m,p)=>m+p.length,0);for(let{firstChild:m}of this.editorDiv.childNodes)if(m.nodeType===Node.TEXT_NODE){let p=m.nodeValue.length;if(u<=p){h.setStart(m,u),h.setEnd(m,u);break}u-=p}n.removeAllRanges(),n.addRange(h)}#h(){if(this.editorDiv.replaceChildren(),!!this.#e)for(let e of this.#e.split(`
`)){let t=document.createElement("div");t.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(t)}}#r(){return this.#e.replaceAll("\xA0"," ")}static#u(e){return e.replaceAll(" ","\xA0")}get contentDiv(){return this.editorDiv}static deserialize(e,t,i){return k(this,null,function*(){let s=null;if(e instanceof Qi){let{data:{defaultAppearanceData:{fontSize:a,fontColor:r},rect:l,rotation:c,id:d,popupRef:h},textContent:u,textPosition:m,parent:{page:{pageNumber:p}}}=e;if(!u||u.length===0)return null;s=e={annotationType:D.FREETEXT,color:Array.from(r),fontSize:a,value:u.join(`
`),position:m,pageIndex:p-1,rect:l.slice(0),rotation:c,id:d,deleted:!1,popupRef:h}}let n=yield ee(o,this,"deserialize").call(this,e,t,i);return n.#a=e.fontSize,n.#t=E.makeHexColor(...e.color),n.#e=o.#u(e.value),n.annotationElementId=e.id||null,n._initialData=s,n})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let t=o._internalPadding*this.parentScale,i=this.getRect(t,t),s=q._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#t),n={annotationType:D.FREETEXT,color:s,fontSize:this.#a,value:this.#r(),pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?n:this.annotationElementId&&!this.#m(n)?null:(n.id=this.annotationElementId,n)}#m(e){let{value:t,fontSize:i,color:s,pageIndex:n}=this._initialData;return this._hasBeenMoved||e.value!==t||e.fontSize!==i||e.color.some((a,r)=>a!==s[r])||e.pageIndex!==n}renderAnnotationElement(e){let t=super.renderAnnotationElement(e);if(this.deleted)return t;let{style:i}=t;i.fontSize=`calc(${this.#a}px * var(--scale-factor))`,i.color=this.#t,t.replaceChildren();for(let n of this.#e.split(`
`)){let a=document.createElement("div");a.append(n?document.createTextNode(n):document.createElement("br")),t.append(a)}let s=o._internalPadding*this.parentScale;return e.updateEdited({rect:this.getRect(s,s),popupContent:this.#e}),t}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}},C=(()=>{class o{static PRECISION=1e-4;toSVGPath(){V("Abstract method `toSVGPath` must be implemented.")}get box(){V("Abstract getter `box` must be implemented.")}serialize(t,i){V("Abstract method `serialize` must be implemented.")}static _rescale(t,i,s,n,a,r){r||=new Float32Array(t.length);for(let l=0,c=t.length;l<c;l+=2)r[l]=i+t[l]*n,r[l+1]=s+t[l+1]*a;return r}static _rescaleAndSwap(t,i,s,n,a,r){r||=new Float32Array(t.length);for(let l=0,c=t.length;l<c;l+=2)r[l]=i+t[l+1]*n,r[l+1]=s+t[l]*a;return r}static _translate(t,i,s,n){n||=new Float32Array(t.length);for(let a=0,r=t.length;a<r;a+=2)n[a]=i+t[a],n[a+1]=s+t[a+1];return n}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,i,s,n,a){switch(a){case 90:return[1-i/s,t/n];case 180:return[1-t/s,1-i/n];case 270:return[i/s,1-t/n];default:return[t/s,i/n]}}static _normalizePagePoint(t,i,s){switch(s){case 90:return[1-i,t];case 180:return[1-t,1-i];case 270:return[i,1-t];default:return[t,i]}}static createBezierPoints(t,i,s,n,a,r){return[(t+5*s)/6,(i+5*n)/6,(5*s+a)/6,(5*n+r)/6,(s+a)/2,(n+r)/2]}}return o})(),es=class o{#t;#e=[];#i;#s;#a=[];#n=new Float32Array(18);#c;#o;#d;#l;#h;#r;#u=[];static#m=8;static#p=2;static#g=o.#m+o.#p;constructor({x:e,y:t},i,s,n,a,r=0){this.#t=i,this.#r=n*s,this.#s=a,this.#n.set([NaN,NaN,NaN,NaN,e,t],6),this.#i=r,this.#l=o.#m*s,this.#d=o.#g*s,this.#h=s,this.#u.push(e,t)}isEmpty(){return isNaN(this.#n[8])}#f(){let e=this.#n.subarray(4,6),t=this.#n.subarray(16,18),[i,s,n,a]=this.#t;return[(this.#c+(e[0]-t[0])/2-i)/n,(this.#o+(e[1]-t[1])/2-s)/a,(this.#c+(t[0]-e[0])/2-i)/n,(this.#o+(t[1]-e[1])/2-s)/a]}add({x:e,y:t}){this.#c=e,this.#o=t;let[i,s,n,a]=this.#t,[r,l,c,d]=this.#n.subarray(8,12),h=e-c,u=t-d,m=Math.hypot(h,u);if(m<this.#d)return!1;let p=m-this.#l,f=p/m,_=f*h,g=f*u,b=r,v=l;r=c,l=d,c+=_,d+=g,this.#u?.push(e,t);let y=-g/p,w=_/p,A=y*this.#r,x=w*this.#r;return this.#n.set(this.#n.subarray(2,8),0),this.#n.set([c+A,d+x],4),this.#n.set(this.#n.subarray(14,18),12),this.#n.set([c-A,d-x],16),isNaN(this.#n[6])?(this.#a.length===0&&(this.#n.set([r+A,l+x],2),this.#a.push(NaN,NaN,NaN,NaN,(r+A-i)/n,(l+x-s)/a),this.#n.set([r-A,l-x],14),this.#e.push(NaN,NaN,NaN,NaN,(r-A-i)/n,(l-x-s)/a)),this.#n.set([b,v,r,l,c,d],6),!this.isEmpty()):(this.#n.set([b,v,r,l,c,d],6),Math.abs(Math.atan2(v-l,b-r)-Math.atan2(g,_))<Math.PI/2?([r,l,c,d]=this.#n.subarray(2,6),this.#a.push(NaN,NaN,NaN,NaN,((r+c)/2-i)/n,((l+d)/2-s)/a),[r,l,b,v]=this.#n.subarray(14,18),this.#e.push(NaN,NaN,NaN,NaN,((b+r)/2-i)/n,((v+l)/2-s)/a),!0):([b,v,r,l,c,d]=this.#n.subarray(0,6),this.#a.push(((b+5*r)/6-i)/n,((v+5*l)/6-s)/a,((5*r+c)/6-i)/n,((5*l+d)/6-s)/a,((r+c)/2-i)/n,((l+d)/2-s)/a),[c,d,r,l,b,v]=this.#n.subarray(12,18),this.#e.push(((b+5*r)/6-i)/n,((v+5*l)/6-s)/a,((5*r+c)/6-i)/n,((5*l+d)/6-s)/a,((r+c)/2-i)/n,((l+d)/2-s)/a),!0))}toSVGPath(){if(this.isEmpty())return"";let e=this.#a,t=this.#e;if(isNaN(this.#n[6])&&!this.isEmpty())return this.#_();let i=[];i.push(`M${e[4]} ${e[5]}`);for(let s=6;s<e.length;s+=6)isNaN(e[s])?i.push(`L${e[s+4]} ${e[s+5]}`):i.push(`C${e[s]} ${e[s+1]} ${e[s+2]} ${e[s+3]} ${e[s+4]} ${e[s+5]}`);this.#y(i);for(let s=t.length-6;s>=6;s-=6)isNaN(t[s])?i.push(`L${t[s+4]} ${t[s+5]}`):i.push(`C${t[s]} ${t[s+1]} ${t[s+2]} ${t[s+3]} ${t[s+4]} ${t[s+5]}`);return this.#b(i),i.join(" ")}#_(){let[e,t,i,s]=this.#t,[n,a,r,l]=this.#f();return`M${(this.#n[2]-e)/i} ${(this.#n[3]-t)/s} L${(this.#n[4]-e)/i} ${(this.#n[5]-t)/s} L${n} ${a} L${r} ${l} L${(this.#n[16]-e)/i} ${(this.#n[17]-t)/s} L${(this.#n[14]-e)/i} ${(this.#n[15]-t)/s} Z`}#b(e){let t=this.#e;e.push(`L${t[4]} ${t[5]} Z`)}#y(e){let[t,i,s,n]=this.#t,a=this.#n.subarray(4,6),r=this.#n.subarray(16,18),[l,c,d,h]=this.#f();e.push(`L${(a[0]-t)/s} ${(a[1]-i)/n} L${l} ${c} L${d} ${h} L${(r[0]-t)/s} ${(r[1]-i)/n}`)}newFreeDrawOutline(e,t,i,s,n,a){return new is(e,t,i,s,n,a)}getOutlines(){let e=this.#a,t=this.#e,i=this.#n,[s,n,a,r]=this.#t,l=new Float32Array((this.#u?.length??0)+2);for(let h=0,u=l.length-2;h<u;h+=2)l[h]=(this.#u[h]-s)/a,l[h+1]=(this.#u[h+1]-n)/r;if(l[l.length-2]=(this.#c-s)/a,l[l.length-1]=(this.#o-n)/r,isNaN(i[6])&&!this.isEmpty())return this.#w(l);let c=new Float32Array(this.#a.length+24+this.#e.length),d=e.length;for(let h=0;h<d;h+=2){if(isNaN(e[h])){c[h]=c[h+1]=NaN;continue}c[h]=e[h],c[h+1]=e[h+1]}d=this.#k(c,d);for(let h=t.length-6;h>=6;h-=6)for(let u=0;u<6;u+=2){if(isNaN(t[h+u])){c[d]=c[d+1]=NaN,d+=2;continue}c[d]=t[h+u],c[d+1]=t[h+u+1],d+=2}return this.#C(c,d),this.newFreeDrawOutline(c,l,this.#t,this.#h,this.#i,this.#s)}#w(e){let t=this.#n,[i,s,n,a]=this.#t,[r,l,c,d]=this.#f(),h=new Float32Array(36);return h.set([NaN,NaN,NaN,NaN,(t[2]-i)/n,(t[3]-s)/a,NaN,NaN,NaN,NaN,(t[4]-i)/n,(t[5]-s)/a,NaN,NaN,NaN,NaN,r,l,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,(t[16]-i)/n,(t[17]-s)/a,NaN,NaN,NaN,NaN,(t[14]-i)/n,(t[15]-s)/a],0),this.newFreeDrawOutline(h,e,this.#t,this.#h,this.#i,this.#s)}#C(e,t){let i=this.#e;return e.set([NaN,NaN,NaN,NaN,i[4],i[5]],t),t+=6}#k(e,t){let i=this.#n.subarray(4,6),s=this.#n.subarray(16,18),[n,a,r,l]=this.#t,[c,d,h,u]=this.#f();return e.set([NaN,NaN,NaN,NaN,(i[0]-n)/r,(i[1]-a)/l,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,h,u,NaN,NaN,NaN,NaN,(s[0]-n)/r,(s[1]-a)/l],t),t+=24}},is=class extends C{#t;#e=new Float32Array(4);#i;#s;#a;#n;#c;constructor(e,t,i,s,n,a){super(),this.#c=e,this.#a=t,this.#t=i,this.#n=s,this.#i=n,this.#s=a,this.lastPoint=[NaN,NaN],this.#o(a);let[r,l,c,d]=this.#e;for(let h=0,u=e.length;h<u;h+=2)e[h]=(e[h]-r)/c,e[h+1]=(e[h+1]-l)/d;for(let h=0,u=t.length;h<u;h+=2)t[h]=(t[h]-r)/c,t[h+1]=(t[h+1]-l)/d}toSVGPath(){let e=[`M${this.#c[4]} ${this.#c[5]}`];for(let t=6,i=this.#c.length;t<i;t+=6){if(isNaN(this.#c[t])){e.push(`L${this.#c[t+4]} ${this.#c[t+5]}`);continue}e.push(`C${this.#c[t]} ${this.#c[t+1]} ${this.#c[t+2]} ${this.#c[t+3]} ${this.#c[t+4]} ${this.#c[t+5]}`)}return e.push("Z"),e.join(" ")}serialize([e,t,i,s],n){let a=i-e,r=s-t,l,c;switch(n){case 0:l=C._rescale(this.#c,e,s,a,-r),c=C._rescale(this.#a,e,s,a,-r);break;case 90:l=C._rescaleAndSwap(this.#c,e,t,a,r),c=C._rescaleAndSwap(this.#a,e,t,a,r);break;case 180:l=C._rescale(this.#c,i,t,-a,r),c=C._rescale(this.#a,i,t,-a,r);break;case 270:l=C._rescaleAndSwap(this.#c,i,s,-a,-r),c=C._rescaleAndSwap(this.#a,i,s,-a,-r);break}return{outline:Array.from(l),points:[Array.from(c)]}}#o(e){let t=this.#c,i=t[4],s=t[5],n=i,a=s,r=i,l=s,c=i,d=s,h=e?Math.max:Math.min;for(let m=6,p=t.length;m<p;m+=6){if(isNaN(t[m]))n=Math.min(n,t[m+4]),a=Math.min(a,t[m+5]),r=Math.max(r,t[m+4]),l=Math.max(l,t[m+5]),d<t[m+5]?(c=t[m+4],d=t[m+5]):d===t[m+5]&&(c=h(c,t[m+4]));else{let f=E.bezierBoundingBox(i,s,...t.slice(m,m+6));n=Math.min(n,f[0]),a=Math.min(a,f[1]),r=Math.max(r,f[2]),l=Math.max(l,f[3]),d<f[3]?(c=f[2],d=f[3]):d===f[3]&&(c=h(c,f[2]))}i=t[m+4],s=t[m+5]}let u=this.#e;u[0]=n-this.#i,u[1]=a-this.#i,u[2]=r-n+2*this.#i,u[3]=l-a+2*this.#i,this.lastPoint=[c,d]}get box(){return this.#e}newOutliner(e,t,i,s,n,a=0){return new es(e,t,i,s,n,a)}getNewOutline(e,t){let[i,s,n,a]=this.#e,[r,l,c,d]=this.#t,h=n*c,u=a*d,m=i*c+r,p=s*d+l,f=this.newOutliner({x:this.#a[0]*h+m,y:this.#a[1]*u+p},this.#t,this.#n,e,this.#s,t??this.#i);for(let _=2;_<this.#a.length;_+=2)f.add({x:this.#a[_]*h+m,y:this.#a[_+1]*u+p});return f.getOutlines()}},ti=class{#t;#e;#i=[];#s=[];constructor(e,t=0,i=0,s=!0){let n=1/0,a=-1/0,r=1/0,l=-1/0,d=10**-4;for(let{x:g,y:b,width:v,height:y}of e){let w=Math.floor((g-t)/d)*d,A=Math.ceil((g+v+t)/d)*d,x=Math.floor((b-t)/d)*d,T=Math.ceil((b+y+t)/d)*d,M=[w,x,T,!0],H=[A,x,T,!1];this.#i.push(M,H),n=Math.min(n,w),a=Math.max(a,A),r=Math.min(r,x),l=Math.max(l,T)}let h=a-n+2*i,u=l-r+2*i,m=n-i,p=r-i,f=this.#i.at(s?-1:-2),_=[f[0],f[2]];for(let g of this.#i){let[b,v,y]=g;g[0]=(b-m)/h,g[1]=(v-p)/u,g[2]=(y-p)/u}this.#t=new Float32Array([m,p,h,u]),this.#e=_}getOutlines(){this.#i.sort((t,i)=>t[0]-i[0]||t[1]-i[1]||t[2]-i[2]);let e=[];for(let t of this.#i)t[3]?(e.push(...this.#d(t)),this.#c(t)):(this.#o(t),e.push(...this.#d(t)));return this.#a(e)}#a(e){let t=[],i=new Set;for(let a of e){let[r,l,c]=a;t.push([r,l,a],[r,c,a])}t.sort((a,r)=>a[1]-r[1]||a[0]-r[0]);for(let a=0,r=t.length;a<r;a+=2){let l=t[a][2],c=t[a+1][2];l.push(c),c.push(l),i.add(l),i.add(c)}let s=[],n;for(;i.size>0;){let a=i.values().next().value,[r,l,c,d,h]=a;i.delete(a);let u=r,m=l;for(n=[r,c],s.push(n);;){let p;if(i.has(d))p=d;else if(i.has(h))p=h;else break;i.delete(p),[r,l,c,d,h]=p,u!==r&&(n.push(u,m,r,m===l?l:c),u=r),m=m===l?c:l}n.push(u,m)}return new Jn(s,this.#t,this.#e)}#n(e){let t=this.#s,i=0,s=t.length-1;for(;i<=s;){let n=i+s>>1,a=t[n][0];if(a===e)return n;a<e?i=n+1:s=n-1}return s+1}#c([,e,t]){let i=this.#n(e);this.#s.splice(i,0,[e,t])}#o([,e,t]){let i=this.#n(e);for(let s=i;s<this.#s.length;s++){let[n,a]=this.#s[s];if(n!==e)break;if(n===e&&a===t){this.#s.splice(s,1);return}}for(let s=i-1;s>=0;s--){let[n,a]=this.#s[s];if(n!==e)break;if(n===e&&a===t){this.#s.splice(s,1);return}}}#d(e){let[t,i,s]=e,n=[[t,i,s]],a=this.#n(s);for(let r=0;r<a;r++){let[l,c]=this.#s[r];for(let d=0,h=n.length;d<h;d++){let[,u,m]=n[d];if(!(c<=u||m<=l)){if(u>=l){if(m>c)n[d][1]=c;else{if(h===1)return[];n.splice(d,1),d--,h--}continue}n[d][2]=l,m>c&&n.push([t,c,m])}}}return n}},Jn=class extends C{#t;#e;constructor(e,t,i){super(),this.#e=e,this.#t=t,this.lastPoint=i}toSVGPath(){let e=[];for(let t of this.#e){let[i,s]=t;e.push(`M${i} ${s}`);for(let n=2;n<t.length;n+=2){let a=t[n],r=t[n+1];a===i?(e.push(`V${r}`),s=r):r===s&&(e.push(`H${a}`),i=a)}e.push("Z")}return e.join(" ")}serialize([e,t,i,s],n){let a=[],r=i-e,l=s-t;for(let c of this.#e){let d=new Array(c.length);for(let h=0;h<c.length;h+=2)d[h]=e+c[h]*r,d[h+1]=s-c[h+1]*l;a.push(d)}return a}get box(){return this.#t}get classNamesForOutlining(){return["highlightOutline"]}},ei=class extends es{newFreeDrawOutline(e,t,i,s,n,a){return new ta(e,t,i,s,n,a)}},ta=class extends is{newOutliner(e,t,i,s,n,a=0){return new ei(e,t,i,s,n,a)}},ss=class o{#t=null;#e=null;#i;#s=null;#a=!1;#n=!1;#c=null;#o;#d=null;#l=null;#h;static#r=null;static get _keyboardManager(){return F(this,"_keyboardManager",new me([[["Escape","mac+Escape"],o.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],o.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],o.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],o.prototype._moveToPrevious],[["Home","mac+Home"],o.prototype._moveToBeginning],[["End","mac+End"],o.prototype._moveToEnd]]))}constructor({editor:e=null,uiManager:t=null}){e?(this.#n=!1,this.#h=N.HIGHLIGHT_COLOR,this.#c=e):(this.#n=!0,this.#h=N.HIGHLIGHT_DEFAULT_COLOR),this.#l=e?._uiManager||t,this.#o=this.#l._eventBus,this.#i=e?.color||this.#l?.highlightColors.values().next().value||"#FFFF98",o.#r||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){let e=this.#t=document.createElement("button");e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);let t=this.#l._signal;e.addEventListener("click",this.#g.bind(this),{signal:t}),e.addEventListener("keydown",this.#p.bind(this),{signal:t});let i=this.#e=document.createElement("span");return i.className="swatch",i.setAttribute("aria-hidden",!0),i.style.backgroundColor=this.#i,e.append(i),e}renderMainDropdown(){let e=this.#s=this.#u();return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}#u(){let e=document.createElement("div"),t=this.#l._signal;e.addEventListener("contextmenu",xt,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(let[i,s]of this.#l.highlightColors){let n=document.createElement("button");n.tabIndex="0",n.role="option",n.setAttribute("data-color",s),n.title=i,n.setAttribute("data-l10n-id",o.#r[i]);let a=document.createElement("span");n.append(a),a.className="swatch",a.style.backgroundColor=s,n.setAttribute("aria-selected",s===this.#i),n.addEventListener("click",this.#m.bind(this,s),{signal:t}),e.append(n)}return e.addEventListener("keydown",this.#p.bind(this),{signal:t}),e}#m(e,t){t.stopPropagation(),this.#o.dispatch("switchannotationeditorparams",{source:this,type:this.#h,value:e})}_colorSelectFromKeyboard(e){if(e.target===this.#t){this.#g(e);return}let t=e.target.getAttribute("data-color");t&&this.#m(t,e)}_moveToNext(e){if(!this.#_){this.#g(e);return}if(e.target===this.#t){this.#s.firstChild?.focus();return}e.target.nextSibling?.focus()}_moveToPrevious(e){if(e.target===this.#s?.firstChild||e.target===this.#t){this.#_&&this._hideDropdownFromKeyboard();return}this.#_||this.#g(e),e.target.previousSibling?.focus()}_moveToBeginning(e){if(!this.#_){this.#g(e);return}this.#s.firstChild?.focus()}_moveToEnd(e){if(!this.#_){this.#g(e);return}this.#s.lastChild?.focus()}#p(e){o._keyboardManager.exec(this,e)}#g(e){if(this.#_){this.hideDropdown();return}if(this.#a=e.detail===0,this.#d||(this.#d=new AbortController,window.addEventListener("pointerdown",this.#f.bind(this),{signal:this.#l.combinedSignal(this.#d)})),this.#s){this.#s.classList.remove("hidden");return}let t=this.#s=this.#u();this.#t.append(t)}#f(e){this.#s?.contains(e.target)||this.hideDropdown()}hideDropdown(){this.#s?.classList.add("hidden"),this.#d?.abort(),this.#d=null}get#_(){return this.#s&&!this.#s.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#n){if(!this.#_){this.#c?.unselect();return}this.hideDropdown(),this.#t.focus({preventScroll:!0,focusVisible:this.#a})}}updateColor(e){if(this.#e&&(this.#e.style.backgroundColor=e),!this.#s)return;let t=this.#l.highlightColors.values();for(let i of this.#s.children)i.setAttribute("aria-selected",t.next().value===e)}destroy(){this.#t?.remove(),this.#t=null,this.#e=null,this.#s?.remove(),this.#s=null}},ns=class o extends q{#t=null;#e=0;#i;#s=null;#a=null;#n=null;#c=null;#o=0;#d=null;#l=null;#h=null;#r=!1;#u=null;#m;#p=null;#g="";#f;#_="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=D.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){let e=o.prototype;return F(this,"_keyboardManager",new me([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}constructor(e){super(Wt(X({},e),{name:"highlightEditor"})),this.color=e.color||o._defaultColor,this.#f=e.thickness||o._defaultThickness,this.#m=e.opacity||o._defaultOpacity,this.#i=e.boxes||null,this.#_=e.methodOfCreation||"",this.#g=e.text||"",this._isDraggable=!1,e.highlightId>-1?(this.#r=!0,this.#y(e),this.#T()):this.#i&&(this.#t=e.anchorNode,this.#e=e.anchorOffset,this.#c=e.focusNode,this.#o=e.focusOffset,this.#b(),this.#T(),this.rotate(this.rotation))}get telemetryInitialData(){return{action:"added",type:this.#r?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:this.#f,methodOfCreation:this.#_}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}#b(){let e=new ti(this.#i,.001);this.#l=e.getOutlines(),[this.x,this.y,this.width,this.height]=this.#l.box;let t=new ti(this.#i,.0025,.001,this._uiManager.direction==="ltr");this.#n=t.getOutlines();let{lastPoint:i}=this.#n;this.#u=[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height]}#y({highlightOutlines:e,highlightId:t,clipPathId:i}){this.#l=e;let s=1.5;if(this.#n=e.getNewOutline(this.#f/2+s,.0025),t>=0)this.#h=t,this.#s=i,this.parent.drawLayer.finalizeDraw(t,{bbox:e.box,path:{d:e.toSVGPath()}}),this.#p=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#n.box,path:{d:this.#n.toSVGPath()}},!0);else if(this.parent){let d=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#h,{bbox:o.#A(this.#l.box,(d-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#p,{bbox:o.#A(this.#n.box,d),path:{d:this.#n.toSVGPath()}})}let[n,a,r,l]=e.box;switch(this.rotation){case 0:this.x=n,this.y=a,this.width=r,this.height=l;break;case 90:{let[d,h]=this.parentDimensions;this.x=a,this.y=1-n,this.width=r*h/d,this.height=l*d/h;break}case 180:this.x=1-n,this.y=1-a,this.width=r,this.height=l;break;case 270:{let[d,h]=this.parentDimensions;this.x=1-a,this.y=n,this.width=r*h/d,this.height=l*d/h;break}}let{lastPoint:c}=this.#n;this.#u=[(c[0]-n)/r,(c[1]-a)/l]}static initialize(e,t){q.initialize(e,t),o._defaultColor||=t.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(e,t){switch(e){case N.HIGHLIGHT_DEFAULT_COLOR:o._defaultColor=t;break;case N.HIGHLIGHT_THICKNESS:o._defaultThickness=t;break}}translateInPage(e,t){}get toolbarPosition(){return this.#u}updateParams(e,t){switch(e){case N.HIGHLIGHT_COLOR:this.#w(t);break;case N.HIGHLIGHT_THICKNESS:this.#C(t);break}}static get defaultPropertiesToUpdate(){return[[N.HIGHLIGHT_DEFAULT_COLOR,o._defaultColor],[N.HIGHLIGHT_THICKNESS,o._defaultThickness]]}get propertiesToUpdate(){return[[N.HIGHLIGHT_COLOR,this.color||o._defaultColor],[N.HIGHLIGHT_THICKNESS,this.#f||o._defaultThickness],[N.HIGHLIGHT_FREE,this.#r]]}#w(e){let t=(n,a)=>{this.color=n,this.#m=a,this.parent?.drawLayer.updateProperties(this.#h,{root:{fill:n,"fill-opacity":a}}),this.#a?.updateColor(n)},i=this.color,s=this.#m;this.addCommands({cmd:t.bind(this,e,o._defaultOpacity),undo:t.bind(this,i,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:N.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(e)},!0)}#C(e){let t=this.#f,i=s=>{this.#f=s,this.#k(s)};this.addCommands({cmd:i.bind(this,e),undo:i.bind(this,t),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:N.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)}addEditToolbar(){return k(this,null,function*(){let e=yield ee(o.prototype,this,"addEditToolbar").call(this);return e?(this._uiManager.highlightColors&&(this.#a=new ss({editor:this}),e.addColorPicker(this.#a)),e):null})}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#L())}getBaseTranslation(){return[0,0]}getRect(e,t){return super.getRect(e,t,this.#L())}onceAdded(){this.annotationElementId||this.parent.addUndoableEditor(this),this.div.focus()}remove(){this.#S(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#T(),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?this.#S():e&&(this.#T(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),this.show(this._isVisible),t&&this.select()}#k(e){if(!this.#r)return;this.#y({highlightOutlines:this.#l.getNewOutline(e/2)}),this.fixAndSetPosition();let[t,i]=this.parentDimensions;this.setDims(this.width*t,this.height*i)}#S(){this.#h===null||!this.parent||(this.parent.drawLayer.remove(this.#h),this.#h=null,this.parent.drawLayer.remove(this.#p),this.#p=null)}#T(e=this.parent){this.#h===null&&({id:this.#h,clipPathId:this.#s}=e.drawLayer.draw({bbox:this.#l.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.#m},rootClass:{highlight:!0,free:this.#r},path:{d:this.#l.toSVGPath()}},!1,!0),this.#p=e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#r},bbox:this.#n.box,path:{d:this.#n.toSVGPath()}},this.#r),this.#d&&(this.#d.style.clipPath=this.#s))}static#A([e,t,i,s],n){switch(n){case 90:return[1-t-s,e,s,i];case 180:return[1-e-i,1-t-s,i,s];case 270:return[t,1-e-i,s,i]}return[e,t,i,s]}rotate(e){let{drawLayer:t}=this.parent,i;this.#r?(e=(e-this.rotation+360)%360,i=o.#A(this.#l.box,e)):i=o.#A([this.x,this.y,this.width,this.height],e),t.updateProperties(this.#h,{bbox:i,root:{"data-main-rotation":e}}),t.updateProperties(this.#p,{bbox:o.#A(this.#n.box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;let e=super.render();this.#g&&(e.setAttribute("aria-label",this.#g),e.setAttribute("role","mark")),this.#r?e.classList.add("free"):this.div.addEventListener("keydown",this.#M.bind(this),{signal:this._uiManager._signal});let t=this.#d=document.createElement("div");e.append(t),t.setAttribute("aria-hidden","true"),t.className="internal",t.style.clipPath=this.#s;let[i,s]=this.parentDimensions;return this.setDims(this.width*i,this.height*s),Ri(this,this.#d,["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1}})}#M(e){o._keyboardManager.exec(this,e)}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:this.#E(!0);break;case 1:case 3:this.#E(!1);break}}#E(e){if(!this.#t)return;let t=window.getSelection();e?t.setPosition(this.#t,this.#e):t.setPosition(this.#c,this.#o)}select(){super.select(),this.#p&&this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#p&&(this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{selected:!1}}),this.#r||this.#E(!1))}get _mustFixPosition(){return!this.#r}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(this.#h,{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(this.#p,{rootClass:{hidden:!e}}))}#L(){return this.#r?this.rotation:0}#R(){if(this.#r)return null;let[e,t]=this.pageDimensions,[i,s]=this.pageTranslation,n=this.#i,a=new Float32Array(n.length*8),r=0;for(let{x:l,y:c,width:d,height:h}of n){let u=l*e+i,m=(1-c)*t+s;a[r]=a[r+4]=u,a[r+1]=a[r+3]=m,a[r+2]=a[r+6]=u+d*e,a[r+5]=a[r+7]=m-h*t,r+=8}return a}#B(e){return this.#l.serialize(e,this.#L())}static startHighlighting(e,t,{target:i,x:s,y:n}){let{x:a,y:r,width:l,height:c}=i.getBoundingClientRect(),d=new AbortController,h=e.combinedSignal(d),u=m=>{d.abort(),this.#v(e,m)};window.addEventListener("blur",u,{signal:h}),window.addEventListener("pointerup",u,{signal:h}),window.addEventListener("pointerdown",At,{capture:!0,passive:!1,signal:h}),window.addEventListener("contextmenu",xt,{signal:h}),i.addEventListener("pointermove",this.#x.bind(this,e),{signal:h}),this._freeHighlight=new ei({x:s,y:n},[a,r,l,c],e.scale,this._defaultThickness/2,t,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#x(e,t){this._freeHighlight.add(t)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#v(e,t){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(t,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static deserialize(e,t,i){return k(this,null,function*(){let s=null;if(e instanceof Ji){let{data:{quadPoints:p,rect:f,rotation:_,id:g,color:b,opacity:v,popupRef:y},parent:{page:{pageNumber:w}}}=e;s=e={annotationType:D.HIGHLIGHT,color:Array.from(b),opacity:v,quadPoints:p,boxes:null,pageIndex:w-1,rect:f.slice(0),rotation:_,id:g,deleted:!1,popupRef:y}}else if(e instanceof Je){let{data:{inkLists:p,rect:f,rotation:_,id:g,color:b,borderStyle:{rawWidth:v},popupRef:y},parent:{page:{pageNumber:w}}}=e;s=e={annotationType:D.HIGHLIGHT,color:Array.from(b),thickness:v,inkLists:p,boxes:null,pageIndex:w-1,rect:f.slice(0),rotation:_,id:g,deleted:!1,popupRef:y}}let{color:n,quadPoints:a,inkLists:r,opacity:l}=e,c=yield ee(o,this,"deserialize").call(this,e,t,i);c.color=E.makeHexColor(...n),c.#m=l||1,r&&(c.#f=e.thickness),c.annotationElementId=e.id||null,c._initialData=s;let[d,h]=c.pageDimensions,[u,m]=c.pageTranslation;if(a){let p=c.#i=[];for(let f=0;f<a.length;f+=8)p.push({x:(a[f]-u)/d,y:1-(a[f+1]-m)/h,width:(a[f+2]-a[f])/d,height:(a[f+1]-a[f+5])/h});c.#b(),c.#T(),c.rotate(c.rotation)}else if(r){c.#r=!0;let p=r[0],f={x:p[0]-u,y:h-(p[1]-m)},_=new ei(f,[0,0,d,h],1,c.#f/2,!0,.001);for(let v=0,y=p.length;v<y;v+=2)f.x=p[v]-u,f.y=h-(p[v+1]-m),_.add(f);let{id:g,clipPathId:b}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:c.color,"fill-opacity":c._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:_.toSVGPath()}},!0,!0);c.#y({highlightOutlines:_.getOutlines(),highlightId:g,clipPathId:b}),c.#T()}return c})}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();let t=this.getRect(0,0),i=q._colorManager.convert(this.color),s={annotationType:D.HIGHLIGHT,color:i,opacity:this.#m,thickness:this.#f,quadPoints:this.#R(),outlines:this.#B(t),pageIndex:this.pageIndex,rect:t,rotation:this.#L(),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!this.#D(s)?null:(s.id=this.annotationElementId,s)}#D(e){let{color:t}=this._initialData;return e.color.some((i,s)=>i!==t[s])}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}},ea=class{#t=Object.create(null);updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(let[t,i]of Object.entries(e))this.updateProperty(t,i)}updateSVGProperty(e,t){this.#t[e]=t}toSVGProperties(){let e=this.#t;return this.#t=Object.create(null),{root:e}}reset(){this.#t=Object.create(null)}updateAll(e=this){this.updateProperties(e)}clone(){V("Not implemented")}},vl=(()=>{class o extends q{#t=null;#e;_drawId=null;static _currentDrawId=-1;static _currentDraw=null;static _currentDrawingOptions=null;static _currentParent=null;static _INNER_MARGIN=3;constructor(t){super(t),this.#e=t.mustBeCommitted||!1,t.drawOutlines&&(this.#i(t),this.#n())}#i({drawOutlines:t,drawId:i,drawingOptions:s}){this.#t=t,this._drawingOptions||=s,i>=0?(this._drawId=i,this.parent.drawLayer.finalizeDraw(i,t.defaultProperties)):this._drawId=this.#s(t,this.parent),this.#d(t.box)}#s(t,i){let{id:s}=i.drawLayer.draw(o._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return s}static _mergeSVGProperties(t,i){let s=new Set(Object.keys(t));for(let[n,a]of Object.entries(i))s.has(n)?Object.assign(t[n],a):t[n]=a;return t}static getDefaultDrawingOptions(t){V("Not implemented")}static get typesMap(){V("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,i){let s=this.typesMap.get(t);s&&this._defaultDrawingOptions.updateProperty(s,i),this._currentParent&&(this._currentDraw.updateProperty(s,i),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,i){let s=this.constructor.typesMap.get(t);s&&this._updateProperty(t,s,i)}static get defaultPropertiesToUpdate(){let t=[],i=this._defaultDrawingOptions;for(let[s,n]of this.typesMap)t.push([s,i[n]]);return t}get propertiesToUpdate(){let t=[],{_drawingOptions:i}=this;for(let[s,n]of this.constructor.typesMap)t.push([s,i[n]]);return t}_updateProperty(t,i,s){let n=this._drawingOptions,a=n[i],r=l=>{n.updateProperty(i,l);let c=this.#t.updateProperty(i,l);c&&this.#d(c),this.parent?.drawLayer.updateProperties(this._drawId,n.toSVGProperties())};this.addCommands({cmd:r.bind(this,s),undo:r.bind(this,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,o._mergeSVGProperties(this.#t.getPathResizingSVGProperties(this.#o()),{bbox:this.#l()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,o._mergeSVGProperties(this.#t.getPathResizedSVGProperties(this.#o()),{bbox:this.#l()}))}_onTranslating(t,i){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#l(t,i)})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,o._mergeSVGProperties(this.#t.getPathTranslatedSVGProperties(this.#o(),this.parentDimensions),{bbox:this.#l()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#e&&(this.#e=!1,this.commit(),this.parent.setSelected(this),this.isOnScreen&&this.div.focus())}remove(){this.#a(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#n(),this.#d(this.#t.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let i=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),this.#a()):t&&(this._uiManager.addShouldRescale(this),this.#n(t),i=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),i&&this.select()}#a(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#n(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#s(this.#t,t)}}#c([t,i,s,n]){let{parentDimensions:[a,r],rotation:l}=this;switch(l){case 90:return[i,1-t,s*(r/a),n*(a/r)];case 180:return[1-t,1-i,s,n];case 270:return[1-i,t,s*(r/a),n*(a/r)];default:return[t,i,s,n]}}#o(){let{x:t,y:i,width:s,height:n,parentDimensions:[a,r],rotation:l}=this;switch(l){case 90:return[1-i,t,s*(a/r),n*(r/a)];case 180:return[1-t,1-i,s,n];case 270:return[i,1-t,s*(a/r),n*(r/a)];default:return[t,i,s,n]}}#d(t){if([this.x,this.y,this.width,this.height]=this.#c(t),this.div){this.fixAndSetPosition();let[i,s]=this.parentDimensions;this.setDims(this.width*i,this.height*s)}this._onResized()}#l(){let{x:t,y:i,width:s,height:n,rotation:a,parentRotation:r,parentDimensions:[l,c]}=this;switch((a*4+r)/90){case 1:return[1-i-n,t,n,s];case 2:return[1-t-s,1-i-n,s,n];case 3:return[i,1-t-s,n,s];case 4:return[t,i-s*(l/c),n*(c/l),s*(l/c)];case 5:return[1-i,t,s*(l/c),n*(c/l)];case 6:return[1-t-n*(c/l),1-i,n*(c/l),s*(l/c)];case 7:return[i-s*(l/c),1-t-n*(c/l),s*(l/c),n*(c/l)];case 8:return[t-s,i-n,s,n];case 9:return[1-i,t-s,n,s];case 10:return[1-t,1-i,s,n];case 11:return[i-n,1-t,n,s];case 12:return[t-n*(c/l),i,n*(c/l),s*(l/c)];case 13:return[1-i-s*(l/c),t-n*(c/l),s*(l/c),n*(c/l)];case 14:return[1-t,1-i-s*(l/c),n*(c/l),s*(l/c)];case 15:return[i,1-t,s*(l/c),n*(c/l)];default:return[t,i,s,n]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,o._mergeSVGProperties({bbox:this.#l()},this.#t.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#d(this.#t.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t=super.render();t.classList.add("draw");let i=document.createElement("div");t.append(i),i.setAttribute("aria-hidden","true"),i.className="internal";let[s,n]=this.parentDimensions;return this.setDims(this.width*s,this.height*n),this._uiManager.addShouldRescale(this),this.disableEditing(),t}static createDrawerInstance(t,i,s,n,a){V("Not implemented")}static startDrawing(t,i,s,{target:n,offsetX:a,offsetY:r}){let{viewport:{rotation:l}}=t,{width:c,height:d}=n.getBoundingClientRect(),h=new AbortController,u=t.combinedSignal(h);if(window.addEventListener("pointerup",m=>{h.abort(),t.toggleDrawing(!0),this._endDraw(m)},{signal:u}),window.addEventListener("pointerdown",At,{capture:!0,passive:!1,signal:u}),window.addEventListener("contextmenu",xt,{signal:u}),n.addEventListener("pointermove",this._drawMove.bind(this),{signal:u}),t.toggleDrawing(),i._editorUndoBar?.hide(),this._currentDraw){t.drawLayer.updateProperties(this._currentDrawId,this._currentDraw.startNew(a,r,c,d,l));return}i.updateUIForDefaultProperties(this),this._currentDraw=this.createDrawerInstance(a,r,c,d,l),this._currentDrawingOptions=this.getDefaultDrawingOptions(),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(this._currentDrawingOptions.toSVGProperties(),this._currentDraw.defaultSVGProperties),!0,!1)}static _drawMove({offsetX:t,offsetY:i}){this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._currentDraw.add(t,i))}static _endDraw({offsetX:t,offsetY:i}){let s=this._currentParent;if(s.drawLayer.updateProperties(this._currentDrawId,this._currentDraw.end(t,i)),this.supportMultipleDrawings){let n=this._currentDraw,a=this._currentDrawId,r=n.getLastElement();s.addCommands({cmd:()=>{s.drawLayer.updateProperties(a,n.setLastElement(r))},undo:()=>{s.drawLayer.updateProperties(a,n.removeLastElement())},mustExec:!1,type:N.DRAW_STEP});return}this.endDrawing(!1)}static endDrawing(t){let i=this._currentParent;if(!i)return null;if(i.toggleDrawing(!0),i.cleanUndoStack(N.DRAW_STEP),!this._currentDraw.isEmpty()){let{pageDimensions:[s,n],scale:a}=i,r=i.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:this._currentDraw.getOutlines(s*a,n*a,a,this._INNER_MARGIN),drawingOptions:this._currentDrawingOptions,mustBeCommitted:!t});return this._cleanup(),r}return i.drawLayer.remove(this._currentDrawId),this._cleanup(),null}static _cleanup(){this._currentDrawId=-1,this._currentDraw=null,this._currentDrawingOptions=null,this._currentParent=null}createDrawingOptions(t){}static deserializeDraw(t,i,s,n,a,r){V("Not implemented")}static deserialize(t,i,s){return k(this,null,function*(){let{rawDims:{pageWidth:n,pageHeight:a,pageX:r,pageY:l}}=i.viewport,c=this.deserializeDraw(r,l,n,a,this._INNER_MARGIN,t),d=yield ee(o,this,"deserialize").call(this,t,i,s);return d.createDrawingOptions(t),d.#i({drawOutlines:c}),d.#n(),d.onScaleChanging(),d.rotate(),d})}serializeDraw(t){let[i,s]=this.pageTranslation,[n,a]=this.pageDimensions;return this.#t.serialize([i,s,n,a],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}}return o})(),ia=class{#t=new Float64Array(6);#e;#i;#s;#a;#n;#c="";#o=0;#d=new as;#l;#h;constructor(e,t,i,s,n,a){this.#l=i,this.#h=s,this.#s=n,this.#a=a,[e,t]=this.#r(e,t);let r=this.#e=[NaN,NaN,NaN,NaN,e,t];this.#n=[e,t],this.#i=[{line:r,points:this.#n}],this.#t.set(r,0)}updateProperty(e,t){e==="stroke-width"&&(this.#a=t)}#r(e,t){return C._normalizePoint(e,t,this.#l,this.#h,this.#s)}isEmpty(){return!this.#i||this.#i.length===0}add(e,t){[e,t]=this.#r(e,t);let[i,s,n,a]=this.#t.subarray(2,6),r=e-n,l=t-a;return Math.hypot(this.#l*r,this.#h*l)<=2?null:(this.#n.push(e,t),isNaN(i)?(this.#t.set([n,a,e,t],2),this.#e.push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(this.#t[0])&&this.#e.splice(6,6),this.#t.set([i,s,n,a,e,t],0),this.#e.push(...C.createBezierPoints(i,s,n,a,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){let i=this.add(e,t);return i||(this.#n.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,i,s,n){this.#l=i,this.#h=s,this.#s=n,[e,t]=this.#r(e,t);let a=this.#e=[NaN,NaN,NaN,NaN,e,t];this.#n=[e,t];let r=this.#i.at(-1);return r&&(r.line=new Float32Array(r.line),r.points=new Float32Array(r.points)),this.#i.push({line:a,points:this.#n}),this.#t.set(a,0),this.#o=0,this.toSVGPath(),null}getLastElement(){return this.#i.at(-1)}setLastElement(e){return this.#i?(this.#i.push(e),this.#e=e.line,this.#n=e.points,this.#o=0,{path:{d:this.toSVGPath()}}):this.#d.setLastElement(e)}removeLastElement(){if(!this.#i)return this.#d.removeLastElement();this.#i.pop(),this.#c="";for(let e=0,t=this.#i.length;e<t;e++){let{line:i,points:s}=this.#i[e];this.#e=i,this.#n=s,this.#o=0,this.toSVGPath()}return{path:{d:this.#c}}}toSVGPath(){let e=C.svgRound(this.#e[4]),t=C.svgRound(this.#e[5]);if(this.#n.length===2)return this.#c=`${this.#c} M ${e} ${t} Z`,this.#c;if(this.#n.length<=6){let s=this.#c.lastIndexOf("M");this.#c=`${this.#c.slice(0,s)} M ${e} ${t}`,this.#o=6}if(this.#n.length===4){let s=C.svgRound(this.#e[10]),n=C.svgRound(this.#e[11]);return this.#c=`${this.#c} L ${s} ${n}`,this.#o=12,this.#c}let i=[];this.#o===0&&(i.push(`M ${e} ${t}`),this.#o=6);for(let s=this.#o,n=this.#e.length;s<n;s+=6){let[a,r,l,c,d,h]=this.#e.slice(s,s+6).map(C.svgRound);i.push(`C${a} ${r} ${l} ${c} ${d} ${h}`)}return this.#c+=i.join(" "),this.#o=this.#e.length,this.#c}getOutlines(e,t,i,s){let n=this.#i.at(-1);return n.line=new Float32Array(n.line),n.points=new Float32Array(n.points),this.#d.build(this.#i,e,t,i,this.#s,this.#a,s),this.#t=null,this.#e=null,this.#i=null,this.#c=null,this.#d}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}},as=class o extends C{#t;#e=0;#i;#s;#a;#n;#c;#o;#d;build(e,t,i,s,n,a,r){this.#a=t,this.#n=i,this.#c=s,this.#o=n,this.#d=a,this.#i=r??0,this.#s=e,this.#r()}setLastElement(e){return this.#s.push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#s.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){let e=[];for(let{line:t}of this.#s){if(e.push(`M${C.svgRound(t[4])} ${C.svgRound(t[5])}`),t.length===6){e.push("Z");continue}if(t.length===12){e.push(`L${C.svgRound(t[10])} ${C.svgRound(t[11])}`);continue}for(let i=6,s=t.length;i<s;i+=6){let[n,a,r,l,c,d]=t.subarray(i,i+6).map(C.svgRound);e.push(`C${n} ${a} ${r} ${l} ${c} ${d}`)}}return e.join("")}serialize([e,t,i,s],n){let a=[],r=[],[l,c,d,h]=this.#h(),u,m,p,f,_,g,b,v,y;switch(this.#o){case 0:y=C._rescale,u=e,m=t+s,p=i,f=-s,_=e+l*i,g=t+(1-c-h)*s,b=e+(l+d)*i,v=t+(1-c)*s;break;case 90:y=C._rescaleAndSwap,u=e,m=t,p=i,f=s,_=e+c*i,g=t+l*s,b=e+(c+h)*i,v=t+(l+d)*s;break;case 180:y=C._rescale,u=e+i,m=t,p=-i,f=s,_=e+(1-l-d)*i,g=t+c*s,b=e+(1-l)*i,v=t+(c+h)*s;break;case 270:y=C._rescaleAndSwap,u=e+i,m=t+s,p=-i,f=-s,_=e+(1-c-h)*i,g=t+(1-l-d)*s,b=e+(1-c)*i,v=t+(1-l)*s;break}for(let{line:w,points:A}of this.#s)a.push(y(w,u,m,p,f,n?new Array(w.length):null)),r.push(y(A,u,m,p,f,n?new Array(A.length):null));return{lines:a,points:r,rect:[_,g,b,v]}}static deserialize(e,t,i,s,n,{paths:{lines:a,points:r},rotation:l,thickness:c}){let d=[],h,u,m,p,f;switch(l){case 0:f=C._rescale,h=-e/i,u=t/s+1,m=1/i,p=-1/s;break;case 90:f=C._rescaleAndSwap,h=-t/s,u=-e/i,m=1/s,p=1/i;break;case 180:f=C._rescale,h=e/i+1,u=-t/s,m=-1/i,p=1/s;break;case 270:f=C._rescaleAndSwap,h=t/s+1,u=e/i+1,m=-1/s,p=-1/i;break}if(!a){a=[];for(let g of r){let b=g.length;if(b===2){a.push(new Float32Array([NaN,NaN,NaN,NaN,g[0],g[1]]));continue}if(b===4){a.push(new Float32Array([NaN,NaN,NaN,NaN,g[0],g[1],NaN,NaN,NaN,NaN,g[2],g[3]]));continue}let v=new Float32Array(3*(b-2));a.push(v);let[y,w,A,x]=g.subarray(0,4);v.set([NaN,NaN,NaN,NaN,y,w],0);for(let T=4;T<b;T+=2){let M=g[T],H=g[T+1];v.set(C.createBezierPoints(y,w,A,x,M,H),(T-2)*3),[y,w,A,x]=[A,x,M,H]}}}for(let g=0,b=a.length;g<b;g++)d.push({line:f(a[g].map(v=>v??NaN),h,u,m,p),points:f(r[g].map(v=>v??NaN),h,u,m,p)});let _=new o;return _.build(d,i,s,1,l,c,n),_}#l(e=this.#d){let t=this.#i+e/2*this.#c;return this.#o%180===0?[t/this.#a,t/this.#n]:[t/this.#n,t/this.#a]}#h(){let[e,t,i,s]=this.#t,[n,a]=this.#l(0);return[e+n,t+a,i-2*n,s-2*a]}#r(){let e=this.#t=new Float32Array([1/0,1/0,-1/0,-1/0]);for(let{line:s}of this.#s){if(s.length<=12){for(let r=4,l=s.length;r<l;r+=6){let[c,d]=s.subarray(r,r+2);e[0]=Math.min(e[0],c),e[1]=Math.min(e[1],d),e[2]=Math.max(e[2],c),e[3]=Math.max(e[3],d)}continue}let n=s[4],a=s[5];for(let r=6,l=s.length;r<l;r+=6){let[c,d,h,u,m,p]=s.subarray(r,r+6);E.bezierBoundingBox(n,a,c,d,h,u,m,p,e),n=m,a=p}}let[t,i]=this.#l();e[0]=Math.min(1,Math.max(0,e[0]-t)),e[1]=Math.min(1,Math.max(0,e[1]-i)),e[2]=Math.min(1,Math.max(0,e[2]+t)),e[3]=Math.min(1,Math.max(0,e[3]+i)),e[2]-=e[0],e[3]-=e[1]}get box(){return this.#t}updateProperty(e,t){return e==="stroke-width"?this.#u(t):null}#u(e){let[t,i]=this.#l();this.#d=e;let[s,n]=this.#l(),[a,r]=[s-t,n-i],l=this.#t;return l[0]-=a,l[1]-=r,l[2]+=2*a,l[3]+=2*r,l}updateParentDimensions([e,t],i){let[s,n]=this.#l();this.#a=e,this.#n=t,this.#c=i;let[a,r]=this.#l(),l=a-s,c=r-n,d=this.#t;return d[0]-=l,d[1]-=c,d[2]+=2*l,d[3]+=2*c,d}updateRotation(e){return this.#e=e,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#t.map(C.svgRound).join(" ")}get defaultProperties(){let[e,t]=this.#t;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${C.svgRound(e)} ${C.svgRound(t)}`}}}get rotationTransform(){let[,,e,t]=this.#t,i=0,s=0,n=0,a=0,r=0,l=0;switch(this.#e){case 90:s=t/e,n=-e/t,r=e;break;case 180:i=-1,a=-1,r=e,l=t;break;case 270:s=-t/e,n=e/t,l=t;break;default:return""}return`matrix(${i} ${s} ${n} ${a} ${C.svgRound(r)} ${C.svgRound(l)})`}getPathResizingSVGProperties([e,t,i,s]){let[n,a]=this.#l(),[r,l,c,d]=this.#t;if(Math.abs(c-n)<=C.PRECISION||Math.abs(d-a)<=C.PRECISION){let f=e+i/2-(r+c/2),_=t+s/2-(l+d/2);return{path:{"transform-origin":`${C.svgRound(e)} ${C.svgRound(t)}`,transform:`${this.rotationTransform} translate(${f} ${_})`}}}let h=(i-2*n)/(c-2*n),u=(s-2*a)/(d-2*a),m=c/i,p=d/s;return{path:{"transform-origin":`${C.svgRound(r)} ${C.svgRound(l)}`,transform:`${this.rotationTransform} scale(${m} ${p}) translate(${C.svgRound(n)} ${C.svgRound(a)}) scale(${h} ${u}) translate(${C.svgRound(-n)} ${C.svgRound(-a)})`}}}getPathResizedSVGProperties([e,t,i,s]){let[n,a]=this.#l(),r=this.#t,[l,c,d,h]=r;if(r[0]=e,r[1]=t,r[2]=i,r[3]=s,Math.abs(d-n)<=C.PRECISION||Math.abs(h-a)<=C.PRECISION){let _=e+i/2-(l+d/2),g=t+s/2-(c+h/2);for(let{line:b,points:v}of this.#s)C._translate(b,_,g,b),C._translate(v,_,g,v);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${C.svgRound(e)} ${C.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}let u=(i-2*n)/(d-2*n),m=(s-2*a)/(h-2*a),p=-u*(l+n)+e+n,f=-m*(c+a)+t+a;if(u!==1||m!==1||p!==0||f!==0)for(let{line:_,points:g}of this.#s)C._rescale(_,p,f,u,m,_),C._rescale(g,p,f,u,m,g);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${C.svgRound(e)} ${C.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,t],i){let[s,n]=i,a=this.#t,r=e-a[0],l=t-a[1];if(this.#a===s&&this.#n===n)for(let{line:c,points:d}of this.#s)C._translate(c,r,l,c),C._translate(d,r,l,d);else{let c=this.#a/s,d=this.#n/n;this.#a=s,this.#n=n;for(let{line:h,points:u}of this.#s)C._rescale(h,r,l,c,d,h),C._rescale(u,r,l,c,d,u);a[2]*=c,a[3]*=d}return a[0]=e,a[1]=t,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${C.svgRound(e)} ${C.svgRound(t)}`}}}get defaultSVGProperties(){let e=this.#t;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${C.svgRound(e[0])} ${C.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}},sa=class o extends ea{#t;constructor(e){super(),this.#t=e,super.updateProperties({fill:"none",stroke:q._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??=this["stroke-width"],t*=this.#t.realScale),super.updateSVGProperty(e,t)}clone(){let e=new o(this.#t);return e.updateAll(this),e}},na=class o extends vl{static _type="ink";static _editorType=D.INK;static _defaultDrawingOptions=null;constructor(e){super(Wt(X({},e),{name:"inkEditor"})),this._willKeepAspectRatio=!0}static initialize(e,t){q.initialize(e,t),this._defaultDrawingOptions=new sa(t.viewParameters)}static getDefaultDrawingOptions(e){let t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!0}static get typesMap(){return F(this,"typesMap",new Map([[N.INK_THICKNESS,"stroke-width"],[N.INK_COLOR,"stroke"],[N.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,t,i,s,n){return new ia(e,t,i,s,n,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,t,i,s,n,a){return as.deserialize(e,t,i,s,n,a)}static deserialize(e,t,i){return k(this,null,function*(){let s=null;if(e instanceof Je){let{data:{inkLists:a,rect:r,rotation:l,id:c,color:d,opacity:h,borderStyle:{rawWidth:u},popupRef:m},parent:{page:{pageNumber:p}}}=e;s=e={annotationType:D.INK,color:Array.from(d),thickness:u,opacity:h,paths:{points:a},boxes:null,pageIndex:p-1,rect:r.slice(0),rotation:l,id:c,deleted:!1,popupRef:m}}let n=yield ee(o,this,"deserialize").call(this,e,t,i);return n.annotationElementId=e.id||null,n._initialData=s,n})}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();let{_drawId:e,_drawingOptions:t,parent:i}=this;t.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(e,t.toSVGProperties())}static onScaleChangingWhenDrawing(){let e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:e,thickness:t,opacity:i}){this._drawingOptions=o.getDefaultDrawingOptions({stroke:E.makeHexColor(...e),"stroke-width":t,"stroke-opacity":i})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let{lines:t,points:i,rect:s}=this.serializeDraw(e),{_drawingOptions:{stroke:n,"stroke-opacity":a,"stroke-width":r}}=this,l={annotationType:D.INK,color:q._colorManager.convert(n),opacity:a,thickness:r,paths:{lines:t,points:i},pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?l:this.annotationElementId&&!this.#t(l)?null:(l.id=this.annotationElementId,l)}#t(e){let{color:t,thickness:i,opacity:s,pageIndex:n}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||e.color.some((a,r)=>a!==t[r])||e.thickness!==i||e.opacity!==s||e.pageIndex!==n}renderAnnotationElement(e){let{points:t,rect:i}=this.serializeDraw(!1);return e.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:t}),null}},aa=class o extends q{#t=null;#e=null;#i=null;#s=null;#a=null;#n="";#c=null;#o=null;#d=null;#l=!1;#h=!1;static _type="stamp";static _editorType=D.STAMP;constructor(e){super(Wt(X({},e),{name:"stampEditor"})),this.#s=e.bitmapUrl,this.#a=e.bitmapFile}static initialize(e,t){q.initialize(e,t)}static get supportedTypes(){return F(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(t=>`image/${t}`))}static get supportedTypesStr(){return F(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(e){return this.supportedTypes.includes(e)}static paste(e,t){t.pasteEditor(D.STAMP,{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(e){let t=e.get("hasAltText");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}#r(e,t=!1){if(!e){this.remove();return}this.#t=e.bitmap,t||(this.#e=e.id,this.#l=e.isSvg),e.file&&(this.#n=e.file.name),this.#p()}#u(){if(this.#i=null,this._uiManager.enableWaiting(!1),!!this.#c){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}mlGuessAltText(e=null,t=!0){return k(this,null,function*(){if(this.hasAltTextData())return null;let{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!(yield i.isEnabledFor("altText")))throw new Error("ML isn't enabled for alt text.");let{data:s,width:n,height:a}=e||this.copyCanvas(null,null,!0).imageData,r=yield i.guess({name:"altText",request:{data:s,width:n,height:a,channels:s.length/(n*a)}});if(!r)throw new Error("No response from the AI service.");if(r.error)throw new Error("Error from the AI service.");if(r.cancel)return null;if(!r.output)throw new Error("No valid response from the AI service.");let l=r.output;return yield this.setGuessedAltText(l),t&&!this.hasAltTextData()&&(this.altTextData={alt:l,decorative:!1}),l})}#m(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(i=>this.#r(i,!0)).finally(()=>this.#u());return}if(this.#s){let i=this.#s;this.#s=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromUrl(i).then(s=>this.#r(s)).finally(()=>this.#u());return}if(this.#a){let i=this.#a;this.#a=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromFile(i).then(s=>this.#r(s)).finally(()=>this.#u());return}let e=document.createElement("input");e.type="file",e.accept=o.supportedTypesStr;let t=this._uiManager._signal;this.#i=new Promise(i=>{e.addEventListener("change",()=>k(this,null,function*(){if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);let s=yield this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#r(s)}i()}),{signal:t}),e.addEventListener("cancel",()=>{this.remove(),i()},{signal:t})}).finally(()=>this.#u()),e.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#c?.remove(),this.#c=null,this.#o?.disconnect(),this.#o=null,this.#d&&(clearTimeout(this.#d),this.#d=null)),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#m();return}super.rebuild(),this.div!==null&&(this.#e&&this.#c===null&&this.#m(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(this.#i||this.#t||this.#s||this.#a||this.#e)}get isResizable(){return!0}render(){if(this.div)return this.div;let e,t;if(this.width&&(e=this.x,t=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),this.#t?this.#p():this.#m(),this.width&&!this.annotationElementId){let[i,s]=this.parentDimensions;this.setAt(e*i,t*s,this.width*i,this.height*s)}return this.div}#p(){let{div:e}=this,{width:t,height:i}=this.#t,[s,n]=this.pageDimensions,a=.75;if(this.width)t=this.width*s,i=this.height*n;else if(t>a*s||i>a*n){let d=Math.min(a*s/t,a*n/i);t*=d,i*=d}let[r,l]=this.parentDimensions;this.setDims(t*r/s,i*l/n),this._uiManager.enableWaiting(!1);let c=this.#c=document.createElement("canvas");c.setAttribute("role","img"),this.addContainer(c),(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(e.hidden=!1),this.#_(t,i),this.#y(),this.#h||(this.parent.addUndoableEditor(this),this.#h=!0),this._reportTelemetry({action:"inserted_image"}),this.#n&&c.setAttribute("aria-label",this.#n)}copyCanvas(e,t,i=!1){e||(e=224);let{width:s,height:n}=this.#t,a=new $e,r=this.#t,l=s,c=n,d=null;if(t){if(s>t||n>t){let A=Math.min(t/s,t/n);l=Math.floor(s*A),c=Math.floor(n*A)}d=document.createElement("canvas");let u=d.width=Math.ceil(l*a.sx),m=d.height=Math.ceil(c*a.sy);this.#l||(r=this.#f(u,m));let p=d.getContext("2d");p.filter=this._uiManager.hcmFilter;let f="white",_="#cfcfd8";this._uiManager.hcmFilter!=="none"?_="black":window.matchMedia?.("(prefers-color-scheme: dark)").matches&&(f="#8f8f9d",_="#42414d");let g=15,b=g*a.sx,v=g*a.sy,y=new OffscreenCanvas(b*2,v*2),w=y.getContext("2d");w.fillStyle=f,w.fillRect(0,0,b*2,v*2),w.fillStyle=_,w.fillRect(0,0,b,v),w.fillRect(b,v,b,v),p.fillStyle=p.createPattern(y,"repeat"),p.fillRect(0,0,u,m),p.drawImage(r,0,0,r.width,r.height,0,0,u,m)}let h=null;if(i){let u,m;if(a.symmetric&&r.width<e&&r.height<e)u=r.width,m=r.height;else if(r=this.#t,s>e||n>e){let _=Math.min(e/s,e/n);u=Math.floor(s*_),m=Math.floor(n*_),this.#l||(r=this.#f(u,m))}let f=new OffscreenCanvas(u,m).getContext("2d",{willReadFrequently:!0});f.drawImage(r,0,0,r.width,r.height,0,0,u,m),h={width:u,height:m,data:f.getImageData(0,0,u,m).data}}return{canvas:d,width:l,height:c,imageData:h}}#g(e,t){let[i,s]=this.parentDimensions;this.width=e/i,this.height=t/s,this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,this.#d!==null&&clearTimeout(this.#d);let n=200;this.#d=setTimeout(()=>{this.#d=null,this.#_(e,t)},n)}#f(e,t){let{width:i,height:s}=this.#t,n=i,a=s,r=this.#t;for(;n>2*e||a>2*t;){let l=n,c=a;n>2*e&&(n=n>=16384?Math.floor(n/2)-1:Math.ceil(n/2)),a>2*t&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));let d=new OffscreenCanvas(n,a);d.getContext("2d").drawImage(r,0,0,l,c,0,0,n,a),r=d.transferToImageBitmap()}return r}#_(e,t){let i=new $e,s=Math.ceil(e*i.sx),n=Math.ceil(t*i.sy),a=this.#c;if(!a||a.width===s&&a.height===n)return;a.width=s,a.height=n;let r=this.#l?this.#t:this.#f(s,n),l=a.getContext("2d");l.filter=this._uiManager.hcmFilter,l.drawImage(r,0,0,r.width,r.height,0,0,s,n)}getImageForAltText(){return this.#c}#b(e){if(e){if(this.#l){let s=this._uiManager.imageManager.getSvgUrl(this.#e);if(s)return s}let t=document.createElement("canvas");return{width:t.width,height:t.height}=this.#t,t.getContext("2d").drawImage(this.#t,0,0),t.toDataURL()}if(this.#l){let[t,i]=this.pageDimensions,s=Math.round(this.width*t*Jt.PDF_TO_CSS_UNITS),n=Math.round(this.height*i*Jt.PDF_TO_CSS_UNITS),a=new OffscreenCanvas(s,n);return a.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,s,n),a.transferToImageBitmap()}return structuredClone(this.#t)}#y(){this._uiManager._signal&&(this.#o=new ResizeObserver(e=>{let t=e[0].contentRect;t.width&&t.height&&this.#g(t.width,t.height)}),this.#o.observe(this.div),this._uiManager._signal.addEventListener("abort",()=>{this.#o?.disconnect(),this.#o=null},{once:!0}))}static deserialize(e,t,i){return k(this,null,function*(){let s=null;if(e instanceof ts){let{data:{rect:p,rotation:f,id:_,structParent:g,popupRef:b},container:v,parent:{page:{pageNumber:y}}}=e,w=v.querySelector("canvas"),A=i.imageManager.getFromCanvas(v.id,w);w.remove();let x=(yield t._structTree.getAriaAttributes(`${la}${_}`))?.get("aria-label")||"";s=e={annotationType:D.STAMP,bitmapId:A.id,bitmap:A.bitmap,pageIndex:y-1,rect:p.slice(0),rotation:f,id:_,deleted:!1,accessibilityData:{decorative:!1,altText:x},isSvg:!1,structParent:g,popupRef:b}}let n=yield ee(o,this,"deserialize").call(this,e,t,i),{rect:a,bitmap:r,bitmapUrl:l,bitmapId:c,isSvg:d,accessibilityData:h}=e;c&&i.imageManager.isValidId(c)?(n.#e=c,r&&(n.#t=r)):n.#s=l,n.#l=d;let[u,m]=n.pageDimensions;return n.width=(a[2]-a[0])/u,n.height=(a[3]-a[1])/m,n.annotationElementId=e.id||null,h&&(n.altTextData=h),n._initialData=s,n.#h=!!s,n})}serialize(e=!1,t=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let i={annotationType:D.STAMP,bitmapId:this.#e,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#l,structTreeParentId:this._structTreeParentId};if(e)return i.bitmapUrl=this.#b(!0),i.accessibilityData=this.serializeAltText(!0),i;let{decorative:s,altText:n}=this.serializeAltText(!1);if(!s&&n&&(i.accessibilityData={type:"Figure",alt:n}),this.annotationElementId){let r=this.#w(i);if(r.isSame)return null;r.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1}if(i.id=this.annotationElementId,t===null)return i;t.stamps||=new Map;let a=this.#l?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!t.stamps.has(this.#e))t.stamps.set(this.#e,{area:a,serialized:i}),i.bitmap=this.#b(!1);else if(this.#l){let r=t.stamps.get(this.#e);a>r.area&&(r.area=a,r.serialized.bitmap.close(),r.serialized.bitmap=this.#b(!1))}return i}#w(e){let{pageIndex:t,accessibilityData:{altText:i}}=this._initialData,s=e.pageIndex===t,n=(e.accessibilityData?.alt||"")===i;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&s&&n,isSameAltText:n}}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}},yl=(()=>{class o{#t;#e=!1;#i=null;#s=null;#a=null;#n=new Map;#c=!1;#o=!1;#d=null;#l=null;#h=null;#r;static _initialized=!1;static#u=new Map([Zn,na,aa,ns].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:i,div:s,structTreeLayer:n,accessibilityManager:a,annotationLayer:r,drawLayer:l,textLayer:c,viewport:d,l10n:h}){let u=[...o.#u.values()];if(!o._initialized){o._initialized=!0;for(let m of u)m.initialize(h,t)}t.registerEditorTypes(u),this.#r=t,this.pageIndex=i,this.div=s,this.#t=a,this.#i=r,this.viewport=d,this.#l=c,this.drawLayer=l,this._structTree=n,this.#r.addLayer(this)}get isEmpty(){return this.#n.size===0}get isInvisible(){return this.isEmpty&&this.#r.getMode()===D.NONE}updateToolbar(t){this.#r.updateToolbar(t)}updateMode(t=this.#r.getMode()){switch(this.#_(),t){case D.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case D.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case D.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);let{classList:i}=this.div;for(let s of o.#u.values())i.toggle(`${s._type}Editing`,t===s._editorType);this.div.hidden=!1}hasTextLayer(t){return t===this.#l?.div}setEditingState(t){this.#r.setEditingState(t)}addCommands(t){this.#r.addCommands(t)}cleanUndoStack(t){this.#r.cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#i?.div.classList.toggle("disabled",!t)}enable(){return k(this,null,function*(){this.div.tabIndex=0,this.togglePointerEvents(!0);let t=new Set;for(let s of this.#n.values())s.enableEditing(),s.show(!0),s.annotationElementId&&(this.#r.removeChangedExistingAnnotation(s),t.add(s.annotationElementId));if(!this.#i)return;let i=this.#i.getEditableAnnotations();for(let s of i){if(s.hide(),this.#r.isDeletedAnnotationElement(s.data.id)||t.has(s.data.id))continue;let n=yield this.deserialize(s);n&&(this.addOrRebuild(n),n.enableEditing())}})}disable(){this.#o=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1);let t=new Map,i=new Map;for(let n of this.#n.values())if(n.disableEditing(),!!n.annotationElementId){if(n.serialize()!==null){t.set(n.annotationElementId,n);continue}else i.set(n.annotationElementId,n);this.getEditableAnnotation(n.annotationElementId)?.show(),n.remove()}if(this.#i){let n=this.#i.getEditableAnnotations();for(let a of n){let{id:r}=a.data;if(this.#r.isDeletedAnnotationElement(r))continue;let l=i.get(r);if(l){l.resetAnnotationElement(a),l.show(!1),a.show();continue}l=t.get(r),l&&(this.#r.addChangedExistingAnnotation(l),l.renderAnnotationElement(a)&&l.show(!1)),a.show()}}this.#_(),this.isEmpty&&(this.div.hidden=!0);let{classList:s}=this.div;for(let n of o.#u.values())s.remove(`${n._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#o=!1}getEditableAnnotation(t){return this.#i?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#r.getActive()!==t&&this.#r.setActiveEditor(t)}enableTextSelection(){if(this.div.tabIndex=-1,this.#l?.div&&!this.#h){this.#h=new AbortController;let t=this.#r.combinedSignal(this.#h);this.#l.div.addEventListener("pointerdown",this.#m.bind(this),{signal:t}),this.#l.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#l?.div&&this.#h&&(this.#h.abort(),this.#h=null,this.#l.div.classList.remove("highlighting"))}#m(t){this.#r.unselectAll();let{target:i}=t;if(i===this.#l.div||(i.getAttribute("role")==="img"||i.classList.contains("endOfContent"))&&this.#l.div.contains(i)){let{isMac:s}=st.platform;if(t.button!==0||t.ctrlKey&&s)return;this.#r.showAllEditors("highlight",!0,!0),this.#l.div.classList.add("free"),this.toggleDrawing(),ns.startHighlighting(this,this.#r.direction==="ltr",{target:this.#l.div,x:t.x,y:t.y}),this.#l.div.addEventListener("pointerup",()=>{this.#l.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#r._signal}),t.preventDefault()}}enableClick(){if(this.#s)return;this.#s=new AbortController;let t=this.#r.combinedSignal(this.#s);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t}),this.div.addEventListener("pointerup",this.pointerup.bind(this),{signal:t})}disableClick(){this.#s?.abort(),this.#s=null}attach(t){this.#n.set(t.id,t);let{annotationElementId:i}=t;i&&this.#r.isDeletedAnnotationElement(i)&&this.#r.removeDeletedAnnotationElement(t)}detach(t){this.#n.delete(t.id),this.#t?.removePointerInTextLayer(t.contentDiv),!this.#o&&t.annotationElementId&&this.#r.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#r.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#r.addDeletedAnnotationElement(t.annotationElementId),q.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),this.#r.addEditor(t),this.attach(t),!t.isAttachedToDOM){let i=t.render();this.div.append(i),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(),this.#r.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;let{activeElement:i}=document;t.div.contains(i)&&!this.#a&&(t._focusEventsAllowed=!1,this.#a=setTimeout(()=>{this.#a=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this.#r._signal}),i.focus())},0)),t._structTreeParentId=this.#t?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){let i=()=>t._uiManager.rebuild(t),s=()=>{t.remove()};this.addCommands({cmd:i,undo:s,mustExec:!1})}getNextId(){return this.#r.getId()}get#p(){return o.#u.get(this.#r.getMode())}combinedSignal(t){return this.#r.combinedSignal(t)}#g(t){let i=this.#p;return i?new i.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#p?.canCreateNewEmptyEditor()}pasteEditor(t,i){this.#r.updateToolbar(t),this.#r.updateMode(t);let{offsetX:s,offsetY:n}=this.#f(),a=this.getNextId(),r=this.#g(X({parent:this,id:a,x:s,y:n,uiManager:this.#r,isCentered:!0},i));r&&this.add(r)}deserialize(t){return k(this,null,function*(){return(yield o.#u.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#r))||null})}createAndAddNewEditor(t,i,s={}){let n=this.getNextId(),a=this.#g(X({parent:this,id:n,x:t.offsetX,y:t.offsetY,uiManager:this.#r,isCentered:i},s));return a&&this.add(a),a}#f(){let{x:t,y:i,width:s,height:n}=this.div.getBoundingClientRect(),a=Math.max(0,t),r=Math.max(0,i),l=Math.min(window.innerWidth,t+s),c=Math.min(window.innerHeight,i+n),d=(a+l)/2-t,h=(r+c)/2-i,[u,m]=this.viewport.rotation%180===0?[d,h]:[h,d];return{offsetX:u,offsetY:m}}addNewEditor(){this.createAndAddNewEditor(this.#f(),!0)}setSelected(t){this.#r.setSelected(t)}toggleSelected(t){this.#r.toggleSelected(t)}unselect(t){this.#r.unselect(t)}pointerup(t){let{isMac:i}=st.platform;if(!(t.button!==0||t.ctrlKey&&i)&&t.target===this.div&&this.#c&&(this.#c=!1,!(this.#p?.isDrawer&&this.#p.supportMultipleDrawings))){if(!this.#e){this.#e=!0;return}if(this.#r.getMode()===D.STAMP){this.#r.unselectAll();return}this.createAndAddNewEditor(t,!1)}}pointerdown(t){if(this.#r.getMode()===D.HIGHLIGHT&&this.enableTextSelection(),this.#c){this.#c=!1;return}let{isMac:i}=st.platform;if(t.button!==0||t.ctrlKey&&i||t.target!==this.div)return;if(this.#c=!0,this.#p?.isDrawer){this.startDrawingSession(t);return}let s=this.#r.getActive();this.#e=!s||s.isEmpty()}startDrawingSession(t){if(this.div.focus(),this.#d){this.#p.startDrawing(this,this.#r,!1,t);return}this.#r.setCurrentDrawingSession(this),this.#d=new AbortController;let i=this.#r.combinedSignal(this.#d);this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&this.commitOrRemove()},{signal:i}),this.#p.startDrawing(this,this.#r,!1,t)}endDrawingSession(t=!1){return this.#d?(this.#r.setCurrentDrawingSession(null),this.#d.abort(),this.#d=null,this.#p.endDrawing(t)):null}findNewParent(t,i,s){let n=this.#r.findParent(i,s);return n===null||n===this?!1:(n.changeParent(t),!0)}commitOrRemove(){return this.#d?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#d&&this.#p.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#r.getActive()?.parent===this&&(this.#r.commitOrRemove(),this.#r.setActiveEditor(null)),this.#a&&(clearTimeout(this.#a),this.#a=null);for(let t of this.#n.values())this.#t?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#n.clear(),this.#r.removeLayer(this)}#_(){for(let t of this.#n.values())t.isEmpty()&&t.remove()}render({viewport:t}){this.viewport=t,ue(this.div,t);for(let i of this.#r.getEditors(this.pageIndex))this.add(i),i.rebuild();this.updateMode()}update({viewport:t}){this.#r.commitOrRemove(),this.#_();let i=this.viewport.rotation,s=t.rotation;if(this.viewport=t,ue(this.div,{rotation:s}),i!==s)for(let n of this.#n.values())n.rotate(s)}get pageDimensions(){let{pageWidth:t,pageHeight:i}=this.viewport.rawDims;return[t,i]}get scale(){return this.#r.viewParameters.realScale}}return o})(),ra=class o{#t=null;#e=0;#i=new Map;#s=new Map;constructor({pageIndex:e}){this.pageIndex=e}setParent(e){if(!this.#t){this.#t=e;return}if(this.#t!==e){if(this.#i.size>0)for(let t of this.#i.values())t.remove(),e.append(t);this.#t=e}}static get _svgFactory(){return F(this,"_svgFactory",new Qe)}static#a(e,[t,i,s,n]){let{style:a}=e;a.top=`${100*i}%`,a.left=`${100*t}%`,a.width=`${100*s}%`,a.height=`${100*n}%`}#n(){let e=o._svgFactory.create(1,1,!0);return this.#t.append(e),e.setAttribute("aria-hidden",!0),e}#c(e,t){let i=o._svgFactory.createElement("clipPath");e.append(i);let s=`clip_${t}`;i.setAttribute("id",s),i.setAttribute("clipPathUnits","objectBoundingBox");let n=o._svgFactory.createElement("use");return i.append(n),n.setAttribute("href",`#${t}`),n.classList.add("clip"),s}#o(e,t){for(let[i,s]of Object.entries(t))s===null?e.removeAttribute(i):e.setAttribute(i,s)}draw(e,t=!1,i=!1){let s=this.#e++,n=this.#n(),a=o._svgFactory.createElement("defs");n.append(a);let r=o._svgFactory.createElement("path");a.append(r);let l=`path_p${this.pageIndex}_${s}`;r.setAttribute("id",l),r.setAttribute("vector-effect","non-scaling-stroke"),t&&this.#s.set(s,r);let c=i?this.#c(a,l):null,d=o._svgFactory.createElement("use");return n.append(d),d.setAttribute("href",`#${l}`),this.updateProperties(n,e),this.#i.set(s,n),{id:s,clipPathId:`url(#${c})`}}drawOutline(e,t){let i=this.#e++,s=this.#n(),n=o._svgFactory.createElement("defs");s.append(n);let a=o._svgFactory.createElement("path");n.append(a);let r=`path_p${this.pageIndex}_${i}`;a.setAttribute("id",r),a.setAttribute("vector-effect","non-scaling-stroke");let l;if(t){let h=o._svgFactory.createElement("mask");n.append(h),l=`mask_p${this.pageIndex}_${i}`,h.setAttribute("id",l),h.setAttribute("maskUnits","objectBoundingBox");let u=o._svgFactory.createElement("rect");h.append(u),u.setAttribute("width","1"),u.setAttribute("height","1"),u.setAttribute("fill","white");let m=o._svgFactory.createElement("use");h.append(m),m.setAttribute("href",`#${r}`),m.setAttribute("stroke","none"),m.setAttribute("fill","black"),m.setAttribute("fill-rule","nonzero"),m.classList.add("mask")}let c=o._svgFactory.createElement("use");s.append(c),c.setAttribute("href",`#${r}`),l&&c.setAttribute("mask",`url(#${l})`);let d=c.cloneNode();return s.append(d),c.classList.add("mainOutline"),d.classList.add("secondaryOutline"),this.updateProperties(s,e),this.#i.set(i,s),i}finalizeDraw(e,t){this.#s.delete(e),this.updateProperties(e,t)}updateProperties(e,t){if(!t)return;let{root:i,bbox:s,rootClass:n,path:a}=t,r=typeof e=="number"?this.#i.get(e):e;if(r){if(i&&this.#o(r,i),s&&o.#a(r,s),n){let{classList:l}=r;for(let[c,d]of Object.entries(n))l.toggle(c,d)}if(a){let c=r.firstChild.firstChild;this.#o(c,a)}}}updateParent(e,t){if(t===this)return;let i=this.#i.get(e);i&&(t.#t.append(i),this.#i.delete(e),t.#i.set(e,i))}remove(e){this.#s.delete(e),this.#t!==null&&(this.#i.get(e).remove(),this.#i.delete(e))}destroy(){this.#t=null;for(let e of this.#i.values())e.remove();this.#i.clear(),this.#s.clear()}};globalThis.pdfjsTestingUtils={HighlightOutliner:ti};var jc=P.AbortException,Vc=P.AnnotationEditorLayer,Gc=P.AnnotationEditorParamsType,Uc=P.AnnotationEditorType,$c=P.AnnotationEditorUIManager,Wc=P.AnnotationLayer,qc=P.AnnotationMode,Xc=P.ColorPicker,Yc=P.DOMSVGFactory,Kc=P.DrawLayer,Qc=P.FeatureTest,qr=P.GlobalWorkerOptions,Zc=P.ImageKind,Jc=P.InvalidPDFException,td=P.MissingPDFException,ed=P.OPS,id=P.OutputScale,sd=P.PDFDataRangeTransport,nd=P.PDFDateString,ad=P.PDFWorker,rd=P.PasswordResponses,od=P.PermissionFlag,ld=P.PixelsPerInch,cd=P.RenderingCancelledException,dd=P.TextLayer,hd=P.UnexpectedResponseException,ud=P.Util,md=P.VerbosityLevel,pd=P.XfaLayer,fd=P.build,gd=P.createValidAbsoluteUrl,_d=P.fetchData,Xr=P.getDocument,bd=P.getFilenameFromUrl,vd=P.getPdfFilenameFromUrl,yd=P.getXfaPageViewport,wd=P.isDataScheme,Ad=P.isPdfFile,xd=P.noContextMenu,Cd=P.normalizeUnicode,kd=P.setLayerDimensions,Sd=P.shadow,Ed=P.stopEvent,Yr=P.version;var ps=class o{constructor(e){this.data=e}static \u0275fac=function(t){return new(t||o)(_e(Ls))};static \u0275cmp=nt({type:o,selectors:[["app-page-preview-dialog"]],decls:2,vars:2,consts:[[1,"preview-dialog"],[3,"src","alt"]],template:function(t,i){t&1&&(B(0,"div",0),_t(1,"img",1),j()),t&2&&(Q(),lt("src",i.data.pageUrl,hi)("alt","Page "+i.data.pageNumber))},dependencies:[Xt,xi],styles:[".preview-dialog[_ngcontent-%COMP%]{padding:16px}.preview-dialog[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:80vh;object-fit:contain}"]})};function kl(o,e){o&1&&(B(0,"div",4),_t(1,"mat-spinner",5),j())}function Sl(o,e){if(o&1){let t=re();B(0,"mat-list-item",7),_t(1,"img",8),B(2,"span",9),at(3),j(),B(4,"button",10),It("click",function(){let s=Tt(t).index,n=Dt(2);return Mt(n.openPreview(s))}),B(5,"mat-icon"),at(6,"zoom_in"),j()()()}if(o&2){let t=e.$implicit,i=e.index;Q(),lt("src",t,hi)("alt","Page "+(i+1)),Q(2),ve("Page ",i+1,"")}}function El(o,e){if(o&1&&(B(0,"mat-list"),gt(1,Sl,7,3,"mat-list-item",6),j()),o&2){let t=Dt();Q(),lt("ngForOf",t.pages)}}function Tl(o,e){if(o&1&&(B(0,"div",11),at(1),j()),o&2){let t=Dt();Q(),ve(" ",t.error," ")}}qr.workerSrc=`https://cdn.jsdelivr.net/npm/pdfjs-dist@${Yr}/build/pdf.worker.min.mjs`;var Se=class o{constructor(e){this.dialog=e}file=null;pages=[];isLoading=!1;error=null;ngOnChanges(e){e.file&&this.file&&this.loadPdfPreview()}loadPdfPreview(){return k(this,null,function*(){if(this.file){this.isLoading=!0,this.error=null,this.pages=[];try{let e=yield this.file.arrayBuffer(),t=yield Xr(e).promise,i=[];for(let s=1;s<=t.numPages;s++)i.push(this.renderPage(t,s));this.pages=yield Promise.all(i)}catch(e){console.error("Error loading PDF preview:",e),this.error="Failed to load PDF preview"}finally{this.isLoading=!1}}})}openPreview(e){this.dialog.open(ps,{data:{pageUrl:this.pages[e],pageNumber:e+1},maxWidth:"90vw",maxHeight:"90vh"})}renderPage(e,t){return k(this,null,function*(){let i=yield e.getPage(t),n=i.getViewport({scale:1}),a=document.createElement("canvas"),r=a.getContext("2d");if(!r)throw new Error("Could not get canvas context");return a.width=n.width,a.height=n.height,yield i.render({canvasContext:r,viewport:n}).promise,a.toDataURL()})}static \u0275fac=function(t){return new(t||o)(_e(Ps))};static \u0275cmp=nt({type:o,selectors:[["app-pdf-preview"]],inputs:{file:"file"},features:[li],decls:4,vars:3,consts:[[1,"preview-container"],["class","loading-overlay",4,"ngIf"],[4,"ngIf"],["class","error-message",4,"ngIf"],[1,"loading-overlay"],["diameter","40"],["class","page-item",4,"ngFor","ngForOf"],[1,"page-item"],["matListItemAvatar","",1,"page-thumbnail",3,"src","alt"],["matListItemTitle",""],["mat-icon-button","","matListItemMeta","",3,"click"],[1,"error-message"]],template:function(t,i){t&1&&(B(0,"div",0),gt(1,kl,2,0,"div",1)(2,El,2,1,"mat-list",2)(3,Tl,2,1,"div",3),j()),t&2&&(Q(),lt("ngIf",i.isLoading),Q(),lt("ngIf",i.pages.length),Q(),lt("ngIf",i.error))},dependencies:[Xt,Ca,ui,yi,sr,ir,wr,vr,yr,Os,Ds,Rs,bi,_i,gi,za,xi],styles:[".preview-container[_ngcontent-%COMP%]{position:relative;min-height:200px}.loading-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;justify-content:center;align-items:center;background:#fffc;z-index:1}.page-item[_ngcontent-%COMP%]{border-bottom:1px solid rgba(0,0,0,.12)}.page-thumbnail[_ngcontent-%COMP%]{width:40px;height:40px;object-fit:cover;border-radius:4px}.error-message[_ngcontent-%COMP%]{color:var(--mat-warn-500);text-align:center;padding:16px}"]})};var Kr={selectedFile:null,isProcessing:!1,error:null},fs=class o{state=new pa(Kr);get state$(){return this.state.asObservable()}setSelectedFile(e){this.updateState({selectedFile:e,error:null})}setProcessing(e){this.updateState({isProcessing:e})}setError(e){this.updateState({error:e})}reset(){this.state.next(Kr)}updateState(e){this.state.next(X(X({},this.state.value),e))}static \u0275fac=function(t){return new(t||o)};static \u0275prov=ge({token:o,factory:o.\u0275fac,providedIn:"root"})};function Ll(o,e){o&1&&_t(0,"mat-progress-bar",12)}function Pl(o,e){if(o&1){let t=re();B(0,"div",7)(1,"p"),at(2),j(),gt(3,Ll,1,0,"mat-progress-bar",8),oe(4,"async"),B(5,"mat-form-field",9)(6,"mat-label"),at(7,"New filenames (one per line)"),j(),B(8,"textarea",10),wa("ngModelChange",function(s){Tt(t);let n=Dt();return ya(n.newNames,s)||(n.newNames=s),Mt(s)}),It("input",function(){Tt(t);let s=Dt();return Mt(s.updateFileNames())}),j(),B(9,"mat-hint"),at(10,"Each line will be used as a filename for the corresponding page"),j()(),_t(11,"app-pdf-preview",11),j()}if(o&2){let t,i=e.ngIf,s=Dt();Q(2),ve("Selected file: ",i.name,""),Q(),lt("ngIf",(t=le(4,4,s.state$))==null?null:t.isProcessing),Q(5),va("ngModel",s.newNames),Q(3),lt("file",i)}}function Il(o,e){if(o&1&&(B(0,"p",13),at(1),oe(2,"async"),j()),o&2){let t,i=Dt();Q(),ve(" ",(t=le(2,1,i.state$))==null?null:t.error," ")}}var Ee=class o{constructor(e){this.pdfSplitterService=e;this.state$=this.pdfSplitterService.state$}state$;newNames="";fileNames=[];ngOnInit(){this.pdfSplitterService.reset()}onFileSelected(e){let t=e.target;t.files?.length&&this.pdfSplitterService.setSelectedFile(t.files[0])}updateFileNames(){this.fileNames=this.newNames.split(`
`).map(e=>e.trim()).filter(e=>e.length>0)}splitPdf(){return k(this,null,function*(){this.pdfSplitterService.setProcessing(!0);try{console.log("Splitting PDF with names:",this.fileNames)}catch(e){this.pdfSplitterService.setError("Failed to split PDF"),console.error("Error splitting PDF:",e)}finally{this.pdfSplitterService.setProcessing(!1)}})}static \u0275fac=function(t){return new(t||o)(_e(fs))};static \u0275cmp=nt({type:o,selectors:[["app-pdf-splitter"]],decls:26,vars:11,consts:[["fileInput",""],["mat-card-avatar",""],["class","file-info",4,"ngIf"],["class","error-message",4,"ngIf"],["type","file","accept",".pdf",2,"display","none",3,"change"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"file-info"],["mode","indeterminate","color","primary",4,"ngIf"],[1,"names-input"],["matInput","","placeholder","Enter names (one per line)",3,"ngModelChange","input","ngModel"],[3,"file"],["mode","indeterminate","color","primary"],[1,"error-message"]],template:function(t,i){if(t&1){let s=re();B(0,"mat-card")(1,"mat-card-header")(2,"mat-icon",1),at(3,"file_copy"),j(),B(4,"mat-card-title"),at(5,"PDF Splitter"),j(),B(6,"mat-card-subtitle"),at(7,"Split PDF into single pages"),j()(),B(8,"mat-card-content"),gt(9,Pl,12,6,"div",2),oe(10,"async"),gt(11,Il,3,3,"p",3),oe(12,"async"),j(),B(13,"mat-card-actions")(14,"input",4,0),It("change",function(a){return Tt(s),Mt(i.onFileSelected(a))}),j(),B(16,"button",5),It("click",function(){Tt(s);let a=vs(15);return Mt(a.click())}),B(17,"mat-icon"),at(18,"upload_file"),j(),at(19," Select PDF "),j(),B(20,"button",6),oe(21,"async"),oe(22,"async"),It("click",function(){return Tt(s),Mt(i.splitPdf())}),B(23,"mat-icon"),at(24,"call_split"),j(),at(25," Split PDF "),j()()()}if(t&2){let s,n,a;Q(9),lt("ngIf",(s=le(10,3,i.state$))==null?null:s.selectedFile),Q(2),lt("ngIf",(n=le(12,5,i.state$))==null?null:n.error),Q(9),lt("disabled",!((a=le(21,7,i.state$))!=null&&a.selectedFile)||((a=le(22,9,i.state$))==null?null:a.isProcessing))}},dependencies:[Xt,ui,ka,er,Za,Ja,tr,gi,Ha,bi,_i,yi,$a,Ya,Qa,qa,Ka,Xa,Wa,hr,dr,or,rr,nr,ar,cr,lr,Se],styles:["mat-card[_ngcontent-%COMP%]{max-width:600px;margin:20px auto}mat-card-actions[_ngcontent-%COMP%]{display:flex;gap:8px;padding:16px}.file-info[_ngcontent-%COMP%]{padding:16px}.error-message[_ngcontent-%COMP%]{color:var(--mat-warn-500);padding:8px 16px}.names-input[_ngcontent-%COMP%]{width:100%;margin:16px 0}"]})};var si=class o{static \u0275fac=function(t){return new(t||o)};static \u0275cmp=nt({type:o,selectors:[["app-pdf-tools"]],decls:1,vars:0,template:function(t,i){t&1&&_t(0,"app-pdf-splitter")},dependencies:[Ee],encapsulation:2})};var Qr=class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=Lt({type:o});static \u0275inj=Et({imports:[Xt,Sa.forChild([{path:"",component:si}]),Se,Ee,si]})};export{Qr as PdfToolsModule};
